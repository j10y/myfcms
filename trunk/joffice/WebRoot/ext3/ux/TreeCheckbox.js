Ext.override(Ext.tree.TreeNodeUI,{grayedValue:null,onDisableChange:function(a,b){this.disabled=b;this[b?"addClass":"removeClass"]("x-tree-node-disabled");},initEvents:function(){this.node.on("move",this.onMove,this);if(this.node.disabled){this.disabled=true;this.addClass("x-tree-node-disabled");}if(this.node.hidden){this.hide();}var b=this.node.getOwnerTree();var a=b.enableDD||b.enableDrag||b.enableDrop;if(a&&(!this.node.isRoot||b.rootVisible)){Ext.dd.Registry.register(this.elNode,{node:this.node,handles:this.getDDHandles(),isHandle:false});}},onDblClick:function(a){a.preventDefault();if(this.disabled){return;}if(!this.animating&&this.node.isExpandable()&&!a.getTarget(".x-tree-checkbox",1)){this.node.toggle();}this.fireEvent("dblclick",this.node,a);},onCheckChange:function(){var a=this.isChecked();if(a!==this.node.attributes.checked){this.node.attributes.checked=a;this.fireEvent("checkchange",this.node,a);}},toggleCheck:function(b){var a=this.checkbox;if(!a){return false;}if(b===undefined){b=this.isChecked()===false;}if(b===true){Ext.fly(a).replaceClass("x-tree-node-grayed","x-tree-node-checked");}else{if(b!==false){Ext.fly(a).replaceClass("x-tree-node-checked","x-tree-node-grayed");}else{Ext.fly(a).removeClass(["x-tree-node-checked","x-tree-node-grayed"]);}}this.onCheckChange();return b;},onCheckboxClick:function(){if(!this.disabled){this.toggleCheck();}},onCheckboxOver:function(){this.addClass("x-tree-checkbox-over");},onCheckboxOut:function(){this.removeClass("x-tree-checkbox-over");},onCheckboxDown:function(){this.addClass("x-tree-checkbox-down");},onCheckboxUp:function(){this.removeClass("x-tree-checkbox-down");},renderElements:function(e,j,i,k){this.indentMarkup=e.parentNode?e.parentNode.ui.getChildIndent():"";var f=j.checked!==undefined;var c=j.href?j.href:Ext.isGecko?"":"#";var d=['<li class="x-tree-node"><div ext:tree-node-id="',e.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',j.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',j.icon||this.emptyIcon,'" class="x-tree-node-icon',(j.icon?" x-tree-node-inline-icon":""),(j.iconCls?" "+j.iconCls:""),'" unselectable="on" />',f?('<img src="'+this.emptyIcon+'" class="x-tree-checkbox'+(j.checked===true?" x-tree-node-checked":(j.checked!==false?" x-tree-node-grayed":""))+'" />'):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',c,'" tabIndex="1" ',j.hrefTarget?' target="'+j.hrefTarget+'"':"",'><span unselectable="on">',e.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");var b;if(k!==true&&e.nextSibling&&(b=e.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",b,d);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",i,d);}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var h=this.elNode.childNodes;this.indentNode=h[0];this.ecNode=h[1];this.iconNode=h[2];var g=3;if(f){this.checkbox=h[3];g++;}this.anchor=h[g];this.textNode=h[g].firstChild;},isChecked:function(){return this.checkbox?(Ext.fly(this.checkbox).hasClass("x-tree-node-checked")?true:Ext.fly(this.checkbox).hasClass("x-tree-node-grayed")?this.grayedValue:false):false;},getChecked:function(){return this.node.attributes.checked;}});Ext.override(Ext.tree.TreeEventModel,{initEvents:function(){var a=this.tree.getTreeEl();a.on("click",this.delegateClick,this);if(this.tree.trackMouseOver!==false){a.on("mouseover",this.delegateOver,this);a.on("mouseout",this.delegateOut,this);}a.on("mousedown",this.delegateDown,this);a.on("mouseup",this.delegateUp,this);a.on("dblclick",this.delegateDblClick,this);a.on("contextmenu",this.delegateContextMenu,this);},delegateOver:function(b,a){if(!this.beforeEvent(b)){return;}if(this.lastEcOver){this.onIconOut(b,this.lastEcOver);delete this.lastEcOver;}if(this.lastCbOver){this.onCheckboxOut(b,this.lastCbOver);delete this.lastCbOver;}if(b.getTarget(".x-tree-ec-icon",1)){this.lastEcOver=this.getNode(b);this.onIconOver(b,this.lastEcOver);}else{if(b.getTarget(".x-tree-checkbox",1)){this.lastCbOver=this.getNode(b);this.onCheckboxOver(b,this.lastCbOver);}}if(this.getNodeTarget(b)){this.onNodeOver(b,this.getNode(b));}},delegateOut:function(b,a){if(!this.beforeEvent(b)){return;}var c;if(b.getTarget(".x-tree-ec-icon",1)){c=this.getNode(b);this.onIconOut(b,c);if(c==this.lastEcOver){delete this.lastEcOver;}}else{if(b.getTarget(".x-tree-checkbox",1)){c=this.getNode(b);this.onCheckboxOut(b,c);if(c==this.lastCbOver){delete this.lastCbOver;}}}a=this.getNodeTarget(b);if(a&&!b.within(a,true)){this.onNodeOut(b,this.getNode(b));}},delegateDown:function(b,a){if(!this.beforeEvent(b)){return;}if(b.getTarget(".x-tree-checkbox",1)){this.onCheckboxDown(b,this.getNode(b));}},delegateUp:function(b,a){if(!this.beforeEvent(b)){return;}if(b.getTarget(".x-tree-checkbox",1)){this.onCheckboxUp(b,this.getNode(b));}},delegateClick:function(b,a){if(!this.beforeEvent(b)){return;}if(b.getTarget(".x-tree-checkbox",1)){this.onCheckboxClick(b,this.getNode(b));}else{if(b.getTarget(".x-tree-ec-icon",1)){this.onIconClick(b,this.getNode(b));}else{if(this.getNodeTarget(b)){console.log(this.getNodeTarget(b));this.onNodeClick(b,this.getNode(b));}}}},onCheckboxClick:function(b,a){a.ui.onCheckboxClick();},onCheckboxOver:function(b,a){a.ui.onCheckboxOver();},onCheckboxOut:function(b,a){a.ui.onCheckboxOut();},onCheckboxDown:function(b,a){a.ui.onCheckboxDown();},onCheckboxUp:function(b,a){a.ui.onCheckboxUp();}});Ext.override(Ext.tree.TreePanel,{getChecked:function(b,c){c=c||this.root;var d=[];var e=function(){if(this.ui.getChecked()){d.push(!b?this:(b=="id"?this.id:this.attributes[b]));}};c.cascade(e);return d;}});