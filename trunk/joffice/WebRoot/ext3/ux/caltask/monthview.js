Ext.ECalendar.monthview=function(a){Ext.apply(this,a);this.addEvents("dayClick","beforeMonthChange","afterMonthChange");Ext.ECalendar.monthview.superclass.constructor.call(this);};Ext.extend(Ext.ECalendar.monthview,Ext.util.Observable,{referid:"monthview",header:true,headerUseTpl:false,headerTpl:new Ext.XTemplate('<tpl for=".">{title}-{datetouse:this.formatx}</tpl>',{formatx:function(a){var b=11;return a.format("M-Y");}}),headerData:{title:"Custom header for Month",datetouse:new Date()},headerFormat:"M-Y",headerButtons:true,moreMenuItems:[],dayAction:"viewday",showTaskcount:true,showTaskList:false,showNumTasks:5,task_format:"Y-m-d H:i:s",TaskList_launchEventOn:"click",contextMenuLabels:e2cs.cal_locale.contextMenuLabelsDay,ShowMenuItems:[1,1,1,1,1,1],TaskList_ShowMenuItems:[1,1,1],TaskList_moreMenuItems:[],taskStyle:"margin-top: 10px;",startDay:0,thisview:null,init:function(b,a){this.calx=b;this.datetohandle=a;},render:function(){if(this.calx.loadMask){var a=new Ext.LoadMask(this.calx.id,{removeMask:true,msg:this.calx.customMaskText});a.show();}this.showTaskcount==true?this.showTaskList=false:this.showTaskList=this.showTaskList;var m=new Date(this.calx.currentdate);Date.monthNames=e2cs.cal_locale.monthtitles;Date.dayNames=e2cs.cal_locale.daytitles;if(this.header){var q=this.genHeader(this.datetohandle);}var j=Ext.get(this.calx.body);var u=j.dom.childNodes.length;if(u){for(var r=u;r<u;r++){j.dom.removeChild(j.dom.childNodes[0]);}}j.update("");var g='<div id="'+this.calx.id+'-main-calendar-header"></div>';g+='<div id="'+this.calx.id+'-main-calendar-month-body"></div>';j.update(g);if(this.header){var q=Ext.get(this.calx.id+"-main-calendar-header");var b=q;var k=b.wrap({tag:"div",cls:"x-calendar-month-header",html:""});if(this.headerButtons){var h=k.createChild({id:this.calx.id+"-btn-pm",tag:"div",cls:"x-calendar-month-previous",html:""});var l=k.createChild({id:this.calx.id+"-btn-nm",tag:"div",cls:"x-calendar-month-next",html:""});h.dom["qtip"]=e2cs.cal_locale.headerTooltipsMonth.prev;h.addListener("click",this.onclickprev_month,this);h.addClassOnOver("x-calendar-month-previous-over");l.dom["qtip"]=e2cs.cal_locale.headerTooltipsMonth.next;l.addListener("click",this.onclicknext_month,this);l.addClassOnOver("x-calendar-month-next-over");}if(this.headerUseTpl){var c=this.headerTpl.apply(this.headerData);var x=k.createChild({tag:"div",id:"header",html:""+c+""});}else{var x=k.createChild({tag:"div",id:"header",html:""+m.format(this.headerFormat)+""});}}var d=Ext.get(this.calx.id+"-main-calendar-month-body");var v=this.genDaysHeader();var w=this.genBody(m,{styletasks:this.taskStyle});var o=d.wrap({tag:"div",cls:"x-calendar-month-days",html:""});var e=o.createChild({tag:"div",id:this.calx.id+"-calendar-view-month",cls:"header-days",html:' <table id="'+this.calx.id+'-month_skel" width="100%" border="0" cellspacing="0" cellpadding="0"><tr class="skel_hdrdays" id="'+this.calx.id+'-skel_hdrdays">'+v+"</tr>"+w+"</table>"});Ext.get(this.calx.id+"-skel_hdrdays").setHeight(17);if(Ext.isIE){var t=e.dom.childNodes[0].childNodes[0].rows.length-1;}else{var t=e.dom.childNodes[1].childNodes[0].rows.length-1;}if(this.calx.ownerCt!=undefined){if(this.calx.ownerCt.ctype&&this.calx.ownerCt.ctype=="Ext.Component"){this.calx.height=this.calx.ownerCt.getInnerHeight();}}if(!this.calx.height||this.calx.height=="undefined"){if(this.calx.getEl().dom.offsetParent!=null){var n=this.calx.getEl().dom.offsetParent.clientHeight;}else{var n=0;}if(n==0){n=300;}if(this.header){n+=-27;}if(this.calx.showCal_tbar){n+=-27;}if(this.calx.header){n+=-22;}n+=-16;var s=0;Ext.get(this.calx.id+"-month_skel").setStyle({height:""+n-s+"px"});valtosethtmp=Math.round((n)/t);valtosethtmp+=-3;}else{var n=0;if(this.header){n+=-27;}if(this.calx.showCal_tbar){n+=-27;}if(this.calx.header){n+=-22;}n+=-16;n+=this.calx.height;if(this.calx.showCal_tbar){var s=77;}else{var s=24;}valtosethtmp=Math.round((n)/t);valtosethtmp+=-3;}Ext.get(this.calx.id+"-month_skel").setHeight(n);newsize=n;valtosethtmp=Math.round(newsize/t);var e=Ext.select("td.daybody",true);e.each(function(C,i,z){var B=C;if(B.id==undefined||B==null){var A=C.dom.id;}else{var A=C.id;}if(A.indexOf("m-td-"+this.calx.id+"-")>=0){var y=Ext.get(A);y.setStyle({height:""+valtosethtmp+"px"});y.addClassOnOver("daybody-over");if(Ext.isOpera){y.addListener("mousedown",this.operabuttons,this);}else{y.addListener("click",this.onhandler_day,this);y.addListener("contextmenu",this.oncontextmenu,this,{stopPropagation:true,normalized:true,preventDefault:true});}}},this);if(this.showTaskcount==false&&this.showTaskList==true){var f=Ext.select("div.tasks_list",true);f.each(function(A,i,y){if((A.id.indexOf(this.calx.id)+1)>0){element_id=A.id;testtdobjref=element_id.replace(this.calx.id+"-tasklist-","");objtd=Ext.get("m-td-"+this.calx.id+"-"+testtdobjref);objtdtd={top:objtd.getTop(),heigth:objtd.getHeight()};tmprefdata=0;tmprefdata=Ext.get(element_id).getTop()-objtdtd.top;tmprefdata=tmprefdata+4;var z=0;z=objtdtd.heigth-tmprefdata;Ext.get(element_id).setHeight(z);}},this);var p=Ext.select("div.tasks_list_item",true);p.each(function(z,i,y){if((z.id.indexOf(this.calx.id)+1)>0){test=11;z.addClassOnOver("task_list_item_over");if(this.TaskList_launchEventOn!=""){z.addListener(this.TaskList_launchEventOn,this.onDblClick_tasklistitem,this);}if(Ext.isOpera){z.addListener("mousedown",this.operataskitembuttons,this);}else{z.addListener("contextmenu",this.oncontextmenuTaskitem,this,{stopPropagation:true,normalized:true,preventDefault:true});}}},this);}if(this.calx.loadMask){a.hide();}},refreshView:function(){this.render();},ZoomDay:function(d){var c=new Date(d);var e=this.calx.store.getCount();if(e>0){var g=0;taskstmp=[];for(var b=0;b<e;b++){var a=this.calx.store.getAt(b).data;dateinit=this.calx.store.getAt(b).data[this.calx.fieldsRefer.startdate];dateend=this.calx.store.getAt(b).data[this.calx.fieldsRefer.enddate];checkdates=c.between(new Date(dateinit),new Date(dateend));chkformat=c.format("m/d/Y");test=new Date(dateinit);if(test.format("m/d/Y")==chkformat){checkdates=true;}test=new Date(dateend);if(test.format("m/d/Y")==chkformat){checkdates=true;}if(checkdates){taskstmp[g]=a;g+=1;}}if(g<=0){return false;}}else{return false;}showdata=[];for(var f=0;f<taskstmp.length;f++){showdata[f]=[taskstmp[f][this.calx.fieldsRefer.id],taskstmp[f][this.calx.fieldsRefer.subject],taskstmp[f][this.calx.fieldsRefer.description],taskstmp[f][this.calx.fieldsRefer.startdate],taskstmp[f][this.calx.fieldsRefer.enddate],taskstmp[f][this.calx.fieldsRefer.color]];}var h=new Ext.data.ArrayReader({},[{name:this.calx.fieldsRefer.id,type:"int"},{name:this.calx.fieldsRefer.subject,type:"string"},{name:this.calx.fieldsRefer.description,type:"string"},{name:this.calx.fieldsRefer.startdate,type:"string"},{name:this.calx.fieldsRefer.enddate,type:"string"},{name:this.calx.fieldsRefer.color,type:"string"}]);tmpstore=new Ext.data.Store({reader:h,data:showdata});tmppanel=new Ext.Panel({id:"ecal-more-task-panel",header:false,autoDestroy:true,autoScroll:true,monitorResize:true,border:false,autoWidth:false,autoHeight:false,items:new Ext.DataView({loadingText:e2cs.cal_locale.win_tasks_loading,store:tmpstore,tpl:this.calx.tplTaskZoom,autoWidth:true,autoHeight:true,overClass:"",itemSelector:"",emptyText:e2cs.cal_locale.win_tasks_empty})});var j=new Ext.Window({id:"ecal-win-moretasks",name:"ecal-win-moretasks",title:e2cs.cal_locale.win_month_zoomlabel+" "+c.format(e2cs.cal_locale.win_tasks_format),width:450,height:300,closeAction:"close",resizable:true,resizeHandles:"all",hideBorders:true,maximizable:true,plain:true,modal:true,layout:"fit",iconCls:"x-calendar-more-tasks-win",items:[tmppanel]});j.show();return true;},operabuttons:function(b,c,a){if(Ext.isOpera){if(b.button==0){this.onhandler_day(b,c,a);}if(b.button==2){this.oncontextmenu(b,c,a);}}},oncontextmenu:function(e,f,d){if(Ext.isOpera){if(e.button!=2){return false;}}if(f.className=="tasks_list_item"||f.className=="tasks_list_item task_list_item_over"||f.className.indexOf("task_list_item_over")>0){return false;}if(this.ShowMenuItems[0]!=true&&this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true&&this.ShowMenuItems[3]!=true&&this.ShowMenuItems[4]!=true&&this.ShowMenuItems[5]!=true&&this.moreMenuItems.length<=0){return false;}e.stopEvent();if(f.className=="noday"||f.className=="today"||f.className=="monthday"){var a=new Date(f.id.substring(this.calx.id.length+1));}else{if(f.className=="tasks"){var a=new Date(f.parentNode.firstChild.id.substring(this.calx.id.length+1));}else{if(f.id.indexOf("-tasklist-")>0){tmpdata=f.id.replace(this.calx.id+"-tasklist-","");var a=new Date(tmpdata+"");}else{var a=new Date(f.firstChild.id.substring(this.calx.id.length+1));}}}if(this.menu){this.menu.removeAll();}this.menu=new Ext.menu.Menu({id:this.calx.id+"-contextmenu-month",shadow:true,items:[{id:this.calx.id+"-month_ctxbtn_task",iconCls:"x-calendar-month-btnmv_task",text:e2cs.cal_locale.contextMenuLabelsMonth.task+" ("+a.format(this.calx.dateformat)+")",scope:this},"-",{id:this.calx.id+"-month_ctxbtn_nextmonth",iconCls:"x-calendar-month-btnmv_nextmth",text:e2cs.cal_locale.contextMenuLabelsMonth.gonextmonth,scope:this},{id:this.calx.id+"-month_ctxbtn_prevmonth",iconCls:"x-calendar-month-btnmv_prevmth",text:e2cs.cal_locale.contextMenuLabelsMonth.goprevmonth,scope:this},"-",{id:this.calx.id+"-month_ctxbtn_viewweek",iconCls:"x-calendar-month-btnmv_viewweek",text:e2cs.cal_locale.contextMenuLabelsMonth.chgwview,scope:this},{id:this.calx.id+"-month_ctxbtn_viewday",iconCls:"x-calendar-month-btnmv_viewday",text:e2cs.cal_locale.contextMenuLabelsMonth.chgdview,scope:this},{id:this.calx.id+"-month_ctxbtn_viewsched",iconCls:"x-calendar-month-btnmv_viewsched",text:e2cs.cal_locale.contextMenuLabelsMonth.chgsview,scope:this}]});if(this.moreMenuItems.length>0){this.menu.add("-");for(var c=0;c<this.moreMenuItems.length;c++){var b=this.moreMenuItems[c].id;this.moreMenuItems[c].rendered=false;this.moreMenuItems[c].addListener("click",function(g){this.onCustomMenuAction(g.id,Ext.get(f),this);},this);this.menu.add(this.moreMenuItems[c]);}}this.menu.items.items[0].addListener("click",function(){this.onTaskAdd(Ext.get(f),this);},this);this.menu.items.items[2].addListener("click",function(){this.onclicknext_month();},this);this.menu.items.items[3].addListener("click",function(){this.onclickprev_month();},this);this.menu.items.items[5].addListener("click",function(){this.changeCalview(Ext.get(f),this,1);},this);this.menu.items.items[6].addListener("click",function(){this.changeCalview(Ext.get(f),this,2);},this);this.menu.items.items[7].addListener("click",function(){this.changeCalview(Ext.get(f),this,3);},this);if(this.ShowMenuItems[0]!=true){this.menu.items.items[0].hidden=true;this.menu.items.items[1].hidden=true;}if(this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true&&this.ShowMenuItems[3]!=true&&this.ShowMenuItems[4]!=true&&this.ShowMenuItems[5]!=true){this.menu.items.items[1].hidden=true;}if(this.ShowMenuItems[1]!=true){this.menu.items.items[2].hidden=true;}if(this.ShowMenuItems[2]!=true){this.menu.items.items[3].hidden=true;}if(this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true){this.menu.items.items[4].hidden=true;}if(this.ShowMenuItems[3]!=true){this.menu.items.items[5].hidden=true;}if(this.ShowMenuItems[4]!=true){this.menu.items.items[6].hidden=true;}if(this.ShowMenuItems[5]!=true){this.menu.items.items[7].hidden=true;}if(this.ShowMenuItems[3]==false&&this.ShowMenuItems[4]==false&&this.ShowMenuItems[5]==false){if(this.moreMenuItems.length>0){this.menu.items.items[8].hidden=true;}}if(!this.calx.dview){this.menu.items.items[6].hidden=true;}if(!this.calx.wview){this.menu.items.items[5].hidden=true;}if(!this.calx.sview){this.menu.items.items[7].hidden=true;}if(this.menu.items.items[5].hidden&&this.menu.items.items[6].hidden&&this.menu.items.items[7].hidden){if(this.moreMenuItems.length>0){this.menu.items.items[8].hidden=true;}}this.menu.on("hide",this.onContextHide,this);this.menu.showAt([e.getPageX(),e.getPageY()]);},onCustomMenuAction:function(d,a,e){var b=[];var c=Ext.get(a);if(a.dom.className=="noday"||a.dom.className=="today"||a.dom.className=="monthday"){b[0]=Ext.get(a).dom.id.substring(this.calx.id.length+1);b[1]=Ext.get(a).getAttributeNS("tag","class");}else{if(a.dom.className=="tasks"){b[0]=Ext.get(a).dom.parentNode.firstChild.id.substring(this.calx.id.length+1);b[1]=Ext.get(a.dom.parentNode.firstChild).getAttributeNS("tag","class");}else{b[0]=Ext.get(a).dom.firstChild.id.substring(this.calx.id.length+1);b[1]=Ext.get(a.dom.firstChild).getAttributeNS("tag","class");}}this.calx.fireEvent("customMenuAction",d,"month",b,a,this);},changeCalview:function(c,d,b){if(c.dom.className=="noday"||c.dom.className=="today"||c.dom.className=="monthday"){var a=new Date(c.id.substring(this.calx.id.length+1));}else{if(c.dom.className=="tasks"){var a=new Date(c.dom.parentNode.firstChild.id.substring(this.calx.id.length+1));}else{var a=new Date(c.dom.firstChild.id.substring(this.calx.id.length+1));}}if(b==1){varview="week";}else{if(b==2){varview="day";}else{varview="schedule";}}this.calx.changeView(varview);},onTaskAdd:function(b,c){if(b.dom.className=="noday"||b.dom.className=="today"||b.dom.className=="monthday"){var a=new Date(b.id.substring(this.calx.id.length+1));}else{if(b.dom.className=="tasks"){var a=new Date(b.dom.parentNode.firstChild.id.substring(this.calx.id.length+1));}else{if(b.dom.className=="tasks_list_item"||b.dom.className=="tasks_list_item task_list_item_over"||b.dom.className.indexOf("task_list_item_over")>0){tmpdata=b.id.replace(this.calx.id+"-tasklist-","");a=new Date(tmpdata+"");}else{if(b.dom.className=="tasks_list"){tmpdata=b.id.replace(this.calx.id+"-tasklist-","");var a=new Date(tmpdata+"");}else{if(b.dom.className=="daybody"){tmpdata=b.id.replace("m-td-"+this.calx.id+"-","");a=new Date(tmpdata+"");}else{var a=new Date(b.dom.firstChild.id.substring(this.calx.id.length+1));}}}}}this.calx.fireEvent("taskAdd",a);},onContextHide:function(){},operataskitembuttons:function(l,d,m){if(Ext.isOpera){l.stopEvent();var a=Ext.get(d.id);var n=this.TaskList_ShowMenuItems;var b=this.TaskList_moreMenuItems;var f=[];var k=this.getTaskarray(a);var c=this.calx.fireEvent("beforeContextMenuTask","monthview-task",k,n,f);if(c==false){if(f[0]==false){if(f[1]==true){if(f[2]==true){var b=f[3];}var n=f[4];}else{var b=this.TaskList_moreMenuItems;var n=this.TaskList_ShowMenuItems;}}else{return false;}}else{var b=this.TaskList_moreMenuItems;}var g=d.id.replace(this.calx.id+"-tasklist-","");if(this.taskitem_menu){this.taskitem_menu.removeAll();}this.taskitem_menu=new Ext.menu.Menu({ignoreParentClicks:true,shadow:false,items:[{id:"month_tskitem_btn_task-add",iconCls:"x-calendar-day-btnmv_add",text:this.contextMenuLabels.taskAdd,scope:this},{id:"month_tskitem_btn_task-delete",iconCls:"x-calendar-day-btnmv_delete",text:this.contextMenuLabels.taskDelete,scope:this},"-",{id:"month_tskitem_btn_task-edit",iconCls:"x-calendar-day-btnmv_task",text:this.contextMenuLabels.taskEdit+a.getAttributeNS("tag","ec_subject"),scope:this}]});if(b.length>0){this.taskitem_menu.add("-");for(var e=0;e<b.length;e++){b[e].rendered=false;if(b[e].menu==undefined){if(b[e].ctype=="Ext.menu.Item"){b[e].rendered=false;b[e].addListener("click",function(o,i){this.onCustomMenuAction_TaskItem(o.id,Ext.get(d),this);},this);}else{var j=11;}this.taskitem_menu.add(b[e]);}else{b[e].menu.rendered=false;for(var h=0;h<b[e].menu.items.length;h++){b[e].menu.items.items[h].rendered=false;if(b[e].menu.items.items[h].ctype=="Ext.menu.Item"){b[e].menu.items.items[h].addListener("click",function(o,i){this.onCustomMenuAction_TaskItem(o.id,Ext.get(d),this);},this);}else{}}this.taskitem_menu.add(b[e]);}}}this.taskitem_menu.items.items[0].addListener("click",function(){this.onActionTask(1,Ext.get(d),this);},this);this.taskitem_menu.items.items[1].addListener("click",function(){this.onActionTask(2,Ext.get(d),this);},this);this.taskitem_menu.items.items[3].addListener("click",function(){this.onActionTask(3,Ext.get(d),this);},this);if(n[0]!=true){this.taskitem_menu.items.items[0].hidden=true;}if(n[1]!=true){this.taskitem_menu.items.items[1].hidden=true;}if(n[0]!=true&&n[1]!=true){this.taskitem_menu.items.items[2].hidden=true;}if(n[2]!=true){this.taskitem_menu.items.items[3].hidden=true;}this.taskitem_menu.on("hide",this.onContextHide_Taskitem,this);this.taskitem_menu.showAt(l.xy);}},onDblClick_tasklistitem:function(c,d,b){test=d.id.indexOf(this.calx.id+"-mtask-item-")+1;if(test){var a=this.getTaskarray(d);this.calx.fireEvent("taskDblClick",a,this,this.calx,"month");}},oncontextmenuTaskitem:function(k,d,l){if(Ext.isOpera){if(k.button!=2){return false;}}k.stopEvent();if(this.TaskList_ShowMenuItems[0]!=true&&this.TaskList_ShowMenuItems[1]!=true&&this.TaskList_ShowMenuItems[2]!=true&&this.TaskList_moreMenuItems.length<=0){return false;}var a=Ext.get(d.id);var m=this.TaskList_ShowMenuItems;var b=this.TaskList_moreMenuItems;var f=[];var j=this.getTaskarray(a);var c=this.calx.fireEvent("beforeContextMenuTask","monthview-task",j,m,f);if(c==false){if(f[0]==false){if(f[1]==true){if(f[2]==true){var b=f[3];}var m=f[4];}else{var b=this.TaskList_moreMenuItems;var m=this.TaskList_ShowMenuItems;}}else{return false;}}else{var b=this.TaskList_moreMenuItems;}var g=d.id.replace(this.calx.id+"-tasklist-","");if(this.taskitem_menu){this.taskitem_menu.removeAll();}this.taskitem_menu=new Ext.menu.Menu({allowOtherMenus:true,shadow:true,items:[{id:"month_tskitem_btn_task-add",iconCls:"x-calendar-day-btnmv_add",text:this.contextMenuLabels.taskAdd,scope:this},{id:"month_tskitem_btn_task-delete",iconCls:"x-calendar-day-btnmv_delete",text:this.contextMenuLabels.taskDelete,scope:this},"-",{id:"month_tskitem_btn_task-edit",iconCls:"x-calendar-day-btnmv_task",text:this.contextMenuLabels.taskEdit+a.getAttributeNS("tag","ec_subject"),scope:this}]});if(b.length>0){this.taskitem_menu.add("-");for(var e=0;e<b.length;e++){b[e].rendered=false;if(b[e].menu==undefined){b[e].rendered=false;if(b[e].ctype=="Ext.menu.Item"){b[e].rendered=false;b[e].addListener("click",function(n,i){this.onCustomMenuAction_TaskItem(n.id,Ext.get(d),this);},this);}else{}this.taskitem_menu.add(b[e]);}else{this.taskitem_menu.addMenuItem({iconCls:b[e].iconCls,text:b[e].text,menu:b[e].menu});for(var h=0;h<b[e].menu.items.length;h++){b[e].menu.items.items[h].rendered=false;if(b[e].menu.items.items[h].ctype=="Ext.menu.Item"){b[e].menu.items.items[h].addListener("click",function(n,i){this.onCustomMenuAction_TaskItem(n.id,Ext.get(d),this);},this);}else{}}}}}this.taskitem_menu.items.items[0].addListener("click",function(){this.onActionTask(1,Ext.get(d),this);},this);this.taskitem_menu.items.items[1].addListener("click",function(){this.onActionTask(2,Ext.get(d),this);},this);this.taskitem_menu.items.items[3].addListener("click",function(){this.onActionTask(3,Ext.get(d),this);},this);if(m[0]!=true){this.taskitem_menu.items.items[0].hidden=true;}if(m[1]!=true){this.taskitem_menu.items.items[1].hidden=true;}if(m[0]!=true&&m[1]!=true){this.taskitem_menu.items.items[2].hidden=true;}if(m[2]!=true){this.taskitem_menu.items.items[3].hidden=true;if(b.length>0){this.taskitem_menu.items.items[4].hidden=true;}}this.taskitem_menu.on("hide",this.onContextHide_Taskitem,this);this.taskitem_menu.showAt(k.xy);},onActionTask:function(e,g,f){this.taskitem_menu.hide();var b=this.getTaskarray(g);switch(e){case 1:if(g.id.indexOf("-mtask-item-")>0){var d=g.id.replace(this.calx.id+"-mtask-item-","");}else{if(g.id.indexOf("-tasklist-")>0){var d=g.id.replace(this.calx.id+"-tasklist-","");}}d=d.substr(0,10);var c=new Date(d);this.calx.fireEvent("taskAdd",c);break;case 2:var a=this.calx.fireEvent("beforeTaskDelete",b,this);if(a){if(this.calx.fireEvent("onTaskDelete",b)==true){this.calx.fireEvent("afterTaskDelete",b,true);}else{this.calx.fireEvent("afterTaskDelete",null,false);}}break;case 3:var a=this.calx.fireEvent("beforeTaskEdit",b,this);if(a){if(this.calx.fireEvent("onTaskEdit",b)==true){this.calx.fireEvent("afterTaskEdit",b,true);}else{this.calx.fireEvent("afterTaskEdit",null,false);}}break;default:break;}},onCustomMenuAction_TaskItem:function(b,d,c){var a=this.getTaskarray(d);this.calx.fireEvent("customMenuAction",b,"month",a,d,this);this.taskitem_menu.hide();},onContextHide_Taskitem:function(a){},onhandler_day:function(d,e,c){if(e.className=="noday"||e.className=="today"||e.className=="monthday"){var a=new Date(e.id.substring(this.calx.id.length+1));}else{if(e.className=="tasks"){var a=new Date(e.parentNode.firstChild.id.substring(this.calx.id.length+1));}else{if(e.className=="tasks_list_item"||e.className=="tasks_list"||e.className=="tasks_list_item task_list_item_over"||e.className.indexOf("task_list_item_over")>0){var b=11;}else{var a=new Date(e.firstChild.id.substring(this.calx.id.length+1));}}}if(e.className=="tasks_list_item"||e.className=="tasks_list"||e.className=="tasks_list_item task_list_item_over"||e.className.indexOf("task_list_item_over")>0){var b=11;}else{if(this.dayAction=="viewday"){if(this.calx.fireEvent("beforeChangeView","day",this.calx.currentView,this.calx)==false){return false;}else{this.calx.currentdate=a;this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);this.calx.currentView="day";this.calx.viewday.render();this.calx.fireEvent("onChangeView","day","month",this);}}if(this.dayAction=="event"){this.fireEvent("dayClick",a,this,this.calx);}if(this.dayAction=="window"){this.ZoomDay(a);}}},onclickprev_month:function(){var b=this.calx.currentdate.add(Date.MONTH,-1);var a=this.fireEvent("beforeMonthChange",this.calx.currentdate,b);if(a){this.calx.currentdate=b;this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);this.render();this.fireEvent("afterMonthChange",b);}},onclicknext_month:function(){var b=this.calx.currentdate.add(Date.MONTH,1);var a=this.fireEvent("beforeMonthChange",this.calx.currentdate,b);if(a){this.calx.currentdate=b;this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);this.render();this.fireEvent("afterMonthChange",b);}},genHeader:function(c){var b=new Date(c);Date.monthNames=e2cs.cal_locale.monthtitles;var a='<div class="x-calendar-month-header" style="width:'+(this.calx.width-10)+'px;">';a+='<div id="header">'+b.format(this.headerFormat)+"</div>";if(this.headerButtons){a+='<div class="x-calendar-month-previous"></div>';a+='<div class="x-calendar-month-next"></div>';}a+="</div>";return a;},genDaysHeader:function(){var b="";for(var a=0;a<e2cs.cal_locale.daytitles.length;a++){var c=this.startDay+a;if(c>6){c=c-7;}b+='<td width="14%"><div class="dayheader">'+e2cs.cal_locale.daytitles[c]+"</div></td>";}return b;},getDateRangeOfMonth:function(f){var b=new Date(f);var k=b.getFirstDayOfMonth()-this.startDay;var j=b.getDaysInMonth();if(b.getMonth()==1){if((b.getFullYear()%4==0&&b.getFullYear()%100!=0)||b.getFullYear()%400==0){j=29;}}if(k<0){k=7+(k);}var i=new Date((f.getMonth()+1)+"/1/"+f.getFullYear()).add(Date.DAY,(k*-1));var g=k;startmonthdate=new Date(b.format("m")+"/01/"+b.format("Y"));for(var h=0;h<j;h++){if(g>=7){g=0;}var c=new Date(startmonthdate).add(Date.DAY,h);g+=1;}var n=new Date((f.getMonth()+1)+"/1/"+f.getFullYear()).add(Date.DAY,(j));var d=n.getDay();if(g<7){var m=0;for(var e=g;e<7;e++){m=m+1;var a=new Date(c).add(Date.DAY,m);}}var l=[i,a];return l;},genBody:function(h,m){var b=new Date(h);var k=b.getFirstDayOfMonth()-this.startDay;var j=b.getDaysInMonth();var f=0;if(b.getMonth()==1){if((b.getFullYear()%4==0&&b.getFullYear()%100!=0)||b.getFullYear()%400==0){j=29;}}var d="<tr>";if(k<0){k=7+(k);}if(k!=0){for(var c=(k);c>0;c--){writedt=new Date((h.getMonth()+1)+"/1/"+h.getFullYear()).add(Date.DAY,(c*-1));d+='<td valign="top" id="m-td-'+this.calx.id+"-"+writedt.format("m/d/Y")+'" class="daybody">';d+='<div class="noday" id="'+this.calx.id+"-"+writedt.format("m/d/Y")+'">'+writedt.format("j-M")+"</div>";if(this.showTaskcount){tmptasks=this.getCountTask(writedt,this.calx.store);if(tmptasks>0){d+='<div class="tasks" style="'+m.styletasks+'">'+e2cs.cal_locale.labelforTasksinMonth+" ("+tmptasks+")</div>";}}else{if(this.showTaskList){var g=this.getTaskList(writedt,this.calx.store);if(g!=""){d+='<div class="tasks_list" id="'+this.calx.id+"-tasklist-"+writedt.format("m/d/Y")+'" style="height:5px;'+m.styletasks+'">';d+=g;d+="</div>";}}}d+="</td>";}}icount=k;f=1;startmonthdate=new Date(b.format("m")+"/01/"+b.format("Y"));for(var i=0;i<j;i++){if(icount>=7){icount=0;d+="</tr><tr>";f+=1;}var e=new Date(startmonthdate).add(Date.DAY,i);if(e.format("m/d/Y")==b.format("m/d/Y")){d+='<td valign="top" id="m-td-'+this.calx.id+"-"+e.format("m/d/Y")+'" class="daybody" height="10px">';d+='<div class="today" id="'+this.calx.id+"-"+e.format("m/d/Y")+'">'+e.format("j")+"</div>";if(this.showTaskcount){tmptasks=this.getCountTask(e,this.calx.store);if(tmptasks>0){d+='<div class="tasks" style="'+m.styletasks+'">'+e2cs.cal_locale.labelforTasksinMonth+" ("+tmptasks+")</div>";}}else{if(this.showTaskList){var g=this.getTaskList(e,this.calx.store);if(g!=""){d+='<div class="tasks_list" id="'+this.calx.id+"-tasklist-"+e.format("m/d/Y")+'" style="height:5px;'+m.styletasks+'">';d+=g;d+="</div>";}}}d+="</td>";}else{d+='<td valign="top" id="m-td-'+this.calx.id+"-"+e.format("m/d/Y")+'" class="daybody" height="10px">';d+='<div class="monthday" id="'+this.calx.id+"-"+e.format("m/d/Y")+'">'+e.format("j")+"</div>";if(this.showTaskcount){tmptasks=this.getCountTask(e,this.calx.store);if(tmptasks>0){d+='<div class="tasks" style="'+m.styletasks+'">'+e2cs.cal_locale.labelforTasksinMonth+" ("+tmptasks+")</div>";}}else{if(this.showTaskList){var g=this.getTaskList(e,this.calx.store);if(g!=""){d+='<div class="tasks_list" id="'+this.calx.id+"-tasklist-"+e.format("m/d/Y")+'" style="height:5px;'+m.styletasks+'">';d+=g;d+="</div>";}}}d+="</td>";}icount+=1;}if(icount<7){var l=0;for(var c=icount;c<7;c++){l=l+1;var a=new Date(e).add(Date.DAY,l);d+='<td valign="top"   id="m-td-'+this.calx.id+"-"+a.format("m/d/Y")+'" class="daybody" height="10px">';d+='<div class="noday" id="'+this.calx.id+"-"+a.format("m/d/Y")+'">'+a.format("j-M")+"</div>";if(this.showTaskcount){tmptasks=this.getCountTask(a,this.calx.store);if(tmptasks>0){d+='<div class="tasks" style="'+m.styletasks+'">'+e2cs.cal_locale.labelforTasksinMonth+" ("+tmptasks+")</div>";}}else{if(this.showTaskList){var g=this.getTaskList(a,this.calx.store);if(g!=""){d+='<div class="tasks_list" id="'+this.calx.id+"-tasklist-"+a.format("m/d/Y")+'" style="height:5px;'+m.styletasks+'">';d+=g;d+="</div>";}}}d+="</td>";}}d+="</tr>";return d;},getCountTask:function(f,e){var a=e.getCount();if(a>0){var g=0;for(var b=0;b<a;b++){dateinit=e.getAt(b).data[this.calx.fieldsRefer.startdate];dateend=e.getAt(b).data[this.calx.fieldsRefer.enddate];checkdates=f.between(new Date(dateinit),new Date(dateend));chkformat=f.format("m/d/Y");test=new Date(dateinit);if(test.format("m/d/Y")==chkformat){checkdates=true;}test=new Date(dateend);if(test.format("m/d/Y")==chkformat){checkdates=true;}var d=new Date(dateinit);var c=new Date(dateend);if(d<f&&c>f){checkdates=true;}if(checkdates){g+=1;}}return g;}else{return 0;}},getTaskList:function(b,i){var o="";var e=i.getCount();if(e>0){var g=0;for(var a=0;a<e;a++){dateinit=i.getAt(a).data[this.calx.fieldsRefer.startdate];dateend=i.getAt(a).data[this.calx.fieldsRefer.enddate];checkdates=b.between(new Date(dateinit),new Date(dateend));chkformat=b.format("m/d/Y");test=new Date(dateinit);if(test.format("m/d/Y")==chkformat){checkdates=true;}test=new Date(dateend);if(test.format("m/d/Y")==chkformat){checkdates=true;}var h=new Date(dateinit);var d=new Date(dateend);if(h<b&&d>b){checkdates=true;}if(checkdates){if(g<this.showNumTasks){var n=new Date(i.getAt(a).data[this.calx.fieldsRefer.startdate]);var c=n.format(this.task_format);tmpdateb=new Date(i.getAt(a).data[this.calx.fieldsRefer.enddate]);var m=tmpdateb.format(this.task_format);var k=i.getAt(a).data[this.calx.fieldsRefer.description];var j=k;if(k.length>this.calx.tipmaxLength){var j=k.substring(0,this.calx.tipmaxLength)+"...";}o+='<div class="tasks_list_item"';o+='style="background-color:'+i.getAt(a).data[this.calx.fieldsRefer.color]+'" ';o+='id="'+this.calx.id+"-mtask-item-"+chkformat+"-"+i.getAt(a).data[this.calx.fieldsRefer.id]+'" ';o+='ec_id="'+i.getAt(a).data[this.calx.fieldsRefer.id]+'" ';o+='ec_starts="'+c+'" ';o+='ec_ends="'+m+'" ';o+='ec_subject="'+i.getAt(a).data[this.calx.fieldsRefer.subject]+'" ';o+='ec_cnt="'+j+'" ';o+='ec_storeindex="'+a+'" ';o+='ec_location="'+i.getAt(a).data[this.calx.fieldsRefer.location]+'" ';o+='ec_allday="'+i.getAt(a).data[this.calx.fieldsRefer.alldaytask]+'" ';o+='ec_isholiday="'+i.getAt(a).data[this.calx.fieldsRefer.isHoliday]+'" ';o+=' ext:qtitle="'+i.getAt(a).data[this.calx.fieldsRefer.subject]+'" ';var f={starxl:e2cs.cal_locale.task_qtip_starts,startval:c,endxl:e2cs.cal_locale.task_qtip_ends,endval:m,details:j,color:i.getAt(a).data[this.calx.fieldsRefer.color],location:i.getAt(a).data[this.calx.fieldsRefer.location]};var l=this.calx.tplTaskTip.apply(f);o+='ext:qtip="'+l+'">';o+=i.getAt(a).data[this.calx.fieldsRefer.subject]+"</div>";g+=1;}}}return o;}else{return 0;}},getTaskarray:function(a){var c=Ext.get(a);var b=[];b[0]=c.getAttributeNS("tag","id");b[1]=c.getAttributeNS("tag","ec_id");b[2]=c.getAttributeNS("tag","ec_subject");b[3]=c.getAttributeNS("tag","ec_starts");b[4]=c.getAttributeNS("tag","ec_ends");b[5]=c.getAttributeNS("tag","ec_cnt");b[6]=c.getAttributeNS("tag","ec_storeindex");b[7]=c.getAttributeNS("tag","ec_location");b[8]=c.getAttributeNS("tag","ec_allday");b[9]=c.getAttributeNS("tag","ec_isholiday");return b;}});