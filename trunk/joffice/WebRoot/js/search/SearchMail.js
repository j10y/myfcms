Ext.ns("SearchMail");var SearchMail=function(a){return this.getView(a);};SearchMail.prototype.getView=function(a){return new Ext.Panel({id:"SearchMail",title:"搜索邮件",iconCls:"menu-mail_box",border:false,style:"padding-bottom:20px;",autoScroll:true,items:[{region:"center",anchor:"100%",items:[new Ext.FormPanel({id:"ALLMailSearchForm",height:40,frame:false,border:false,layout:"hbox",layoutConfig:{padding:"5",align:"middle"},defaults:{xtype:"label",margins:{top:0,right:4,bottom:4,left:4}},items:[{text:"请输入条件:"},{xtype:"textfield",name:"searchContent",width:150},{xtype:"button",text:"查询",iconCls:"search",handler:function(){var b=Ext.getCmp("ALLMailSearchForm");var c=Ext.getCmp("SearchMailGrid");if(b.getForm().isValid()){b.getForm().submit({waitMsg:"正在提交查询",url:__ctxPath+"/info/searchMail.do",success:function(e,f){var d=Ext.util.JSON.decode(f.response.responseText);c.getStore().loadData(d);}});}}},{xtype:"button",text:"重置",iconCls:"reset",handler:function(){var b=Ext.getCmp("ALLMailSearchForm");b.getForm().reset();}}]}),this.setup(a)]}]});};SearchMail.prototype.setup=function(a){return this.grid(a);};SearchMail.prototype.grid=function(d){var e=new Ext.ux.grid.RowExpander({tpl:new Ext.Template('<p style="padding:5px 5px 5px 62px;"><b>内容摘要:</b> {content}</p>')});var a=new Ext.grid.ColumnModel({columns:[new Ext.grid.RowNumberer(),e,{header:"mailId",dataIndex:"mailId",hidden:true},{header:"优先级",dataIndex:"importantFlag",width:55,renderer:function(i,h,f,k,g){var j="";if(i==2){j+='<img title="重要" src="'+__ctxPath+'/images/flag/mail/important.png"/>';}else{if(i==3){j+='<img title="非常重要" src="'+__ctxPath+'/images/flag/mail/veryImportant.png"/>';}else{j+='<img title="一般" src="'+__ctxPath+'/images/flag/mail/common.png"/>';}}return j;}},{header:"阅读",dataIndex:"mailStatus",width:40,renderer:function(i,h,f,k,g){var j="";if(i!=0){if(f.data.readFlag==0){j+='<img title="未读" src="'+__ctxPath+'/images/flag/mail/mail.png"/>';}else{j+='<img title="已读" src="'+__ctxPath+'/images/flag/mail/mail_open.png"/>';}}else{j+='<img title="草稿" src="'+__ctxPath+'/images/flag/mail/mail_draft.png"/>';}return j;}},{header:"附件",dataIndex:"fileIds",width:40,renderer:function(i,h,f,k,g){var j="";if(i!=""){j+='<img title="附件" src="'+__ctxPath+'/images/flag/attachment.png"/>';}return j;}},{header:"回复",dataIndex:"replyFlag",width:40,renderer:function(i,h,f,k,g){var j="";if(i==1){j+='<img title="已回复" src="'+__ctxPath+'/images/flag/mail/replyed.png" style="background: white;"/>';}return j;}},{header:"邮件主题",dataIndex:"subject",width:150},{header:"发件人",dataIndex:"sender",width:80},{header:"收件人",dataIndex:"recipientNames",width:80,renderer:function(f){if(f!=""){return f;}else{return"(收信人未写)";}}},{header:"发信时间",width:80,dataIndex:"sendTime",renderer:function(f){return f.substring(0,10);}}],defaults:{sortable:true,menuDisabled:false,width:100}});var b=this.store();b.load({params:{start:0,limit:25,searchContent:d}});var c=new Ext.grid.GridPanel({id:"SearchMailGrid",autoWidth:true,border:false,autoHeight:true,store:b,plugins:e,trackMouseOver:true,disableSelection:false,loadMask:true,cm:a,viewConfig:{forceFit:true,enableRowBody:false,showPreview:false},bbar:new Ext.PagingToolbar({pageSize:25,store:b,displayInfo:true,displayMsg:"当前显示从{0}至{1}， 共{2}条记录",emptyMsg:"当前没有记录"})});c.addListener("rowdblclick",function(f,h,g){f.getSelectionModel().each(function(i){SearchMail.detail(i.data.mailId,i.data.boxId,i.data.mailStatus,h);});});return c;};SearchMail.prototype.store=function(){var a=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/communicate/searchMail.do"}),reader:new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",id:"id",fields:[{name:"boxId",type:"int"},{name:"mailId",type:"int"},{name:"delFlag",type:"int"},{name:"readFlag",type:"int"},{name:"replyFlag",type:"int"},"importantFlag","mailStatus","sendTime","fileIds","subject","recipientNames","content","sender"]}),remoteSort:true});a.setDefaultSort("boxId","desc");return a;};SearchMail.detail=function(e,k,f,j){var h=new SearchMail.centerViewToolbar(e,k,j);if(f==0){var d=Ext.getCmp("centerTabPanel");var c=Ext.getCmp("MailForm");if(c==null){c=new MailForm(e,k,"draft");d.add(c);d.activate(c);}else{d.remove(c);c=new MailForm(e,k,"draft");d.add(c);d.activate(c);}}else{var g=Ext.getCmp("SearchMail");var a=Ext.getCmp("SearchMailGrid");var b=Ext.getCmp("ALLMailSearchForm");a.hide();b.hide();var i=new Ext.Panel({id:"HomeShowMailDetail",border:false,tbar:h,autoLoad:{url:__ctxPath+"/communicate/getMail.do?",params:{mailId:e,boxId:k},method:"Post"}});g.add(i);g.doLayout();}};SearchMail.centerViewToolbar=function(a,c,d){var b=new Ext.Toolbar({height:30,defaultType:"button",bodyStyle:"text-align:left",items:[{iconCls:"btn-mail_back",text:"返回",handler:function(){var e=Ext.getCmp("SearchMail");e.remove("HomeShowMailDetail");var g=Ext.getCmp("SearchMailGrid");var f=Ext.getCmp("ALLMailSearchForm");g.show();f.show();e.doLayout();}},{iconCls:"btn-mail_reply",text:"回复",handler:function(){var e=Ext.getCmp("centerTabPanel");var f=Ext.getCmp("MailForm");if(f==null){f=new MailForm(a,c,"reply");e.add(f);e.activate(f);}else{e.remove(f);f=new MailForm(a,c,"reply");e.add(f);e.activate(f);}}},{iconCls:"btn-mail_resend",text:"转发",handler:function(){var e=Ext.getCmp("centerTabPanel");var f=Ext.getCmp("MailForm");if(f==null){f=new MailForm(a,c,"forward");e.add(f);e.activate(f);}else{e.remove(f);f=new MailForm(a,c,"forward");e.add(f);e.activate(f);}}}]});return b;};