var FCKIndentCommand=function(a,b){this.Name=a;this.Offset=b;this.IndentCSSProperty=FCKConfig.ContentLangDirection.IEquals("ltr")?"marginLeft":"marginRight";};FCKIndentCommand._InitIndentModeParameters=function(){if(FCKConfig.IndentClasses&&FCKConfig.IndentClasses.length>0){this._UseIndentClasses=true;this._IndentClassMap={};for(var a=0;a<FCKConfig.IndentClasses.length;a++){this._IndentClassMap[FCKConfig.IndentClasses[a]]=a+1;}this._ClassNameRegex=new RegExp("(?:^|\\s+)("+FCKConfig.IndentClasses.join("|")+")(?=$|\\s)");}else{this._UseIndentClasses=false;}};FCKIndentCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var b=new FCKDomRange(FCK.EditorWindow);b.MoveToSelection();var c=b.CreateBookmark();var a=FCKDomTools.GetCommonParentNode(b.StartNode||b.StartContainer,b.EndNode||b.EndContainer,["ul","ol"]);if(a){this._IndentList(b,a);}else{this._IndentBlock(b);}b.MoveToBookmark(c);b.Select();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange");},GetState:function(){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG||!FCK.EditorWindow){return FCK_TRISTATE_DISABLED;}if(FCKIndentCommand._UseIndentClasses==undefined){FCKIndentCommand._InitIndentModeParameters();}var c=FCKSelection.GetBoundaryParentElement(true);var i=FCKSelection.GetBoundaryParentElement(false);var d=FCKDomTools.GetCommonParentNode(c,i,["ul","ol"]);if(d){if(this.Name.IEquals("outdent")){return FCK_TRISTATE_OFF;}var e=FCKTools.GetElementAscensor(c,"li");if(!e||!e.previousSibling){return FCK_TRISTATE_DISABLED;}return FCK_TRISTATE_OFF;}if(!FCKIndentCommand._UseIndentClasses&&this.Name.IEquals("indent")){return FCK_TRISTATE_OFF;}var h=new FCKElementPath(c);var f=h.Block||h.BlockLimit;if(!f){return FCK_TRISTATE_DISABLED;}if(FCKIndentCommand._UseIndentClasses){var a=f.className.match(FCKIndentCommand._ClassNameRegex);var g=0;if(a!=null){a=a[1];g=FCKIndentCommand._IndentClassMap[a];}if((this.Name=="outdent"&&g==0)||(this.Name=="indent"&&g==FCKConfig.IndentClasses.length)){return FCK_TRISTATE_DISABLED;}return FCK_TRISTATE_OFF;}else{var b=parseInt(f.style[this.IndentCSSProperty],10);if(isNaN(b)){b=0;}if(b<=0){return FCK_TRISTATE_DISABLED;}return FCK_TRISTATE_OFF;}},_IndentBlock:function(f){var e=new FCKDomRangeIterator(f);e.EnforceRealBlocks=true;f.Expand("block_contents");var b=FCKDomTools.GetCommonParents(f.StartContainer,f.EndContainer);var d=b[b.length-1];var c;while((c=e.GetNextParagraph())){if(!(c==d||c.parentNode==d)){continue;}if(FCKIndentCommand._UseIndentClasses){var a=c.className.match(FCKIndentCommand._ClassNameRegex);var i=0;if(a!=null){a=a[1];i=FCKIndentCommand._IndentClassMap[a];}if(this.Name.IEquals("outdent")){i--;}else{if(this.Name.IEquals("indent")){i++;}}i=Math.min(i,FCKConfig.IndentClasses.length);i=Math.max(i,0);var g=c.className.replace(FCKIndentCommand._ClassNameRegex,"");if(i<1){c.className=g;}else{c.className=(g.length>0?g+" ":"")+FCKConfig.IndentClasses[i-1];}}else{var h=parseInt(c.style[this.IndentCSSProperty],10);if(isNaN(h)){h=0;}h+=this.Offset;h=Math.max(h,0);h=Math.ceil(h/this.Offset)*this.Offset;c.style[this.IndentCSSProperty]=h?h+FCKConfig.IndentUnit:"";if(c.getAttribute("style")==""){c.removeAttribute("style");}}}},_IndentList:function(k,h){var d=k.StartContainer;var q=k.EndContainer;while(d&&d.parentNode!=h){d=d.parentNode;}while(q&&q.parentNode!=h){q=q.parentNode;}if(!d||!q){return;}var f=d;var g=[];var l=false;while(l==false){if(f==q){l=true;}g.push(f);f=f.nextSibling;}if(g.length<1){return;}var b=FCKDomTools.GetParents(h);for(var j=0;j<b.length;j++){if(b[j].nodeName.IEquals(["ul","ol"])){h=b[j];break;}}var m=this.Name.IEquals("indent")?1:-1;var p=g[0];var o=g[g.length-1];var e={};var c=FCKDomTools.ListToArray(h,e);var n=c[o._FCK_ListArray_Index].indent;for(var j=p._FCK_ListArray_Index;j<=o._FCK_ListArray_Index;j++){c[j].indent+=m;}for(var j=o._FCK_ListArray_Index+1;j<c.length&&c[j].indent>n;j++){c[j].indent+=m;}var a=FCKDomTools.ArrayToList(c);if(a){h.parentNode.replaceChild(a.listNode,h);}FCKDomTools.ClearAllMarkers(e);}};