var FCKW3CRange=function(a){this._Document=a;this.startContainer=null;this.startOffset=null;this.endContainer=null;this.endOffset=null;this.collapsed=true;};FCKW3CRange.CreateRange=function(a){return new FCKW3CRange(a);};FCKW3CRange.CreateFromRange=function(b,c){var a=FCKW3CRange.CreateRange(b);a.setStart(c.startContainer,c.startOffset);a.setEnd(c.endContainer,c.endOffset);return a;};FCKW3CRange.prototype={_UpdateCollapsed:function(){this.collapsed=(this.startContainer==this.endContainer&&this.startOffset==this.endOffset);},setStart:function(a,b){this.startContainer=a;this.startOffset=b;if(!this.endContainer){this.endContainer=a;this.endOffset=b;}this._UpdateCollapsed();},setEnd:function(a,b){this.endContainer=a;this.endOffset=b;if(!this.startContainer){this.startContainer=a;this.startOffset=b;}this._UpdateCollapsed();},setStartAfter:function(a){this.setStart(a.parentNode,FCKDomTools.GetIndexOf(a)+1);},setStartBefore:function(a){this.setStart(a.parentNode,FCKDomTools.GetIndexOf(a));},setEndAfter:function(a){this.setEnd(a.parentNode,FCKDomTools.GetIndexOf(a)+1);},setEndBefore:function(a){this.setEnd(a.parentNode,FCKDomTools.GetIndexOf(a));},collapse:function(a){if(a){this.endContainer=this.startContainer;this.endOffset=this.startOffset;}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset;}this.collapsed=true;},selectNodeContents:function(a){this.setStart(a,0);this.setEnd(a,a.nodeType==3?a.data.length:a.childNodes.length);},insertNode:function(b){var c=this.startContainer;var a=this.startOffset;if(c.nodeType==3){c.splitText(a);if(c==this.endContainer){this.setEnd(c.nextSibling,this.endOffset-this.startOffset);}FCKDomTools.InsertAfterNode(c,b);return;}else{c.insertBefore(b,c.childNodes[a]||null);if(c==this.endContainer){this.endOffset++;this.collapsed=false;}}},deleteContents:function(){if(this.collapsed){return;}this._ExecContentsAction(0);},extractContents:function(){var a=new FCKDocumentFragment(this._Document);if(!this.collapsed){this._ExecContentsAction(1,a);}return a;},cloneContents:function(){var a=new FCKDocumentFragment(this._Document);if(!this.collapsed){this._ExecContentsAction(2,a);}return a;},_ExecContentsAction:function(r,a){var y=this.startContainer;var o=this.endContainer;var t=this.startOffset;var g=this.endOffset;var q=false;var h=false;if(o.nodeType==3){o=o.splitText(g);}else{if(o.childNodes.length>0){if(g>o.childNodes.length-1){o=FCKDomTools.InsertAfterNode(o.lastChild,this._Document.createTextNode(""));h=true;}else{o=o.childNodes[g];}}}if(y.nodeType==3){y.splitText(t);if(y==o){o=y.nextSibling;}}else{if(t==0){y=y.insertBefore(this._Document.createTextNode(""),y.firstChild);q=true;}else{if(t>y.childNodes.length-1){y=y.appendChild(this._Document.createTextNode(""));q=true;}else{y=y.childNodes[t].previousSibling;}}}var v=FCKDomTools.GetParents(y);var c=FCKDomTools.GetParents(o);var u,z,x;for(u=0;u<v.length;u++){z=v[u];x=c[u];if(z!=x){break;}}var w,n,m,e,l;if(a){w=a.RootNode;}for(var s=u;s<v.length;s++){n=v[s];if(w&&n!=y){m=w.appendChild(n.cloneNode(n==y));}e=n.nextSibling;while(e){if(e==c[s]||e==o){break;}l=e.nextSibling;if(r==2){w.appendChild(e.cloneNode(true));}else{e.parentNode.removeChild(e);if(r==1){w.appendChild(e);}}e=l;}if(w){w=m;}}if(a){w=a.RootNode;}for(var p=u;p<c.length;p++){n=c[p];if(r>0&&n!=o){m=w.appendChild(n.cloneNode(n==o));}if(!v[p]||n.parentNode!=v[p].parentNode){e=n.previousSibling;while(e){if(e==v[p]||e==y){break;}l=e.previousSibling;if(r==2){w.insertBefore(e.cloneNode(true),w.firstChild);}else{e.parentNode.removeChild(e);if(r==1){w.insertBefore(e,w.firstChild);}}e=l;}}if(w){w=m;}}if(r==2){var b=this.startContainer;if(b.nodeType==3){b.data+=b.nextSibling.data;b.parentNode.removeChild(b.nextSibling);}var f=this.endContainer;if(f.nodeType==3&&f.nextSibling){f.data+=f.nextSibling.data;f.parentNode.removeChild(f.nextSibling);}}else{if(z&&x&&(y.parentNode!=z.parentNode||o.parentNode!=x.parentNode)){var d=FCKDomTools.GetIndexOf(x);if(q&&x.parentNode==y.parentNode){d--;}this.setStart(x.parentNode,d);}this.collapse(true);}if(q){y.parentNode.removeChild(y);}if(h&&o.parentNode){o.parentNode.removeChild(o);}},cloneRange:function(){return FCKW3CRange.CreateFromRange(this._Document,this);}};