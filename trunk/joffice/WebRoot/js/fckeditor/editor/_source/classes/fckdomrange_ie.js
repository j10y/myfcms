FCKDomRange.prototype.MoveToSelection=function(){this.Release(true);this._Range=new FCKW3CRange(this.Window.document);var a=this.Window.document.selection;if(a.type!="Control"){var c=this._GetSelectionMarkerTag(true);var d=this._GetSelectionMarkerTag(false);if(!c&&!d){this._Range.setStart(this.Window.document.body,0);this._UpdateElementInfo();return;}this._Range.setStart(c.parentNode,FCKDomTools.GetIndexOf(c));c.parentNode.removeChild(c);this._Range.setEnd(d.parentNode,FCKDomTools.GetIndexOf(d));d.parentNode.removeChild(d);this._UpdateElementInfo();}else{var b=a.createRange().item(0);if(b){this._Range.setStartBefore(b);this._Range.setEndAfter(b);this._UpdateElementInfo();}}};FCKDomRange.prototype.Select=function(a){if(this._Range){this.SelectBookmark(this.CreateBookmark(true),a);}};FCKDomRange.prototype.SelectBookmark=function(g,b){var h=this.CheckIsCollapsed();var i;var f;var c=this.GetBookmarkNode(g,true);if(!c){return;}var d;if(!h){d=this.GetBookmarkNode(g,false);}var a=this.Window.document.body.createTextRange();a.moveToElementText(c);a.moveStart("character",1);if(d){var e=this.Window.document.body.createTextRange();e.moveToElementText(d);a.setEndPoint("EndToEnd",e);a.moveEnd("character",-1);}else{i=b||!c.previousSibling||c.previousSibling.nodeName.toLowerCase()=="br";f=this.Window.document.createElement("span");f.innerHTML="&#65279;";c.parentNode.insertBefore(f,c);if(i){c.parentNode.insertBefore(this.Window.document.createTextNode("\ufeff"),c);}}if(!this._Range){this._Range=this.CreateRange();}this._Range.setStartBefore(c);c.parentNode.removeChild(c);if(h){if(i){a.moveStart("character",-1);a.select();this.Window.document.selection.clear();}else{a.select();}FCKDomTools.RemoveNode(f);}else{this._Range.setEndBefore(d);d.parentNode.removeChild(d);a.select();}};FCKDomRange.prototype._GetSelectionMarkerTag=function(a){var f=this.Window.document;var c=f.selection;var g;try{g=c.createRange();}catch(d){return null;}if(g.parentElement().document!=f){return null;}g.collapse(a===true);var b="fck_dom_range_temp_"+(new Date()).valueOf()+"_"+Math.floor(Math.random()*1000);g.pasteHTML('<span id="'+b+'"></span>');return f.getElementById(b);};