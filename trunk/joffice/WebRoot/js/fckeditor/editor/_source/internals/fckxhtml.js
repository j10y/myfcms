var FCKXHtml=new Object();FCKXHtml.CurrentJobNum=0;FCKXHtml.GetXHTML=function(e,f,g){FCKDomTools.CheckAndRemovePaddingNode(FCKTools.GetElementDocument(e),FCKConfig.EnterMode);FCKXHtmlEntities.Initialize();this._NbspEntity=(FCKConfig.ProcessHTMLEntities?"nbsp":"#160");var b=FCK.IsDirty();FCKXHtml.SpecialBlocks=new Array();this.XML=FCKTools.CreateXmlObject("DOMDocument");this.MainNode=this.XML.appendChild(this.XML.createElement("xhtml"));FCKXHtml.CurrentJobNum++;if(f){this._AppendNode(this.MainNode,e);}else{this._AppendChildNodes(this.MainNode,e,false);}if(FCKBrowserInfo.IsIE){FCKXHtml._RemoveXHtmlJobProperties(e);}var d=this._GetMainXmlString();this.XML=null;if(FCKBrowserInfo.IsSafari){d=d.replace(/^<xhtml.*?>/,"<xhtml>");}d=d.substr(7,d.length-15).Trim();if(FCKConfig.DocType.length>0&&FCKRegexLib.HtmlDocType.test(FCKConfig.DocType)){d=d.replace(FCKRegexLib.SpaceNoClose,">");}else{d=d.replace(FCKRegexLib.SpaceNoClose," />");}if(FCKConfig.ForceSimpleAmpersand){d=d.replace(FCKRegexLib.ForceSimpleAmpersand,"&");}if(g){d=FCKCodeFormatter.Format(d);}for(var c=0;c<FCKXHtml.SpecialBlocks.length;c++){var a=new RegExp("___FCKsi___"+c);d=d.replace(a,FCKXHtml.SpecialBlocks[c]);}d=d.replace(FCKRegexLib.GeckoEntitiesMarker,"&");if(!b){FCK.ResetIsDirty();}FCKDomTools.EnforcePaddingNode(FCKTools.GetElementDocument(e),FCKConfig.EnterMode);return d;};FCKXHtml._AppendAttribute=function(b,a,c){try{if(c==undefined||c==null){c="";}else{if(c.replace){if(FCKConfig.ForceSimpleAmpersand){c=c.replace(/&/g,"___FCKAmp___");}c=c.replace(FCKXHtmlEntities.EntitiesRegex,FCKXHtml_GetEntity);}}var d=this.XML.createAttribute(a);d.value=c;b.attributes.setNamedItem(d);}catch(f){}};FCKXHtml._AppendChildNodes=function(a,c,d){var f=c.firstChild;while(f){this._AppendNode(a,f);f=f.nextSibling;}if(d&&c.tagName&&c.tagName.toLowerCase()!="pre"){FCKDomTools.TrimNode(a);if(FCKConfig.FillEmptyBlocks){var b=a.lastChild;if(b&&b.nodeType==1&&b.nodeName=="br"){this._AppendEntity(a,this._NbspEntity);}}}if(a.childNodes.length==0){if(d&&FCKConfig.FillEmptyBlocks){this._AppendEntity(a,this._NbspEntity);return a;}var e=a.nodeName;if(FCKListsLib.InlineChildReqElements[e]){return null;}if(!FCKListsLib.EmptyElements[e]){a.appendChild(this.XML.createTextNode(""));}}return a;};FCKXHtml._AppendNode=function(a,b){if(!b){return false;}switch(b.nodeType){case 1:if(FCKBrowserInfo.IsGecko&&b.tagName.toLowerCase()=="br"&&b.parentNode.tagName.toLowerCase()=="pre"){var h="\r";if(b==b.parentNode.firstChild){h+="\r";}return FCKXHtml._AppendNode(a,this.XML.createTextNode(h));}if(b.getAttribute("_fckfakelement")){return FCKXHtml._AppendNode(a,FCK.GetRealElement(b));}if(FCKBrowserInfo.IsGecko&&(b.hasAttribute("_moz_editor_bogus_node")||b.getAttribute("type")=="_moz")){if(b.nextSibling){return false;}else{b.removeAttribute("_moz_editor_bogus_node");b.removeAttribute("type");}}if(b.getAttribute("_fcktemp")){return false;}var g=b.tagName.toLowerCase();if(FCKBrowserInfo.IsIE){if(b.scopeName&&b.scopeName!="HTML"&&b.scopeName!="FCK"){g=b.scopeName.toLowerCase()+":"+g;}}else{if(g.StartsWith("fck:")){g=g.Remove(0,4);}}if(!FCKRegexLib.ElementName.test(g)){return false;}if(b._fckxhtmljob&&b._fckxhtmljob==FCKXHtml.CurrentJobNum){return false;}var f=this.XML.createElement(g);FCKXHtml._AppendAttributes(a,b,f,g);b._fckxhtmljob=FCKXHtml.CurrentJobNum;var d=FCKXHtml.TagProcessors[g];if(d){f=d(f,b,a);}else{f=this._AppendChildNodes(f,b,Boolean(FCKListsLib.NonEmptyBlockElements[g]));}if(!f){return false;}a.appendChild(f);break;case 3:if(b.parentNode&&b.parentNode.nodeName.IEquals("pre")){return this._AppendTextNode(a,b.nodeValue);}return this._AppendTextNode(a,b.nodeValue.ReplaceNewLineChars(" "));case 8:if(FCKBrowserInfo.IsIE&&!b.innerHTML){break;}try{a.appendChild(this.XML.createComment(b.nodeValue));}catch(c){}break;default:a.appendChild(this.XML.createComment("Element not supported - Type: "+b.nodeType+" Name: "+b.nodeName));break;}return true;};FCKXHtml._AppendSpecialItem=function(a){return"___FCKsi___"+(FCKXHtml.SpecialBlocks.push(a)-1);};FCKXHtml._AppendEntity=function(b,a){b.appendChild(this.XML.createTextNode("#?-:"+a+";"));};FCKXHtml._AppendTextNode=function(c,a){var b=a.length>0;if(b){c.appendChild(this.XML.createTextNode(a.replace(FCKXHtmlEntities.EntitiesRegex,FCKXHtml_GetEntity)));}return b;};function FCKXHtml_GetEntity(b){var a=FCKXHtmlEntities.Entities[b]||("#"+b.charCodeAt(0));return"#?-:"+a+";";}FCKXHtml.TagProcessors={a:function(b,c){if(c.innerHTML.Trim().length==0&&!c.name){return false;}var a=c.getAttribute("_fcksavedurl");if(a!=null){FCKXHtml._AppendAttribute(b,"href",a);}if(FCKBrowserInfo.IsIE){if(c.name){FCKXHtml._AppendAttribute(b,"name",c.name);}}b=FCKXHtml._AppendChildNodes(b,c,false);return b;},area:function(d,e){var b=e.getAttribute("_fcksavedurl");if(b!=null){FCKXHtml._AppendAttribute(d,"href",b);}if(FCKBrowserInfo.IsIE){if(!d.attributes.getNamedItem("coords")){var a=e.getAttribute("coords",2);if(a&&a!="0,0,0"){FCKXHtml._AppendAttribute(d,"coords",a);}}if(!d.attributes.getNamedItem("shape")){var c=e.getAttribute("shape",2);if(c&&c.length>0){FCKXHtml._AppendAttribute(d,"shape",c.toLowerCase());}}}return d;},body:function(a,b){a=FCKXHtml._AppendChildNodes(a,b,false);a.removeAttribute("spellcheck");return a;},iframe:function(a,b){var c=b.innerHTML;if(FCKBrowserInfo.IsGecko){c=FCKTools.HTMLDecode(c);}c=c.replace(/\s_fcksavedurl="[^"]*"/g,"");a.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(c)));return a;},img:function(b,c){if(!b.attributes.getNamedItem("alt")){FCKXHtml._AppendAttribute(b,"alt","");}var a=c.getAttribute("_fcksavedurl");if(a!=null){FCKXHtml._AppendAttribute(b,"src",a);}if(c.style.width){b.removeAttribute("width");}if(c.style.height){b.removeAttribute("height");}return b;},li:function(a,b,c){if(c.nodeName.IEquals(["ul","ol"])){return FCKXHtml._AppendChildNodes(a,b,true);}var d=FCKXHtml.XML.createElement("ul");b._fckxhtmljob=null;do{FCKXHtml._AppendNode(d,b);do{b=FCKDomTools.GetNextSibling(b);}while(b&&b.nodeType==3&&b.nodeValue.Trim().length==0);}while(b&&b.nodeName.toLowerCase()=="li");return d;},ol:function(b,c,d){if(c.innerHTML.Trim().length==0){return false;}var a=d.lastChild;if(a&&a.nodeType==3){a=a.previousSibling;}if(a&&a.nodeName.toUpperCase()=="LI"){c._fckxhtmljob=null;FCKXHtml._AppendNode(a,c);return false;}b=FCKXHtml._AppendChildNodes(b,c);return b;},pre:function(a,b){var c=b.firstChild;if(c&&c.nodeType==3){a.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem("\r\n")));}FCKXHtml._AppendChildNodes(a,b,true);return a;},script:function(a,b){if(!a.attributes.getNamedItem("type")){FCKXHtml._AppendAttribute(a,"type","text/javascript");}a.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(b.text)));return a;},span:function(a,b){if(b.innerHTML.length==0){return false;}a=FCKXHtml._AppendChildNodes(a,b,false);return a;},style:function(b,c){if(!b.attributes.getNamedItem("type")){FCKXHtml._AppendAttribute(b,"type","text/css");}var a=c.innerHTML;if(FCKBrowserInfo.IsIE){a=a.replace(/^(\r\n|\n|\r)/,"");}b.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(a)));return b;},title:function(a,b){a.appendChild(FCKXHtml.XML.createTextNode(FCK.EditorDocument.title));return a;}};FCKXHtml.TagProcessors.ul=FCKXHtml.TagProcessors.ol;