FCKCommands.RegisterCommand("Placeholder",new FCKDialogCommand("Placeholder",FCKLang.PlaceholderDlgTitle,FCKPlugins.Items["placeholder"].Path+"fck_placeholder.html",340,160));var oPlaceholderItem=new FCKToolbarButton("Placeholder",FCKLang.PlaceholderBtn);oPlaceholderItem.IconPath=FCKPlugins.Items["placeholder"].Path+"placeholder.gif";FCKToolbarItems.RegisterItem("Placeholder",oPlaceholderItem);var FCKPlaceholders=new Object();FCKPlaceholders.Add=function(a){var b=FCK.InsertElement("span");this.SetupSpan(b,a);};FCKPlaceholders.SetupSpan=function(b,a){b.innerHTML="[[ "+a+" ]]";b.style.backgroundColor="#ffff00";b.style.color="#000000";if(FCKBrowserInfo.IsGecko){b.style.cursor="default";}b._fckplaceholder=a;b.contentEditable=false;b.onresizestart=function(){FCK.EditorWindow.event.returnValue=false;return false;};};FCKPlaceholders._SetupClickListener=function(){FCKPlaceholders._ClickListener=function(a){if(a.target.tagName=="SPAN"&&a.target._fckplaceholder){FCKSelection.SelectNode(a.target);}};FCK.EditorDocument.addEventListener("click",FCKPlaceholders._ClickListener,true);};FCKPlaceholders.OnDoubleClick=function(a){if(a.tagName=="SPAN"&&a._fckplaceholder){FCKCommands.GetCommand("Placeholder").Execute();}};FCK.RegisterDoubleClickHandler(FCKPlaceholders.OnDoubleClick,"SPAN");FCKPlaceholders.Exist=function(b){var a=FCK.EditorDocument.getElementsByTagName("SPAN");for(var c=0;c<a.length;c++){if(a[c]._fckplaceholder==b){return true;}}return false;};if(FCKBrowserInfo.IsIE){FCKPlaceholders.Redraw=function(){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG){return;}var a=FCK.EditorDocument.body.innerText.match(/\[\[[^\[\]]+\]\]/g);if(!a){return;}var d=FCK.EditorDocument.body.createTextRange();for(var b=0;b<a.length;b++){if(d.findText(a[b])){var c=a[b].match(/\[\[\s*([^\]]*?)\s*\]\]/)[1];d.pasteHTML('<span style="color: #000000; background-color: #ffff00" contenteditable="false" _fckplaceholder="'+c+'">'+a[b]+"</span>");}}};}else{FCKPlaceholders.Redraw=function(){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG){return;}var d=FCK.EditorDocument.createTreeWalker(FCK.EditorDocument.body,NodeFilter.SHOW_TEXT,FCKPlaceholders._AcceptNode,true);var a=new Array();while((oNode=d.nextNode())){a[a.length]=oNode;}for(var g=0;g<a.length;g++){var c=a[g].nodeValue.split(/(\[\[[^\[\]]+\]\])/g);for(var b=0;b<c.length;b++){if(c[b].length>0){if(c[b].indexOf("[[")==0){var f=c[b].match(/\[\[\s*([^\]]*?)\s*\]\]/)[1];var e=FCK.EditorDocument.createElement("span");FCKPlaceholders.SetupSpan(e,f);a[g].parentNode.insertBefore(e,a[g]);}else{a[g].parentNode.insertBefore(FCK.EditorDocument.createTextNode(c[b]),a[g]);}}}a[g].parentNode.removeChild(a[g]);}FCKPlaceholders._SetupClickListener();};FCKPlaceholders._AcceptNode=function(a){if(/\[\[[^\[\]]+\]\]/.test(a.nodeValue)){return NodeFilter.FILTER_ACCEPT;}else{return NodeFilter.FILTER_SKIP;}};}FCK.Events.AttachEvent("OnAfterSetHTML",FCKPlaceholders.Redraw);FCKXHtml.TagProcessors["span"]=function(a,b){if(b._fckplaceholder){a=FCKXHtml.XML.createTextNode("[["+b._fckplaceholder+"]]");}else{FCKXHtml._AppendChildNodes(a,b,false);}return a;};