var FCK_STATUS_NOTLOADED=window.parent.FCK_STATUS_NOTLOADED=0;var FCK_STATUS_ACTIVE=window.parent.FCK_STATUS_ACTIVE=1;var FCK_STATUS_COMPLETE=window.parent.FCK_STATUS_COMPLETE=2;var FCK_TRISTATE_OFF=window.parent.FCK_TRISTATE_OFF=0;var FCK_TRISTATE_ON=window.parent.FCK_TRISTATE_ON=1;var FCK_TRISTATE_DISABLED=window.parent.FCK_TRISTATE_DISABLED=-1;var FCK_UNKNOWN=window.parent.FCK_UNKNOWN=-9;var FCK_TOOLBARITEM_ONLYICON=window.parent.FCK_TOOLBARITEM_ONLYICON=0;var FCK_TOOLBARITEM_ONLYTEXT=window.parent.FCK_TOOLBARITEM_ONLYTEXT=1;var FCK_TOOLBARITEM_ICONTEXT=window.parent.FCK_TOOLBARITEM_ICONTEXT=2;var FCK_EDITMODE_WYSIWYG=window.parent.FCK_EDITMODE_WYSIWYG=0;var FCK_EDITMODE_SOURCE=window.parent.FCK_EDITMODE_SOURCE=1;var FCK_IMAGES_PATH="images/";var FCK_SPACER_PATH="images/spacer.gif";var CTRL=1000;var SHIFT=2000;var ALT=4000;var FCK_STYLE_BLOCK=0;var FCK_STYLE_INLINE=1;var FCK_STYLE_OBJECT=2;String.prototype.Contains=function(a){return(this.indexOf(a)>-1);};String.prototype.Equals=function(){var a=arguments;if(a.length==1&&a[0].pop){a=a[0];}for(var b=0;b<a.length;b++){if(this==a[b]){return true;}}return false;};String.prototype.IEquals=function(){var a=this.toUpperCase();var c=arguments;if(c.length==1&&c[0].pop){c=c[0];}for(var b=0;b<c.length;b++){if(a==c[b].toUpperCase()){return true;}}return false;};String.prototype.ReplaceAll=function(a,d){var c=this;for(var b=0;b<a.length;b++){c=c.replace(a[b],d[b]);}return c;};String.prototype.StartsWith=function(a){return(this.substr(0,a.length)==a);};String.prototype.EndsWith=function(a,f){var d=this.length;var c=a.length;if(c>d){return false;}if(f){var b=new RegExp(a+"$","i");return b.test(this);}else{return(c==0||this.substr(d-c,c)==a);}};String.prototype.Remove=function(a,c){var b="";if(a>0){b=this.substring(0,a);}if(a+c<this.length){b+=this.substring(a+c,this.length);}return b;};String.prototype.Trim=function(){return this.replace(/(^[ \t\n\r]*)|([ \t\n\r]*$)/g,"");};String.prototype.LTrim=function(){return this.replace(/^[ \t\n\r]*/g,"");};String.prototype.RTrim=function(){return this.replace(/[ \t\n\r]*$/g,"");};String.prototype.ReplaceNewLineChars=function(a){return this.replace(/\n/g,a);};String.prototype.Replace=function(a,c,b){if(typeof c=="function"){return this.replace(a,function(){return c.apply(b||this,arguments);});}else{return this.replace(a,c);}};Array.prototype.IndexOf=function(a){for(var b=0;b<this.length;b++){if(this[b]==a){return b;}}return -1;};var s=navigator.userAgent.toLowerCase();var FCKBrowserInfo={IsIE:
/*@cc_on!@*/
false,IsIE7:
/*@cc_on!@*/
false&&(parseInt(s.match(/msie (\d+)/)[1],10)>=7),IsIE6:
/*@cc_on!@*/
false&&(parseInt(s.match(/msie (\d+)/)[1],10)>=6),IsSafari:s.Contains(" applewebkit/"),IsOpera:!!window.opera,IsAIR:s.Contains(" adobeair/"),IsMac:s.Contains("macintosh")};(function(a){a.IsGecko=(navigator.product=="Gecko")&&!a.IsSafari&&!a.IsOpera;a.IsGeckoLike=(a.IsGecko||a.IsSafari||a.IsOpera);if(a.IsGecko){var c=s.match(/rv:(\d+\.\d+)/);var b=c&&parseFloat(c[1]);if(b){a.IsGecko10=(b<1.8);a.IsGecko19=(b>1.8);}}if(a.IsSafari){a.IsSafari3=(parseFloat(s.match(/ applewebkit\/(\d+)/)[1])<526);}})(FCKBrowserInfo);var FCKURLParams={};(function(){var a=document.location.search.substr(1).split("&");for(var b=0;b<a.length;b++){var f=a[b].split("=");var d=decodeURIComponent(f[0]);var c=decodeURIComponent(f[1]);FCKURLParams[d]=c;}})();var FCKEvents=function(a){this.Owner=a;this._RegisteredEvents={};};FCKEvents.prototype.AttachEvent=function(a,c){var b;if(!(b=this._RegisteredEvents[a])){this._RegisteredEvents[a]=[c];}else{if(b.IndexOf(c)==-1){b.push(c);}}};FCKEvents.prototype.FireEvent=function(a,g){var f=true;var d=this._RegisteredEvents[a];if(d){for(var b=0;b<d.length;b++){try{f=(d[b](this.Owner,g)&&f);}catch(c){if(c.number!=-2146823277){throw c;}}}}return f;};var FCKDataProcessor=function(){};FCKDataProcessor.prototype={ConvertToHtml:function(a){if(FCKConfig.FullPage){FCK.DocTypeDeclaration=a.match(FCKRegexLib.DocTypeTag);if(!FCKRegexLib.HasBodyTag.test(a)){a="<body>"+a+"</body>";}if(!FCKRegexLib.HtmlOpener.test(a)){a='<html dir="'+FCKConfig.ContentLangDirection+'">'+a+"</html>";}if(!FCKRegexLib.HeadOpener.test(a)){a=a.replace(FCKRegexLib.HtmlOpener,"$&<head><title></title></head>");}return a;}else{var b=FCKConfig.DocType+'<html dir="'+FCKConfig.ContentLangDirection+'"';if(FCKBrowserInfo.IsIE&&FCKConfig.DocType.length>0&&!FCKRegexLib.Html4DocType.test(FCKConfig.DocType)){b+=' style="overflow-y: scroll"';}b+="><head><title></title></head><body"+FCKConfig.GetBodyAttributes()+">"+a+"</body></html>";return b;}},ConvertToDataFormat:function(a,f,d,c){var b=FCKXHtml.GetXHTML(a,!f,c);if(d&&FCKRegexLib.EmptyOutParagraph.test(b)){return"";}return b;},FixHtml:function(a){return a;}};var FCK={Name:FCKURLParams["InstanceName"],Status:0,EditMode:0,Toolbar:null,HasFocus:false,DataProcessor:new FCKDataProcessor(),GetInstanceObject:(function(){var a=window;return function(b){return a[b];};})(),AttachToOnSelectionChange:function(a){this.Events.AttachEvent("OnSelectionChange",a);},GetLinkedFieldValue:function(){return this.LinkedField.value;},GetParentForm:function(){return this.LinkedField.form;},StartupValue:"",IsDirty:function(){if(this.EditMode==1){return(this.StartupValue!=this.EditingArea.Textarea.value);}else{if(!this.EditorDocument){return false;}return(this.StartupValue!=this.EditorDocument.body.innerHTML);}},ResetIsDirty:function(){if(this.EditMode==1){this.StartupValue=this.EditingArea.Textarea.value;}else{if(this.EditorDocument.body){this.StartupValue=this.EditorDocument.body.innerHTML;}}},StartEditor:function(){this.TempBaseTag=FCKConfig.BaseHref.length>0?'<base href="'+FCKConfig.BaseHref+'" _fcktemp="true"></base>':"";var a=FCK.KeystrokeHandler=new FCKKeystrokeHandler();a.OnKeystroke=_FCK_KeystrokeHandler_OnKeystroke;a.SetKeystrokes(FCKConfig.Keystrokes);if(FCKBrowserInfo.IsIE7){if((CTRL+86) in a.Keystrokes){a.SetKeystrokes([CTRL+86,true]);}if((SHIFT+45) in a.Keystrokes){a.SetKeystrokes([SHIFT+45,true]);}}a.SetKeystrokes([CTRL+8,true]);this.EditingArea=new FCKEditingArea(document.getElementById("xEditingArea"));this.EditingArea.FFSpellChecker=FCKConfig.FirefoxSpellChecker;this.SetData(this.GetLinkedFieldValue(),true);FCKTools.AddEventListener(document,"keydown",this._TabKeyHandler);this.AttachToOnSelectionChange(_FCK_PaddingNodeListener);if(FCKBrowserInfo.IsGecko){this.AttachToOnSelectionChange(this._ExecCheckEmptyBlock);}},Focus:function(){FCK.EditingArea.Focus();},SetStatus:function(a){this.Status=a;if(a==1){FCKFocusManager.AddWindow(window,true);if(FCKBrowserInfo.IsIE){FCKFocusManager.AddWindow(window.frameElement,true);}if(FCKConfig.StartupFocus){FCK.Focus();}}this.Events.FireEvent("OnStatusChange",a);},FixBody:function(){var a=FCKConfig.EnterMode;if(a!="p"&&a!="div"){return;}var i=this.EditorDocument;if(!i){return;}var h=i.body;if(!h){return;}FCKDomTools.TrimNode(h);var g=h.firstChild;var f;while(g){var d=false;switch(g.nodeType){case 1:var c=g.nodeName.toLowerCase();if(!FCKListsLib.BlockElements[c]&&c!="li"&&!g.getAttribute("_fckfakelement")&&g.getAttribute("_moz_dirty")==null){d=true;}break;case 3:if(f||g.nodeValue.Trim().length>0){d=true;}break;case 8:if(f){d=true;}break;}if(d){var b=g.parentNode;if(!f){f=b.insertBefore(i.createElement(a),g);}f.appendChild(b.removeChild(g));g=f.nextSibling;}else{if(f){FCKDomTools.TrimNode(f);f=null;}g=g.nextSibling;}}if(f){FCKDomTools.TrimNode(f);}},GetData:function(a){FCK.Events.FireEvent("OnBeforeGetData");if(FCK.EditMode==1){return FCK.EditingArea.Textarea.value;}this.FixBody();var d=FCK.EditorDocument;if(!d){return null;}var c=FCKConfig.FullPage;var b=FCK.DataProcessor.ConvertToDataFormat(c?d.documentElement:d.body,!c,FCKConfig.IgnoreEmptyParagraphValue,a);b=FCK.ProtectEventsRestore(b);if(FCKBrowserInfo.IsIE){b=b.replace(FCKRegexLib.ToReplace,"$1");}if(c){if(FCK.DocTypeDeclaration&&FCK.DocTypeDeclaration.length>0){b=FCK.DocTypeDeclaration+"\n"+b;}if(FCK.XmlDeclaration&&FCK.XmlDeclaration.length>0){b=FCK.XmlDeclaration+"\n"+b;}}b=FCKConfig.ProtectedSource.Revert(b);setTimeout(function(){FCK.Events.FireEvent("OnAfterGetData");},0);return b;},UpdateLinkedField:function(){var a=FCK.GetXHTML(FCKConfig.FormatOutput);if(FCKConfig.HtmlEncodeOutput){a=FCKTools.HTMLEncode(a);}FCK.LinkedField.value=a;FCK.Events.FireEvent("OnAfterLinkedFieldUpdate");},RegisteredDoubleClickHandlers:{},OnDoubleClick:function(a){var c=FCK.RegisteredDoubleClickHandlers[a.tagName.toUpperCase()];if(c){for(var b=0;b<c.length;b++){c[b](a);}}c=FCK.RegisteredDoubleClickHandlers["*"];if(c){for(var b=0;b<c.length;b++){c[b](a);}}},RegisterDoubleClickHandler:function(a,d){var c=d||"*";c=c.toUpperCase();var b;if(!(b=FCK.RegisteredDoubleClickHandlers[c])){FCK.RegisteredDoubleClickHandlers[c]=[a];}else{if(b.IndexOf(a)==-1){b.push(a);}}},OnAfterSetHTML:function(){FCKDocumentProcessor.Process(FCK.EditorDocument);FCKUndo.SaveUndoStep();FCK.Events.FireEvent("OnSelectionChange");FCK.Events.FireEvent("OnAfterSetHTML");},ProtectUrls:function(a){a=a.replace(FCKRegexLib.ProtectUrlsA,"$& _fcksavedurl=$1");a=a.replace(FCKRegexLib.ProtectUrlsImg,"$& _fcksavedurl=$1");a=a.replace(FCKRegexLib.ProtectUrlsArea,"$& _fcksavedurl=$1");return a;},ProtectEvents:function(a){return a.replace(FCKRegexLib.TagsWithEvent,_FCK_ProtectEvents_ReplaceTags);},ProtectEventsRestore:function(a){return a.replace(FCKRegexLib.ProtectedEvents,_FCK_ProtectEvents_RestoreEvents);},ProtectTags:function(a){var c=FCKConfig.ProtectedTags;if(FCKBrowserInfo.IsIE){c+=c.length>0?"|ABBR|XML|EMBED|OBJECT":"ABBR|XML|EMBED|OBJECT";}var b;if(c.length>0){b=new RegExp("<("+c+")(?!w|:)","gi");a=a.replace(b,"<FCK:$1");b=new RegExp("</("+c+")>","gi");a=a.replace(b,"</FCK:$1>");}c="META";if(FCKBrowserInfo.IsIE){c+="|HR";}b=new RegExp("<(("+c+")(?=\\s|>|/)[\\s\\S]*?)/?>","gi");a=a.replace(b,"<FCK:$1 />");return a;},SetData:function(a,c){this.EditingArea.Mode=FCK.EditMode;if(FCKBrowserInfo.IsIE&&FCK.EditorDocument){FCK.EditorDocument.detachEvent("onselectionchange",Doc_OnSelectionChange);}FCKTempBin.Reset();FCK.Selection.Release();if(FCK.EditMode==0){this._ForceResetIsDirty=(c===true);a=FCKConfig.ProtectedSource.Protect(a);a=FCK.DataProcessor.ConvertToHtml(a);a=a.replace(FCKRegexLib.InvalidSelfCloseTags,"$1></$2>");a=FCK.ProtectEvents(a);a=FCK.ProtectUrls(a);a=FCK.ProtectTags(a);if(FCK.TempBaseTag.length>0&&!FCKRegexLib.HasBaseTag.test(a)){a=a.replace(FCKRegexLib.HeadOpener,"$&"+FCK.TempBaseTag);}var b="";if(!FCKConfig.FullPage){b+=_FCK_GetEditorAreaStyleTags();}if(FCKBrowserInfo.IsIE){b+=FCK._GetBehaviorsStyle();}else{if(FCKConfig.ShowBorders){b+=FCKTools.GetStyleHtml(FCK_ShowTableBordersCSS,true);}}b+=FCKTools.GetStyleHtml(FCK_InternalCSS,true);a=a.replace(FCKRegexLib.HeadCloser,b+"$&");this.EditingArea.OnLoad=_FCK_EditingArea_OnLoad;this.EditingArea.Start(a);}else{FCK.EditorWindow=null;FCK.EditorDocument=null;FCKDomTools.PaddingNode=null;this.EditingArea.OnLoad=null;this.EditingArea.Start(a);this.EditingArea.Textarea._FCKShowContextMenu=true;FCK.EnterKeyHandler=null;if(c){this.ResetIsDirty();}FCK.KeystrokeHandler.AttachToElement(this.EditingArea.Textarea);this.EditingArea.Textarea.focus();FCK.Events.FireEvent("OnAfterSetHTML");}if(window.onresize){window.onresize();}},RedirectNamedCommands:{},ExecuteNamedCommand:function(a,d,c,b){if(!b){FCKUndo.SaveUndoStep();}if(!c&&FCK.RedirectNamedCommands[a]!=null){FCK.ExecuteRedirectedNamedCommand(a,d);}else{FCK.Focus();FCK.EditorDocument.execCommand(a,false,d);FCK.Events.FireEvent("OnSelectionChange");}if(!b){FCKUndo.SaveUndoStep();}},GetNamedCommandState:function(a){try{if(FCKBrowserInfo.IsSafari&&FCK.EditorWindow&&a.IEquals("Paste")){return 0;}if(!FCK.EditorDocument.queryCommandEnabled(a)){return -1;}else{return FCK.EditorDocument.queryCommandState(a)?1:0;}}catch(b){return 0;}},GetNamedCommandValue:function(a){var d="";var c=FCK.GetNamedCommandState(a);if(c==-1){return null;}try{d=this.EditorDocument.queryCommandValue(a);}catch(b){}return d?d:"";},Paste:function(a){if(FCK.Status!=2||!FCK.Events.FireEvent("OnPaste")){return false;}return a||FCK._ExecPaste();},PasteFromWord:function(){FCKDialog.OpenDialog("FCKDialog_Paste",FCKLang.PasteFromWord,"dialog/fck_paste.html",400,330,"Word");},Preview:function(){var a;if(FCKConfig.FullPage){if(FCK.TempBaseTag.length>0){a=FCK.TempBaseTag+FCK.GetXHTML();}else{a=FCK.GetXHTML();}}else{a=FCKConfig.DocType+'<html dir="'+FCKConfig.ContentLangDirection+'"><head>'+FCK.TempBaseTag+"<title>"+FCKLang.Preview+"</title>"+_FCK_GetEditorAreaStyleTags()+"</head><body"+FCKConfig.GetBodyAttributes()+">"+FCK.GetXHTML()+"</body></html>";}var g=FCKConfig.ScreenWidth*0.8;var f=FCKConfig.ScreenHeight*0.7;var d=(FCKConfig.ScreenWidth-g)/2;var c="";if(FCK_IS_CUSTOM_DOMAIN&&FCKBrowserInfo.IsIE){window._FCKHtmlToLoad=a;c='javascript:void( (function(){document.open() ;document.domain="'+document.domain+'" ;document.write( window.opener._FCKHtmlToLoad );document.close() ;window.opener._FCKHtmlToLoad = null ;})() )';}var b=window.open(c,null,"toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+g+",height="+f+",left="+d);if(!FCK_IS_CUSTOM_DOMAIN||!FCKBrowserInfo.IsIE){b.document.write(a);b.document.close();}},SwitchEditMode:function(a){var d=(FCK.EditMode==0);var c=FCK.IsDirty();var b;if(d){FCKCommands.GetCommand("ShowBlocks").SaveState();if(!a&&FCKBrowserInfo.IsIE){FCKUndo.SaveUndoStep();}b=FCK.GetXHTML(FCKConfig.FormatSource);if(FCKBrowserInfo.IsIE){FCKTempBin.ToHtml();}if(b==null){return false;}}else{b=this.EditingArea.Textarea.value;}FCK.EditMode=d?1:0;FCK.SetData(b,!c);FCK.Focus();FCKTools.RunFunction(FCK.ToolbarSet.RefreshModeState,FCK.ToolbarSet);return true;},InsertElement:function(a){if(typeof a=="string"){a=this.EditorDocument.createElement(a);}var d=a.nodeName.toLowerCase();FCKSelection.Restore();var c=new FCKDomRange(this.EditorWindow);c.MoveToSelection();c.DeleteContents();if(FCKListsLib.BlockElements[d]!=null){if(c.StartBlock){if(c.CheckStartOfBlock()){c.MoveToPosition(c.StartBlock,3);}else{if(c.CheckEndOfBlock()){c.MoveToPosition(c.StartBlock,4);}else{c.SplitBlock();}}}c.InsertNode(a);var b=FCKDomTools.GetNextSourceElement(a,false,null,["hr","br","param","img","area","input"],true);if(!b&&FCKConfig.EnterMode!="br"){b=this.EditorDocument.body.appendChild(this.EditorDocument.createElement(FCKConfig.EnterMode));if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(b);}}if(FCKListsLib.EmptyElements[d]==null){c.MoveToElementEditStart(a);}else{if(b){c.MoveToElementEditStart(b);}else{c.MoveToPosition(a,4);}}if(FCKBrowserInfo.IsGeckoLike){if(b){FCKDomTools.ScrollIntoView(b,false);}FCKDomTools.ScrollIntoView(a,false);}}else{c.InsertNode(a);c.SetStart(a,4);c.SetEnd(a,4);}c.Select();c.Release();this.Focus();return a;},_InsertBlockElement:function(a){},_IsFunctionKey:function(a){if(a>=16&&a<=20){return true;}if(a==27||(a>=33&&a<=40)){return true;}if(a==45){return true;}return false;},_KeyDownListener:function(a){if(!a){a=FCK.EditorWindow.event;}if(FCK.EditorWindow){if(!FCK._IsFunctionKey(a.keyCode)&&!(a.ctrlKey||a.metaKey)&&!(a.keyCode==46)){FCK._KeyDownUndo();}}return true;},_KeyDownUndo:function(){if(!FCKUndo.Typing){FCKUndo.SaveUndoStep();FCKUndo.Typing=true;FCK.Events.FireEvent("OnSelectionChange");}FCKUndo.TypesCount++;FCKUndo.Changed=1;if(FCKUndo.TypesCount>FCKUndo.MaxTypes){FCKUndo.TypesCount=0;FCKUndo.SaveUndoStep();}},_TabKeyHandler:function(b){if(!b){b=window.event;}var i=b.keyCode;if(i==9&&FCK.EditMode!=0){if(FCKBrowserInfo.IsIE){var h=document.selection.createRange();if(h.parentElement()!=FCK.EditingArea.Textarea){return true;}h.text="\t";h.select();}else{var c=[];var g=FCK.EditingArea.Textarea;var f=g.selectionStart;var d=g.selectionEnd;c.push(g.value.substr(0,f));c.push("\t");c.push(g.value.substr(d));g.value=c.join("");g.setSelectionRange(f+1,f+1);}if(b.preventDefault){return b.preventDefault();}return b.returnValue=false;}return true;}};FCK.Events=new FCKEvents(FCK);FCK.GetHTML=FCK.GetXHTML=FCK.GetData;FCK.SetHTML=FCK.SetData;FCK.InsertElementAndGetIt=FCK.CreateElement=FCK.InsertElement;function _FCK_ProtectEvents_ReplaceTags(a){return a.replace(FCKRegexLib.EventAttributes,_FCK_ProtectEvents_ReplaceEvents);}function _FCK_ProtectEvents_ReplaceEvents(a,b){return" "+b+'_fckprotectedatt="'+encodeURIComponent(a)+'"';}function _FCK_ProtectEvents_RestoreEvents(a,b){return decodeURIComponent(b);}function _FCK_MouseEventsListener(a){if(!a){a=window.event;}if(a.type=="mousedown"){FCK.MouseDownFlag=true;}else{if(a.type=="mouseup"){FCK.MouseDownFlag=false;}else{if(a.type=="mousemove"){FCK.Events.FireEvent("OnMouseMove",a);}}}}function _FCK_PaddingNodeListener(){if(FCKConfig.EnterMode.IEquals("br")){return;}FCKDomTools.EnforcePaddingNode(FCK.EditorDocument,FCKConfig.EnterMode);if(!FCKBrowserInfo.IsIE&&FCKDomTools.PaddingNode){var a=FCKSelection.GetSelection();if(a&&a.rangeCount==1){var f=a.getRangeAt(0);if(f.collapsed&&f.startContainer==FCK.EditorDocument.body&&f.startOffset==0){f.selectNodeContents(FCKDomTools.PaddingNode);f.collapse(true);a.removeAllRanges();a.addRange(f);}}}else{if(FCKDomTools.PaddingNode){var d=FCKSelection.GetParentElement();var c=FCKDomTools.PaddingNode;if(d&&d.nodeName.IEquals("body")){if(FCK.EditorDocument.body.childNodes.length==1&&FCK.EditorDocument.body.firstChild==c){if(FCKSelection._GetSelectionDocument(FCK.EditorDocument.selection)!=FCK.EditorDocument){return;}var f=FCK.EditorDocument.body.createTextRange();var b=false;if(!c.childNodes.firstChild){c.appendChild(FCKTools.GetElementDocument(c).createTextNode("\ufeff"));b=true;}f.moveToElementText(c);f.select();if(b){f.pasteHTML("");}}}}}}function _FCK_EditingArea_OnLoad(){FCK.EditorWindow=FCK.EditingArea.Window;FCK.EditorDocument=FCK.EditingArea.Document;if(FCKBrowserInfo.IsIE){FCKTempBin.ToElements();}FCK.InitializeBehaviors();FCK.MouseDownFlag=false;FCKTools.AddEventListener(FCK.EditorDocument,"mousemove",_FCK_MouseEventsListener);FCKTools.AddEventListener(FCK.EditorDocument,"mousedown",_FCK_MouseEventsListener);FCKTools.AddEventListener(FCK.EditorDocument,"mouseup",_FCK_MouseEventsListener);if(FCKBrowserInfo.IsSafari){FCKTools.AddEventListener(FCK.EditorDocument,"paste",function(c){var b=new FCKDomRange(FCK.EditorWindow);var f=FCK.EditorDocument.createTextNode("\ufeff");var d=FCK.EditorDocument.createElement("a");d.id="fck_paste_padding";d.innerHTML="&#65279;";b.MoveToSelection();b.DeleteContents();b.InsertNode(f);b.Collapse();b.InsertNode(d);b.MoveToPosition(d,3);b.Select();setTimeout(function(){f.parentNode.removeChild(f);d=FCK.EditorDocument.getElementById("fck_paste_padding");d.parentNode.removeChild(d);},0);});}if(FCKBrowserInfo.IsSafari){var a=function(b){if(!(b.ctrlKey||b.metaKey)){return;}if(FCK.EditMode!=0){return;}switch(b.keyCode){case 89:FCKUndo.Redo();break;case 90:FCKUndo.Undo();break;}};FCKTools.AddEventListener(FCK.EditorDocument,"keyup",a);}FCK.EnterKeyHandler=new FCKEnterKey(FCK.EditorWindow,FCKConfig.EnterMode,FCKConfig.ShiftEnterMode,FCKConfig.TabSpaces);FCK.KeystrokeHandler.AttachToElement(FCK.EditorDocument);if(FCK._ForceResetIsDirty){FCK.ResetIsDirty();}if(FCKBrowserInfo.IsIE&&FCK.HasFocus){FCK.EditorDocument.body.setActive();}FCK.OnAfterSetHTML();FCKCommands.GetCommand("ShowBlocks").RestoreState();if(FCK.Status!=0){return;}FCK.SetStatus(1);}function _FCK_GetEditorAreaStyleTags(){return FCKTools.GetStyleHtml(FCKConfig.EditorAreaCSS)+FCKTools.GetStyleHtml(FCKConfig.EditorAreaStyles);}function _FCK_KeystrokeHandler_OnKeystroke(a,c){if(FCK.Status!=2){return false;}if(FCK.EditMode==0){switch(c){case"Paste":return !FCK.Paste();case"Cut":FCKUndo.SaveUndoStep();return false;}}else{if(c.Equals("Paste","Undo","Redo","SelectAll","Cut")){return false;}}var b=FCK.Commands.GetCommand(c);if(b.GetState()==-1){return false;}return(b.Execute.apply(b,FCKTools.ArgumentsToArray(arguments,2))!==false);}(function(){var a=window.parent.document;var c=a.getElementById(FCK.Name);var b=0;while(c||b==0){if(c&&c.tagName.toLowerCase().Equals("input","textarea")){FCK.LinkedField=c;break;}c=a.getElementsByName(FCK.Name)[b++];}})();var FCKTempBin={Elements:[],AddElement:function(a){var b=this.Elements.length;this.Elements[b]=a;return b;},RemoveElement:function(a){var b=this.Elements[a];this.Elements[a]=null;return b;},Reset:function(){var a=0;while(a<this.Elements.length){this.Elements[a++]=null;}this.Elements.length=0;},ToHtml:function(){for(var a=0;a<this.Elements.length;a++){this.Elements[a]="<div>&nbsp;"+this.Elements[a].outerHTML+"</div>";this.Elements[a].isHtml=true;}},ToElements:function(){var a=FCK.EditorDocument.createElement("div");for(var b=0;b<this.Elements.length;b++){if(this.Elements[b].isHtml){a.innerHTML=this.Elements[b];this.Elements[b]=a.firstChild.removeChild(a.firstChild.lastChild);}}}};var FCKFocusManager=FCK.FocusManager={IsLocked:false,AddWindow:function(a,c){var b;if(FCKBrowserInfo.IsIE){b=a.nodeType==1?a:a.frameElement?a.frameElement:a.document;}else{if(FCKBrowserInfo.IsSafari){b=a;}else{b=a.document;}}FCKTools.AddEventListener(b,"blur",FCKFocusManager_Win_OnBlur);FCKTools.AddEventListener(b,"focus",c?FCKFocusManager_Win_OnFocus_Area:FCKFocusManager_Win_OnFocus);},RemoveWindow:function(a){if(FCKBrowserInfo.IsIE){oTarget=a.nodeType==1?a:a.frameElement?a.frameElement:a.document;}else{oTarget=a.document;}FCKTools.RemoveEventListener(oTarget,"blur",FCKFocusManager_Win_OnBlur);FCKTools.RemoveEventListener(oTarget,"focus",FCKFocusManager_Win_OnFocus_Area);FCKTools.RemoveEventListener(oTarget,"focus",FCKFocusManager_Win_OnFocus);},Lock:function(){this.IsLocked=true;},Unlock:function(){if(this._HasPendingBlur){FCKFocusManager._Timer=window.setTimeout(FCKFocusManager_FireOnBlur,100);}this.IsLocked=false;},_ResetTimer:function(){this._HasPendingBlur=false;if(this._Timer){window.clearTimeout(this._Timer);delete this._Timer;}}};function FCKFocusManager_Win_OnBlur(){if(typeof(FCK)!="undefined"&&FCK.HasFocus){FCKFocusManager._ResetTimer();FCKFocusManager._Timer=window.setTimeout(FCKFocusManager_FireOnBlur,100);}}function FCKFocusManager_FireOnBlur(){if(FCKFocusManager.IsLocked){FCKFocusManager._HasPendingBlur=true;}else{FCK.HasFocus=false;FCK.Events.FireEvent("OnBlur");}}function FCKFocusManager_Win_OnFocus_Area(){if(FCKFocusManager._IsFocusing){return;}FCKFocusManager._IsFocusing=true;FCK.Focus();FCKFocusManager_Win_OnFocus();FCKTools.RunFunction(function(){delete FCKFocusManager._IsFocusing;});}function FCKFocusManager_Win_OnFocus(){FCKFocusManager._ResetTimer();if(!FCK.HasFocus&&!FCKFocusManager.IsLocked){FCK.HasFocus=true;FCK.Events.FireEvent("OnFocus");}}(function(){var a=window.frameElement;var d=a.width;var c=a.height;if(/^\d+$/.test(d)){d+="px";}if(/^\d+$/.test(c)){c+="px";}var b=a.style;b.border=b.padding=b.margin=0;b.backgroundColor="transparent";b.backgroundImage="none";b.width=d;b.height=c;})();FCK.Description="FCKeditor for Gecko Browsers";FCK.InitializeBehaviors=function(){if(window.onresize){window.onresize();}FCKFocusManager.AddWindow(this.EditorWindow);this.ExecOnSelectionChange=function(){FCK.Events.FireEvent("OnSelectionChange");};this._ExecDrop=function(b){if(FCK.MouseDownFlag){FCK.MouseDownFlag=false;return;}if(FCKConfig.ForcePasteAsPlainText){if(b.dataTransfer){var a=b.dataTransfer.getData("Text");a=FCKTools.HTMLEncode(a);a=FCKTools.ProcessLineBreaks(window,FCKConfig,a);FCK.InsertHtml(a);}else{if(FCKConfig.ShowDropDialog){FCK.PasteAsPlainText();}}b.preventDefault();b.stopPropagation();}};this._ExecCheckCaret=function(a){if(FCK.EditMode!=0){return;}if(a.type=="keypress"){var d=a.keyCode;if(d<33||d>40){return;}}var c=function(f){if(f.nodeType!=1){return false;}var g=f.tagName.toLowerCase();return(FCKListsLib.BlockElements[g]||FCKListsLib.EmptyElements[g]);};var b=function(){var l=FCKSelection.GetSelection();var k=l.getRangeAt(0);if(!k||!k.collapsed){return;}var j=k.endContainer;if(j.nodeType!=3){return;}if(j.nodeValue.length!=k.endOffset){return;}var i=j.parentNode.tagName.toLowerCase();if(!(i=="a"||(!FCKBrowserInfo.IsOpera&&String(j.parentNode.contentEditable)=="false")||(!(FCKListsLib.BlockElements[i]||FCKListsLib.NonEmptyBlockElements[i])&&d==35))){return;}var h=FCKTools.GetNextTextNode(j,j.parentNode,c);if(h){return;}k=FCK.EditorDocument.createRange();h=FCKTools.GetNextTextNode(j,j.parentNode.parentNode,c);if(h){if(FCKBrowserInfo.IsOpera&&d==37){return;}k.setStart(h,0);k.setEnd(h,0);}else{while(j.parentNode&&j.parentNode!=FCK.EditorDocument.body&&j.parentNode!=FCK.EditorDocument.documentElement&&j==j.parentNode.lastChild&&(!FCKListsLib.BlockElements[j.parentNode.tagName.toLowerCase()]&&!FCKListsLib.NonEmptyBlockElements[j.parentNode.tagName.toLowerCase()])){j=j.parentNode;}if(FCKListsLib.BlockElements[i]||FCKListsLib.EmptyElements[i]||j==FCK.EditorDocument.body){k.setStart(j,j.childNodes.length);k.setEnd(j,j.childNodes.length);}else{var g=j.nextSibling;while(g){if(g.nodeType!=1){g=g.nextSibling;continue;}var f=g.tagName.toLowerCase();if(FCKListsLib.BlockElements[f]||FCKListsLib.EmptyElements[f]||FCKListsLib.NonEmptyBlockElements[f]){break;}g=g.nextSibling;}var m=FCK.EditorDocument.createTextNode("");if(g){j.parentNode.insertBefore(m,g);}else{j.parentNode.appendChild(m);}k.setStart(m,0);k.setEnd(m,0);}}l.removeAllRanges();l.addRange(k);FCK.Events.FireEvent("OnSelectionChange");};setTimeout(b,1);};this.ExecOnSelectionChangeTimer=function(){if(FCK.LastOnChangeTimer){window.clearTimeout(FCK.LastOnChangeTimer);}FCK.LastOnChangeTimer=window.setTimeout(FCK.ExecOnSelectionChange,100);};this.EditorDocument.addEventListener("mouseup",this.ExecOnSelectionChange,false);this.EditorDocument.addEventListener("keyup",this.ExecOnSelectionChangeTimer,false);this._DblClickListener=function(a){FCK.OnDoubleClick(a.target);a.stopPropagation();};this.EditorDocument.addEventListener("dblclick",this._DblClickListener,true);this.EditorDocument.addEventListener("keydown",this._KeyDownListener,false);if(FCKBrowserInfo.IsGecko){this.EditorWindow.addEventListener("dragdrop",this._ExecDrop,true);}else{if(FCKBrowserInfo.IsSafari){this.EditorDocument.addEventListener("dragover",function(a){if(!FCK.MouseDownFlag&&FCK.Config.ForcePasteAsPlainText){a.returnValue=false;}},true);this.EditorDocument.addEventListener("drop",this._ExecDrop,true);this.EditorDocument.addEventListener("mousedown",function(a){var b=a.srcElement;if(b.nodeName.IEquals("IMG","HR","INPUT","TEXTAREA","SELECT")){FCKSelection.SelectNode(b);}},true);this.EditorDocument.addEventListener("mouseup",function(a){if(a.srcElement.nodeName.IEquals("INPUT","TEXTAREA","SELECT")){a.preventDefault();}},true);this.EditorDocument.addEventListener("click",function(a){if(a.srcElement.nodeName.IEquals("INPUT","TEXTAREA","SELECT")){a.preventDefault();}},true);}}if(FCKBrowserInfo.IsGecko||FCKBrowserInfo.IsOpera){this.EditorDocument.addEventListener("keypress",this._ExecCheckCaret,false);this.EditorDocument.addEventListener("click",this._ExecCheckCaret,false);}FCK.ContextMenu._InnerContextMenu.SetMouseClickWindow(FCK.EditorWindow);FCK.ContextMenu._InnerContextMenu.AttachToElement(FCK.EditorDocument);};FCK.MakeEditable=function(){this.EditingArea.MakeEditable();};function Document_OnContextMenu(a){if(!a.target._FCKShowContextMenu){a.preventDefault();}}document.oncontextmenu=Document_OnContextMenu;FCK._BaseGetNamedCommandState=FCK.GetNamedCommandState;FCK.GetNamedCommandState=function(a){switch(a){case"Unlink":return FCKSelection.HasAncestorNode("A")?0:-1;default:return FCK._BaseGetNamedCommandState(a);}};FCK.RedirectNamedCommands={Print:true,Paste:true};FCK.ExecuteRedirectedNamedCommand=function(a,c){switch(a){case"Print":FCK.EditorWindow.print();break;case"Paste":try{if(FCKBrowserInfo.IsSafari){throw"";}if(FCK.Paste()){FCK.ExecuteNamedCommand("Paste",null,true);}}catch(b){if(FCKConfig.ForcePasteAsPlainText){FCK.PasteAsPlainText();}else{FCKDialog.OpenDialog("FCKDialog_Paste",FCKLang.Paste,"dialog/fck_paste.html",400,330,"Security");}}break;default:FCK.ExecuteNamedCommand(a,c);}};FCK._ExecPaste=function(){FCKUndo.SaveUndoStep();if(FCKConfig.ForcePasteAsPlainText){FCK.PasteAsPlainText();return false;}return true;};FCK.InsertHtml=function(a){var i=FCK.EditorDocument,b;a=FCKConfig.ProtectedSource.Protect(a);a=FCK.ProtectEvents(a);a=FCK.ProtectUrls(a);a=FCK.ProtectTags(a);FCKUndo.SaveUndoStep();if(FCKBrowserInfo.IsGecko){a=a.replace(/&nbsp;$/,'$&<span _fcktemp="1"/>');var h=new FCKDocumentFragment(this.EditorDocument);h.AppendHtml(a);var g=h.RootNode.lastChild;b=new FCKDomRange(this.EditorWindow);b.MoveToSelection();var d=h.RootNode.firstChild;while(d&&d.nodeType!=1){d=d.nextSibling;}if(d&&FCKListsLib.BlockElements[d.nodeName.toLowerCase()]){b.SplitBlock();}b.DeleteContents();b.InsertNode(h.RootNode);b.MoveToPosition(g,4);}else{i.execCommand("inserthtml",false,a);}this.Focus();if(!b){b=new FCKDomRange(this.EditorWindow);b.MoveToSelection();}var c=b.CreateBookmark();FCKDocumentProcessor.Process(i);try{b.MoveToBookmark(c);b.Select();}catch(f){}this.Events.FireEvent("OnSelectionChange");};FCK.PasteAsPlainText=function(){FCKTools.RunFunction(FCKDialog.OpenDialog,FCKDialog,["FCKDialog_Paste",FCKLang.PasteAsText,"dialog/fck_paste.html",400,330,"PlainText"]);};FCK.GetClipboardHTML=function(){return"";};FCK.CreateLink=function(a,h){var g=[];if(FCKSelection.GetSelection().isCollapsed){return g;}FCK.ExecuteNamedCommand("Unlink",null,false,!!h);if(a.length>0){var f="javascript:void(0);/*"+(new Date().getTime())+"*/";FCK.ExecuteNamedCommand("CreateLink",f,false,!!h);var d=this.EditorDocument.evaluate("//a[@href='"+f+"']",this.EditorDocument.body,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(var b=0;b<d.snapshotLength;b++){var c=d.snapshotItem(b);c.href=a;g.push(c);}}return g;};FCK._FillEmptyBlock=function(a){if(!a||a.nodeType!=1){return;}var b=a.tagName.toLowerCase();if(b!="p"&&b!="div"){return;}if(a.firstChild){return;}FCKTools.AppendBogusBr(a);};FCK._ExecCheckEmptyBlock=function(){FCK._FillEmptyBlock(FCK.EditorDocument.body.firstChild);var a=FCKSelection.GetSelection();if(!a||a.rangeCount<1){return;}var b=a.getRangeAt(0);FCK._FillEmptyBlock(b.startContainer);};var FCKConfig=FCK.Config={};if(document.location.protocol=="file:"){FCKConfig.BasePath=decodeURIComponent(document.location.pathname.substr(1));FCKConfig.BasePath=FCKConfig.BasePath.replace(/\\/gi,"/");var sFullProtocol=document.location.href.match(/^(file\:\/{2,3})/)[1];if(FCKBrowserInfo.IsOpera){sFullProtocol+="localhost/";}FCKConfig.BasePath=sFullProtocol+FCKConfig.BasePath.substring(0,FCKConfig.BasePath.lastIndexOf("/")+1);}else{FCKConfig.BasePath=document.location.protocol+"//"+document.location.host+document.location.pathname.substring(0,document.location.pathname.lastIndexOf("/")+1);}FCKConfig.FullBasePath=FCKConfig.BasePath;FCKConfig.EditorPath=FCKConfig.BasePath.replace(/editor\/$/,"");try{FCKConfig.ScreenWidth=screen.width;FCKConfig.ScreenHeight=screen.height;}catch(e){FCKConfig.ScreenWidth=800;FCKConfig.ScreenHeight=600;}FCKConfig.ProcessHiddenField=function(){this.PageConfig={};var a=window.parent.document.getElementById(FCK.Name+"___Config");if(!a){return;}var g=a.value.split("&");for(var b=0;b<g.length;b++){if(g[b].length==0){continue;}var f=g[b].split("=");var d=decodeURIComponent(f[0]);var c=decodeURIComponent(f[1]);if(d=="CustomConfigurationsPath"){FCKConfig[d]=c;}else{if(c.toLowerCase()=="true"){this.PageConfig[d]=true;}else{if(c.toLowerCase()=="false"){this.PageConfig[d]=false;}else{if(c.length>0&&!isNaN(c)){this.PageConfig[d]=parseFloat(c);}else{this.PageConfig[d]=c;}}}}}};function FCKConfig_LoadPageConfig(){var a=FCKConfig.PageConfig;for(var b in a){FCKConfig[b]=a[b];}}function FCKConfig_PreProcess(){var a=FCKConfig;if(a.AllowQueryStringDebug){try{if((/fckdebug=true/i).test(window.top.location.search)){a.Debug=true;}}catch(b){}}if(!a.PluginsPath.EndsWith("/")){a.PluginsPath+="/";}var c=a.ToolbarComboPreviewCSS;if(!c||c.length==0){a.ToolbarComboPreviewCSS=a.EditorAreaCSS;}a.RemoveAttributesArray=(a.RemoveAttributes||"").split(",");if(!FCKConfig.SkinEditorCSS||FCKConfig.SkinEditorCSS.length==0){FCKConfig.SkinEditorCSS=FCKConfig.SkinPath+"fck_editor.css";}if(!FCKConfig.SkinDialogCSS||FCKConfig.SkinDialogCSS.length==0){FCKConfig.SkinDialogCSS=FCKConfig.SkinPath+"fck_dialog.css";}}FCKConfig.ToolbarSets={};FCKConfig.Plugins={};FCKConfig.Plugins.Items=[];FCKConfig.Plugins.Add=function(a,c,b){FCKConfig.Plugins.Items.push([a,c,b]);};FCKConfig.ProtectedSource={};FCKConfig.ProtectedSource._CodeTag=(new Date()).valueOf();FCKConfig.ProtectedSource.RegexEntries=[/<!--[\s\S]*?-->/g,/<script[\s\S]*?<\/script>/gi,/<noscript[\s\S]*?<\/noscript>/gi];FCKConfig.ProtectedSource.Add=function(a){this.RegexEntries.push(a);};FCKConfig.ProtectedSource.Protect=function(a){var d=this._CodeTag;function c(f){var g=FCKTempBin.AddElement(f);return"<!--{"+d+g+"}-->";}for(var b=0;b<this.RegexEntries.length;b++){a=a.replace(this.RegexEntries[b],c);}return a;};FCKConfig.ProtectedSource.Revert=function(a,d){function c(f,h,g){var i=d?FCKTempBin.RemoveElement(g):FCKTempBin.Elements[g];return FCKConfig.ProtectedSource.Revert(i,d);}var b=new RegExp("(<|&lt;)!--\\{"+this._CodeTag+"(\\d+)\\}--(>|&gt;)","g");return a.replace(b,c);};FCKConfig.GetBodyAttributes=function(){var a="";if(this.BodyId&&this.BodyId.length>0){a+=' id="'+this.BodyId+'"';}if(this.BodyClass&&this.BodyClass.length>0){a+=' class="'+this.BodyClass+'"';}return a;};FCKConfig.ApplyBodyAttributes=function(a){if(this.BodyId&&this.BodyId.length>0){a.id=FCKConfig.BodyId;}if(this.BodyClass&&this.BodyClass.length>0){a.className+=" "+FCKConfig.BodyClass;}};var FCKDebug={Output:function(){},OutputObject:function(){}};var FCKDomTools={MoveChildren:function(a,d,c){if(a==d){return;}var b;if(c){while((b=a.lastChild)){d.insertBefore(a.removeChild(b),d.firstChild);}}else{while((b=a.firstChild)){d.appendChild(a.removeChild(b));}}},MoveNode:function(a,c,b){if(b){c.insertBefore(FCKDomTools.RemoveNode(a),c.firstChild);}else{c.appendChild(FCKDomTools.RemoveNode(a));}},TrimNode:function(a){this.LTrimNode(a);this.RTrimNode(a);},LTrimNode:function(a){var d;while((d=a.firstChild)){if(d.nodeType==3){var c=d.nodeValue.LTrim();var b=d.nodeValue.length;if(c.length==0){a.removeChild(d);continue;}else{if(c.length<b){d.splitText(b-c.length);a.removeChild(a.firstChild);}}}break;}},RTrimNode:function(a){var d;while((d=a.lastChild)){if(d.nodeType==3){var c=d.nodeValue.RTrim();var b=d.nodeValue.length;if(c.length==0){d.parentNode.removeChild(d);continue;}else{if(c.length<b){d.splitText(c.length);a.lastChild.parentNode.removeChild(a.lastChild);}}}break;}if(!FCKBrowserInfo.IsIE&&!FCKBrowserInfo.IsOpera){d=a.lastChild;if(d&&d.nodeType==1&&d.nodeName.toLowerCase()=="br"){d.parentNode.removeChild(d);}}},RemoveNode:function(a,c){if(c){var b;while((b=a.firstChild)){a.parentNode.insertBefore(a.removeChild(b),a);}}return a.parentNode.removeChild(a);},GetFirstChild:function(a,c){if(typeof(c)=="string"){c=[c];}var b=a.firstChild;while(b){if(b.nodeType==1&&b.tagName.Equals.apply(b.tagName,c)){return b;}b=b.nextSibling;}return null;},GetLastChild:function(a,c){if(typeof(c)=="string"){c=[c];}var b=a.lastChild;while(b){if(b.nodeType==1&&(!c||b.tagName.Equals(c))){return b;}b=b.previousSibling;}return null;},GetPreviousSourceElement:function(a,d,c,b){if(!a){return null;}if(c&&a.nodeType==1&&a.nodeName.IEquals(c)){return null;}if(a.previousSibling){a=a.previousSibling;}else{return this.GetPreviousSourceElement(a.parentNode,d,c,b);}while(a){if(a.nodeType==1){if(c&&a.nodeName.IEquals(c)){break;}if(!b||!a.nodeName.IEquals(b)){return a;}}else{if(d&&a.nodeType==3&&a.nodeValue.RTrim().length>0){break;}}if(a.lastChild){a=a.lastChild;}else{return this.GetPreviousSourceElement(a,d,c,b);}}return null;},GetNextSourceElement:function(a,f,d,c,b){while((a=this.GetNextSourceNode(a,b))){if(a.nodeType==1){if(d&&a.nodeName.IEquals(d)){break;}if(c&&a.nodeName.IEquals(c)){return this.GetNextSourceElement(a,f,d,c);}return a;}else{if(f&&a.nodeType==3&&a.nodeValue.RTrim().length>0){break;}}}return null;},GetNextSourceNode:function(a,f,d,c){if(!a){return null;}var b;if(!f&&a.firstChild){b=a.firstChild;}else{if(c&&a==c){return null;}b=a.nextSibling;if(!b&&(!c||c!=a.parentNode)){return this.GetNextSourceNode(a.parentNode,true,d,c);}}if(d&&b&&b.nodeType!=d){return this.GetNextSourceNode(b,false,d,c);}return b;},GetPreviousSourceNode:function(a,f,d,c){if(!a){return null;}var b;if(!f&&a.lastChild){b=a.lastChild;}else{if(c&&a==c){return null;}b=a.previousSibling;if(!b&&(!c||c!=a.parentNode)){return this.GetPreviousSourceNode(a.parentNode,true,d,c);}}if(d&&b&&b.nodeType!=d){return this.GetPreviousSourceNode(b,false,d,c);}return b;},InsertAfterNode:function(a,b){return a.parentNode.insertBefore(b,a.nextSibling);},GetParents:function(a){var b=[];while(a){b.unshift(a);a=a.parentNode;}return b;},GetCommonParents:function(a,g){var f=this.GetParents(a);var d=this.GetParents(g);var c=[];for(var b=0;b<f.length;b++){if(f[b]==d[b]){c.push(f[b]);}}return c;},GetCommonParentNode:function(a,g,f){var d={};if(!f.pop){f=[f];}while(f.length>0){d[f.pop().toLowerCase()]=1;}var c=this.GetCommonParents(a,g);var b=null;while((b=c.pop())){if(d[b.nodeName.toLowerCase()]){return b;}}return null;},GetIndexOf:function(a){var c=a.parentNode?a.parentNode.firstChild:null;var b=-1;while(c){b++;if(c==a){return b;}c=c.nextSibling;}return -1;},PaddingNode:null,EnforcePaddingNode:function(a,d){try{if(!a||!a.body){return;}}catch(b){return;}this.CheckAndRemovePaddingNode(a,d,true);try{if(a.body.lastChild&&(a.body.lastChild.nodeType!=1||a.body.lastChild.tagName.toLowerCase()==d.toLowerCase())){return;}}catch(b){return;}var c=a.createElement(d);if(FCKBrowserInfo.IsGecko&&FCKListsLib.NonEmptyBlockElements[d]){FCKTools.AppendBogusBr(c);}this.PaddingNode=c;if(a.body.childNodes.length==1&&a.body.firstChild.nodeType==1&&a.body.firstChild.tagName.toLowerCase()=="br"&&(a.body.firstChild.getAttribute("_moz_dirty")!=null||a.body.firstChild.getAttribute("type")=="_moz")){a.body.replaceChild(c,a.body.firstChild);}else{a.body.appendChild(c);}},CheckAndRemovePaddingNode:function(a,f,d){var c=this.PaddingNode;if(!c){return;}try{if(c.parentNode!=a.body||c.tagName.toLowerCase()!=f||(c.childNodes.length>1)||(c.firstChild&&c.firstChild.nodeValue!="\xa0"&&String(c.firstChild.tagName).toLowerCase()!="br")){this.PaddingNode=null;return;}}catch(b){this.PaddingNode=null;return;}if(!d){if(c.parentNode.childNodes.length>1){c.parentNode.removeChild(c);}this.PaddingNode=null;}},HasAttribute:function(a,c){if(a.hasAttribute){return a.hasAttribute(c);}else{var b=a.attributes[c];return(b!=undefined&&b.specified);}},HasAttributes:function(a){var d=a.attributes;for(var b=0;b<d.length;b++){if(FCKBrowserInfo.IsIE){var c=d[b].nodeName;if(c.StartsWith("_fck")){continue;}if(c=="class"){if(a.className.length>0){return true;}continue;}}if(d[b].specified){return true;}}return false;},RemoveAttribute:function(a,b){if(FCKBrowserInfo.IsIE&&b.toLowerCase()=="class"){b="className";}return a.removeAttribute(b,0);},RemoveAttributes:function(a,c){for(var b=0;b<c.length;b++){this.RemoveAttribute(a,c[b]);}},GetAttributeValue:function(a,c){var b=c;if(typeof c=="string"){c=a.attributes[c];}else{b=c.nodeName;}if(c&&c.specified){if(b=="style"){return a.style.cssText;}else{if(b=="class"||b.indexOf("on")==0){return c.nodeValue;}else{return a.getAttribute(b,2);}}}return null;},Contains:function(a,b){if(a.contains&&b.nodeType==1){return a.contains(b);}while((b=b.parentNode)){if(b==a){return true;}}return false;},BreakParent:function(a,f,d){var c=d||new FCKDomRange(FCKTools.GetElementWindow(a));c.SetStart(a,4);c.SetEnd(f,4);var b=c.ExtractContents();c.InsertNode(a.parentNode.removeChild(a));b.InsertAfterNode(a);c.Release(!!d);},GetNodeAddress:function(a,h){var g=[];while(a&&a!=FCKTools.GetElementDocument(a).documentElement){var f=a.parentNode;var d=-1;for(var b=0;b<f.childNodes.length;b++){var c=f.childNodes[b];if(h===true&&c.nodeType==3&&c.previousSibling&&c.previousSibling.nodeType==3){continue;}d++;if(f.childNodes[b]==a){break;}}g.unshift(d);a=a.parentNode;}return g;},GetNodeFromAddress:function(d,c,b){var a=d.documentElement;for(var g=0;g<c.length;g++){var l=c[g];if(!b){a=a.childNodes[l];continue;}var k=-1;for(var f=0;f<a.childNodes.length;f++){var h=a.childNodes[f];if(b===true&&h.nodeType==3&&h.previousSibling&&h.previousSibling.nodeType==3){continue;}k++;if(k==l){a=h;break;}}}return a;},CloneElement:function(a){a=a.cloneNode(false);a.removeAttribute("id",false);return a;},ClearElementJSProperty:function(a,b){if(FCKBrowserInfo.IsIE){a.removeAttribute(b);}else{delete a[b];}},SetElementMarker:function(a,f,d,c){var b=String(parseInt(Math.random()*4294967295,10));f._FCKMarkerId=b;f[d]=c;if(!a[b]){a[b]={"element":f,"markers":{}};}a[b]["markers"][d]=c;},ClearElementMarkers:function(a,f,d){var c=f._FCKMarkerId;if(!c){return;}this.ClearElementJSProperty(f,"_FCKMarkerId");for(var b in a[c]["markers"]){this.ClearElementJSProperty(f,b);}if(d){delete a[c];}},ClearAllMarkers:function(a){for(var b in a){this.ClearElementMarkers(a,a[b]["element"],true);}},ListToArray:function(d,c,b,a,m){if(!d.nodeName.IEquals(["ul","ol"])){return[];}if(!a){a=0;}if(!b){b=[];}for(var g=0;g<d.childNodes.length;g++){var l=d.childNodes[g];if(!l.nodeName.IEquals("li")){continue;}var k={"parent":d,"indent":a,"contents":[]};if(!m){k.grandparent=d.parentNode;if(k.grandparent&&k.grandparent.nodeName.IEquals("li")){k.grandparent=k.grandparent.parentNode;}}else{k.grandparent=m;}if(c){this.SetElementMarker(c,l,"_FCK_ListArray_Index",b.length);}b.push(k);for(var f=0;f<l.childNodes.length;f++){var h=l.childNodes[f];if(h.nodeName.IEquals(["ul","ol"])){this.ListToArray(h,c,b,a+1,k.grandparent);}else{k.contents.push(h);}}}return b;},ArrayToList:function(d,c,b){if(b==undefined){b=0;}if(!d||d.length<b+1){return null;}var a=FCKTools.GetElementDocument(d[b].parent);var p=a.createDocumentFragment();var o=null;var n=b;var m=Math.max(d[b].indent,0);var l=null;while(true){var k=d[n];if(k.indent==m){if(!o||d[n].parent.nodeName!=o.nodeName){o=d[n].parent.cloneNode(false);p.appendChild(o);}l=a.createElement("li");o.appendChild(l);for(var f=0;f<k.contents.length;f++){l.appendChild(k.contents[f].cloneNode(true));}n++;}else{if(k.indent==Math.max(m,0)+1){var j=this.ArrayToList(d,null,n);l.appendChild(j.listNode);n=j.nextIndex;}else{if(k.indent==-1&&b==0&&k.grandparent){var l;if(k.grandparent.nodeName.IEquals(["ul","ol"])){l=a.createElement("li");}else{if(FCKConfig.EnterMode.IEquals(["div","p"])&&!k.grandparent.nodeName.IEquals("td")){l=a.createElement(FCKConfig.EnterMode);}else{l=a.createDocumentFragment();}}for(var f=0;f<k.contents.length;f++){l.appendChild(k.contents[f].cloneNode(true));}if(l.nodeType==11){if(l.lastChild&&l.lastChild.getAttribute&&l.lastChild.getAttribute("type")=="_moz"){l.removeChild(l.lastChild);}l.appendChild(a.createElement("br"));}if(l.nodeName.IEquals(FCKConfig.EnterMode)&&l.firstChild){this.TrimNode(l);if(FCKListsLib.BlockBoundaries[l.firstChild.nodeName.toLowerCase()]){var h=a.createDocumentFragment();while(l.firstChild){h.appendChild(l.removeChild(l.firstChild));}l=h;}}if(FCKBrowserInfo.IsGeckoLike&&l.nodeName.IEquals(["div","p"])){FCKTools.AppendBogusBr(l);}p.appendChild(l);o=null;n++;}else{return null;}}}if(d.length<=n||Math.max(d[n].indent,0)<m){break;}}if(c){var g=p.firstChild;while(g){if(g.nodeType==1){this.ClearElementMarkers(c,g);}g=this.GetNextSourceNode(g);}}return{"listNode":p,"nextIndex":n};},GetNextSibling:function(a,b){a=a.nextSibling;while(a&&!b&&a.nodeType!=1&&(a.nodeType!=3||a.nodeValue.length==0)){a=a.nextSibling;}return a;},GetPreviousSibling:function(a,b){a=a.previousSibling;while(a&&!b&&a.nodeType!=1&&(a.nodeType!=3||a.nodeValue.length==0)){a=a.previousSibling;}return a;},CheckIsEmptyElement:function(a,d){var c=a.firstChild;var b;while(c){if(c.nodeType==1){if(b||!FCKListsLib.InlineNonEmptyElements[c.nodeName.toLowerCase()]){return false;}if(!d||d(c)===true){b=c;}}else{if(c.nodeType==3&&c.nodeValue.length>0){return false;}}c=c.nextSibling;}return b?this.CheckIsEmptyElement(b,d):true;},SetElementStyles:function(a,d){var c=a.style;for(var b in d){c[b]=d[b];}},SetOpacity:function(a,b){if(FCKBrowserInfo.IsIE){b=Math.round(b*100);a.style.filter=(b>100?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+b+")");}else{a.style.opacity=b;}},GetCurrentElementStyle:function(a,b){if(FCKBrowserInfo.IsIE){return a.currentStyle[b];}else{return a.ownerDocument.defaultView.getComputedStyle(a,"").getPropertyValue(b);}},GetPositionedAncestor:function(a){var b=a;while(b!=FCKTools.GetElementDocument(b).documentElement){if(this.GetCurrentElementStyle(b,"position")!="static"){return b;}if(b==FCKTools.GetElementDocument(b).documentElement&&currentWindow!=w){b=currentWindow.frameElement;}else{b=b.parentNode;}}return null;},ScrollIntoView:function(a,h){var g=FCKTools.GetElementWindow(a);var f=FCKTools.GetViewPaneSize(g).Height;var d=f*-1;if(h===false){d+=a.offsetHeight||0;d+=parseInt(this.GetCurrentElementStyle(a,"marginBottom")||0,10)||0;}var c=FCKTools.GetDocumentPosition(g,a);d+=c.y;var b=FCKTools.GetScrollPosition(g).Y;if(d>0&&(d>b||d<b-f)){g.scrollTo(0,d);}},CheckIsEditable:function(a){var c=a.nodeName.toLowerCase();var b=FCK.DTD[c]||FCK.DTD.span;return(b["#"]&&!FCKListsLib.NonEditableElements[c]);},GetSelectedDivContainers:function(){var a=[];var h=new FCKDomRange(FCK.EditorWindow);h.MoveToSelection();var g=h.GetTouchedStartNode();var f=h.GetTouchedEndNode();var d=g;if(g==f){while(f.nodeType==1&&f.lastChild){f=f.lastChild;}f=FCKDomTools.GetNextSourceNode(f);}while(d&&d!=f){if(d.nodeType!=3||!/^[ \t\n]*$/.test(d.nodeValue)){var c=new FCKElementPath(d);var b=c.BlockLimit;if(b&&b.nodeName.IEquals("div")&&a.IndexOf(b)==-1){a.push(b);}}d=FCKDomTools.GetNextSourceNode(d);}return a;}};var FCKTools={};FCKTools.CreateBogusBR=function(a){var b=a.createElement("br");b.setAttribute("type","_moz");return b;};FCKTools.FixCssUrls=function(a,b){if(!a||a.length==0){return b;}return b.replace(/url\s*\(([\s'"]*)(.*?)([\s"']*)\)/g,function(c,d,f,g){if(/^\/|^\w?:/.test(f)){return c;}else{return"url("+d+a+f+g+")";}});};FCKTools._GetUrlFixedCss=function(a,c){var b=a.match(/^([^|]+)\|([\s\S]*)/);if(b){return FCKTools.FixCssUrls(b[1],b[2]);}else{return a;}};FCKTools.AppendStyleSheet=function(a,d){if(!d){return[];}if(typeof(d)=="string"){if(/[\\\/\.][^{}]*$/.test(d)){return this.AppendStyleSheet(a,d.split(","));}else{return[this.AppendStyleString(a,FCKTools._GetUrlFixedCss(d))];}}else{var c=[];for(var b=0;b<d.length;b++){c.push(this._AppendStyleSheet(a,d[b]));}return c;}};FCKTools.GetStyleHtml=(function(){var a=function(d,c){if(d.length==0){return"";}var f=c?' _fcktemp="true"':"";return'<style type="text/css"'+f+">"+d+"</style>";};var b=function(c,d){if(c.length==0){return"";}var f=d?' _fcktemp="true"':"";return'<link href="'+c+'" type="text/css" rel="stylesheet" '+f+"/>";};return function(g,d){if(!g){return"";}if(typeof(g)=="string"){if(/[\\\/\.][^{}]*$/.test(g)){return this.GetStyleHtml(g.split(","),d);}else{return a(this._GetUrlFixedCss(g),d);}}else{var f="";for(var c=0;c<g.length;c++){f+=b(g[c],d);}return f;}};})();FCKTools.GetElementDocument=function(a){return a.ownerDocument||a.document;};FCKTools.GetElementWindow=function(a){return this.GetDocumentWindow(this.GetElementDocument(a));};FCKTools.GetDocumentWindow=function(a){if(FCKBrowserInfo.IsSafari&&!a.parentWindow){this.FixDocumentParentWindow(window.top);}return a.parentWindow||a.defaultView;};FCKTools.FixDocumentParentWindow=function(a){if(a.document){a.document.parentWindow=a;}for(var b=0;b<a.frames.length;b++){FCKTools.FixDocumentParentWindow(a.frames[b]);}};FCKTools.HTMLEncode=function(a){if(!a){return"";}a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");return a;};FCKTools.HTMLDecode=function(a){if(!a){return"";}a=a.replace(/&gt;/g,">");a=a.replace(/&lt;/g,"<");a=a.replace(/&amp;/g,"&");return a;};FCKTools._ProcessLineBreaksForPMode=function(f,d,b,a,p){var o=0;var m="<p>";var l="</p>";var k="<br />";if(b){m="<li>";l="</li>";o=1;}while(a&&a!=f.FCK.EditorDocument.body){if(a.tagName.toLowerCase()=="p"){o=1;break;}a=a.parentNode;}for(var h=0;h<d.length;h++){var j=d.charAt(h);if(j=="\r"){continue;}if(j!="\n"){p.push(j);continue;}var g=d.charAt(h+1);if(g=="\r"){h++;g=d.charAt(h+1);}if(g=="\n"){h++;if(o){p.push(l);}p.push(m);o=1;}else{p.push(k);}}};FCKTools._ProcessLineBreaksForDivMode=function(f,d,b,a,m){var l=0;var k="<div>";var j="</div>";if(b){k="<li>";j="</li>";l=1;}while(a&&a!=f.FCK.EditorDocument.body){if(a.tagName.toLowerCase()=="div"){l=1;break;}a=a.parentNode;}for(var g=0;g<d.length;g++){var h=d.charAt(g);if(h=="\r"){continue;}if(h!="\n"){m.push(h);continue;}if(l){if(m[m.length-1]==k){m.push("&nbsp;");}m.push(j);}m.push(k);l=1;}if(l){m.push(j);}};FCKTools._ProcessLineBreaksForBrMode=function(f,d,b,a,m){var l=0;var k="<br />";var j="";if(b){k="<li>";j="</li>";l=1;}for(var g=0;g<d.length;g++){var h=d.charAt(g);if(h=="\r"){continue;}if(h!="\n"){m.push(h);continue;}if(l&&j.length){m.push(j);}m.push(k);l=1;}};FCKTools.ProcessLineBreaks=function(a,i,h){var g=i.EnterMode.toLowerCase();var f=[];var d=0;var c=new a.FCKDomRange(a.FCK.EditorWindow);c.MoveToSelection();var b=c._Range.startContainer;while(b&&b.nodeType!=1){b=b.parentNode;}if(b&&b.tagName.toLowerCase()=="li"){d=1;}if(g=="p"){this._ProcessLineBreaksForPMode(a,h,d,b,f);}else{if(g=="div"){this._ProcessLineBreaksForDivMode(a,h,d,b,f);}else{if(g=="br"){this._ProcessLineBreaksForBrMode(a,h,d,b,f);}}}return f.join("");};FCKTools.AddSelectOption=function(a,d,c){var b=FCKTools.GetElementDocument(a).createElement("OPTION");b.text=d;b.value=c;a.options.add(b);return b;};FCKTools.RunFunction=function(a,d,c,b){if(a){this.SetTimeout(a,0,d,c,b);}};FCKTools.SetTimeout=function(a,f,d,c,b){return(b||window).setTimeout(function(){if(c){a.apply(d,[].concat(c));}else{a.apply(d);}},f);};FCKTools.SetInterval=function(a,f,d,c,b){return(b||window).setInterval(function(){a.apply(d,c||[]);},f);};FCKTools.ConvertStyleSizeToHtml=function(a){return a.EndsWith("%")?a:parseInt(a,10);};FCKTools.ConvertHtmlSizeToStyle=function(a){return a.EndsWith("%")?a:(a+"px");};FCKTools.GetElementAscensor=function(a,d){var b=a;var c=","+d.toUpperCase()+",";while(b){if(c.indexOf(","+b.nodeName.toUpperCase()+",")!=-1){return b;}b=b.parentNode;}return null;};FCKTools.CreateEventListener=function(a,c){var b=function(){var f=[];for(var d=0;d<arguments.length;d++){f.push(arguments[d]);}a.apply(this,f.concat(c));};return b;};FCKTools.IsStrictMode=function(a){return("CSS1Compat"==(a.compatMode||(FCKBrowserInfo.IsSafari?"CSS1Compat":null)));};FCKTools.ArgumentsToArray=function(a,f,d){f=f||0;d=d||a.length;var c=[];for(var b=f;b<f+d&&b<a.length;b++){c.push(a[b]);}return c;};FCKTools.CloneObject=function(a){var b=function(){};b.prototype=a;return new b;};FCKTools.AppendBogusBr=function(a){if(!a){return;}var c=this.GetLastItem(a.getElementsByTagName("br"));if(!c||(c.getAttribute("type",2)!="_moz"&&c.getAttribute("_moz_dirty")==null)){var b=this.GetElementDocument(a);if(FCKBrowserInfo.IsOpera){a.appendChild(b.createTextNode(""));}else{a.appendChild(this.CreateBogusBR(b));}}};FCKTools.GetLastItem=function(a){if(a.length>0){return a[a.length-1];}return null;};FCKTools.GetDocumentPosition=function(c,b){var a=0;var i=0;var h=b;var g=null;var f=FCKTools.GetElementWindow(h);while(h&&!(f==c&&(h==c.document.body||h==c.document.documentElement))){a+=h.offsetLeft-h.scrollLeft;i+=h.offsetTop-h.scrollTop;if(!FCKBrowserInfo.IsOpera){var d=g;while(d&&d!=h){a-=d.scrollLeft;i-=d.scrollTop;d=d.parentNode;}}g=h;if(h.offsetParent){h=h.offsetParent;}else{if(f!=c){h=f.frameElement;g=null;if(h){f=h.contentWindow.parent;}}else{h=null;}}}if(FCKDomTools.GetCurrentElementStyle(c.document.body,"position")!="static"||(FCKBrowserInfo.IsIE&&FCKDomTools.GetPositionedAncestor(b)==null)){a+=c.document.body.offsetLeft;i+=c.document.body.offsetTop;}return{"x":a,"y":i};};FCKTools.GetWindowPosition=function(b,a){var d=this.GetDocumentPosition(b,a);var c=FCKTools.GetScrollPosition(b);d.x-=c.X;d.y-=c.Y;return d;};FCKTools.ProtectFormStyles=function(a){if(!a||a.nodeType!=1||a.tagName.toLowerCase()!="form"){return[];}var g=[];var f=["style","className"];for(var b=0;b<f.length;b++){var d=f[b];if(a.elements.namedItem(d)){var c=a.elements.namedItem(d);g.push([c,c.nextSibling]);a.removeChild(c);}}return g;};FCKTools.RestoreFormStyles=function(a,f){if(!a||a.nodeType!=1||a.tagName.toLowerCase()!="form"){return;}if(f.length>0){for(var b=f.length-1;b>=0;b--){var d=f[b][0];var c=f[b][1];if(c){a.insertBefore(d,c);}else{a.appendChild(d);}}}};FCKTools.GetNextNode=function(a,c){if(a.firstChild){return a.firstChild;}else{if(a.nextSibling){return a.nextSibling;}else{var b=a.parentNode;while(b){if(b==c){return null;}if(b.nextSibling){return b.nextSibling;}else{b=b.parentNode;}}}}return null;};FCKTools.GetNextTextNode=function(a,c,b){node=this.GetNextNode(a,c);if(b&&node&&b(node)){return null;}while(node&&node.nodeType!=3){node=this.GetNextNode(node,c);if(b&&node&&b(node)){return null;}}return node;};FCKTools.Merge=function(){var a=arguments;var d=a[0];for(var b=1;b<a.length;b++){var f=a[b];for(var c in f){d[c]=f[c];}}return d;};FCKTools.IsArray=function(a){return(a instanceof Array);};FCKTools.AppendLengthProperty=function(a,d){var b=0;for(var c in a){b++;}return a[d||"length"]=b;};FCKTools.NormalizeCssText=function(a){var b=document.createElement("span");b.style.cssText=a;return b.style.cssText;};FCKTools.Bind=function(a,b){return function(){return b.apply(a,arguments);};};FCKTools.GetVoidUrl=function(){if(FCK_IS_CUSTOM_DOMAIN){return"javascript: void( function(){document.open();document.write('<html><head><title></title></head><body></body></html>');document.domain = '"+FCK_RUNTIME_DOMAIN+"';document.close();}() ) ;";}if(FCKBrowserInfo.IsIE){if(FCKBrowserInfo.IsIE7||!FCKBrowserInfo.IsIE6){return"";}else{return"javascript: '';";}}return"javascript: void(0);";};FCKTools.ResetStyles=function(a){a.style.cssText="margin:0;padding:0;border:0;background-color:transparent;background-image:none;";};FCKTools.CancelEvent=function(a){if(a){a.preventDefault();}};FCKTools.DisableSelection=function(a){if(FCKBrowserInfo.IsGecko){a.style.MozUserSelect="none";}else{if(FCKBrowserInfo.IsSafari){a.style.KhtmlUserSelect="none";}else{a.style.userSelect="none";}}};FCKTools._AppendStyleSheet=function(a,c){var b=a.createElement("LINK");b.rel="stylesheet";b.type="text/css";b.href=c;a.getElementsByTagName("HEAD")[0].appendChild(b);return b;};FCKTools.AppendStyleString=function(a,c){if(!c){return null;}var b=a.createElement("STYLE");b.appendChild(a.createTextNode(c));a.getElementsByTagName("HEAD")[0].appendChild(b);return b;};FCKTools.ClearElementAttributes=function(a){for(var b=0;b<a.attributes.length;b++){a.removeAttribute(a.attributes[b].name,0);}};FCKTools.GetAllChildrenIds=function(a){var c=[];var b=function(f){for(var d=0;d<f.childNodes.length;d++){var g=f.childNodes[d].id;if(g&&g.length>0){c[c.length]=g;}b(f.childNodes[d]);}};b(a);return c;};FCKTools.RemoveOuterTags=function(c){var a=c.ownerDocument.createDocumentFragment();for(var b=0;b<c.childNodes.length;b++){a.appendChild(c.childNodes[b].cloneNode(true));}c.parentNode.replaceChild(a,c);};FCKTools.CreateXmlObject=function(a){switch(a){case"XmlHttp":return new XMLHttpRequest();case"DOMDocument":var b=(new DOMParser()).parseFromString("<tmp></tmp>","text/xml");FCKDomTools.RemoveNode(b.firstChild);return b;}return null;};FCKTools.GetScrollPosition=function(a){return{X:a.pageXOffset,Y:a.pageYOffset};};FCKTools.AddEventListener=function(a,c,b){a.addEventListener(c,b,false);};FCKTools.RemoveEventListener=function(a,c,b){a.removeEventListener(c,b,false);};FCKTools.AddEventListenerEx=function(a,d,c,b){a.addEventListener(d,function(f){c.apply(a,[f].concat(b||[]));},false);};FCKTools.GetViewPaneSize=function(a){return{Width:a.innerWidth,Height:a.innerHeight};};FCKTools.SaveStyles=function(a){var d=FCKTools.ProtectFormStyles(a);var c={};if(a.className.length>0){c.Class=a.className;a.className="";}var b=a.getAttribute("style");if(b&&b.length>0){c.Inline=b;a.setAttribute("style","",0);}FCKTools.RestoreFormStyles(a,d);return c;};FCKTools.RestoreStyles=function(a,c){var b=FCKTools.ProtectFormStyles(a);a.className=c.Class||"";if(c.Inline){a.setAttribute("style",c.Inline,0);}else{a.removeAttribute("style",0);}FCKTools.RestoreFormStyles(a,b);};FCKTools.RegisterDollarFunction=function(a){a.$=function(b){return a.document.getElementById(b);};};FCKTools.AppendElement=function(a,b){return a.appendChild(a.ownerDocument.createElement(b));};FCKTools.GetElementPosition=function(a,j){var i={X:0,Y:0};var h=j||window;var g=FCKTools.GetElementWindow(a);var f=null;while(a){var d=g.getComputedStyle(a,"").position;if(d&&d!="static"&&a.style.zIndex!=FCKConfig.FloatingPanelsZIndex){break;}i.X+=a.offsetLeft-a.scrollLeft;i.Y+=a.offsetTop-a.scrollTop;if(!FCKBrowserInfo.IsOpera){var b=f;while(b&&b!=a){i.X-=b.scrollLeft;i.Y-=b.scrollTop;b=b.parentNode;}}f=a;if(a.offsetParent){a=a.offsetParent;}else{if(g!=h){a=g.frameElement;f=null;if(a){g=FCKTools.GetElementWindow(a);}}else{i.X+=a.scrollLeft;i.Y+=a.scrollTop;break;}}}return i;};var FCKeditorAPI;function InitializeAPI(){var A=window.parent;if(!(FCKeditorAPI=A.FCKeditorAPI)){var B='window.FCKeditorAPI = {Version : "2.6.6",VersionBuild : "25427",Instances : window.FCKeditorAPI && window.FCKeditorAPI.Instances || {},GetInstance : function( name ){return this.Instances[ name ];},_FormSubmit : function(){for ( var name in FCKeditorAPI.Instances ){var oEditor = FCKeditorAPI.Instances[ name ] ;if ( oEditor.GetParentForm && oEditor.GetParentForm() == this )oEditor.UpdateLinkedField() ;}this._FCKOriginalSubmit() ;},_FunctionQueue	: window.FCKeditorAPI && window.FCKeditorAPI._FunctionQueue || {Functions : new Array(),IsRunning : false,Add : function( f ){this.Functions.push( f );if ( !this.IsRunning )this.StartNext();},StartNext : function(){var aQueue = this.Functions ;if ( aQueue.length > 0 ){this.IsRunning = true;aQueue[0].call();}else this.IsRunning = false;},Remove : function( f ){var aQueue = this.Functions;var i = 0, fFunc;while( (fFunc = aQueue[ i ]) ){if ( fFunc == f )aQueue.splice( i,1 );i++ ;}this.StartNext();}}}';if(A.execScript){A.execScript(B,"JavaScript");}else{if(FCKBrowserInfo.IsGecko10){eval.call(A,B);}else{if(FCKBrowserInfo.IsAIR){FCKAdobeAIR.FCKeditorAPI_Evaluate(A,B);}else{if(FCKBrowserInfo.IsSafari){var C=A.document;var D=C.createElement("script");D.appendChild(C.createTextNode(B));C.documentElement.appendChild(D);}else{A.eval(B);}}}}FCKeditorAPI=A.FCKeditorAPI;FCKeditorAPI.__Instances=FCKeditorAPI.Instances;}FCKeditorAPI.Instances[FCK.Name]=FCK;}function _AttachFormSubmitToAPI(){var a=FCK.GetParentForm();if(a){FCKTools.AddEventListener(a,"submit",FCK.UpdateLinkedField);if(!a._FCKOriginalSubmit&&(typeof(a.submit)=="function"||(!a.submit.tagName&&!a.submit.length))){a._FCKOriginalSubmit=a.submit;a.submit=FCKeditorAPI._FormSubmit;}}}function FCKeditorAPI_Cleanup(){if(window.FCKConfig&&FCKConfig.MsWebBrowserControlCompat&&!window.FCKUnloadFlag){return;}delete FCKeditorAPI.Instances[FCK.Name];}function FCKeditorAPI_ConfirmCleanup(){if(window.FCKConfig&&FCKConfig.MsWebBrowserControlCompat){window.FCKUnloadFlag=true;}}FCKTools.AddEventListener(window,"unload",FCKeditorAPI_Cleanup);FCKTools.AddEventListener(window,"beforeunload",FCKeditorAPI_ConfirmCleanup);var FCKImagePreloader=function(){this._Images=[];};FCKImagePreloader.prototype={AddImages:function(a){if(typeof(a)=="string"){a=a.split(";");}this._Images=this._Images.concat(a);},Start:function(){var a=this._Images;this._PreloadCount=a.length;for(var b=0;b<a.length;b++){var c=document.createElement("img");FCKTools.AddEventListenerEx(c,"load",_FCKImagePreloader_OnImage,this);FCKTools.AddEventListenerEx(c,"error",_FCKImagePreloader_OnImage,this);c.src=a[b];_FCKImagePreloader_ImageCache.push(c);}}};var _FCKImagePreloader_ImageCache=[];function _FCKImagePreloader_OnImage(a,b){if((--b._PreloadCount)==0&&b.OnComplete){b.OnComplete();}}var FCKRegexLib={AposEntity:/&apos;/gi,ObjectElements:/^(?:IMG|TABLE|TR|TD|TH|INPUT|SELECT|TEXTAREA|HR|OBJECT|A|UL|OL|LI)$/i,NamedCommands:/^(?:Cut|Copy|Paste|Print|SelectAll|RemoveFormat|Unlink|Undo|Redo|Bold|Italic|Underline|StrikeThrough|Subscript|Superscript|JustifyLeft|JustifyCenter|JustifyRight|JustifyFull|Outdent|Indent|InsertOrderedList|InsertUnorderedList|InsertHorizontalRule)$/i,BeforeBody:/(^[\s\S]*\<body[^\>]*\>)/i,AfterBody:/(\<\/body\>[\s\S]*$)/i,ToReplace:/___fcktoreplace:([\w]+)/ig,MetaHttpEquiv:/http-equiv\s*=\s*["']?([^"' ]+)/i,HasBaseTag:/<base /i,HasBodyTag:/<body[\s|>]/i,HtmlOpener:/<html\s?[^>]*>/i,HeadOpener:/<head\s?[^>]*>/i,HeadCloser:/<\/head\s*>/i,FCK_Class:/\s*FCK__[^ ]*(?=\s+|$)/,ElementName:/(^[a-z_:][\w.\-:]*\w$)|(^[a-z_]$)/,ForceSimpleAmpersand:/___FCKAmp___/g,SpaceNoClose:/\/>/g,EmptyParagraph:/^<(p|div|address|h\d|center)(?=[ >])[^>]*>\s*(<\/\1>)?$/,EmptyOutParagraph:/^<(p|div|address|h\d|center)(?=[ >])[^>]*>(?:\s*|&nbsp;|&#160;)(<\/\1>)?$/,TagBody:/></,GeckoEntitiesMarker:/#\?-\:/g,ProtectUrlsImg:/<img(?=\s).*?\ssrc=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi,ProtectUrlsA:/<a(?=\s).*?\shref=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi,ProtectUrlsArea:/<area(?=\s).*?\shref=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi,Html4DocType:/HTML 4\.0 Transitional/i,DocTypeTag:/<!DOCTYPE[^>]*>/i,HtmlDocType:/DTD HTML/,TagsWithEvent:/<[^\>]+ on\w+[\s\r\n]*=[\s\r\n]*?('|")[\s\S]+?\>/g,EventAttributes:/\s(on\w+)[\s\r\n]*=[\s\r\n]*?('|")([\s\S]*?)\2/g,ProtectedEvents:/\s\w+_fckprotectedatt="([^"]+)"/g,StyleProperties:/\S+\s*:/g,InvalidSelfCloseTags:/(<(?!base|meta|link|hr|br|param|img|area|input)([a-zA-Z0-9:]+)[^>]*)\/>/gi,StyleVariableAttName:/#\(\s*("|')(.+?)\1[^\)]*\s*\)/g,RegExp:/^\/(.*)\/([gim]*)$/,HtmlTag:/<[^\s<>](?:"[^"]*"|'[^']*'|[^<])*>/};var FCKListsLib={BlockElements:{address:1,blockquote:1,center:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,marquee:1,noscript:1,ol:1,p:1,pre:1,script:1,table:1,ul:1},NonEmptyBlockElements:{p:1,div:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,address:1,pre:1,ol:1,ul:1,li:1,td:1,th:1},InlineChildReqElements:{abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},InlineNonEmptyElements:{a:1,abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},EmptyElements:{base:1,col:1,meta:1,link:1,hr:1,br:1,param:1,img:1,area:1,input:1},PathBlockElements:{address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,de:1},PathBlockLimitElements:{body:1,div:1,td:1,th:1,caption:1,form:1},StyleBlockElements:{address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},StyleObjectElements:{img:1,hr:1,li:1,table:1,tr:1,td:1,embed:1,object:1,ol:1,ul:1},NonEditableElements:{button:1,option:1,script:1,iframe:1,textarea:1,object:1,embed:1,map:1,applet:1},BlockBoundaries:{p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,address:1,pre:1,ol:1,ul:1,li:1,dt:1,de:1,table:1,thead:1,tbody:1,tfoot:1,tr:1,th:1,td:1,caption:1,col:1,colgroup:1,blockquote:1,body:1},ListBoundaries:{p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,address:1,pre:1,ol:1,ul:1,li:1,dt:1,de:1,table:1,thead:1,tbody:1,tfoot:1,tr:1,th:1,td:1,caption:1,col:1,colgroup:1,blockquote:1,body:1,br:1}};var FCKLanguageManager=FCK.Language={AvailableLanguages:{af:"Afrikaans",ar:"Arabic",bg:"Bulgarian",bn:"Bengali/Bangla",bs:"Bosnian",ca:"Catalan",cs:"Czech",da:"Danish",de:"German",el:"Greek",en:"English","en-au":"English (Australia)","en-ca":"English (Canadian)","en-uk":"English (United Kingdom)",eo:"Esperanto",es:"Spanish",et:"Estonian",eu:"Basque",fa:"Persian",fi:"Finnish",fo:"Faroese",fr:"French","fr-ca":"French (Canada)",gl:"Galician",gu:"Gujarati",he:"Hebrew",hi:"Hindi",hr:"Croatian",hu:"Hungarian",is:"Icelandic",it:"Italian",ja:"Japanese",km:"Khmer",ko:"Korean",lt:"Lithuanian",lv:"Latvian",mn:"Mongolian",ms:"Malay",nb:"Norwegian Bokmal",nl:"Dutch",no:"Norwegian",pl:"Polish",pt:"Portuguese (Portugal)","pt-br":"Portuguese (Brazil)",ro:"Romanian",ru:"Russian",sk:"Slovak",sl:"Slovenian",sr:"Serbian (Cyrillic)","sr-latn":"Serbian (Latin)",sv:"Swedish",th:"Thai",tr:"Turkish",uk:"Ukrainian",vi:"Vietnamese",zh:"Chinese Traditional","zh-cn":"Chinese Simplified"},GetActiveLanguage:function(){if(FCKConfig.AutoDetectLanguage){var a;if(navigator.userLanguage){a=navigator.userLanguage.toLowerCase();}else{if(navigator.language){a=navigator.language.toLowerCase();}else{return FCKConfig.DefaultLanguage;}}if(a.length>=5){a=a.substr(0,5);if(this.AvailableLanguages[a]){return a;}}if(a.length>=2){a=a.substr(0,2);if(this.AvailableLanguages[a]){return a;}}}return this.DefaultLanguage;},TranslateElements:function(a,j,h,g){var f=a.getElementsByTagName(j);var d,c;for(var b=0;b<f.length;b++){if((d=f[b].getAttribute("fckLang"))){if((c=FCKLang[d])){if(g){c=FCKTools.HTMLEncode(c);}f[b][h]=c;}}}},TranslatePage:function(a){this.TranslateElements(a,"INPUT","value");this.TranslateElements(a,"SPAN","innerHTML");this.TranslateElements(a,"LABEL","innerHTML");this.TranslateElements(a,"OPTION","innerHTML",true);this.TranslateElements(a,"LEGEND","innerHTML");},Initialize:function(){if(this.AvailableLanguages[FCKConfig.DefaultLanguage]){this.DefaultLanguage=FCKConfig.DefaultLanguage;}else{this.DefaultLanguage="en";}this.ActiveLanguage={};this.ActiveLanguage.Code=this.GetActiveLanguage();this.ActiveLanguage.Name=this.AvailableLanguages[this.ActiveLanguage.Code];}};var FCKXHtmlEntities={};FCKXHtmlEntities.Initialize=function(){if(FCKXHtmlEntities.Entities){return;}var a="";var f,c;if(FCKConfig.ProcessHTMLEntities){FCKXHtmlEntities.Entities={" ":"nbsp","¡":"iexcl","¢":"cent","£":"pound","¤":"curren","¥":"yen","¦":"brvbar","§":"sect","¨":"uml","©":"copy","ª":"ordf","«":"laquo","¬":"not","":"shy","®":"reg","¯":"macr","°":"deg","±":"plusmn","²":"sup2","³":"sup3","´":"acute","µ":"micro","¶":"para","·":"middot","¸":"cedil","¹":"sup1","º":"ordm","»":"raquo","¼":"frac14","½":"frac12","¾":"frac34","¿":"iquest","×":"times","÷":"divide","ƒ":"fnof","•":"bull","…":"hellip","′":"prime","″":"Prime","‾":"oline","⁄":"frasl","℘":"weierp","ℑ":"image","ℜ":"real","™":"trade","ℵ":"alefsym","←":"larr","↑":"uarr","→":"rarr","↓":"darr","↔":"harr","↵":"crarr","⇐":"lArr","⇑":"uArr","⇒":"rArr","⇓":"dArr","⇔":"hArr","∀":"forall","∂":"part","∃":"exist","∅":"empty","∇":"nabla","∈":"isin","∉":"notin","∋":"ni","∏":"prod","∑":"sum","−":"minus","∗":"lowast","√":"radic","∝":"prop","∞":"infin","∠":"ang","∧":"and","∨":"or","∩":"cap","∪":"cup","∫":"int","∴":"there4","∼":"sim","≅":"cong","≈":"asymp","≠":"ne","≡":"equiv","≤":"le","≥":"ge","⊂":"sub","⊃":"sup","⊄":"nsub","⊆":"sube","⊇":"supe","⊕":"oplus","⊗":"otimes","⊥":"perp","⋅":"sdot","\u2308":"lceil","\u2309":"rceil","\u230a":"lfloor","\u230b":"rfloor","\u2329":"lang","\u232a":"rang","◊":"loz","♠":"spades","♣":"clubs","♥":"hearts","♦":"diams",'"':"quot",">":"gt","ˆ":"circ","˜":"tilde"," ":"ensp"," ":"emsp"," ":"thinsp","":"zwnj","":"zwj","":"lrm","":"rlm","–":"ndash","—":"mdash","‘":"lsquo","’":"rsquo","‚":"sbquo","“":"ldquo","”":"rdquo","„":"bdquo","†":"dagger","‡":"Dagger","‰":"permil","‹":"lsaquo","›":"rsaquo","€":"euro"};for(c in FCKXHtmlEntities.Entities){a+=c;}if(FCKConfig.IncludeLatinEntities){f={"À":"Agrave","Á":"Aacute","Â":"Acirc","Ã":"Atilde","Ä":"Auml","Å":"Aring","Æ":"AElig","Ç":"Ccedil","È":"Egrave","É":"Eacute","Ê":"Ecirc","Ë":"Euml","Ì":"Igrave","Í":"Iacute","Î":"Icirc","Ï":"Iuml","Ð":"ETH","Ñ":"Ntilde","Ò":"Ograve","Ó":"Oacute","Ô":"Ocirc","Õ":"Otilde","Ö":"Ouml","Ø":"Oslash","Ù":"Ugrave","Ú":"Uacute","Û":"Ucirc","Ü":"Uuml","Ý":"Yacute","Þ":"THORN","ß":"szlig","à":"agrave","á":"aacute","â":"acirc","ã":"atilde","ä":"auml","å":"aring","æ":"aelig","ç":"ccedil","è":"egrave","é":"eacute","ê":"ecirc","ë":"euml","ì":"igrave","í":"iacute","î":"icirc","ï":"iuml","ð":"eth","ñ":"ntilde","ò":"ograve","ó":"oacute","ô":"ocirc","õ":"otilde","ö":"ouml","ø":"oslash","ù":"ugrave","ú":"uacute","û":"ucirc","ü":"uuml","ý":"yacute","þ":"thorn","ÿ":"yuml","Œ":"OElig","œ":"oelig","Š":"Scaron","š":"scaron","Ÿ":"Yuml"};for(c in f){FCKXHtmlEntities.Entities[c]=f[c];a+=c;}f=null;}if(FCKConfig.IncludeGreekEntities){f={"Α":"Alpha","Β":"Beta","Γ":"Gamma","Δ":"Delta","Ε":"Epsilon","Ζ":"Zeta","Η":"Eta","Θ":"Theta","Ι":"Iota","Κ":"Kappa","Λ":"Lambda","Μ":"Mu","Ν":"Nu","Ξ":"Xi","Ο":"Omicron","Π":"Pi","Ρ":"Rho","Σ":"Sigma","Τ":"Tau","Υ":"Upsilon","Φ":"Phi","Χ":"Chi","Ψ":"Psi","Ω":"Omega","α":"alpha","β":"beta","γ":"gamma","δ":"delta","ε":"epsilon","ζ":"zeta","η":"eta","θ":"theta","ι":"iota","κ":"kappa","λ":"lambda","μ":"mu","ν":"nu","ξ":"xi","ο":"omicron","π":"pi","ρ":"rho","ς":"sigmaf","σ":"sigma","τ":"tau","υ":"upsilon","φ":"phi","χ":"chi","ψ":"psi","ω":"omega","\u03d1":"thetasym","\u03d2":"upsih","\u03d6":"piv"};for(c in f){FCKXHtmlEntities.Entities[c]=f[c];a+=c;}f=null;}}else{FCKXHtmlEntities.Entities={">":"gt"};a=">";a+=" ";}var d="["+a+"]";if(FCKConfig.ProcessNumericEntities){d="[^ -~]|"+d;}var b=FCKConfig.AdditionalNumericEntities;if(b&&b.length>0){d+="|"+FCKConfig.AdditionalNumericEntities;}FCKXHtmlEntities.EntitiesRegex=new RegExp(d,"g");};var FCKXHtml={};FCKXHtml.CurrentJobNum=0;FCKXHtml.GetXHTML=function(a,h,g){FCKDomTools.CheckAndRemovePaddingNode(FCKTools.GetElementDocument(a),FCKConfig.EnterMode);FCKXHtmlEntities.Initialize();this._NbspEntity=(FCKConfig.ProcessHTMLEntities?"nbsp":"#160");var f=FCK.IsDirty();FCKXHtml.SpecialBlocks=[];this.XML=FCKTools.CreateXmlObject("DOMDocument");this.MainNode=this.XML.appendChild(this.XML.createElement("xhtml"));FCKXHtml.CurrentJobNum++;if(h){this._AppendNode(this.MainNode,a);}else{this._AppendChildNodes(this.MainNode,a,false);}if(FCKBrowserInfo.IsIE){FCKXHtml._RemoveXHtmlJobProperties(a);}var d=this._GetMainXmlString();this.XML=null;if(FCKBrowserInfo.IsSafari){d=d.replace(/^<xhtml.*?>/,"<xhtml>");}d=d.substr(7,d.length-15).Trim();if(FCKConfig.DocType.length>0&&FCKRegexLib.HtmlDocType.test(FCKConfig.DocType)){d=d.replace(FCKRegexLib.SpaceNoClose,">");}else{d=d.replace(FCKRegexLib.SpaceNoClose," />");}if(FCKConfig.ForceSimpleAmpersand){d=d.replace(FCKRegexLib.ForceSimpleAmpersand,"&");}if(g){d=FCKCodeFormatter.Format(d);}for(var b=0;b<FCKXHtml.SpecialBlocks.length;b++){var c=new RegExp("___FCKsi___"+b);d=d.replace(c,FCKXHtml.SpecialBlocks[b]);}d=d.replace(FCKRegexLib.GeckoEntitiesMarker,"&");if(!f){FCK.ResetIsDirty();}FCKDomTools.EnforcePaddingNode(FCKTools.GetElementDocument(a),FCKConfig.EnterMode);return d;};FCKXHtml._AppendAttribute=function(a,f,d){try{if(d==undefined||d==null){d="";}else{if(d.replace){if(FCKConfig.ForceSimpleAmpersand){d=d.replace(/&/g,"___FCKAmp___");}d=d.replace(FCKXHtmlEntities.EntitiesRegex,FCKXHtml_GetEntity);}}var c=this.XML.createAttribute(f);c.value=d;a.attributes.setNamedItem(c);}catch(b){}};FCKXHtml._AppendChildNodes=function(a,g,f){var d=g.firstChild;while(d){this._AppendNode(a,d);d=d.nextSibling;}if(f&&g.tagName&&g.tagName.toLowerCase()!="pre"){FCKDomTools.TrimNode(a);if(FCKConfig.FillEmptyBlocks){var c=a.lastChild;if(c&&c.nodeType==1&&c.nodeName=="br"){this._AppendEntity(a,this._NbspEntity);}}}if(a.childNodes.length==0){if(f&&FCKConfig.FillEmptyBlocks){this._AppendEntity(a,this._NbspEntity);return a;}var b=a.nodeName;if(FCKListsLib.InlineChildReqElements[b]){return null;}if(!FCKListsLib.EmptyElements[b]){a.appendChild(this.XML.createTextNode(""));}}return a;};FCKXHtml._AppendNode=function(a,h){if(!h){return false;}switch(h.nodeType){case 1:if(FCKBrowserInfo.IsGecko&&h.tagName.toLowerCase()=="br"&&h.parentNode.tagName.toLowerCase()=="pre"){var g="\r";if(h==h.parentNode.firstChild){g+="\r";}return FCKXHtml._AppendNode(a,this.XML.createTextNode(g));}if(h.getAttribute("_fckfakelement")){return FCKXHtml._AppendNode(a,FCK.GetRealElement(h));}if(FCKBrowserInfo.IsGecko&&(h.hasAttribute("_moz_editor_bogus_node")||h.getAttribute("type")=="_moz")){if(h.nextSibling){return false;}else{h.removeAttribute("_moz_editor_bogus_node");h.removeAttribute("type");}}if(h.getAttribute("_fcktemp")){return false;}var f=h.tagName.toLowerCase();if(FCKBrowserInfo.IsIE){if(h.scopeName&&h.scopeName!="HTML"&&h.scopeName!="FCK"){f=h.scopeName.toLowerCase()+":"+f;}}else{if(f.StartsWith("fck:")){f=f.Remove(0,4);}}if(!FCKRegexLib.ElementName.test(f)){return false;}if(h._fckxhtmljob&&h._fckxhtmljob==FCKXHtml.CurrentJobNum){return false;}var c=this.XML.createElement(f);FCKXHtml._AppendAttributes(a,h,c,f);h._fckxhtmljob=FCKXHtml.CurrentJobNum;var b=FCKXHtml.TagProcessors[f];if(b){c=b(c,h,a);}else{c=this._AppendChildNodes(c,h,Boolean(FCKListsLib.NonEmptyBlockElements[f]));}if(!c){return false;}a.appendChild(c);break;case 3:if(h.parentNode&&h.parentNode.nodeName.IEquals("pre")){return this._AppendTextNode(a,h.nodeValue);}return this._AppendTextNode(a,h.nodeValue.ReplaceNewLineChars(" "));case 8:if(FCKBrowserInfo.IsIE&&!h.innerHTML){break;}try{a.appendChild(this.XML.createComment(h.nodeValue));}catch(d){}break;default:a.appendChild(this.XML.createComment("Element not supported - Type: "+h.nodeType+" Name: "+h.nodeName));break;}return true;};FCKXHtml._AppendSpecialItem=function(a){return"___FCKsi___"+(FCKXHtml.SpecialBlocks.push(a)-1);};FCKXHtml._AppendEntity=function(a,b){a.appendChild(this.XML.createTextNode("#?-:"+b+";"));};FCKXHtml._AppendTextNode=function(a,c){var b=c.length>0;if(b){a.appendChild(this.XML.createTextNode(c.replace(FCKXHtmlEntities.EntitiesRegex,FCKXHtml_GetEntity)));}return b;};function FCKXHtml_GetEntity(a){var b=FCKXHtmlEntities.Entities[a]||("#"+a.charCodeAt(0));return"#?-:"+b+";";}FCKXHtml.TagProcessors={a:function(a,c){if(c.innerHTML.Trim().length==0&&!c.name){return false;}var b=c.getAttribute("_fcksavedurl");if(b!=null){FCKXHtml._AppendAttribute(a,"href",b);}if(FCKBrowserInfo.IsIE){if(c.name){FCKXHtml._AppendAttribute(a,"name",c.name);}}a=FCKXHtml._AppendChildNodes(a,c,false);return a;},area:function(a,f){var d=f.getAttribute("_fcksavedurl");if(d!=null){FCKXHtml._AppendAttribute(a,"href",d);}if(FCKBrowserInfo.IsIE){if(!a.attributes.getNamedItem("coords")){var c=f.getAttribute("coords",2);if(c&&c!="0,0,0"){FCKXHtml._AppendAttribute(a,"coords",c);}}if(!a.attributes.getNamedItem("shape")){var b=f.getAttribute("shape",2);if(b&&b.length>0){FCKXHtml._AppendAttribute(a,"shape",b.toLowerCase());}}}return a;},body:function(a,b){a=FCKXHtml._AppendChildNodes(a,b,false);a.removeAttribute("spellcheck");return a;},iframe:function(a,c){var b=c.innerHTML;if(FCKBrowserInfo.IsGecko){b=FCKTools.HTMLDecode(b);}b=b.replace(/\s_fcksavedurl="[^"]*"/g,"");a.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(b)));return a;},img:function(a,c){if(!a.attributes.getNamedItem("alt")){FCKXHtml._AppendAttribute(a,"alt","");}var b=c.getAttribute("_fcksavedurl");if(b!=null){FCKXHtml._AppendAttribute(a,"src",b);}if(c.style.width){a.removeAttribute("width");}if(c.style.height){a.removeAttribute("height");}return a;},li:function(a,d,c){if(c.nodeName.IEquals(["ul","ol"])){return FCKXHtml._AppendChildNodes(a,d,true);}var b=FCKXHtml.XML.createElement("ul");d._fckxhtmljob=null;do{FCKXHtml._AppendNode(b,d);do{d=FCKDomTools.GetNextSibling(d);}while(d&&d.nodeType==3&&d.nodeValue.Trim().length==0);}while(d&&d.nodeName.toLowerCase()=="li");return b;},ol:function(a,d,c){if(d.innerHTML.Trim().length==0){return false;}var b=c.lastChild;if(b&&b.nodeType==3){b=b.previousSibling;}if(b&&b.nodeName.toUpperCase()=="LI"){d._fckxhtmljob=null;FCKXHtml._AppendNode(b,d);return false;}a=FCKXHtml._AppendChildNodes(a,d);return a;},pre:function(a,c){var b=c.firstChild;if(b&&b.nodeType==3){a.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem("\r\n")));}FCKXHtml._AppendChildNodes(a,c,true);return a;},script:function(a,b){if(!a.attributes.getNamedItem("type")){FCKXHtml._AppendAttribute(a,"type","text/javascript");}a.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(b.text)));return a;},span:function(a,b){if(b.innerHTML.length==0){return false;}a=FCKXHtml._AppendChildNodes(a,b,false);return a;},style:function(a,c){if(!a.attributes.getNamedItem("type")){FCKXHtml._AppendAttribute(a,"type","text/css");}var b=c.innerHTML;if(FCKBrowserInfo.IsIE){b=b.replace(/^(\r\n|\n|\r)/,"");}a.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(b)));return a;},title:function(a,b){a.appendChild(FCKXHtml.XML.createTextNode(FCK.EditorDocument.title));return a;}};FCKXHtml.TagProcessors.ul=FCKXHtml.TagProcessors.ol;FCKXHtml._GetMainXmlString=function(){return(new XMLSerializer()).serializeToString(this.MainNode);};FCKXHtml._AppendAttributes=function(a,i,g){var f=i.attributes;for(var h=0;h<f.length;h++){var d=f[h];if(d.specified){var c=d.nodeName.toLowerCase();var b;if(c.StartsWith("_fck")){continue;}else{if(c.indexOf("_moz")==0){continue;}else{if(c=="class"){b=d.nodeValue.replace(FCKRegexLib.FCK_Class,"");if(b.length==0){continue;}}else{if(d.nodeValue===true){b=c;}else{b=i.getAttribute(c,2);}}}}this._AppendAttribute(g,c,b);}}};if(FCKBrowserInfo.IsOpera){FCKXHtml.TagProcessors["head"]=function(a,b){FCKXHtml.XML._HeadElement=a;a=FCKXHtml._AppendChildNodes(a,b,true);return a;};FCKXHtml.TagProcessors["meta"]=function(a,d,c){if(d.parentNode.nodeName.toLowerCase()!="head"){var b=FCKXHtml.XML._HeadElement;if(b&&c!=b){delete d._fckxhtmljob;FCKXHtml._AppendNode(b,d);return null;}}return a;};}if(FCKBrowserInfo.IsGecko){FCKXHtml.TagProcessors["link"]=function(a,b){if(b.href.substr(0,9).toLowerCase()=="chrome://"){return false;}return a;};}var FCKCodeFormatter={};FCKCodeFormatter.Init=function(){var a=this.Regex={};a.BlocksOpener=/\<(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DL|DT|DD|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi;a.BlocksCloser=/\<\/(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DL|DT|DD|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi;a.NewLineTags=/\<(BR|HR)[^\>]*\>/gi;a.MainTags=/\<\/?(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR)[^\>]*\>/gi;a.LineSplitter=/\s*\n+\s*/g;a.IncreaseIndent=/^\<(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL|DL)[ \/\>]/i;a.DecreaseIndent=/^\<\/(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL|DL)[ \>]/i;a.FormatIndentatorRemove=new RegExp("^"+FCKConfig.FormatIndentator);a.ProtectedTags=/(<PRE[^>]*>)([\s\S]*?)(<\/PRE>)/gi;};FCKCodeFormatter._ProtectData=function(a,d,c,b){return d+"___FCKpd___"+(FCKCodeFormatter.ProtectedData.push(c)-1)+b;};FCKCodeFormatter.Format=function(a){if(!this.Regex){this.Init();}FCKCodeFormatter.ProtectedData=[];var k=a.replace(this.Regex.ProtectedTags,FCKCodeFormatter._ProtectData);k=k.replace(this.Regex.BlocksOpener,"\n$&");k=k.replace(this.Regex.BlocksCloser,"$&\n");k=k.replace(this.Regex.NewLineTags,"$&\n");k=k.replace(this.Regex.MainTags,"\n$&\n");var h="";var g=k.split(this.Regex.LineSplitter);k="";for(var c=0;c<g.length;c++){var f=g[c];if(f.length==0){continue;}if(this.Regex.DecreaseIndent.test(f)){h=h.replace(this.Regex.FormatIndentatorRemove,"");}k+=h+f+"\n";if(this.Regex.IncreaseIndent.test(f)){h+=FCKConfig.FormatIndentator;}}for(var b=0;b<FCKCodeFormatter.ProtectedData.length;b++){var d=new RegExp("___FCKpd___"+b);k=k.replace(d,FCKCodeFormatter.ProtectedData[b].replace(/\$/g,"$$$$"));}return k.Trim();};var FCKUndo={};FCKUndo.SavedData=[];FCKUndo.CurrentIndex=-1;FCKUndo.TypesCount=0;FCKUndo.Changed=false;FCKUndo.MaxTypes=25;FCKUndo.Typing=false;FCKUndo.SaveLocked=false;FCKUndo._GetBookmark=function(){FCKSelection.Restore();var a=new FCKDomRange(FCK.EditorWindow);try{a.MoveToSelection();}catch(b){return null;}if(FCKBrowserInfo.IsIE){var d=a.CreateBookmark();var c=FCK.EditorDocument.body.innerHTML;a.MoveToBookmark(d);return[d,c];}return a.CreateBookmark2();};FCKUndo._SelectBookmark=function(a){if(!a){return;}var c=new FCKDomRange(FCK.EditorWindow);if(a instanceof Object){if(FCKBrowserInfo.IsIE){c.MoveToBookmark(a[0]);}else{c.MoveToBookmark2(a);}try{c.Select();}catch(b){c.MoveToPosition(FCK.EditorDocument.body,4);c.Select();}}};FCKUndo._CompareCursors=function(a,c){for(var b=0;b<Math.min(a.length,c.length);b++){if(a[b]<c[b]){return -1;}else{if(a[b]>c[b]){return 1;}}}if(a.length<c.length){return -1;}else{if(a.length>c.length){return 1;}}return 0;};FCKUndo._CheckIsBookmarksEqual=function(a,g){if(!(a&&g)){return false;}if(FCKBrowserInfo.IsIE){var f=a[1].search(a[0].StartId);var d=g[1].search(g[0].StartId);var c=a[1].search(a[0].EndId);var b=g[1].search(g[0].EndId);return f==d&&c==b;}else{return this._CompareCursors(a.Start,g.Start)==0&&this._CompareCursors(a.End,g.End)==0;}};FCKUndo.SaveUndoStep=function(){if(FCK.EditMode!=0||this.SaveLocked){return;}if(this.SavedData.length){this.Changed=true;}var a=FCK.EditorDocument.body.innerHTML;var b=this._GetBookmark();this.SavedData=this.SavedData.slice(0,this.CurrentIndex+1);if(this.CurrentIndex>0&&a==this.SavedData[this.CurrentIndex][0]&&this._CheckIsBookmarksEqual(b,this.SavedData[this.CurrentIndex][1])){return;}else{if(this.CurrentIndex==0&&this.SavedData.length&&a==this.SavedData[0][0]){this.SavedData[0][1]=b;return;}}if(this.CurrentIndex+1>=FCKConfig.MaxUndoLevels){this.SavedData.shift();}else{this.CurrentIndex++;}this.SavedData[this.CurrentIndex]=[a,b];FCK.Events.FireEvent("OnSelectionChange");};FCKUndo.CheckUndoState=function(){return(this.Changed||this.CurrentIndex>0);};FCKUndo.CheckRedoState=function(){return(this.CurrentIndex<(this.SavedData.length-1));};FCKUndo.Undo=function(){if(this.CheckUndoState()){if(this.CurrentIndex==(this.SavedData.length-1)){this.SaveUndoStep();}this._ApplyUndoLevel(--this.CurrentIndex);FCK.Events.FireEvent("OnSelectionChange");}};FCKUndo.Redo=function(){if(this.CheckRedoState()){this._ApplyUndoLevel(++this.CurrentIndex);FCK.Events.FireEvent("OnSelectionChange");}};FCKUndo._ApplyUndoLevel=function(a){var b=this.SavedData[a];if(!b){return;}if(FCKBrowserInfo.IsIE){if(b[1]&&b[1][1]){FCK.SetInnerHtml(b[1][1]);}else{FCK.SetInnerHtml(b[0]);}}else{FCK.EditorDocument.body.innerHTML=b[0];}this._SelectBookmark(b[1]);this.TypesCount=0;this.Changed=false;this.Typing=false;};var FCKEditingArea=function(a){this.TargetElement=a;this.Mode=0;if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKEditingArea_Cleanup);}};FCKEditingArea.prototype.Start=function(d,c){var b=this.TargetElement;var a=FCKTools.GetElementDocument(b);while(b.firstChild){b.removeChild(b.firstChild);}if(this.Mode==0){if(FCK_IS_CUSTOM_DOMAIN){d='<script>document.domain="'+FCK_RUNTIME_DOMAIN+'";<\/script>'+d;}if(FCKBrowserInfo.IsIE){d=d.replace(/(<base[^>]*?)\s*\/?>(?!\s*<\/base>)/gi,"$1></base>");}else{if(!c){var m=d.match(FCKRegexLib.BeforeBody);var l=d.match(FCKRegexLib.AfterBody);if(m&&l){var k=d.substr(m[1].length,d.length-m[1].length-l[1].length);d=m[1]+"&nbsp;"+l[1];if(FCKBrowserInfo.IsGecko&&(k.length==0||FCKRegexLib.EmptyParagraph.test(k))){k='<br type="_moz">';}this._BodyHTML=k;}else{this._BodyHTML=d;}}}var j=this.IFrame=a.createElement("iframe");var i='<script type="text/javascript" _fcktemp="true">window.onerror=function(){return true;};<\/script>';j.frameBorder=0;j.style.width=j.style.height="100%";if(FCK_IS_CUSTOM_DOMAIN&&FCKBrowserInfo.IsIE){window._FCKHtmlToLoad=d.replace(/<head>/i,"<head>"+i);j.src='javascript:void( (function(){document.open() ;document.domain="'+document.domain+'" ;document.write( window.parent._FCKHtmlToLoad );document.close() ;window.parent._FCKHtmlToLoad = null ;})() )';}else{if(!FCKBrowserInfo.IsGecko){j.src="javascript:void(0)";}}b.appendChild(j);this.Window=j.contentWindow;if(!FCK_IS_CUSTOM_DOMAIN||!FCKBrowserInfo.IsIE){var h=this.Window.document;h.open();h.write(d.replace(/<head>/i,"<head>"+i));h.close();}if(FCKBrowserInfo.IsAIR){FCKAdobeAIR.EditingArea_Start(h,d);}if(FCKBrowserInfo.IsGecko10&&!c){this.Start(d,true);return;}if(j.readyState&&j.readyState!="completed"){var g=this;setTimeout(function(){try{g.Window.document.documentElement.doScroll("left");}catch(n){setTimeout(arguments.callee,0);return;}g.Window._FCKEditingArea=g;FCKEditingArea_CompleteStart.call(g.Window);},0);}else{this.Window._FCKEditingArea=this;if(FCKBrowserInfo.IsGecko10){this.Window.setTimeout(FCKEditingArea_CompleteStart,500);}else{FCKEditingArea_CompleteStart.call(this.Window);}}}else{var f=this.Textarea=a.createElement("textarea");f.className="SourceField";f.dir="ltr";FCKDomTools.SetElementStyles(f,{width:"100%",height:"100%",border:"none",resize:"none",outline:"none"});b.appendChild(f);f.value=d;FCKTools.RunFunction(this.OnLoad);}};function FCKEditingArea_CompleteStart(){if(!this.document.body){this.setTimeout(FCKEditingArea_CompleteStart,50);return;}var a=this._FCKEditingArea;a.Document=a.Window.document;a.MakeEditable();FCKTools.RunFunction(a.OnLoad);}FCKEditingArea.prototype.MakeEditable=function(){var a=this.Document;if(FCKBrowserInfo.IsIE){a.body.disabled=true;a.body.contentEditable=true;a.body.removeAttribute("disabled");}else{try{a.body.spellcheck=(this.FFSpellChecker!==false);if(this._BodyHTML){a.body.innerHTML=this._BodyHTML;a.body.offsetLeft;this._BodyHTML=null;}a.designMode="on";a.execCommand("enableObjectResizing",false,!FCKConfig.DisableObjectResizing);a.execCommand("enableInlineTableEditing",false,!FCKConfig.DisableFFTableHandles);}catch(b){FCKTools.AddEventListener(this.Window.frameElement,"DOMAttrModified",FCKEditingArea_Document_AttributeNodeModified);}}};function FCKEditingArea_Document_AttributeNodeModified(a){var b=a.currentTarget.contentWindow._FCKEditingArea;if(b._timer){window.clearTimeout(b._timer);}b._timer=FCKTools.SetTimeout(FCKEditingArea_MakeEditableByMutation,1000,b);}function FCKEditingArea_MakeEditableByMutation(){delete this._timer;FCKTools.RemoveEventListener(this.Window.frameElement,"DOMAttrModified",FCKEditingArea_Document_AttributeNodeModified);this.MakeEditable();}FCKEditingArea.prototype.Focus=function(){try{if(this.Mode==0){if(FCKBrowserInfo.IsIE){this._FocusIE();}else{this.Window.focus();}}else{var a=FCKTools.GetElementDocument(this.Textarea);if((!a.hasFocus||a.hasFocus())&&a.activeElement==this.Textarea){return;}this.Textarea.focus();}}catch(b){}};FCKEditingArea.prototype._FocusIE=function(){this.Document.body.setActive();this.Window.focus();var a=this.Document.selection.createRange();var c=a.parentElement();var b=c.nodeName.toLowerCase();if(c.childNodes.length>0||!(FCKListsLib.BlockElements[b]||FCKListsLib.NonEmptyBlockElements[b])){return;}a=new FCKDomRange(this.Window);a.MoveToElementEditStart(c);a.Select();};function FCKEditingArea_Cleanup(){if(this.Document){this.Document.selection.empty();this.Document.body.innerHTML="";}this.TargetElement=null;this.IFrame=null;this.Document=null;this.Textarea=null;if(this.Window){this.Window._FCKEditingArea=null;this.Window=null;}}var FCKKeystrokeHandler=function(a){this.Keystrokes={};this.CancelCtrlDefaults=(a!==false);};FCKKeystrokeHandler.prototype.AttachToElement=function(a){FCKTools.AddEventListenerEx(a,"keydown",_FCKKeystrokeHandler_OnKeyDown,this);if(FCKBrowserInfo.IsGecko10||FCKBrowserInfo.IsOpera||(FCKBrowserInfo.IsGecko&&FCKBrowserInfo.IsMac)){FCKTools.AddEventListenerEx(a,"keypress",_FCKKeystrokeHandler_OnKeyPress,this);}};FCKKeystrokeHandler.prototype.SetKeystrokes=function(){for(var b=0;b<arguments.length;b++){var a=arguments[b];if(!a){continue;}if(typeof(a[0])=="object"){this.SetKeystrokes.apply(this,a);}else{if(a.length==1){delete this.Keystrokes[a[0]];}else{this.Keystrokes[a[0]]=a[1]===true?true:a;}}}};function _FCKKeystrokeHandler_OnKeyDown(a,h){var g=a.keyCode||a.which;var f=0;if(a.ctrlKey||a.metaKey){f+=CTRL;}if(a.shiftKey){f+=SHIFT;}if(a.altKey){f+=ALT;}var d=g+f;var c=h._CancelIt=false;var b=h.Keystrokes[d];if(b){if(b===true||!(h.OnKeystroke&&h.OnKeystroke.apply(h,b))){return true;}c=true;}if(c||(h.CancelCtrlDefaults&&f==CTRL&&(g<33||g>40))){h._CancelIt=true;if(a.preventDefault){return a.preventDefault();}a.returnValue=false;a.cancelBubble=true;return false;}return true;}function _FCKKeystrokeHandler_OnKeyPress(a,b){if(b._CancelIt){if(a.preventDefault){return a.preventDefault();}return false;}return true;}FCK.DTD=(function(){var a=FCKTools.Merge;var t,h,j,g,f,d,p,l,c,i,b,n,m,q,r,o,k;t={isindex:1,fieldset:1};r={input:1,button:1,select:1,textarea:1,label:1};q=a({a:1},r);p=a({iframe:1},q);o={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1};n={ins:1,del:1,script:1};m=a({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},n);l=a({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},m);k=a({p:1},l);j=a({iframe:1},l,r);i={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};h=a({a:1},j);g={tr:1};f={"#":1};d=a({param:1},i);c=a({form:1},t,p,o,k);b={li:1};return{col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:c,td:c,br:{},th:c,center:c,kbd:h,button:a(k,o),basefont:{},h5:h,h4:h,samp:h,h6:h,ol:b,h1:h,h3:h,option:f,h2:h,form:a(t,p,o,k),select:{optgroup:1,option:1},font:j,ins:c,menu:b,abbr:h,label:h,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:h,script:f,tfoot:g,cite:h,li:c,input:{},iframe:c,strong:j,textarea:f,noframes:c,big:j,small:j,span:j,hr:{},dt:h,sub:j,optgroup:{option:1},param:{},bdo:h,"var":j,div:c,object:d,sup:j,dd:c,strike:j,area:{},dir:b,map:a({area:1,form:1,p:1},t,n,o),applet:d,dl:{dt:1,dd:1},del:c,isindex:{},fieldset:a({legend:1},i),thead:g,ul:b,acronym:h,b:j,a:j,blockquote:c,caption:h,i:j,u:j,tbody:g,s:h,address:a(p,k),tt:j,legend:h,q:h,pre:a(m,q),p:h,em:j,dfn:h};})();var FCKStyle=function(a){this.Element=(a.Element||"span").toLowerCase();this._StyleDesc=a;};FCKStyle.prototype={GetType:function(){var a=this.GetType_$;if(a!=undefined){return a;}var b=this.Element;if(b=="#"||FCKListsLib.StyleBlockElements[b]){a=0;}else{if(FCKListsLib.StyleObjectElements[b]){a=2;}else{a=1;}}return(this.GetType_$=a);},ApplyToSelection:function(a){var b=new FCKDomRange(a);b.MoveToSelection();this.ApplyToRange(b,true);},ApplyToRange:function(a,c,b){switch(this.GetType()){case 0:this.ApplyToRange=this._ApplyBlockStyle;break;case 1:this.ApplyToRange=this._ApplyInlineStyle;break;default:return;}this.ApplyToRange(a,c,b);},ApplyToObject:function(a){if(!a){return;}this.BuildElement(null,a);},RemoveFromSelection:function(a){var b=new FCKDomRange(a);b.MoveToSelection();this.RemoveFromRange(b,true);},RemoveFromRange:function(Y,W,V){var G;var z=this._GetAttribsForComparison();var y=this._GetOverridesForComparison();if(Y.CheckIsCollapsed()){var G=Y.CreateBookmark(true);var x=Y.GetBookmarkNode(G,true);var v=new FCKElementPath(x.parentNode);var u=[];var t=!FCKDomTools.GetNextSibling(x);var r=t||!FCKDomTools.GetPreviousSibling(x);var q;var p=-1;for(var ab=0;ab<v.Elements.length;ab++){var o=v.Elements[ab];if(this.CheckElementRemovable(o)){if(r&&!FCKDomTools.CheckIsEmptyElement(o,function(a){return(a!=x);})){q=o;p=u.length-1;}else{var n=o.nodeName.toLowerCase();if(n==this.Element){for(var m in z){if(FCKDomTools.HasAttribute(o,m)){switch(m){case"style":this._RemoveStylesFromElement(o);break;case"class":if(FCKDomTools.GetAttributeValue(o,m)!=this.GetFinalAttributeValue(m)){continue;}default:FCKDomTools.RemoveAttribute(o,m);}}}}this._RemoveOverrides(o,y[n]);if(this.GetType()==1){this._RemoveNoAttribElement(o);}}}else{if(r){u.push(o);}}r=r&&((t&&!FCKDomTools.GetNextSibling(o))||(!t&&!FCKDomTools.GetPreviousSibling(o)));if(q&&(!r||(ab==v.Elements.length-1))){var l=FCKDomTools.RemoveNode(x);for(var aa=0;aa<=p;aa++){var k=FCKDomTools.CloneElement(u[aa]);k.appendChild(l);l=k;}if(t){FCKDomTools.InsertAfterNode(q,l);}else{q.parentNode.insertBefore(l,q);}r=false;q=null;}}if(W){Y.SelectBookmark(G);}if(V){Y.MoveToBookmark(G);}return;}Y.Expand("inline_elements");G=Y.CreateBookmark(true);var h=Y.GetBookmarkNode(G,true);var g=Y.GetBookmarkNode(G,false);Y.Release(true);var v=new FCKElementPath(h);var f=v.Elements;var o;for(var ab=1;ab<f.length;ab++){o=f[ab];if(o==v.Block||o==v.BlockLimit){break;}if(this.CheckElementRemovable(o)){FCKDomTools.BreakParent(h,o,Y);}}v=new FCKElementPath(g);f=v.Elements;for(var ab=1;ab<f.length;ab++){o=f[ab];if(o==v.Block||o==v.BlockLimit){break;}ad=o.nodeName.toLowerCase();if(this.CheckElementRemovable(o)){FCKDomTools.BreakParent(g,o,Y);}}var d=FCKDomTools.GetNextSourceNode(h,true);while(d){var ae=FCKDomTools.GetNextSourceNode(d);if(d.nodeType==1){var ad=d.nodeName.toLowerCase();var ac=(ad==this.Element);if(ac){for(var m in z){if(FCKDomTools.HasAttribute(d,m)){switch(m){case"style":this._RemoveStylesFromElement(d);break;case"class":if(FCKDomTools.GetAttributeValue(d,m)!=this.GetFinalAttributeValue(m)){continue;}default:FCKDomTools.RemoveAttribute(d,m);}}}}else{ac=!!y[ad];}if(ac){this._RemoveOverrides(d,y[ad]);this._RemoveNoAttribElement(d);}}if(ae==g){break;}d=ae;}this._FixBookmarkStart(h);if(W){Y.SelectBookmark(G);}if(V){Y.MoveToBookmark(G);}},CheckElementRemovable:function(d,c){if(!d){return false;}var b=d.nodeName.toLowerCase();if(b==this.Element){if(!c&&!FCKDomTools.HasAttributes(d)){return true;}var a=this._GetAttribsForComparison();var l=(a._length==0);for(var k in a){if(k=="_length"){continue;}if(this._CompareAttributeValues(k,FCKDomTools.GetAttributeValue(d,k),(this.GetFinalAttributeValue(k)||""))){l=true;if(!c){break;}}else{l=false;if(c){return false;}}}if(l){return true;}}var j=this._GetOverridesForComparison()[b];if(j){if(!(a=j.Attributes)){return true;}for(var f=0;f<a.length;f++){var h=a[f][0];if(FCKDomTools.HasAttribute(d,h)){var g=a[f][1];if(g==null||(typeof g=="string"&&FCKDomTools.GetAttributeValue(d,h)==g)||g.test(FCKDomTools.GetAttributeValue(d,h))){return true;}}}}return false;},CheckActive:function(a){switch(this.GetType()){case 0:return this.CheckElementRemovable(a.Block||a.BlockLimit,true);case 1:var d=a.Elements;for(var b=0;b<d.length;b++){var c=d[b];if(c==a.Block||c==a.BlockLimit){continue;}if(this.CheckElementRemovable(c,true)){return true;}}}return false;},RemoveFromElement:function(a){var j=this._GetAttribsForComparison();var h=this._GetOverridesForComparison();var g=a.getElementsByTagName(this.Element);for(var b=g.length-1;b>=0;b--){var f=g[b];for(var d in j){if(FCKDomTools.HasAttribute(f,d)){switch(d){case"style":this._RemoveStylesFromElement(f);break;case"class":if(FCKDomTools.GetAttributeValue(f,d)!=this.GetFinalAttributeValue(d)){continue;}default:FCKDomTools.RemoveAttribute(f,d);}}}this._RemoveOverrides(f,h[this.Element]);this._RemoveNoAttribElement(f);}for(var c in h){if(c!=this.Element){g=a.getElementsByTagName(c);for(var b=g.length-1;b>=0;b--){var f=g[b];this._RemoveOverrides(f,h[c]);this._RemoveNoAttribElement(f);}}}},_RemoveStylesFromElement:function(a){var d=a.style.cssText;var c=this.GetFinalStyleValue();if(d.length>0&&c.length==0){return;}c="(^|;)\\s*("+c.replace(/\s*([^ ]+):.*?(;|$)/g,"$1|").replace(/\|$/,"")+"):[^;]+";var b=new RegExp(c,"gi");d=d.replace(b,"").Trim();if(d.length==0||d==";"){FCKDomTools.RemoveAttribute(a,"style");}else{a.style.cssText=d.replace(b,"");}},_RemoveOverrides:function(a,g){var f=g&&g.Attributes;if(f){for(var b=0;b<f.length;b++){var d=f[b][0];if(FCKDomTools.HasAttribute(a,d)){var c=f[b][1];if(c==null||(c.test&&c.test(FCKDomTools.GetAttributeValue(a,d)))||(typeof c=="string"&&FCKDomTools.GetAttributeValue(a,d)==c)){FCKDomTools.RemoveAttribute(a,d);}}}}},_RemoveNoAttribElement:function(a){if(!FCKDomTools.HasAttributes(a)){var c=a.firstChild;var b=a.lastChild;FCKDomTools.RemoveNode(a,true);this._MergeSiblings(c);if(c!=b){this._MergeSiblings(b);}}},BuildElement:function(a,g){var f=g||a.createElement(this.Element);var d=this._StyleDesc.Attributes;var c;if(d){for(var b in d){c=this.GetFinalAttributeValue(b);if(b.toLowerCase()=="class"){f.className=c;}else{f.setAttribute(b,c);}}}if(this._GetStyleText().length>0){f.style.cssText=this.GetFinalStyleValue();}return f;},_CompareAttributeValues:function(a,c,b){if(a=="style"&&c&&b){c=c.replace(/;$/,"").toLowerCase();b=b.replace(/;$/,"").toLowerCase();}return(c==b||((c===null||c==="")&&(b===null||b==="")));},GetFinalAttributeValue:function(a){var b=this._StyleDesc.Attributes;var b=b?b[a]:null;if(!b&&a=="style"){return this.GetFinalStyleValue();}if(b&&this._Variables){b=b.Replace(FCKRegexLib.StyleVariableAttName,this._GetVariableReplace,this);}return b;},GetFinalStyleValue:function(){var a=this._GetStyleText();if(a.length>0&&this._Variables){a=a.Replace(FCKRegexLib.StyleVariableAttName,this._GetVariableReplace,this);a=FCKTools.NormalizeCssText(a);}return a;},_GetVariableReplace:function(){return this._Variables[arguments[2]]||arguments[0];},SetVariable:function(a,c){var b=this._Variables;if(!b){b=this._Variables={};}this._Variables[a]=c;},_FromPre:function(a,g,f){var d=g.innerHTML;d=d.replace(/(\r\n|\r)/g,"\n");d=d.replace(/^[ \t]*\n/,"");d=d.replace(/\n$/,"");d=d.replace(/^[ \t]+|[ \t]+$/g,function(h,j,i){if(h.length==1){return"&nbsp;";}else{if(j==0){return new Array(h.length).join("&nbsp;")+" ";}else{return" "+new Array(h.length).join("&nbsp;");}}});var c=new FCKHtmlIterator(d);var b=[];c.Each(function(h,i){if(!h){i=i.replace(/\n/g,"<br>");i=i.replace(/[ \t]{2,}/g,function(j){return new Array(j.length).join("&nbsp;")+" ";});}b.push(i);});f.innerHTML=b.join("");return f;},_ToPre:function(a,h,g){var f=h.innerHTML.Trim();f=f.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"<br />");var d=new FCKHtmlIterator(f);var c=[];d.Each(function(i,j){if(!i){j=j.replace(/([ \t\n\r]+|&nbsp;)/g," ");}else{if(i&&j=="<br />"){j="\n";}}c.push(j);});if(FCKBrowserInfo.IsIE){var b=a.createElement("div");b.appendChild(g);g.outerHTML="<pre>\n"+c.join("")+"</pre>";g=b.removeChild(b.firstChild);}else{g.innerHTML=c.join("");}return g;},_CheckAndMergePre:function(a,c){if(a!=FCKDomTools.GetPreviousSourceElement(c,true)){return;}var b=a.innerHTML.replace(/\n$/,"")+"\n\n"+c.innerHTML.replace(/^\n/,"");if(FCKBrowserInfo.IsIE){c.outerHTML="<pre>"+b+"</pre>";}else{c.innerHTML=b;}FCKDomTools.RemoveNode(a);},_CheckAndSplitPre:function(a){var d;var c=a.firstChild;c=c&&c.nextSibling;while(c){var b=c.nextSibling;if(b&&b.nextSibling&&c.nodeName.IEquals("br")&&b.nodeName.IEquals("br")){FCKDomTools.RemoveNode(c);c=b.nextSibling;FCKDomTools.RemoveNode(b);d=FCKDomTools.InsertAfterNode(d||a,FCKDomTools.CloneElement(a));continue;}if(d){c=c.previousSibling;FCKDomTools.MoveNode(c.nextSibling,d);}c=c.nextSibling;}},_ApplyBlockStyle:function(d,c,b){var a;if(c){a=d.CreateBookmark();}var n=new FCKDomRangeIterator(d);n.EnforceRealBlocks=true;var m;var l=d.Window.document;var k;while((m=n.GetNextParagraph())){var j=this.BuildElement(l);var i=j.nodeName.IEquals("pre");var h=m.nodeName.IEquals("pre");var g=i&&!h;var f=!i&&h;if(g){j=this._ToPre(l,m,j);}else{if(f){j=this._FromPre(l,m,j);}else{FCKDomTools.MoveChildren(m,j);}}m.parentNode.insertBefore(j,m);FCKDomTools.RemoveNode(m);if(i){if(k){this._CheckAndMergePre(k,j);}k=j;}else{if(f){this._CheckAndSplitPre(j);}}}if(c){d.SelectBookmark(a);}if(b){d.MoveToBookmark(a);}},_ApplyInlineStyle:function(t,r,q){var p=t.Window.document;if(t.CheckIsCollapsed()){var o=this.BuildElement(p);t.InsertNode(o);t.MoveToPosition(o,2);t.Select();return;}var n=this.Element;var m=FCK.DTD[n]||FCK.DTD.span;var l=this._GetAttribsForComparison();var k;t.Expand("inline_elements");var j=t.CreateBookmark(true);var i=t.GetBookmarkNode(j,true);var h=t.GetBookmarkNode(j,false);t.Release(true);var g=FCKDomTools.GetNextSourceNode(i,true);while(g){var f=false;var d=g.nodeType;var c=d==1?g.nodeName.toLowerCase():null;if(!c||m[c]){if((FCK.DTD[g.parentNode.nodeName.toLowerCase()]||FCK.DTD.span)[n]||!FCK.DTD[n]){if(!t.CheckHasRange()){t.SetStart(g,3);}if(d!=1||g.childNodes.length==0){var b=g;var a=b.parentNode;while(b==a.lastChild&&m[a.nodeName.toLowerCase()]){b=a;}t.SetEnd(b,4);if(b==b.parentNode.lastChild&&!m[b.parentNode.nodeName.toLowerCase()]){f=true;}}else{t.SetEnd(g,3);}}else{f=true;}}else{f=true;}g=FCKDomTools.GetNextSourceNode(g);if(g==h){g=null;f=true;}if(f&&t.CheckHasRange()&&!t.CheckIsCollapsed()){k=this.BuildElement(p);t.ExtractContents().AppendTo(k);if(k.innerHTML.RTrim().length>0){t.InsertNode(k);this.RemoveFromElement(k);this._MergeSiblings(k,this._GetAttribsForComparison());if(!FCKBrowserInfo.IsIE){k.normalize();}}t.Release(true);}}this._FixBookmarkStart(i);if(r){t.SelectBookmark(j);}if(q){t.MoveToBookmark(j);}},_FixBookmarkStart:function(a){var b;while((b=a.nextSibling)){if(b.nodeType==1&&FCKListsLib.InlineNonEmptyElements[b.nodeName.toLowerCase()]){if(!b.firstChild){FCKDomTools.RemoveNode(b);}else{FCKDomTools.MoveNode(a,b,true);}continue;}if(b.nodeType==3&&b.length==0){FCKDomTools.RemoveNode(b);continue;}break;}},_MergeSiblings:function(a,b){if(!a||a.nodeType!=1||!FCKListsLib.InlineNonEmptyElements[a.nodeName.toLowerCase()]){return;}this._MergeNextSibling(a,b);this._MergePreviousSibling(a,b);},_MergeNextSibling:function(a,f){var d=a.nextSibling;var c=(d&&d.nodeType==1&&d.getAttribute("_fck_bookmark"));if(c){d=d.nextSibling;}if(d&&d.nodeType==1&&d.nodeName==a.nodeName){if(!f){f=this._CreateElementAttribsForComparison(a);}if(this._CheckAttributesMatch(d,f)){var b=a.lastChild;if(c){FCKDomTools.MoveNode(a.nextSibling,a);}FCKDomTools.MoveChildren(d,a);FCKDomTools.RemoveNode(d);if(b){this._MergeNextSibling(b);}}}},_MergePreviousSibling:function(a,f){var d=a.previousSibling;var c=(d&&d.nodeType==1&&d.getAttribute("_fck_bookmark"));if(c){d=d.previousSibling;}if(d&&d.nodeType==1&&d.nodeName==a.nodeName){if(!f){f=this._CreateElementAttribsForComparison(a);}if(this._CheckAttributesMatch(d,f)){var b=a.firstChild;if(c){FCKDomTools.MoveNode(a.previousSibling,a,true);}FCKDomTools.MoveChildren(d,a,true);FCKDomTools.RemoveNode(d);if(b){this._MergePreviousSibling(b);}}}},_GetStyleText:function(){var a=this._StyleDesc.Styles;var c=(this._StyleDesc.Attributes?this._StyleDesc.Attributes["style"]||"":"");if(c.length>0){c+=";";}for(var b in a){c+=b+":"+a[b]+";";}if(c.length>0&&!(/#\(/.test(c))){c=FCKTools.NormalizeCssText(c);}return(this._GetStyleText=function(){return c;})();},_GetAttribsForComparison:function(){var a=this._GetAttribsForComparison_$;if(a){return a;}a={};var c=this._StyleDesc.Attributes;if(c){for(var b in c){a[b.toLowerCase()]=c[b].toLowerCase();}}if(this._GetStyleText().length>0){a["style"]=this._GetStyleText().toLowerCase();}FCKTools.AppendLengthProperty(a,"_length");return(this._GetAttribsForComparison_$=a);},_GetOverridesForComparison:function(){var d=this._GetOverridesForComparison_$;if(d){return d;}d={};var c=this._StyleDesc.Overrides;if(c){if(!FCKTools.IsArray(c)){c=[c];}for(var f=0;f<c.length;f++){var b=c[f];var a;var k;var j;if(typeof b=="string"){a=b.toLowerCase();}else{a=b.Element?b.Element.toLowerCase():this.Element;j=b.Attributes;}k=d[a]||(d[a]={});if(j){var h=(k.Attributes=k.Attributes||[]);for(var g in j){h.push([g.toLowerCase(),j[g]]);}}}}return(this._GetOverridesForComparison_$=d);},_CreateElementAttribsForComparison:function(a){var f={};var d=0;for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];if(c.specified){f[c.nodeName.toLowerCase()]=FCKDomTools.GetAttributeValue(a,c).toLowerCase();d++;}}f._length=d;return f;},_CheckAttributesMatch:function(a,j){var h=a.attributes;var g=0;for(var b=0;b<h.length;b++){var f=h[b];if(f.specified){var d=f.nodeName.toLowerCase();var c=j[d];if(!c){break;}if(c!=FCKDomTools.GetAttributeValue(a,f).toLowerCase()){break;}g++;}}return(g==j._length);}};var FCKStyles=FCK.Styles={_Callbacks:{},_ObjectStyles:{},ApplyStyle:function(a){if(typeof a=="string"){a=this.GetStyles()[a];}if(a){if(a.GetType()==2){a.ApplyToObject(FCKSelection.GetSelectedElement());}else{a.ApplyToSelection(FCK.EditorWindow);}FCK.Events.FireEvent("OnSelectionChange");}},RemoveStyle:function(a){if(typeof a=="string"){a=this.GetStyles()[a];}if(a){a.RemoveFromSelection(FCK.EditorWindow);FCK.Events.FireEvent("OnSelectionChange");}},AttachStyleStateChange:function(a,d,c){var b=this._Callbacks[a];if(!b){b=this._Callbacks[a]=[];}b.push([d,c]);},CheckSelectionChanges:function(){var d=FCKSelection.GetBoundaryParentElement(true);if(!d){return;}var c=new FCKElementPath(d);var b=this.GetStyles();for(var a in b){var l=this._Callbacks[a];if(l){var k=b[a];var j=k.CheckActive(c);if(j!=(k._LastState||null)){k._LastState=j;for(var f=0;f<l.length;f++){var h=l[f][0];var g=l[f][1];h.call(g||window,a,j);}}}}},CheckStyleInSelection:function(a){return false;},_GetRemoveFormatTagsRegex:function(){var a=new RegExp("^(?:"+FCKConfig.RemoveFormatTags.replace(/,/g,"|")+")$","i");return(this._GetRemoveFormatTagsRegex=function(){return a;})&&a;},RemoveAll:function(){var d=new FCKDomRange(FCK.EditorWindow);d.MoveToSelection();if(d.CheckIsCollapsed()){return;}d.Expand("inline_elements");var c=d.CreateBookmark(true);var b=d.GetBookmarkNode(c,true);var a=d.GetBookmarkNode(c,false);d.Release(true);var m=this._GetRemoveFormatTagsRegex();var l=new FCKElementPath(b);var k=l.Elements;var j;for(var f=1;f<k.length;f++){j=k[f];if(j==l.Block||j==l.BlockLimit){break;}if(m.test(j.nodeName)){FCKDomTools.BreakParent(b,j,d);}}l=new FCKElementPath(a);k=l.Elements;for(var f=1;f<k.length;f++){j=k[f];if(j==l.Block||j==l.BlockLimit){break;}elementName=j.nodeName.toLowerCase();if(m.test(j.nodeName)){FCKDomTools.BreakParent(a,j,d);}}var h=FCKDomTools.GetNextSourceNode(b,true,1);while(h){if(h==a){break;}var g=FCKDomTools.GetNextSourceNode(h,false,1);if(m.test(h.nodeName)){FCKDomTools.RemoveNode(h,true);}else{FCKDomTools.RemoveAttributes(h,FCKConfig.RemoveAttributesArray);}h=g;}d.SelectBookmark(c);FCK.Events.FireEvent("OnSelectionChange");},GetStyle:function(a){return this.GetStyles()[a];},GetStyles:function(){var a=this._GetStyles;if(!a){a=this._GetStyles=FCKTools.Merge(this._LoadStylesCore(),this._LoadStylesCustom(),this._LoadStylesXml());}return a;},CheckHasObjectStyle:function(a){return !!this._ObjectStyles[a];},_LoadStylesCore:function(){var a={};var d=FCKConfig.CoreStyles;for(var c in d){var b=a["_FCK_"+c]=new FCKStyle(d[c]);b.IsCore=true;}return a;},_LoadStylesCustom:function(){var a={};var d=FCKConfig.CustomStyles;if(d){for(var c in d){var b=a[c]=new FCKStyle(d[c]);b.Name=c;}}return a;},_LoadStylesXml:function(){var v={};var u=FCKConfig.StylesXmlPath;if(!u||u.length==0){return v;}var t=new FCKXml();t.LoadUrl(u);var r=FCKXml.TransformToObject(t.SelectSingleNode("Styles"));var q=r.$Style;if(!q){return v;}for(var z=0;z<q.length;z++){var p=q[z];var o=(p.element||"").toLowerCase();if(o.length==0){throw ('The element name is required. Error loading "'+u+'"');}var n={Element:o,Attributes:{},Styles:{},Overrides:[]};var m=p.$Attribute||[];for(var y=0;y<m.length;y++){n.Attributes[m[y].name]=m[y].value;}var l=p.$Style||[];for(y=0;y<l.length;y++){n.Styles[l[y].name]=l[y].value;}var h=p.$Override;if(h){for(y=0;y<h.length;y++){var g=h[y];var f={Element:g.element};var d=g.$Attribute;if(d){f.Attributes={};for(var x=0;x<d.length;x++){var c=d[x].value||null;if(c){var b=c&&FCKRegexLib.RegExp.exec(c);if(b){c=new RegExp(b[1],b[2]||"");}}f.Attributes[d[x].name]=c;}}n.Overrides.push(f);}}var a=new FCKStyle(n);a.Name=p.name||o;if(a.GetType()==2){this._ObjectStyles[o]=true;}v[a.Name]=a;}return v;}};var FCKListHandler={OutdentListItem:function(d){var c=d.parentNode;if(c.tagName.toUpperCase().Equals("UL","OL")){var b=FCKTools.GetElementDocument(d);var a=new FCKDocumentFragment(b);var o=a.RootNode;var n=false;var m=FCKDomTools.GetFirstChild(d,["UL","OL"]);if(m){n=true;var l;while((l=m.firstChild)){o.appendChild(m.removeChild(l));}FCKDomTools.RemoveNode(m);}var k;var j=false;while((k=d.nextSibling)){if(!n&&k.nodeType==1&&k.nodeName.toUpperCase()=="LI"){j=n=true;}o.appendChild(k.parentNode.removeChild(k));if(!j&&k.nodeType==1&&k.nodeName.toUpperCase().Equals("UL","OL")){FCKDomTools.RemoveNode(k,true);}}var i=c.parentNode.tagName.toUpperCase();var h=(i=="LI");if(h||i.Equals("UL","OL")){if(n){var m=c.cloneNode(false);a.AppendTo(m);d.appendChild(m);}else{if(h){a.InsertAfterNode(c.parentNode);}else{a.InsertAfterNode(c);}}if(h){FCKDomTools.InsertAfterNode(c.parentNode,c.removeChild(d));}else{FCKDomTools.InsertAfterNode(c,c.removeChild(d));}}else{if(n){var g=c.cloneNode(false);a.AppendTo(g);FCKDomTools.InsertAfterNode(c,g);}var f=b.createElement(FCKConfig.EnterMode=="p"?"p":"div");FCKDomTools.MoveChildren(c.removeChild(d),f);FCKDomTools.InsertAfterNode(c,f);if(FCKConfig.EnterMode=="br"){if(FCKBrowserInfo.IsGecko){f.parentNode.insertBefore(FCKTools.CreateBogusBR(b),f);}else{FCKDomTools.InsertAfterNode(f,FCKTools.CreateBogusBR(b));}FCKDomTools.RemoveNode(f,true);}}if(this.CheckEmptyList(c)){FCKDomTools.RemoveNode(c,true);}}},CheckEmptyList:function(a){return(FCKDomTools.GetFirstChild(a,"LI")==null);},CheckListHasContents:function(a){var b=a.firstChild;while(b){switch(b.nodeType){case 1:if(!b.nodeName.IEquals("UL","LI")){return true;}break;case 3:if(b.nodeValue.Trim().length>0){return true;}}b=b.nextSibling;}return false;}};var FCKElementPath=function(a){var g=null;var f=null;var d=[];var c=a;while(c){if(c.nodeType==1){if(!this.LastElement){this.LastElement=c;}var b=c.nodeName.toLowerCase();if(FCKBrowserInfo.IsIE&&c.scopeName!="HTML"){b=c.scopeName.toLowerCase()+":"+b;}if(!f){if(!g&&FCKListsLib.PathBlockElements[b]!=null){g=c;}if(FCKListsLib.PathBlockLimitElements[b]!=null){if(!g&&b=="div"&&!FCKElementPath._CheckHasBlock(c)){g=c;}else{f=c;}}}d.push(c);if(b=="body"){break;}}c=c.parentNode;}this.Block=g;this.BlockLimit=f;this.Elements=d;};FCKElementPath._CheckHasBlock=function(a){var f=a.childNodes;for(var b=0,c=f.length;b<c;b++){var d=f[b];if(d.nodeType==1&&FCKListsLib.BlockElements[d.nodeName.toLowerCase()]){return true;}}return false;};var FCKDomRange=function(a){this.Window=a;this._Cache={};};FCKDomRange.prototype={_UpdateElementInfo:function(){var a=this._Range;if(!a){this.Release(true);}else{var f=a.startContainer;var d=new FCKElementPath(f);this.StartNode=f.nodeType==3?f:f.childNodes[a.startOffset];this.StartContainer=f;this.StartBlock=d.Block;this.StartBlockLimit=d.BlockLimit;if(a.collapsed){this.EndNode=this.StartNode;this.EndContainer=this.StartContainer;this.EndBlock=this.StartBlock;this.EndBlockLimit=this.StartBlockLimit;}else{var c=a.endContainer;if(f!=c){d=new FCKElementPath(c);}var b=c;if(a.endOffset==0){while(b&&!b.previousSibling){b=b.parentNode;}if(b){b=b.previousSibling;}}else{if(b.nodeType==1){b=b.childNodes[a.endOffset-1];}}this.EndNode=b;this.EndContainer=c;this.EndBlock=d.Block;this.EndBlockLimit=d.BlockLimit;}}this._Cache={};},CreateRange:function(){return new FCKW3CRange(this.Window.document);},DeleteContents:function(){if(this._Range){this._Range.deleteContents();this._UpdateElementInfo();}},ExtractContents:function(){if(this._Range){var a=this._Range.extractContents();this._UpdateElementInfo();return a;}return null;},CheckIsCollapsed:function(){if(this._Range){return this._Range.collapsed;}return false;},Collapse:function(a){if(this._Range){this._Range.collapse(a);}this._UpdateElementInfo();},Clone:function(){var a=FCKTools.CloneObject(this);if(this._Range){a._Range=this._Range.cloneRange();}return a;},MoveToNodeContents:function(a){if(!this._Range){this._Range=this.CreateRange();}this._Range.selectNodeContents(a);this._UpdateElementInfo();},MoveToElementStart:function(a){this.SetStart(a,1);this.SetEnd(a,1);},MoveToElementEditStart:function(a){var b;while(a&&a.nodeType==1){if(FCKDomTools.CheckIsEditable(a)){b=a;}else{if(b){break;}}a=a.firstChild;}if(b){this.MoveToElementStart(b);}},InsertNode:function(a){if(this._Range){this._Range.insertNode(a);}},CheckIsEmpty:function(){if(this.CheckIsCollapsed()){return true;}var a=this.Window.document.createElement("div");this._Range.cloneContents().AppendTo(a);FCKDomTools.TrimNode(a);return(a.innerHTML.length==0);},CheckStartOfBlock:function(){var a=this._Cache;var h=a.IsStartOfBlock;if(h!=undefined){return h;}var g=this.StartBlock||this.StartBlockLimit;var f=this._Range.startContainer;var d=this._Range.startOffset;var c;if(d>0){if(f.nodeType==3){var b=f.nodeValue.substr(0,d).Trim();if(b.length!=0){return a.IsStartOfBlock=false;}}else{c=f.childNodes[d-1];}}if(!c){c=FCKDomTools.GetPreviousSourceNode(f,true,null,g);}while(c){switch(c.nodeType){case 1:if(!FCKListsLib.InlineChildReqElements[c.nodeName.toLowerCase()]){return a.IsStartOfBlock=false;}break;case 3:if(c.nodeValue.Trim().length>0){return a.IsStartOfBlock=false;}}c=FCKDomTools.GetPreviousSourceNode(c,false,null,g);}return a.IsStartOfBlock=true;},CheckEndOfBlock:function(d){var c=this._Cache.IsEndOfBlock;if(c!=undefined){return c;}var b=this.EndBlock||this.EndBlockLimit;var a=this._Range.endContainer;var j=this._Range.endOffset;var i;if(a.nodeType==3){var h=a.nodeValue;if(j<h.length){h=h.substr(j);if(h.Trim().length!=0){return this._Cache.IsEndOfBlock=false;}}}else{i=a.childNodes[j];}if(!i){i=FCKDomTools.GetNextSourceNode(a,true,null,b);}var g=false;while(i){switch(i.nodeType){case 1:var f=i.nodeName.toLowerCase();if(FCKListsLib.InlineChildReqElements[f]){break;}if(f=="br"&&!g){g=true;break;}return this._Cache.IsEndOfBlock=false;case 3:if(i.nodeValue.Trim().length>0){return this._Cache.IsEndOfBlock=false;}}i=FCKDomTools.GetNextSourceNode(i,false,null,b);}if(d){this.Select();}return this._Cache.IsEndOfBlock=true;},CreateBookmark:function(a){var g={StartId:(new Date()).valueOf()+Math.floor(Math.random()*1000)+"S",EndId:(new Date()).valueOf()+Math.floor(Math.random()*1000)+"E"};var f=this.Window.document;var d;var c;var b;if(!this.CheckIsCollapsed()){c=f.createElement("span");c.style.display="none";c.id=g.EndId;c.setAttribute("_fck_bookmark",true);c.innerHTML="&nbsp;";b=this.Clone();b.Collapse(false);b.InsertNode(c);}d=f.createElement("span");d.style.display="none";d.id=g.StartId;d.setAttribute("_fck_bookmark",true);d.innerHTML="&nbsp;";b=this.Clone();b.Collapse(true);b.InsertNode(d);if(a){g.StartNode=d;g.EndNode=c;}if(c){this.SetStart(d,4);this.SetEnd(c,3);}else{this.MoveToPosition(d,4);}return g;},GetBookmarkNode:function(a,c){var b=this.Window.document;if(c){return a.StartNode||b.getElementById(a.StartId);}else{return a.EndNode||b.getElementById(a.EndId);}},MoveToBookmark:function(a,d){var c=this.GetBookmarkNode(a,true);var b=this.GetBookmarkNode(a,false);this.SetStart(c,3);if(!d){FCKDomTools.RemoveNode(c);}if(b){this.SetEnd(b,3);if(!d){FCKDomTools.RemoveNode(b);}}else{this.Collapse(true);}this._UpdateElementInfo();},CreateBookmark2:function(){if(!this._Range){return{"Start":0,"End":0};}var a={"Start":[this._Range.startOffset],"End":[this._Range.endOffset]};var h=this._Range.startContainer.previousSibling;var g=this._Range.endContainer.previousSibling;var f=this._Range.startContainer;var d=this._Range.endContainer;while(h&&h.nodeType==3&&f.nodeType==3){a.Start[0]+=h.length;f=h;h=h.previousSibling;}while(g&&g.nodeType==3&&d.nodeType==3){a.End[0]+=g.length;d=g;g=g.previousSibling;}if(f.nodeType==1&&f.childNodes[a.Start[0]]&&f.childNodes[a.Start[0]].nodeType==3){var c=f.childNodes[a.Start[0]];var b=0;while(c.previousSibling&&c.previousSibling.nodeType==3){c=c.previousSibling;b+=c.length;}f=c;a.Start[0]=b;}if(d.nodeType==1&&d.childNodes[a.End[0]]&&d.childNodes[a.End[0]].nodeType==3){var c=d.childNodes[a.End[0]];var b=0;while(c.previousSibling&&c.previousSibling.nodeType==3){c=c.previousSibling;b+=c.length;}d=c;a.End[0]=b;}a.Start=FCKDomTools.GetNodeAddress(f,true).concat(a.Start);a.End=FCKDomTools.GetNodeAddress(d,true).concat(a.End);return a;},MoveToBookmark2:function(a){var f=FCKDomTools.GetNodeFromAddress(this.Window.document,a.Start.slice(0,-1),true);var d=FCKDomTools.GetNodeFromAddress(this.Window.document,a.End.slice(0,-1),true);this.Release(true);this._Range=new FCKW3CRange(this.Window.document);var c=a.Start[a.Start.length-1];var b=a.End[a.End.length-1];while(f.nodeType==3&&c>f.length){if(!f.nextSibling||f.nextSibling.nodeType!=3){break;}c-=f.length;f=f.nextSibling;}while(d.nodeType==3&&b>d.length){if(!d.nextSibling||d.nextSibling.nodeType!=3){break;}b-=d.length;d=d.nextSibling;}this._Range.setStart(f,c);this._Range.setEnd(d,b);this._UpdateElementInfo();},MoveToPosition:function(a,b){this.SetStart(a,b);this.Collapse(true);},SetStart:function(a,d,c){var b=this._Range;if(!b){b=this._Range=this.CreateRange();}switch(d){case 1:b.setStart(a,0);break;case 2:b.setStart(a,a.childNodes.length);break;case 3:b.setStartBefore(a);break;case 4:b.setStartAfter(a);}if(!c){this._UpdateElementInfo();}},SetEnd:function(a,d,c){var b=this._Range;if(!b){b=this._Range=this.CreateRange();}switch(d){case 1:b.setEnd(a,0);break;case 2:b.setEnd(a,a.childNodes.length);break;case 3:b.setEndBefore(a);break;case 4:b.setEndAfter(a);}if(!c){this._UpdateElementInfo();}},Expand:function(a){var g,b;switch(a){case"inline_elements":if(this._Range.startOffset==0){g=this._Range.startContainer;if(g.nodeType!=1){g=g.previousSibling?null:g.parentNode;}if(g){while(FCKListsLib.InlineNonEmptyElements[g.nodeName.toLowerCase()]){this._Range.setStartBefore(g);if(g!=g.parentNode.firstChild){break;}g=g.parentNode;}}}g=this._Range.endContainer;var f=this._Range.endOffset;if((g.nodeType==3&&f>=g.nodeValue.length)||(g.nodeType==1&&f>=g.childNodes.length)||(g.nodeType!=1&&g.nodeType!=3)){if(g.nodeType!=1){g=g.nextSibling?null:g.parentNode;}if(g){while(FCKListsLib.InlineNonEmptyElements[g.nodeName.toLowerCase()]){this._Range.setEndAfter(g);if(g!=g.parentNode.lastChild){break;}g=g.parentNode;}}}break;case"block_contents":case"list_contents":var d=FCKListsLib.BlockBoundaries;if(a=="list_contents"||FCKConfig.EnterMode=="br"){d=FCKListsLib.ListBoundaries;}if(this.StartBlock&&FCKConfig.EnterMode!="br"&&a=="block_contents"){this.SetStart(this.StartBlock,1);}else{g=this._Range.startContainer;if(g.nodeType==1){var c=g.childNodes[this._Range.startOffset];if(c){g=FCKDomTools.GetPreviousSourceNode(c,true);}else{g=g.lastChild||g;}}while(g&&(g.nodeType!=1||(g!=this.StartBlockLimit&&!d[g.nodeName.toLowerCase()]))){this._Range.setStartBefore(g);g=g.previousSibling||g.parentNode;}}if(this.EndBlock&&FCKConfig.EnterMode!="br"&&a=="block_contents"&&this.EndBlock.nodeName.toLowerCase()!="li"){this.SetEnd(this.EndBlock,2);}else{g=this._Range.endContainer;if(g.nodeType==1){g=g.childNodes[this._Range.endOffset]||g.lastChild;}while(g&&(g.nodeType!=1||(g!=this.StartBlockLimit&&!d[g.nodeName.toLowerCase()]))){this._Range.setEndAfter(g);g=g.nextSibling||g.parentNode;}if(g&&g.nodeName.toLowerCase()=="br"){this._Range.setEndAfter(g);}}this._UpdateElementInfo();}},SplitBlock:function(a){var i=a||FCKConfig.EnterMode;if(!this._Range){this.MoveToSelection();}if(this.StartBlockLimit==this.EndBlockLimit){var h=this.StartBlock;var g=this.EndBlock;var f=null;if(i!="br"){if(!h){h=this.FixBlock(true,i);g=this.EndBlock;}if(!g){g=this.FixBlock(false,i);}}var d=(h!=null&&this.CheckStartOfBlock());var c=(g!=null&&this.CheckEndOfBlock());if(!this.CheckIsEmpty()){this.DeleteContents();}if(h&&g&&h==g){if(c){f=new FCKElementPath(this.StartContainer);this.MoveToPosition(g,4);g=null;}else{if(d){f=new FCKElementPath(this.StartContainer);this.MoveToPosition(h,3);h=null;}else{this.SetEnd(h,2);var b=this.ExtractContents();g=h.cloneNode(false);g.removeAttribute("id",false);b.AppendTo(g);FCKDomTools.InsertAfterNode(h,g);this.MoveToPosition(h,4);if(FCKBrowserInfo.IsGecko&&!h.nodeName.IEquals(["ul","ol"])){FCKTools.AppendBogusBr(h);}}}}return{PreviousBlock:h,NextBlock:g,WasStartOfBlock:d,WasEndOfBlock:c,ElementPath:f};}return null;},FixBlock:function(a,d){var c=this.CreateBookmark();this.Collapse(a);this.Expand("block_contents");var b=this.Window.document.createElement(d);this.ExtractContents().AppendTo(b);FCKDomTools.TrimNode(b);if(FCKDomTools.CheckIsEmptyElement(b,function(f){return f.getAttribute("_fck_bookmark")!="true";})&&FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(b);}this.InsertNode(b);this.MoveToBookmark(c);return b;},Release:function(a){if(!a){this.Window=null;}this.StartNode=null;this.StartContainer=null;this.StartBlock=null;this.StartBlockLimit=null;this.EndNode=null;this.EndContainer=null;this.EndBlock=null;this.EndBlockLimit=null;this._Range=null;this._Cache=null;},CheckHasRange:function(){return !!this._Range;},GetTouchedStartNode:function(){var a=this._Range;var b=a.startContainer;if(a.collapsed||b.nodeType!=1){return b;}return b.childNodes[a.startOffset]||b;},GetTouchedEndNode:function(){var a=this._Range;var b=a.endContainer;if(a.collapsed||b.nodeType!=1){return b;}return b.childNodes[a.endOffset-1]||b;}};FCKDomRange.prototype.MoveToSelection=function(){this.Release(true);var a=this.Window.getSelection();if(a&&a.rangeCount>0){this._Range=FCKW3CRange.CreateFromRange(this.Window.document,a.getRangeAt(0));this._UpdateElementInfo();}else{if(this.Window.document){this.MoveToElementStart(this.Window.document.body);}}};FCKDomRange.prototype.Select=function(){var a=this._Range;if(a){var f=a.startContainer;if(a.collapsed&&f.nodeType==1&&f.childNodes.length==0){f.appendChild(a._Document.createTextNode(""));}var d=this.Window.document.createRange();d.setStart(f,a.startOffset);try{d.setEnd(a.endContainer,a.endOffset);}catch(c){if(c.toString().Contains("NS_ERROR_ILLEGAL_VALUE")){a.collapse(true);d.setEnd(a.endContainer,a.endOffset);}else{throw (c);}}var b=this.Window.getSelection();b.removeAllRanges();b.addRange(d);}};FCKDomRange.prototype.SelectBookmark=function(a){var f=this.Window.document.createRange();var d=this.GetBookmarkNode(a,true);var c=this.GetBookmarkNode(a,false);f.setStart(d.parentNode,FCKDomTools.GetIndexOf(d));FCKDomTools.RemoveNode(d);if(c){f.setEnd(c.parentNode,FCKDomTools.GetIndexOf(c));FCKDomTools.RemoveNode(c);}var b=this.Window.getSelection();b.removeAllRanges();b.addRange(f);};var FCKDomRangeIterator=function(a){this.Range=a;this.ForceBrBreak=false;this.EnforceRealBlocks=false;};FCKDomRangeIterator.CreateFromSelection=function(a){var b=new FCKDomRange(a);b.MoveToSelection();return new FCKDomRangeIterator(b);};FCKDomRangeIterator.prototype={GetNextParagraph:function(){var d;var c;var b;var a;var q;var p=this.ForceBrBreak?FCKListsLib.ListBoundaries:FCKListsLib.BlockBoundaries;if(!this._LastNode){var c=this.Range.Clone();c.Expand(this.ForceBrBreak?"list_contents":"block_contents");this._NextNode=c.GetTouchedStartNode();this._LastNode=c.GetTouchedEndNode();c=null;}var o=this._NextNode;var n=this._LastNode;this._NextNode=null;while(o){var m=false;var l=(o.nodeType!=1);var k=false;if(!l){var j=o.nodeName.toLowerCase();if(p[j]&&(!FCKBrowserInfo.IsIE||o.scopeName=="HTML")){if(j=="br"){l=true;}else{if(!c&&o.childNodes.length==0&&j!="hr"){d=o;b=o==n;break;}}if(c){c.SetEnd(o,3,true);if(j!="br"){this._NextNode=FCKDomTools.GetNextSourceNode(o,true,null,n)||o;}}m=true;}else{if(o.firstChild){if(!c){c=new FCKDomRange(this.Range.Window);c.SetStart(o,3,true);}o=o.firstChild;continue;}l=true;}}else{if(o.nodeType==3){if(/^[\r\n\t ]+$/.test(o.nodeValue)){l=false;}}}if(l&&!c){c=new FCKDomRange(this.Range.Window);c.SetStart(o,3,true);}b=((!m||l)&&o==n);if(c&&!m){while(!o.nextSibling&&!b){var i=o.parentNode;if(p[i.nodeName.toLowerCase()]){m=true;b=b||(i==n);break;}o=i;l=true;b=(o==n);k=true;}}if(l){c.SetEnd(o,4,true);}if((m||b)&&c){c._UpdateElementInfo();if(c.StartNode==c.EndNode&&c.StartNode.parentNode==c.StartBlockLimit&&c.StartNode.getAttribute&&c.StartNode.getAttribute("_fck_bookmark")){c=null;}else{break;}}if(b){break;}o=FCKDomTools.GetNextSourceNode(o,k,null,n);}if(!d){if(!c){this._NextNode=null;return null;}d=c.StartBlock;if(!d&&!this.EnforceRealBlocks&&c.StartBlockLimit.nodeName.IEquals("DIV","TH","TD")&&c.CheckStartOfBlock()&&c.CheckEndOfBlock()){d=c.StartBlockLimit;}else{if(!d||(this.EnforceRealBlocks&&d.nodeName.toLowerCase()=="li")){d=this.Range.Window.document.createElement(FCKConfig.EnterMode=="p"?"p":"div");c.ExtractContents().AppendTo(d);FCKDomTools.TrimNode(d);c.InsertNode(d);a=true;q=true;}else{if(d.nodeName.toLowerCase()!="li"){if(!c.CheckStartOfBlock()||!c.CheckEndOfBlock()){d=d.cloneNode(false);c.ExtractContents().AppendTo(d);FCKDomTools.TrimNode(d);var h=c.SplitBlock();a=!h.WasStartOfBlock;q=!h.WasEndOfBlock;c.InsertNode(d);}}else{if(!b){this._NextNode=d==n?null:FCKDomTools.GetNextSourceNode(c.EndNode,true,null,n);return d;}}}}}if(a){var g=d.previousSibling;if(g&&g.nodeType==1){if(g.nodeName.toLowerCase()=="br"){g.parentNode.removeChild(g);}else{if(g.lastChild&&g.lastChild.nodeName.IEquals("br")){g.removeChild(g.lastChild);}}}}if(q){var f=d.lastChild;if(f&&f.nodeType==1&&f.nodeName.toLowerCase()=="br"){d.removeChild(f);}}if(!this._NextNode){this._NextNode=(b||d==n)?null:FCKDomTools.GetNextSourceNode(d,true,null,n);}return d;}};var FCKDocumentFragment=function(a,b){this.RootNode=b||a.createDocumentFragment();};FCKDocumentFragment.prototype={AppendTo:function(a){a.appendChild(this.RootNode);},AppendHtml:function(a){var b=this.RootNode.ownerDocument.createElement("div");b.innerHTML=a;FCKDomTools.MoveChildren(b,this.RootNode);},InsertAfterNode:function(a){FCKDomTools.InsertAfterNode(a,this.RootNode);}};var FCKW3CRange=function(a){this._Document=a;this.startContainer=null;this.startOffset=null;this.endContainer=null;this.endOffset=null;this.collapsed=true;};FCKW3CRange.CreateRange=function(a){return new FCKW3CRange(a);};FCKW3CRange.CreateFromRange=function(a,c){var b=FCKW3CRange.CreateRange(a);b.setStart(c.startContainer,c.startOffset);b.setEnd(c.endContainer,c.endOffset);return b;};FCKW3CRange.prototype={_UpdateCollapsed:function(){this.collapsed=(this.startContainer==this.endContainer&&this.startOffset==this.endOffset);},setStart:function(a,b){this.startContainer=a;this.startOffset=b;if(!this.endContainer){this.endContainer=a;this.endOffset=b;}this._UpdateCollapsed();},setEnd:function(a,b){this.endContainer=a;this.endOffset=b;if(!this.startContainer){this.startContainer=a;this.startOffset=b;}this._UpdateCollapsed();},setStartAfter:function(a){this.setStart(a.parentNode,FCKDomTools.GetIndexOf(a)+1);},setStartBefore:function(a){this.setStart(a.parentNode,FCKDomTools.GetIndexOf(a));},setEndAfter:function(a){this.setEnd(a.parentNode,FCKDomTools.GetIndexOf(a)+1);},setEndBefore:function(a){this.setEnd(a.parentNode,FCKDomTools.GetIndexOf(a));},collapse:function(a){if(a){this.endContainer=this.startContainer;this.endOffset=this.startOffset;}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset;}this.collapsed=true;},selectNodeContents:function(a){this.setStart(a,0);this.setEnd(a,a.nodeType==3?a.data.length:a.childNodes.length);},insertNode:function(a){var c=this.startContainer;var b=this.startOffset;if(c.nodeType==3){c.splitText(b);if(c==this.endContainer){this.setEnd(c.nextSibling,this.endOffset-this.startOffset);}FCKDomTools.InsertAfterNode(c,a);return;}else{c.insertBefore(a,c.childNodes[b]||null);if(c==this.endContainer){this.endOffset++;this.collapsed=false;}}},deleteContents:function(){if(this.collapsed){return;}this._ExecContentsAction(0);},extractContents:function(){var a=new FCKDocumentFragment(this._Document);if(!this.collapsed){this._ExecContentsAction(1,a);}return a;},cloneContents:function(){var a=new FCKDocumentFragment(this._Document);if(!this.collapsed){this._ExecContentsAction(2,a);}return a;},_ExecContentsAction:function(x,v){var u=this.startContainer;var t=this.endContainer;var q=this.startOffset;var o=this.endOffset;var n=false;var m=false;if(t.nodeType==3){t=t.splitText(o);}else{if(t.childNodes.length>0){if(o>t.childNodes.length-1){t=FCKDomTools.InsertAfterNode(t.lastChild,this._Document.createTextNode(""));m=true;}else{t=t.childNodes[o];}}}if(u.nodeType==3){u.splitText(q);if(u==t){t=u.nextSibling;}}else{if(q==0){u=u.insertBefore(this._Document.createTextNode(""),u.firstChild);n=true;}else{if(q>u.childNodes.length-1){u=u.appendChild(this._Document.createTextNode(""));n=true;}else{u=u.childNodes[q].previousSibling;}}}var l=FCKDomTools.GetParents(u);var h=FCKDomTools.GetParents(t);var O,Q,P;for(O=0;O<l.length;O++){Q=l[O];P=h[O];if(Q!=P){break;}}var g,r,p,a,d;if(v){g=v.RootNode;}for(var z=O;z<l.length;z++){r=l[z];if(g&&r!=u){p=g.appendChild(r.cloneNode(r==u));}a=r.nextSibling;while(a){if(a==h[z]||a==t){break;}d=a.nextSibling;if(x==2){g.appendChild(a.cloneNode(true));}else{a.parentNode.removeChild(a);if(x==1){g.appendChild(a);}}a=d;}if(g){g=p;}}if(v){g=v.RootNode;}for(var y=O;y<h.length;y++){r=h[y];if(x>0&&r!=t){p=g.appendChild(r.cloneNode(r==t));}if(!l[y]||r.parentNode!=l[y].parentNode){a=r.previousSibling;while(a){if(a==l[y]||a==u){break;}d=a.previousSibling;if(x==2){g.insertBefore(a.cloneNode(true),g.firstChild);}else{a.parentNode.removeChild(a);if(x==1){g.insertBefore(a,g.firstChild);}}a=d;}}if(g){g=p;}}if(x==2){var f=this.startContainer;if(f.nodeType==3){f.data+=f.nextSibling.data;f.parentNode.removeChild(f.nextSibling);}var c=this.endContainer;if(c.nodeType==3&&c.nextSibling){c.data+=c.nextSibling.data;c.parentNode.removeChild(c.nextSibling);}}else{if(Q&&P&&(u.parentNode!=Q.parentNode||t.parentNode!=P.parentNode)){var b=FCKDomTools.GetIndexOf(P);if(n&&P.parentNode==u.parentNode){b--;}this.setStart(P.parentNode,b);}this.collapse(true);}if(n){u.parentNode.removeChild(u);}if(m&&t.parentNode){t.parentNode.removeChild(t);}},cloneRange:function(){return FCKW3CRange.CreateFromRange(this._Document,this);}};var FCKEnterKey=function(a,f,d,c){this.Window=a;this.EnterMode=f||"p";this.ShiftEnterMode=d||"br";var b=new FCKKeystrokeHandler(false);b._EnterKey=this;b.OnKeystroke=FCKEnterKey_OnKeystroke;b.SetKeystrokes([[13,"Enter"],[SHIFT+13,"ShiftEnter"],[8,"Backspace"],[CTRL+8,"CtrlBackspace"],[46,"Delete"]]);this.TabText="";if(c>0||FCKBrowserInfo.IsSafari){while(c--){this.TabText+="\xa0";}b.SetKeystrokes([9,"Tab"]);}b.AttachToElement(a.document);};function FCKEnterKey_OnKeystroke(a,d){var c=this._EnterKey;try{switch(d){case"Enter":return c.DoEnter();break;case"ShiftEnter":return c.DoShiftEnter();break;case"Backspace":return c.DoBackspace();break;case"Delete":return c.DoDelete();break;case"Tab":return c.DoTab();break;case"CtrlBackspace":return c.DoCtrlBackspace();break;}}catch(b){}return false;}FCKEnterKey.prototype.DoEnter=function(a,f){FCKUndo.SaveUndoStep();this._HasShift=(f===true);var d=FCKSelection.GetParentElement();var c=new FCKElementPath(d);var b=a||this.EnterMode;if(b=="br"||c.Block&&c.Block.tagName.toLowerCase()=="pre"){return this._ExecuteEnterBr();}else{return this._ExecuteEnterBlock(b);}};FCKEnterKey.prototype.DoShiftEnter=function(){return this.DoEnter(this.ShiftEnterMode,true);};FCKEnterKey.prototype.DoBackspace=function(){var d=false;var c=new FCKDomRange(this.Window);c.MoveToSelection();if(FCKBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(c,this.Window.document.body)){this._FixIESelectAllBug(c);return true;}var b=c.CheckIsCollapsed();if(!b){if(FCKBrowserInfo.IsIE&&this.Window.document.selection.type.toLowerCase()=="control"){var a=this.Window.document.selection.createRange();for(var f=a.length-1;f>=0;f--){var o=a.item(f);o.parentNode.removeChild(o);}return true;}return false;}if(FCKBrowserInfo.IsIE){var n=FCKDomTools.GetPreviousSourceElement(c.StartNode,true);if(n&&n.nodeName.toLowerCase()=="br"){var m=c.Clone();m.SetStart(n,4);if(m.CheckIsEmpty()){n.parentNode.removeChild(n);return true;}}}var l=c.StartBlock;var k=c.EndBlock;if(c.StartBlockLimit==c.EndBlockLimit&&l&&k){if(!b){var j=c.CheckEndOfBlock();c.DeleteContents();if(l!=k){c.SetStart(k,1);c.SetEnd(k,1);}c.Select();d=(l==k);}if(c.CheckStartOfBlock()){var h=c.StartBlock;var g=FCKDomTools.GetPreviousSourceElement(h,true,["BODY",c.StartBlockLimit.nodeName],["UL","OL"]);d=this._ExecuteBackspace(c,g,h);}else{if(FCKBrowserInfo.IsGeckoLike){c.Select();}}}c.Release();return d;};FCKEnterKey.prototype.DoCtrlBackspace=function(){FCKUndo.SaveUndoStep();var a=new FCKDomRange(this.Window);a.MoveToSelection();if(FCKBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(a,this.Window.document.body)){this._FixIESelectAllBug(a);return true;}return false;};FCKEnterKey.prototype._ExecuteBackspace=function(d,c,b){var a=false;if(!c&&b&&b.nodeName.IEquals("LI")&&b.parentNode.parentNode.nodeName.IEquals("LI")){this._OutdentWithSelection(b,d);return true;}if(c&&c.nodeName.IEquals("LI")){var j=FCKDomTools.GetLastChild(c,["UL","OL"]);while(j){c=FCKDomTools.GetLastChild(j,"LI");j=FCKDomTools.GetLastChild(c,["UL","OL"]);}}if(c&&b){if(b.nodeName.IEquals("LI")&&!c.nodeName.IEquals("LI")){this._OutdentWithSelection(b,d);return true;}var i=b.parentNode;var h=c.nodeName.toLowerCase();if(FCKListsLib.EmptyElements[h]!=null||h=="table"){FCKDomTools.RemoveNode(c);a=true;}else{FCKDomTools.RemoveNode(b);while(i.innerHTML.Trim().length==0){var g=i.parentNode;g.removeChild(i);i=g;}FCKDomTools.LTrimNode(b);FCKDomTools.RTrimNode(c);d.SetStart(c,2,true);d.Collapse(true);var f=d.CreateBookmark(true);if(!b.tagName.IEquals(["TABLE"])){FCKDomTools.MoveChildren(b,c);}d.SelectBookmark(f);a=true;}}return a;};FCKEnterKey.prototype.DoDelete=function(){FCKUndo.SaveUndoStep();var a=false;var g=new FCKDomRange(this.Window);g.MoveToSelection();if(FCKBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(g,this.Window.document.body)){this._FixIESelectAllBug(g);return true;}if(g.CheckIsCollapsed()&&g.CheckEndOfBlock(FCKBrowserInfo.IsGeckoLike)){var f=g.StartBlock;var d=FCKTools.GetElementAscensor(f,"td");var c=FCKDomTools.GetNextSourceElement(f,true,[g.StartBlockLimit.nodeName],["UL","OL","TR"],true);if(d){var b=FCKTools.GetElementAscensor(c,"td");if(b!=d){return true;}}a=this._ExecuteBackspace(g,f,c);}g.Release();return a;};FCKEnterKey.prototype.DoTab=function(){var a=new FCKDomRange(this.Window);a.MoveToSelection();var c=a._Range.startContainer;while(c){if(c.nodeType==1){var b=c.tagName.toLowerCase();if(b=="tr"||b=="td"||b=="th"||b=="tbody"||b=="table"){return false;}else{break;}}c=c.parentNode;}if(this.TabText){a.DeleteContents();a.InsertNode(this.Window.document.createTextNode(this.TabText));a.Collapse(false);a.Select();}return true;};FCKEnterKey.prototype._ExecuteEnterBlock=function(d,c){var b=c||new FCKDomRange(this.Window);var a=b.SplitBlock(d);if(a){var q=a.PreviousBlock;var p=a.NextBlock;var o=a.WasStartOfBlock;var n=a.WasEndOfBlock;if(p){if(p.parentNode.nodeName.IEquals("li")){FCKDomTools.BreakParent(p,p.parentNode);FCKDomTools.MoveNode(p,p.nextSibling,true);}}else{if(q&&q.parentNode.nodeName.IEquals("li")){FCKDomTools.BreakParent(q,q.parentNode);b.MoveToElementEditStart(q.nextSibling);FCKDomTools.MoveNode(q,q.previousSibling);}}if(!o&&!n){if(p.nodeName.IEquals("li")&&p.firstChild&&p.firstChild.nodeName.IEquals(["ul","ol"])){p.insertBefore(FCKTools.GetElementDocument(p).createTextNode("\xa0"),p.firstChild);}if(p){b.MoveToElementEditStart(p);}}else{if(o&&n&&q.tagName.toUpperCase()=="LI"){b.MoveToElementStart(q);this._OutdentWithSelection(q,b);b.Release();return true;}var m;if(q){var l=q.tagName.toUpperCase();if(!this._HasShift&&!(/^H[1-6]$/).test(l)){m=FCKDomTools.CloneElement(q);}}else{if(p){m=FCKDomTools.CloneElement(p);}}if(!m){m=this.Window.document.createElement(d);}var k=a.ElementPath;if(k){for(var f=0,g=k.Elements.length;f<g;f++){var j=k.Elements[f];if(j==k.Block||j==k.BlockLimit){break;}if(FCKListsLib.InlineChildReqElements[j.nodeName.toLowerCase()]){j=FCKDomTools.CloneElement(j);FCKDomTools.MoveChildren(m,j);m.appendChild(j);}}}if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(m);}b.InsertNode(m);if(FCKBrowserInfo.IsIE){b.MoveToElementEditStart(m);b.Select();}b.MoveToElementEditStart(o&&!n?p:m);}if(FCKBrowserInfo.IsGeckoLike){if(p){var h=this.Window.document.createElement("span");h.innerHTML="&nbsp;";b.InsertNode(h);FCKDomTools.ScrollIntoView(h,false);b.DeleteContents();}else{FCKDomTools.ScrollIntoView(p||m,false);}}b.Select();}b.Release();return true;};FCKEnterKey.prototype._ExecuteEnterBr=function(d){var c=new FCKDomRange(this.Window);c.MoveToSelection();if(c.StartBlockLimit==c.EndBlockLimit){c.DeleteContents();c.MoveToSelection();var b=c.CheckStartOfBlock();var a=c.CheckEndOfBlock();var j=c.StartBlock?c.StartBlock.tagName.toUpperCase():"";var i=this._HasShift;var h=false;if(!i&&j=="LI"){return this._ExecuteEnterBlock(null,c);}if(!i&&a&&(/^H[1-6]$/).test(j)){FCKDomTools.InsertAfterNode(c.StartBlock,this.Window.document.createElement("br"));if(FCKBrowserInfo.IsGecko){FCKDomTools.InsertAfterNode(c.StartBlock,this.Window.document.createTextNode(""));}c.SetStart(c.StartBlock.nextSibling,FCKBrowserInfo.IsIE?3:1);}else{var g;h=j.IEquals("pre");if(h){g=this.Window.document.createTextNode(FCKBrowserInfo.IsIE?"\r":"\n");}else{g=this.Window.document.createElement("br");}c.InsertNode(g);if(FCKBrowserInfo.IsGecko){FCKDomTools.InsertAfterNode(g,this.Window.document.createTextNode(""));}if(a&&FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(g.parentNode);}if(FCKBrowserInfo.IsIE){c.SetStart(g,4);}else{c.SetStart(g.nextSibling,1);}if(!FCKBrowserInfo.IsIE){var f=null;if(FCKBrowserInfo.IsOpera){f=this.Window.document.createElement("span");}else{f=this.Window.document.createElement("br");}g.parentNode.insertBefore(f,g.nextSibling);FCKDomTools.ScrollIntoView(f,false);f.parentNode.removeChild(f);}}c.Collapse(true);c.Select(h);}c.Release();return true;};FCKEnterKey.prototype._OutdentWithSelection=function(a,c){var b=c.CreateBookmark();FCKListHandler.OutdentListItem(a);c.MoveToBookmark(b);c.Select();};FCKEnterKey.prototype._CheckIsAllContentsIncluded=function(a,f){var d=false;var c=false;if(a.StartContainer==f||a.StartContainer==f.firstChild){d=(a._Range.startOffset==0);}if(a.EndContainer==f||a.EndContainer==f.lastChild){var b=a.EndContainer.nodeType==3?a.EndContainer.length:a.EndContainer.childNodes.length;c=(a._Range.endOffset==b);}return d&&c;};FCKEnterKey.prototype._FixIESelectAllBug=function(a){var c=this.Window.document;c.body.innerHTML="";var b;if(FCKConfig.EnterMode.IEquals(["div","p"])){b=c.createElement(FCKConfig.EnterMode);c.body.appendChild(b);}else{b=c.body;}a.MoveToNodeContents(b);a.Collapse(true);a.Select();a.Release();};var FCKDocumentProcessor={};FCKDocumentProcessor._Items=[];FCKDocumentProcessor.AppendNew=function(){var a={};this._Items.push(a);return a;};FCKDocumentProcessor.Process=function(a){var d=FCK.IsDirty();var c,b=0;while((c=this._Items[b++])){c.ProcessDocument(a);}if(!d){FCK.ResetIsDirty();}};var FCKDocumentProcessor_CreateFakeImage=function(a,c){var b=FCKTools.GetElementDocument(c).createElement("IMG");b.className=a;b.src=FCKConfig.BasePath+"images/spacer.gif";b.setAttribute("_fckfakelement","true",0);b.setAttribute("_fckrealelement",FCKTempBin.AddElement(c),0);return b;};if(FCKBrowserInfo.IsIE||FCKBrowserInfo.IsOpera){var FCKAnchorsProcessor=FCKDocumentProcessor.AppendNew();FCKAnchorsProcessor.ProcessDocument=function(a){var f=a.getElementsByTagName("A");var d;var b=f.length-1;while(b>=0&&(d=f[b--])){if(d.name.length>0){if(d.innerHTML!==""){if(FCKBrowserInfo.IsIE){d.className+=" FCK__AnchorC";}}else{var c=FCKDocumentProcessor_CreateFakeImage("FCK__Anchor",d.cloneNode(true));c.setAttribute("_fckanchor","true",0);d.parentNode.insertBefore(c,d);d.parentNode.removeChild(d);}}}};}var FCKPageBreaksProcessor=FCKDocumentProcessor.AppendNew();FCKPageBreaksProcessor.ProcessDocument=function(a){var f=a.getElementsByTagName("DIV");var d;var b=f.length-1;while(b>=0&&(d=f[b--])){if(d.style.pageBreakAfter=="always"&&d.childNodes.length==1&&d.childNodes[0].style&&d.childNodes[0].style.display=="none"){var c=FCKDocumentProcessor_CreateFakeImage("FCK__PageBreak",d.cloneNode(true));d.parentNode.insertBefore(c,d);d.parentNode.removeChild(d);}}};var FCKEmbedAndObjectProcessor=(function(){var a=[];var d=function(g){var k=g.cloneNode(true);var j;var h=j=FCKDocumentProcessor_CreateFakeImage("FCK__UnknownObject",k);FCKEmbedAndObjectProcessor.RefreshView(h,g);for(var f=0;f<a.length;f++){j=a[f](g,j)||j;}if(j!=h){FCKTempBin.RemoveElement(h.getAttribute("_fckrealelement"));}g.parentNode.replaceChild(j,g);};var c=function(f,j){var h=j.getElementsByTagName(f);for(var g=h.length-1;g>=0;g--){d(h[g]);}};var b=function(f){c("object",f);c("embed",f);};return FCKTools.Merge(FCKDocumentProcessor.AppendNew(),{ProcessDocument:function(f){if(FCKBrowserInfo.IsGecko){FCKTools.RunFunction(b,this,[f]);}else{b(f);}},RefreshView:function(g,f){if(f.getAttribute("width")>0){g.style.width=FCKTools.ConvertHtmlSizeToStyle(f.getAttribute("width"));}if(f.getAttribute("height")>0){g.style.height=FCKTools.ConvertHtmlSizeToStyle(f.getAttribute("height"));}},AddCustomHandler:function(f){a.push(f);}});})();FCK.GetRealElement=function(a){var b=FCKTempBin.Elements[a.getAttribute("_fckrealelement")];if(a.getAttribute("_fckflash")){if(a.style.width.length>0){b.width=FCKTools.ConvertStyleSizeToHtml(a.style.width);}if(a.style.height.length>0){b.height=FCKTools.ConvertStyleSizeToHtml(a.style.height);}}return b;};if(FCKBrowserInfo.IsIE){FCKDocumentProcessor.AppendNew().ProcessDocument=function(a){var f=a.getElementsByTagName("HR");var d;var b=f.length-1;while(b>=0&&(d=f[b--])){var c=a.createElement("hr");c.mergeAttributes(d,true);FCKDomTools.InsertAfterNode(d,c);d.parentNode.removeChild(d);}};}FCKDocumentProcessor.AppendNew().ProcessDocument=function(a){var f=a.getElementsByTagName("INPUT");var d;var b=f.length-1;while(b>=0&&(d=f[b--])){if(d.type=="hidden"){var c=FCKDocumentProcessor_CreateFakeImage("FCK__InputHidden",d.cloneNode(true));c.setAttribute("_fckinputhidden","true",0);d.parentNode.insertBefore(c,d);d.parentNode.removeChild(d);}}};FCKEmbedAndObjectProcessor.AddCustomHandler(function(a,b){if(!(a.nodeName.IEquals("embed")&&(a.type=="application/x-shockwave-flash"||/\.swf($|#|\?)/i.test(a.src)))){return;}b.className="FCK__Flash";b.setAttribute("_fckflash","true",0);});if(FCKBrowserInfo.IsSafari){FCKDocumentProcessor.AppendNew().ProcessDocument=function(a){var c=a.getElementsByClassName?a.getElementsByClassName("Apple-style-span"):Array.prototype.filter.call(a.getElementsByTagName("span"),function(d){return d.className=="Apple-style-span";});for(var b=c.length-1;b>=0;b--){FCKDomTools.RemoveNode(c[b],true);}};}var FCKSelection=FCK.Selection={GetParentBlock:function(){var a=this.GetParentElement();while(a){if(FCKListsLib.BlockBoundaries[a.nodeName.toLowerCase()]){break;}a=a.parentNode;}return a;},ApplyStyle:function(a){FCKStyles.ApplyStyle(new FCKStyle(a));}};FCKSelection.GetType=function(){var a="Text";var d;try{d=this.GetSelection();}catch(b){}if(d&&d.rangeCount==1){var c=d.getRangeAt(0);if(c.startContainer==c.endContainer&&(c.endOffset-c.startOffset)==1&&c.startContainer.nodeType==1&&FCKListsLib.StyleObjectElements[c.startContainer.childNodes[c.startOffset].nodeName.toLowerCase()]){a="Control";}}return a;};FCKSelection.GetSelectedElement=function(){var a=!!FCK.EditorWindow&&this.GetSelection();if(!a||a.rangeCount<1){return null;}var c=a.getRangeAt(0);if(c.startContainer!=c.endContainer||c.startContainer.nodeType!=1||c.startOffset!=c.endOffset-1){return null;}var b=c.startContainer.childNodes[c.startOffset];if(b.nodeType!=1){return null;}return b;};FCKSelection.GetParentElement=function(){if(this.GetType()=="Control"){return FCKSelection.GetSelectedElement().parentNode;}else{var a=this.GetSelection();if(a){if(a.anchorNode&&a.anchorNode==a.focusNode){var j=a.getRangeAt(0);if(j.collapsed||j.startContainer.nodeType==3){return a.anchorNode.parentNode;}else{return a.anchorNode;}}var h=new FCKElementPath(a.anchorNode);var g=new FCKElementPath(a.focusNode);var f=null;var d=null;if(h.Elements.length>g.Elements.length){f=h.Elements;d=g.Elements;}else{f=g.Elements;d=h.Elements;}var c=f.length-d.length;for(var b=0;b<d.length;b++){if(f[c+b]==d[b]){return d[b];}}return null;}}return null;};FCKSelection.GetBoundaryParentElement=function(a){if(!FCK.EditorWindow){return null;}if(this.GetType()=="Control"){return FCKSelection.GetSelectedElement().parentNode;}else{var d=this.GetSelection();if(d&&d.rangeCount>0){var c=d.getRangeAt(a?0:(d.rangeCount-1));var b=a?c.startContainer:c.endContainer;return(b.nodeType==1?b:b.parentNode);}}return null;};FCKSelection.SelectNode=function(a){var c=FCK.EditorDocument.createRange();c.selectNode(a);var b=this.GetSelection();b.removeAllRanges();b.addRange(c);};FCKSelection.Collapse=function(a){var b=this.GetSelection();if(a==null||a===true){b.collapseToStart();}else{b.collapseToEnd();}};FCKSelection.HasAncestorNode=function(a){var c=this.GetSelectedElement();if(!c&&FCK.EditorWindow){try{c=this.GetSelection().getRangeAt(0).startContainer;}catch(b){}}while(c){if(c.nodeType==1&&c.nodeName.IEquals(a)){return true;}c=c.parentNode;}return false;};FCKSelection.MoveToAncestorNode=function(a){var c;var b=this.GetSelectedElement();if(!b){b=this.GetSelection().getRangeAt(0).startContainer;}while(b){if(b.nodeName.IEquals(a)){return b;}b=b.parentNode;}return null;};FCKSelection.Delete=function(){var a=this.GetSelection();for(var b=0;b<a.rangeCount;b++){a.getRangeAt(b).deleteContents();}return a;};FCKSelection.GetSelection=function(){return FCK.EditorWindow.getSelection();};FCKSelection.Save=function(){};FCKSelection.Restore=function(){};FCKSelection.Release=function(){};var FCKTableHandler={};FCKTableHandler.InsertRow=function(a){var c=FCKSelection.MoveToAncestorNode("TR");if(!c){return;}var b=c.cloneNode(true);c.parentNode.insertBefore(b,c);FCKTableHandler.ClearRow(a?b:c);};FCKTableHandler.DeleteRows=function(a){if(!a){var g=FCKTableHandler.GetSelectedCells();var f=[];for(var b=0;b<g.length;b++){var d=g[b].parentNode;f[d.rowIndex]=d;}for(var b=f.length;b>=0;b--){if(f[b]){FCKTableHandler.DeleteRows(f[b]);}}return;}var c=FCKTools.GetElementAscensor(a,"TABLE");if(c.rows.length==1){FCKTableHandler.DeleteTable(c);return;}a.parentNode.removeChild(a);};FCKTableHandler.DeleteTable=function(a){if(!a){a=FCKSelection.GetSelectedElement();if(!a||a.tagName!="TABLE"){a=FCKSelection.MoveToAncestorNode("TABLE");}}if(!a){return;}FCKSelection.SelectNode(a);FCKSelection.Collapse();if(a.parentNode.childNodes.length==1){a.parentNode.parentNode.removeChild(a.parentNode);}else{a.parentNode.removeChild(a);}};FCKTableHandler.InsertColumn=function(a){var j=null;var h=this.GetSelectedCells();if(h&&h.length){j=h[a?0:(h.length-1)];}if(!j){return;}var g=FCKTools.GetElementAscensor(j,"TABLE");var f=j.cellIndex;for(var b=0;b<g.rows.length;b++){var d=g.rows[b];if(d.cells.length<(f+1)){continue;}j=d.cells[f].cloneNode(false);if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(j);}var c=d.cells[f];d.insertBefore(j,(a?c:c.nextSibling));}};FCKTableHandler.DeleteColumns=function(a){if(!a){var g=FCKTableHandler.GetSelectedCells();for(var b=g.length;b>=0;b--){if(g[b]){FCKTableHandler.DeleteColumns(g[b]);}}return;}if(!a){return;}var f=FCKTools.GetElementAscensor(a,"TABLE");var d=a.cellIndex;for(var b=f.rows.length-1;b>=0;b--){var c=f.rows[b];if(d==0&&c.cells.length==1){FCKTableHandler.DeleteRows(c);continue;}if(c.cells[d]){c.removeChild(c.cells[d]);}}};FCKTableHandler.InsertCell=function(a,f){var d=null;var c=this.GetSelectedCells();if(c&&c.length){d=c[f?0:(c.length-1)];}if(!d){return null;}var b=FCK.EditorDocument.createElement("TD");if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(b);}if(!f&&d.cellIndex==d.parentNode.cells.length-1){d.parentNode.appendChild(b);}else{d.parentNode.insertBefore(b,f?d:d.nextSibling);}return b;};FCKTableHandler.DeleteCell=function(a){if(a.parentNode.cells.length==1){FCKTableHandler.DeleteRows(a.parentNode);return;}a.parentNode.removeChild(a);};FCKTableHandler.DeleteCells=function(){var a=FCKTableHandler.GetSelectedCells();for(var b=a.length-1;b>=0;b--){FCKTableHandler.DeleteCell(a[b]);}};FCKTableHandler._MarkCells=function(a,c){for(var b=0;b<a.length;b++){a[b][c]=true;}};FCKTableHandler._UnmarkCells=function(a,c){for(var b=0;b<a.length;b++){FCKDomTools.ClearElementJSProperty(a[b],c);}};FCKTableHandler._ReplaceCellsByMarker=function(a,f,d){for(var c=0;c<a.length;c++){for(var b=0;b<a[c].length;b++){if(a[c][b][f]){a[c][b]=d;}}}};FCKTableHandler._GetMarkerGeometry=function(d,c,b,a){var k=0;var j=0;var h=0;var g=0;for(var f=b;d[c][f]&&d[c][f][a];f++){k++;}for(var f=b-1;d[c][f]&&d[c][f][a];f--){k++;h++;}for(var f=c;d[f]&&d[f][b]&&d[f][b][a];f++){j++;}for(var f=c-1;d[f]&&d[f][b]&&d[f][b][a];f--){j++;g++;}return{"width":k,"height":j,"x":h,"y":g};};FCKTableHandler.CheckIsSelectionRectangular=function(){var d=FCKTableHandler.GetSelectedCells();if(d.length<1){return false;}for(var f=0;f<d.length;f++){if(d[f].parentNode.parentNode!=d[0].parentNode.parentNode){return false;}}this._MarkCells(d,"_CellSelected");var c=this._CreateTableMap(d[0]);var b=d[0].parentNode.rowIndex;var a=this._GetCellIndexSpan(c,b,d[0]);var l=this._GetMarkerGeometry(c,b,a,"_CellSelected");var k=a-l.x;var j=b-l.y;if(l.width>=l.height){for(a=k;a<k+l.width;a++){b=j+(a-k)%l.height;if(!c[b]||!c[b][a]){this._UnmarkCells(d,"_CellSelected");return false;}var h=this._GetMarkerGeometry(c,b,a,"_CellSelected");if(h.width!=l.width||h.height!=l.height){this._UnmarkCells(d,"_CellSelected");return false;}}}else{for(b=j;b<j+l.height;b++){a=k+(b-j)%l.width;if(!c[b]||!c[b][a]){this._UnmarkCells(d,"_CellSelected");return false;}var h=this._GetMarkerGeometry(c,b,a,"_CellSelected");if(h.width!=l.width||h.height!=l.height){this._UnmarkCells(d,"_CellSelected");return false;}}}this._UnmarkCells(d,"_CellSelected");return true;};FCKTableHandler.MergeCells=function(){var d=this.GetSelectedCells();if(d.length<2){return;}var c=d[0];var b=this._CreateTableMap(c);var a=c.parentNode.rowIndex;var q=this._GetCellIndexSpan(b,a,c);this._MarkCells(d,"_SelectedCells");var p=this._GetMarkerGeometry(b,a,q,"_SelectedCells");var o=q-p.x;var n=a-p.y;var m=FCKTools.GetElementDocument(c).createDocumentFragment();for(var g=0;g<p.height;g++){var l=0;for(var f=0;f<p.width;f++){var k=b[n+g][o+f];while(k.childNodes.length>0){var h=k.removeChild(k.firstChild);if(h.nodeType!=1||(h.getAttribute("type",2)!="_moz"&&h.getAttribute("_moz_dirty")!=null)){m.appendChild(h);l++;}}}if(l>0){m.appendChild(FCK.EditorDocument.createElement("br"));}}this._ReplaceCellsByMarker(b,"_SelectedCells",c);this._UnmarkCells(d,"_SelectedCells");this._InstallTableMap(b,c.parentNode.parentNode.parentNode);c.appendChild(m);if(FCKBrowserInfo.IsGeckoLike&&(!c.firstChild)){FCKTools.AppendBogusBr(c);}this._MoveCaretToCell(c,false);};FCKTableHandler.MergeRight=function(){var a=this.GetMergeRightTarget();if(a==null){return;}var f=a.refCell;var d=a.tableMap;var c=a.nextCell;var b=FCK.EditorDocument.createDocumentFragment();while(c&&c.childNodes&&c.childNodes.length>0){b.appendChild(c.removeChild(c.firstChild));}c.parentNode.removeChild(c);f.appendChild(b);this._MarkCells([c],"_Replace");this._ReplaceCellsByMarker(d,"_Replace",f);this._InstallTableMap(d,f.parentNode.parentNode.parentNode);this._MoveCaretToCell(f,false);};FCKTableHandler.MergeDown=function(){var a=this.GetMergeDownTarget();if(a==null){return;}var f=a.refCell;var d=a.tableMap;var c=a.nextCell;var b=FCKTools.GetElementDocument(f).createDocumentFragment();while(c&&c.childNodes&&c.childNodes.length>0){b.appendChild(c.removeChild(c.firstChild));}if(b.firstChild){b.insertBefore(FCK.EditorDocument.createElement("br"),b.firstChild);}f.appendChild(b);this._MarkCells([c],"_Replace");this._ReplaceCellsByMarker(d,"_Replace",f);this._InstallTableMap(d,f.parentNode.parentNode.parentNode);this._MoveCaretToCell(f,false);};FCKTableHandler.HorizontalSplitCell=function(){var f=FCKTableHandler.GetSelectedCells();if(f.length!=1){return;}var d=f[0];var c=this._CreateTableMap(d);var b=d.parentNode.rowIndex;var u=FCKTableHandler._GetCellIndexSpan(c,b,d);var t=isNaN(d.colSpan)?1:d.colSpan;if(t>1){var q=Math.ceil(t/2);var p=FCK.EditorDocument.createElement(d.nodeName);if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(p);}var o=u+q;var n=u+t;var m=isNaN(d.rowSpan)?1:d.rowSpan;for(var a=b;a<b+m;a++){for(var h=o;h<n;h++){c[a][h]=p;}}}else{var l=[];for(var h=0;h<c.length;h++){var k=c[h].slice(0,u);if(c[h].length<=u){l.push(k);continue;}if(c[h][u]==d){k.push(d);k.push(FCK.EditorDocument.createElement(d.nodeName));if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(k[k.length-1]);}}else{k.push(c[h][u]);k.push(c[h][u]);}for(var g=u+1;g<c[h].length;g++){k.push(c[h][g]);}l.push(k);}c=l;}this._InstallTableMap(c,d.parentNode.parentNode.parentNode);};FCKTableHandler.VerticalSplitCell=function(){var d=FCKTableHandler.GetSelectedCells();if(d.length!=1){return;}var c=d[0];var b=this._CreateTableMap(c);var a=c.parentNode.rowIndex;var t=FCKTableHandler._GetCellIndexSpan(b,a,c);var r=isNaN(c.colSpan)?1:c.colSpan;var q=c.rowSpan;if(isNaN(q)){q=1;}if(q>1){c.rowSpan=Math.ceil(q/2);var p=a+Math.ceil(q/2);var o=b[p];var n=null;for(var f=t+1;f<o.length;f++){if(o[f].parentNode.rowIndex==p){n=o[f];break;}}var m=FCK.EditorDocument.createElement(c.nodeName);m.rowSpan=Math.floor(q/2);if(r>1){m.colSpan=r;}if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(m);}c.parentNode.parentNode.parentNode.rows[p].insertBefore(m,n);}else{var l=c.parentNode.sectionRowIndex+1;var k=FCK.EditorDocument.createElement("tr");var j=c.parentNode.parentNode;if(j.rows.length>l){j.insertBefore(k,j.rows[l]);}else{j.appendChild(k);}for(var f=0;f<b[a].length;){var h=b[a][f].colSpan;if(isNaN(h)||h<1){h=1;}if(f==t){f+=h;continue;}var g=b[a][f].rowSpan;if(isNaN(g)){g=1;}b[a][f].rowSpan=g+1;f+=h;}var m=FCK.EditorDocument.createElement(c.nodeName);if(r>1){m.colSpan=r;}if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(m);}k.appendChild(m);}};FCKTableHandler._GetCellIndexSpan=function(a,g,d){if(a.length<g+1){return null;}var b=a[g];for(var f=0;f<b.length;f++){if(b[f]==d){return f;}}return null;};FCKTableHandler._GetCellLocation=function(a,f){for(var b=0;b<a.length;b++){for(var d=0;d<a[b].length;d++){if(a[b][d]==f){return[b,d];}}}return null;};FCKTableHandler._CreateTableMap=function(g){var f=(g.nodeName=="TABLE"?g:g.parentNode.parentNode.parentNode);var d=f.rows;var b=-1;var a=[];for(var k=0;k<d.length;k++){b++;if(!a[b]){a[b]=[];}var l=-1;for(var h=0;h<d[k].cells.length;h++){var q=d[k].cells[h];l++;while(a[b][l]){l++;}var p=isNaN(q.colSpan)?1:q.colSpan;var o=isNaN(q.rowSpan)?1:q.rowSpan;for(var n=0;n<o;n++){if(!a[b+n]){a[b+n]=[];}for(var m=0;m<p;m++){a[b+n][l+m]=d[k].cells[h];}}l+=p-1;}}return a;};FCKTableHandler._InstallTableMap=function(a,k){var h=FCKBrowserInfo.IsIE?"_fckrowspan":"rowSpan";for(var d=0;d<a.length;d++){for(var c=0;c<a[d].length;c++){var g=a[d][c];if(g.parentNode){g.parentNode.removeChild(g);}g.colSpan=g[h]=1;}}var f=0;for(var d=0;d<a.length;d++){for(var c=0;c<a[d].length;c++){var g=a[d][c];if(!g){continue;}if(c>f){f=c;}if(g._colScanned===true){continue;}if(a[d][c-1]==g){g.colSpan++;}if(a[d][c+1]!=g){g._colScanned=true;}}}for(var d=0;d<=f;d++){for(var c=0;c<a.length;c++){if(!a[c]){continue;}var g=a[c][d];if(!g||g._rowScanned===true){continue;}if(a[c-1]&&a[c-1][d]==g){g[h]++;}if(!a[c+1]||a[c+1][d]!=g){g._rowScanned=true;}}}for(var d=0;d<a.length;d++){for(var c=0;c<a[d].length;c++){var g=a[d][c];FCKDomTools.ClearElementJSProperty(g,"_colScanned");FCKDomTools.ClearElementJSProperty(g,"_rowScanned");}}for(var d=0;d<a.length;d++){var b=FCK.EditorDocument.createElement("tr");for(var c=0;c<a[d].length;){var g=a[d][c];if(a[d-1]&&a[d-1][c]==g){c+=g.colSpan;continue;}b.appendChild(g);if(h!="rowSpan"){g.rowSpan=g[h];g.removeAttribute(h);}c+=g.colSpan;if(g.colSpan==1){g.removeAttribute("colspan");}if(g.rowSpan==1){g.removeAttribute("rowspan");}}if(FCKBrowserInfo.IsIE){k.rows[d].replaceNode(b);}else{k.rows[d].innerHTML="";FCKDomTools.MoveChildren(b,k.rows[d]);}}};FCKTableHandler._MoveCaretToCell=function(a,c){var b=new FCKDomRange(FCK.EditorWindow);b.MoveToNodeContents(a);b.Collapse(c);b.Select();};FCKTableHandler.ClearRow=function(a){var c=a.cells;for(var b=0;b<c.length;b++){c[b].innerHTML="";if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(c[b]);}}};FCKTableHandler.GetMergeRightTarget=function(){var d=this.GetSelectedCells();if(d.length!=1){return null;}var c=d[0];var b=this._CreateTableMap(c);var a=c.parentNode.rowIndex;var j=this._GetCellIndexSpan(b,a,c);var i=j+(isNaN(c.colSpan)?1:c.colSpan);var h=b[a][i];if(!h){return null;}this._MarkCells([c,h],"_SizeTest");var g=this._GetMarkerGeometry(b,a,j,"_SizeTest");var f=this._GetMarkerGeometry(b,a,i,"_SizeTest");this._UnmarkCells([c,h],"_SizeTest");if(g.height!=f.height||g.y!=f.y){return null;}return{"refCell":c,"nextCell":h,"tableMap":b};};FCKTableHandler.GetMergeDownTarget=function(){var d=this.GetSelectedCells();if(d.length!=1){return null;}var c=d[0];var b=this._CreateTableMap(c);var a=c.parentNode.rowIndex;var j=this._GetCellIndexSpan(b,a,c);var i=a+(isNaN(c.rowSpan)?1:c.rowSpan);if(!b[i]){return null;}var h=b[i][j];if(!h){return null;}if(c.parentNode.parentNode!=h.parentNode.parentNode){return null;}this._MarkCells([c,h],"_SizeTest");var g=this._GetMarkerGeometry(b,a,j,"_SizeTest");var f=this._GetMarkerGeometry(b,i,j,"_SizeTest");this._UnmarkCells([c,h],"_SizeTest");if(g.width!=f.width||g.x!=f.x){return null;}return{"refCell":c,"nextCell":h,"tableMap":b};};FCKTableHandler.GetSelectedCells=function(){var a=[];var g=FCKSelection.GetSelection();if(g.rangeCount==1&&g.anchorNode.nodeType==3){var f=FCKTools.GetElementAscensor(g.anchorNode,"TD,TH");if(f){a[0]=f;}return a;}for(var b=0;b<g.rangeCount;b++){var d=g.getRangeAt(b);var c;if(d.startContainer.tagName.Equals("TD","TH")){c=d.startContainer;}else{c=d.startContainer.childNodes[d.startOffset];}if(c.nodeName.Equals("TD","TH")){a[a.length]=c;}}return a;};var FCKXml=function(){this.Error=false;};FCKXml.GetAttribute=function(a,d,c){var b=a.attributes.getNamedItem(d);return b?b.value:c;};FCKXml.TransformToObject=function(d){if(!d){return null;}var c={};var b=d.attributes;for(var f=0;f<b.length;f++){var a=b[f];c[a.name]=a.value;}var k=d.childNodes;for(f=0;f<k.length;f++){var j=k[f];if(j.nodeType==1){var h="$"+j.nodeName;var g=c[h];if(!g){g=c[h]=[];}g.push(this.TransformToObject(j));}}return c;};FCKXml.prototype={LoadUrl:function(a){this.Error=false;var f;var d=FCKTools.CreateXmlObject("XmlHttp");d.open("GET",a,false);d.send(null);if(d.status==200||d.status==304||(d.status==0&&d.readyState==4)){f=d.responseXML;if(!f){f=(new DOMParser()).parseFromString(d.responseText,"text/xml");}}else{f=null;}if(f){try{var c=f.firstChild;}catch(b){f=(new DOMParser()).parseFromString(d.responseText,"text/xml");}}if(!f||!f.firstChild){this.Error=true;if(window.confirm('Error loading "'+a+'" (HTTP Status: '+d.status+").\r\nDo you want to see the server response dump?")){alert(d.responseText);}}this.DOMDocument=f;},SelectNodes:function(a,f){if(this.Error){return[];}var d=[];var c=this.DOMDocument.evaluate(a,f?f:this.DOMDocument,this.DOMDocument.createNSResolver(this.DOMDocument.documentElement),XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(c){var b=c.iterateNext();while(b){d[d.length]=b;b=c.iterateNext();}}return d;},SelectSingleNode:function(a,c){if(this.Error){return null;}var b=this.DOMDocument.evaluate(a,c?c:this.DOMDocument,this.DOMDocument.createNSResolver(this.DOMDocument.documentElement),9,null);if(b&&b.singleNodeValue){return b.singleNodeValue;}else{return null;}}};var FCKNamedCommand=function(a){this.Name=a;};FCKNamedCommand.prototype.Execute=function(){FCK.ExecuteNamedCommand(this.Name);};FCKNamedCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return -1;}return FCK.GetNamedCommandState(this.Name);};var FCKStyleCommand=function(){};FCKStyleCommand.prototype={Name:"Style",Execute:function(a,b){FCKUndo.SaveUndoStep();if(b.Selected){FCK.Styles.RemoveStyle(b.Style);}else{FCK.Styles.ApplyStyle(b.Style);}FCKUndo.SaveUndoStep();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange");},GetState:function(){if(FCK.EditMode!=0||!FCK.EditorDocument){return -1;}if(FCKSelection.GetType()=="Control"){var a=FCKSelection.GetSelectedElement();if(!a||!FCKStyles.CheckHasObjectStyle(a.nodeName.toLowerCase())){return -1;}}return 0;}};var FCKDialogCommand=function(a,i,h,g,f,d,c,b){this.Name=a;this.Title=i;this.Url=h;this.Width=g;this.Height=f;this.CustomValue=b;this.GetStateFunction=d;this.GetStateParam=c;this.Resizable=false;};FCKDialogCommand.prototype.Execute=function(){FCKDialog.OpenDialog("FCKDialog_"+this.Name,this.Title,this.Url,this.Width,this.Height,this.CustomValue,this.Resizable);};FCKDialogCommand.prototype.GetState=function(){if(this.GetStateFunction){return this.GetStateFunction(this.GetStateParam);}else{return FCK.EditMode==0?0:-1;}};var FCKUndefinedCommand=function(){this.Name="Undefined";};FCKUndefinedCommand.prototype.Execute=function(){alert(FCKLang.NotImplemented);};FCKUndefinedCommand.prototype.GetState=function(){return 0;};var FCKFormatBlockCommand=function(){};FCKFormatBlockCommand.prototype={Name:"FormatBlock",Execute:FCKStyleCommand.prototype.Execute,GetState:function(){return FCK.EditorDocument?0:-1;}};var FCKFontNameCommand=function(){};FCKFontNameCommand.prototype={Name:"FontName",Execute:FCKStyleCommand.prototype.Execute,GetState:FCKFormatBlockCommand.prototype.GetState};var FCKFontSizeCommand=function(){};FCKFontSizeCommand.prototype={Name:"FontSize",Execute:FCKStyleCommand.prototype.Execute,GetState:FCKFormatBlockCommand.prototype.GetState};var FCKPreviewCommand=function(){this.Name="Preview";};FCKPreviewCommand.prototype.Execute=function(){FCK.Preview();};FCKPreviewCommand.prototype.GetState=function(){return 0;};var FCKSaveCommand=function(){this.Name="Save";};FCKSaveCommand.prototype.Execute=function(){var a=FCK.GetParentForm();if(typeof(a.onsubmit)=="function"){var b=a.onsubmit();if(b!=null&&b===false){return;}}if(typeof(a.submit)=="function"){a.submit();}else{a.submit.click();}};FCKSaveCommand.prototype.GetState=function(){return 0;};var FCKNewPageCommand=function(){this.Name="NewPage";};FCKNewPageCommand.prototype.Execute=function(){FCKUndo.SaveUndoStep();FCK.SetData("");FCKUndo.Typing=true;FCK.Focus();};FCKNewPageCommand.prototype.GetState=function(){return 0;};var FCKSourceCommand=function(){this.Name="Source";};FCKSourceCommand.prototype.Execute=function(){if(FCKConfig.SourcePopup){var a=FCKConfig.ScreenWidth*0.65;var b=FCKConfig.ScreenHeight*0.65;FCKDialog.OpenDialog("FCKDialog_Source",FCKLang.Source,"dialog/fck_source.html",a,b,null,true);}else{FCK.SwitchEditMode();}};FCKSourceCommand.prototype.GetState=function(){return(FCK.EditMode==0?0:1);};var FCKUndoCommand=function(){this.Name="Undo";};FCKUndoCommand.prototype.Execute=function(){FCKUndo.Undo();};FCKUndoCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return -1;}return(FCKUndo.CheckUndoState()?0:-1);};var FCKRedoCommand=function(){this.Name="Redo";};FCKRedoCommand.prototype.Execute=function(){FCKUndo.Redo();};FCKRedoCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return -1;}return(FCKUndo.CheckRedoState()?0:-1);};var FCKPageBreakCommand=function(){this.Name="PageBreak";};FCKPageBreakCommand.prototype.Execute=function(){FCKUndo.SaveUndoStep();var b=FCK.EditorDocument.createElement("DIV");b.style.pageBreakAfter="always";b.innerHTML='<span style="DISPLAY:none">&nbsp;</span>';var a=FCKDocumentProcessor_CreateFakeImage("FCK__PageBreak",b);var d=new FCKDomRange(FCK.EditorWindow);d.MoveToSelection();var c=d.SplitBlock();d.InsertNode(a);FCK.Events.FireEvent("OnSelectionChange");};FCKPageBreakCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return -1;}return 0;};var FCKUnlinkCommand=function(){this.Name="Unlink";};FCKUnlinkCommand.prototype.Execute=function(){FCKUndo.SaveUndoStep();if(FCKBrowserInfo.IsGeckoLike){var a=FCK.Selection.MoveToAncestorNode("A");if(a){FCKTools.RemoveOuterTags(a);}return;}FCK.ExecuteNamedCommand(this.Name);};FCKUnlinkCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return -1;}var a=FCK.GetNamedCommandState(this.Name);if(a==0&&FCK.EditMode==0){var c=FCKSelection.MoveToAncestorNode("A");var b=(c&&c.name.length>0&&c.href.length==0);if(b){a=-1;}}return a;};var FCKVisitLinkCommand=function(){this.Name="VisitLink";};FCKVisitLinkCommand.prototype={GetState:function(){if(FCK.EditMode!=0){return -1;}var a=FCK.GetNamedCommandState("Unlink");if(a==0){var b=FCKSelection.MoveToAncestorNode("A");if(!b.href){a=-1;}}return a;},Execute:function(){var a=FCKSelection.MoveToAncestorNode("A");var f=a.getAttribute("_fcksavedurl")||a.getAttribute("href",2);if(!/:\/\//.test(f)){var d=FCKConfig.BaseHref;var c=FCK.GetInstanceObject("parent");if(!d){d=c.document.location.href;d=d.substring(0,d.lastIndexOf("/")+1);}if(/^\//.test(f)){try{d=d.match(/^.*:\/\/+[^\/]+/)[0];}catch(b){d=c.document.location.protocol+"://"+c.parent.document.location.host;}}f=d+f;}if(!window.open(f,"_blank")){alert(FCKLang.VisitLinkBlocked);}}};var FCKSelectAllCommand=function(){this.Name="SelectAll";};FCKSelectAllCommand.prototype.Execute=function(){if(FCK.EditMode==0){FCK.ExecuteNamedCommand("SelectAll");}else{var a=FCK.EditingArea.Textarea;if(FCKBrowserInfo.IsIE){a.createTextRange().execCommand("SelectAll");}else{a.selectionStart=0;a.selectionEnd=a.value.length;}a.focus();}};FCKSelectAllCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return -1;}return 0;};var FCKPasteCommand=function(){this.Name="Paste";};FCKPasteCommand.prototype={Execute:function(){if(FCKBrowserInfo.IsIE){FCK.Paste();}else{FCK.ExecuteNamedCommand("Paste");}},GetState:function(){if(FCK.EditMode!=0){return -1;}return FCK.GetNamedCommandState("Paste");}};var FCKRuleCommand=function(){this.Name="Rule";};FCKRuleCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();FCK.InsertElement("hr");},GetState:function(){if(FCK.EditMode!=0){return -1;}return FCK.GetNamedCommandState("InsertHorizontalRule");}};var FCKCutCopyCommand=function(a){this.Name=a?"Cut":"Copy";};FCKCutCopyCommand.prototype={Execute:function(){var a=false;if(FCKBrowserInfo.IsIE){var d=function(){a=true;};var c="on"+this.Name.toLowerCase();FCK.EditorDocument.body.attachEvent(c,d);FCK.ExecuteNamedCommand(this.Name);FCK.EditorDocument.body.detachEvent(c,d);}else{try{FCK.ExecuteNamedCommand(this.Name);a=true;}catch(b){}}if(!a){alert(FCKLang["PasteError"+this.Name]);}},GetState:function(){return FCK.EditMode!=0?-1:FCK.GetNamedCommandState("Cut");}};var FCKAnchorDeleteCommand=function(){this.Name="AnchorDelete";};FCKAnchorDeleteCommand.prototype={Execute:function(){if(FCK.Selection.GetType()=="Control"){FCK.Selection.Delete();}else{var a=FCK.Selection.GetSelectedElement();if(a){if(a.tagName=="IMG"&&a.getAttribute("_fckanchor")){oAnchor=FCK.GetRealElement(a);}else{a=null;}}if(!a){oAnchor=FCK.Selection.MoveToAncestorNode("A");if(oAnchor){FCK.Selection.SelectNode(oAnchor);}}if(oAnchor.href.length!=0){oAnchor.removeAttribute("name");if(FCKBrowserInfo.IsIE){oAnchor.className=oAnchor.className.replace(FCKRegexLib.FCK_Class,"");}return;}if(a){a.parentNode.removeChild(a);return;}if(oAnchor.innerHTML.length==0){oAnchor.parentNode.removeChild(oAnchor);return;}FCKTools.RemoveOuterTags(oAnchor);}if(FCKBrowserInfo.IsGecko){FCK.Selection.Collapse(true);}},GetState:function(){if(FCK.EditMode!=0){return -1;}return FCK.GetNamedCommandState("Unlink");}};var FCKDeleteDivCommand=function(){};FCKDeleteDivCommand.prototype={GetState:function(){if(FCK.EditMode!=0){return -1;}var a=FCKSelection.GetParentElement();var b=new FCKElementPath(a);return b.BlockLimit&&b.BlockLimit.nodeName.IEquals("div")?0:-1;},Execute:function(){FCKUndo.SaveUndoStep();var a=FCKDomTools.GetSelectedDivContainers();var d=new FCKDomRange(FCK.EditorWindow);d.MoveToSelection();var c=d.CreateBookmark();for(var b=0;b<a.length;b++){FCKDomTools.RemoveNode(a[b],true);}d.MoveToBookmark(c);d.Select();}};var FCKNbsp=function(){this.Name="Non Breaking Space";};FCKNbsp.prototype={Execute:function(){FCK.InsertHtml("&nbsp;");},GetState:function(){return(FCK.EditMode!=0?-1:0);}};var FCKShowBlockCommand=function(a,b){this.Name=a;if(b!=undefined){this._SavedState=b;}else{this._SavedState=null;}};FCKShowBlockCommand.prototype.Execute=function(){var a=this.GetState();if(a==-1){return;}var d=FCK.EditorDocument.body;if(a==1){d.className=d.className.replace(/(^| )FCK__ShowBlocks/g,"");}else{d.className+=" FCK__ShowBlocks";}if(FCKBrowserInfo.IsIE){try{FCK.EditorDocument.selection.createRange().select();}catch(b){}}else{var c=FCK.EditorWindow.getSelection().focusNode;if(c){if(c.nodeType!=1){c=c.parentNode;}FCKDomTools.ScrollIntoView(c,false);}}FCK.Events.FireEvent("OnSelectionChange");};FCKShowBlockCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return -1;}if(!FCK.EditorDocument){return 0;}if(/FCK__ShowBlocks(?:\s|$)/.test(FCK.EditorDocument.body.className)){return 1;}return 0;};FCKShowBlockCommand.prototype.SaveState=function(){this._SavedState=this.GetState();};FCKShowBlockCommand.prototype.RestoreState=function(){if(this._SavedState!=null&&this.GetState()!=this._SavedState){this.Execute();}};var FCKSpellCheckCommand=function(){this.Name="SpellCheck";this.IsEnabled=(FCKConfig.SpellChecker!="ieSpell");};FCKSpellCheckCommand.prototype.Execute=function(){switch(FCKConfig.SpellChecker){case"SpellerPages":FCKDialog.OpenDialog("FCKDialog_SpellCheck","Spell Check","dialog/fck_spellerpages.html",440,480);break;case"WSC":FCKDialog.OpenDialog("FCKDialog_SpellCheck","Spell Check","wsc/w.html",530,480);}};FCKSpellCheckCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return -1;}return this.IsEnabled?0:-1;};var FCKTextColorCommand=function(a){this.Name=a=="ForeColor"?"TextColor":"BGColor";this.Type=a;var b;if(FCKBrowserInfo.IsIE){b=window;}else{if(FCK.ToolbarSet._IFrame){b=FCKTools.GetElementWindow(FCK.ToolbarSet._IFrame);}else{b=window.parent;}}this._Panel=new FCKPanel(b);this._Panel.AppendStyleSheet(FCKConfig.SkinEditorCSS);this._Panel.MainNode.className="FCK_Panel";this._CreatePanelBody(this._Panel.Document,this._Panel.MainNode);FCK.ToolbarSet.ToolbarItems.GetItem(this.Name).RegisterPanel(this._Panel);FCKTools.DisableSelection(this._Panel.Document.body);};FCKTextColorCommand.prototype.Execute=function(a,c,b){this._Panel.Show(a,c,b);};FCKTextColorCommand.prototype.SetColor=function(a){FCKUndo.SaveUndoStep();var b=FCKStyles.GetStyle("_FCK_"+(this.Type=="ForeColor"?"Color":"BackColor"));if(!a||a.length==0){FCK.Styles.RemoveStyle(b);}else{b.SetVariable("Color",a);FCKStyles.ApplyStyle(b);}FCKUndo.SaveUndoStep();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange");};FCKTextColorCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return -1;}return 0;};function FCKTextColorCommand_OnMouseOver(){this.className="ColorSelected";}function FCKTextColorCommand_OnMouseOut(){this.className="ColorDeselected";}function FCKTextColorCommand_OnClick(a,c,b){this.className="ColorDeselected";c.SetColor(b);c._Panel.Hide();}function FCKTextColorCommand_AutoOnClick(a,b){this.className="ColorDeselected";b.SetColor("");b._Panel.Hide();}function FCKTextColorCommand_MoreOnClick(a,b){this.className="ColorDeselected";b._Panel.Hide();FCKDialog.OpenDialog("FCKDialog_Color",FCKLang.DlgColorTitle,"dialog/fck_colorselector.html",410,320,FCKTools.Bind(b,b.SetColor));}FCKTextColorCommand.prototype._CreatePanelBody=function(d,c){function f(){var i=d.createElement("DIV");i.className="ColorDeselected";FCKTools.AddEventListenerEx(i,"mouseover",FCKTextColorCommand_OnMouseOver);FCKTools.AddEventListenerEx(i,"mouseout",FCKTextColorCommand_OnMouseOut);return i;}var a=c.appendChild(d.createElement("TABLE"));a.className="ForceBaseFont";a.style.tableLayout="fixed";a.cellPadding=0;a.cellSpacing=0;a.border=0;a.width=150;var o=a.insertRow(-1).insertCell(-1);o.colSpan=8;var b=o.appendChild(f());b.innerHTML='<table cellspacing="0" cellpadding="0" width="100%" border="0">\n			<tr>\n				<td><div class="ColorBoxBorder"><div class="ColorBox" style="background-color: #000000"></div></div></td>\n				<td nowrap width="100%" align="center">'+FCKLang.ColorAutomatic+"</td>\n			</tr>\n		</table>";FCKTools.AddEventListenerEx(b,"click",FCKTextColorCommand_AutoOnClick,this);if(!FCKBrowserInfo.IsIE){b.style.width="96%";}var n=FCKConfig.FontColors.toString().split(",");var m=0;while(m<n.length){var l=a.insertRow(-1);for(var g=0;g<8;g++,m++){if(m<n.length){var k=n[m].split("/");var j="#"+k[0];var h=k[1]||j;}b=l.insertCell(-1).appendChild(f());b.innerHTML='<div class="ColorBoxBorder"><div class="ColorBox" style="background-color: '+j+'"></div></div>';if(m>=n.length){b.style.visibility="hidden";}else{FCKTools.AddEventListenerEx(b,"click",FCKTextColorCommand_OnClick,[this,h]);}}}if(FCKConfig.EnableMoreFontColors){o=a.insertRow(-1).insertCell(-1);o.colSpan=8;b=o.appendChild(f());b.innerHTML='<table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td nowrap align="center">'+FCKLang.ColorMoreColors+"</td></tr></table>";FCKTools.AddEventListenerEx(b,"click",FCKTextColorCommand_MoreOnClick,this);if(!FCKBrowserInfo.IsIE){b.style.width="96%";}}};var FCKPastePlainTextCommand=function(){this.Name="PasteText";};FCKPastePlainTextCommand.prototype.Execute=function(){FCK.PasteAsPlainText();};FCKPastePlainTextCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return -1;}return FCK.GetNamedCommandState("Paste");};var FCKPasteWordCommand=function(){this.Name="PasteWord";};FCKPasteWordCommand.prototype.Execute=function(){FCK.PasteFromWord();};FCKPasteWordCommand.prototype.GetState=function(){if(FCK.EditMode!=0||FCKConfig.ForcePasteAsPlainText){return -1;}else{return FCK.GetNamedCommandState("Paste");}};var FCKTableCommand=function(a){this.Name=a;};FCKTableCommand.prototype.Execute=function(){FCKUndo.SaveUndoStep();if(!FCKBrowserInfo.IsGecko){switch(this.Name){case"TableMergeRight":return FCKTableHandler.MergeRight();case"TableMergeDown":return FCKTableHandler.MergeDown();}}switch(this.Name){case"TableInsertRowAfter":return FCKTableHandler.InsertRow(false);case"TableInsertRowBefore":return FCKTableHandler.InsertRow(true);case"TableDeleteRows":return FCKTableHandler.DeleteRows();case"TableInsertColumnAfter":return FCKTableHandler.InsertColumn(false);case"TableInsertColumnBefore":return FCKTableHandler.InsertColumn(true);case"TableDeleteColumns":return FCKTableHandler.DeleteColumns();case"TableInsertCellAfter":return FCKTableHandler.InsertCell(null,false);case"TableInsertCellBefore":return FCKTableHandler.InsertCell(null,true);case"TableDeleteCells":return FCKTableHandler.DeleteCells();case"TableMergeCells":return FCKTableHandler.MergeCells();case"TableHorizontalSplitCell":return FCKTableHandler.HorizontalSplitCell();case"TableVerticalSplitCell":return FCKTableHandler.VerticalSplitCell();case"TableDelete":return FCKTableHandler.DeleteTable();default:return alert(FCKLang.UnknownCommand.replace(/%1/g,this.Name));}};FCKTableCommand.prototype.GetState=function(){if(FCK.EditorDocument!=null&&FCKSelection.HasAncestorNode("TABLE")){switch(this.Name){case"TableHorizontalSplitCell":case"TableVerticalSplitCell":if(FCKTableHandler.GetSelectedCells().length==1){return 0;}else{return -1;}case"TableMergeCells":if(FCKTableHandler.CheckIsSelectionRectangular()&&FCKTableHandler.GetSelectedCells().length>1){return 0;}else{return -1;}case"TableMergeRight":return FCKTableHandler.GetMergeRightTarget()?0:-1;case"TableMergeDown":return FCKTableHandler.GetMergeDownTarget()?0:-1;default:return 0;}}else{return -1;}};var FCKFitWindow=function(){this.Name="FitWindow";};FCKFitWindow.prototype.Execute=function(){var d=window.frameElement;var c=d.style;var b=parent;var a=b.document.documentElement;var m=b.document.body;var l=m.style;var k;var j,f;if(FCK.EditMode==0){j=new FCKDomRange(FCK.EditorWindow);j.MoveToSelection();f=FCKTools.GetScrollPosition(FCK.EditorWindow);}else{var i=FCK.EditingArea.Textarea;j=!FCKBrowserInfo.IsIE&&[i.selectionStart,i.selectionEnd];f=[i.scrollLeft,i.scrollTop];}if(!this.IsMaximized){if(FCKBrowserInfo.IsIE){b.attachEvent("onresize",FCKFitWindow_Resize);}else{b.addEventListener("resize",FCKFitWindow_Resize,true);}this._ScrollPos=FCKTools.GetScrollPosition(b);k=d;while((k=k.parentNode)){if(k.nodeType==1){k._fckSavedStyles=FCKTools.SaveStyles(k);k.style.zIndex=FCKConfig.FloatingPanelsZIndex-1;}}if(FCKBrowserInfo.IsIE){this.documentElementOverflow=a.style.overflow;a.style.overflow="hidden";l.overflow="hidden";}else{l.overflow="hidden";l.width="0px";l.height="0px";}this._EditorFrameStyles=FCKTools.SaveStyles(d);var h=FCKTools.GetViewPaneSize(b);c.position="absolute";d.offsetLeft;c.zIndex=FCKConfig.FloatingPanelsZIndex-1;c.left="0px";c.top="0px";c.width=h.Width+"px";c.height=h.Height+"px";if(!FCKBrowserInfo.IsIE){c.borderRight=c.borderBottom="9999px solid white";c.backgroundColor="white";}b.scrollTo(0,0);var g=FCKTools.GetWindowPosition(b,d);if(g.x!=0){c.left=(-1*g.x)+"px";}if(g.y!=0){c.top=(-1*g.y)+"px";}this.IsMaximized=true;}else{if(FCKBrowserInfo.IsIE){b.detachEvent("onresize",FCKFitWindow_Resize);}else{b.removeEventListener("resize",FCKFitWindow_Resize,true);}k=d;while((k=k.parentNode)){if(k._fckSavedStyles){FCKTools.RestoreStyles(k,k._fckSavedStyles);k._fckSavedStyles=null;}}if(FCKBrowserInfo.IsIE){a.style.overflow=this.documentElementOverflow;}FCKTools.RestoreStyles(d,this._EditorFrameStyles);b.scrollTo(this._ScrollPos.X,this._ScrollPos.Y);this.IsMaximized=false;}FCKToolbarItems.GetItem("FitWindow").RefreshState();if(FCK.EditMode==0){FCK.EditingArea.MakeEditable();}FCK.Focus();if(FCK.EditMode==0){j.Select();FCK.EditorWindow.scrollTo(f.X,f.Y);}else{if(!FCKBrowserInfo.IsIE){i.selectionStart=j[0];i.selectionEnd=j[1];}i.scrollLeft=f[0];i.scrollTop=f[1];}};FCKFitWindow.prototype.GetState=function(){if(FCKConfig.ToolbarLocation!="In"){return -1;}else{return(this.IsMaximized?1:0);}};function FCKFitWindow_Resize(){var a=FCKTools.GetViewPaneSize(parent);var b=window.frameElement.style;b.width=a.Width+"px";b.height=a.Height+"px";}var FCKListCommand=function(a,b){this.Name=a;this.TagName=b;};FCKListCommand.prototype={GetState:function(){if(FCK.EditMode!=0||!FCK.EditorWindow){return -1;}var a=FCKSelection.GetBoundaryParentElement(true);var b=a;while(b){if(b.nodeName.IEquals(["ul","ol"])){break;}b=b.parentNode;}if(b&&b.nodeName.IEquals(this.TagName)){return 1;}else{return 0;}},Execute:function(){FCKUndo.SaveUndoStep();var S=FCK.EditorDocument;var z=new FCKDomRange(FCK.EditorWindow);z.MoveToSelection();var y=this.GetState();if(y==0){FCKDomTools.TrimNode(S.body);if(!S.body.firstChild){var x=S.createElement("p");S.body.appendChild(x);z.MoveToNodeContents(x);}}var v=z.CreateBookmark();var u=[];var t={};var r=new FCKDomRangeIterator(z);var q;r.ForceBrBreak=(y==0);var p=true;var o=null;while(p){while((q=r.GetNextParagraph())){var n=new FCKElementPath(q);var m=null;var l=false;var k=n.BlockLimit;for(var V=n.Elements.length-1;V>=0;V--){var j=n.Elements[V];if(j.nodeName.IEquals(["ol","ul"])){if(k._FCK_ListGroupObject){k._FCK_ListGroupObject=null;}var h=j._FCK_ListGroupObject;if(h){h.contents.push(q);}else{h={"root":j,"contents":[q]};u.push(h);FCKDomTools.SetElementMarker(t,j,"_FCK_ListGroupObject",h);}l=true;break;}}if(l){continue;}var g=k;if(g._FCK_ListGroupObject){g._FCK_ListGroupObject.contents.push(q);}else{var h={"root":g,"contents":[q]};FCKDomTools.SetElementMarker(t,g,"_FCK_ListGroupObject",h);u.push(h);}}if(FCKBrowserInfo.IsIE){p=false;}else{if(o==null){o=[];var f=FCKSelection.GetSelection();if(f&&u.length==0){o.push(f.getRangeAt(0));}for(var V=1;f&&V<f.rangeCount;V++){o.push(f.getRangeAt(V));}}if(o.length<1){p=false;}else{var d=FCKW3CRange.CreateFromRange(S,o.shift());z._Range=d;z._UpdateElementInfo();if(z.StartNode.nodeName.IEquals("td")){z.SetStart(z.StartNode,1);}if(z.EndNode.nodeName.IEquals("td")){z.SetEnd(z.EndNode,2);}r=new FCKDomRangeIterator(z);r.ForceBrBreak=(y==0);}}}var c=[];while(u.length>0){var h=u.shift();if(y==0){if(h.root.nodeName.IEquals(["ul","ol"])){this._ChangeListType(h,t,c);}else{this._CreateList(h,c);}}else{if(y==1&&h.root.nodeName.IEquals(["ul","ol"])){this._RemoveList(h,t);}}}for(var V=0;V<c.length;V++){var m=c[V];var b=false;var X=m;while(!b){X=X.nextSibling;if(X&&X.nodeType==3&&X.nodeValue.search(/^[\n\r\t ]*$/)==0){continue;}b=true;}if(X&&X.nodeName.IEquals(this.TagName)){X.parentNode.removeChild(X);while(X.firstChild){m.appendChild(X.removeChild(X.firstChild));}}b=false;X=m;while(!b){X=X.previousSibling;if(X&&X.nodeType==3&&X.nodeValue.search(/^[\n\r\t ]*$/)==0){continue;}b=true;}if(X&&X.nodeName.IEquals(this.TagName)){X.parentNode.removeChild(X);while(X.lastChild){m.insertBefore(X.removeChild(X.lastChild),m.firstChild);}}}FCKDomTools.ClearAllMarkers(t);z.MoveToBookmark(v);z.Select();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange");},_ChangeListType:function(d,c,b){var a=FCKDomTools.ListToArray(d.root,c);var l=[];for(var f=0;f<d.contents.length;f++){var k=d.contents[f];k=FCKTools.GetElementAscensor(k,"li");if(!k||k._FCK_ListItem_Processed){continue;}l.push(k);FCKDomTools.SetElementMarker(c,k,"_FCK_ListItem_Processed",true);}var j=FCKTools.GetElementDocument(d.root).createElement(this.TagName);for(var f=0;f<l.length;f++){var h=l[f]._FCK_ListArray_Index;a[h].parent=j;}var g=FCKDomTools.ArrayToList(a,c);for(var f=0;f<g.listNode.childNodes.length;f++){if(g.listNode.childNodes[f].nodeName.IEquals(this.TagName)){b.push(g.listNode.childNodes[f]);}}d.root.parentNode.replaceChild(g.listNode,d.root);},_CreateList:function(d,c){var b=d.contents;var a=FCKTools.GetElementDocument(d.root);var p=[];if(b.length==1&&b[0]==d.root){var o=a.createElement("div");while(b[0].firstChild){o.appendChild(b[0].removeChild(b[0].firstChild));}b[0].appendChild(o);b[0]=o;}var n=d.contents[0].parentNode;for(var f=0;f<b.length;f++){n=FCKDomTools.GetCommonParents(n,b[f].parentNode).pop();}for(var f=0;f<b.length;f++){var m=b[f];while(m.parentNode){if(m.parentNode==n){p.push(m);break;}m=m.parentNode;}}if(p.length<1){return;}var l=p[p.length-1].nextSibling;var k=a.createElement(this.TagName);c.push(k);while(p.length){var j=p.shift();var h=a.createDocumentFragment();while(j.firstChild){h.appendChild(j.removeChild(j.firstChild));}j.parentNode.removeChild(j);var g=a.createElement("li");g.appendChild(h);k.appendChild(g);}n.insertBefore(k,l);},_RemoveList:function(d,c){var b=FCKDomTools.ListToArray(d.root,c);var a=[];for(var f=0;f<d.contents.length;f++){var m=d.contents[f];m=FCKTools.GetElementAscensor(m,"li");if(!m||m._FCK_ListItem_Processed){continue;}a.push(m);FCKDomTools.SetElementMarker(c,m,"_FCK_ListItem_Processed",true);}var l=null;for(var f=0;f<a.length;f++){var k=a[f]._FCK_ListArray_Index;b[k].indent=-1;l=k;}for(var f=l+1;f<b.length;f++){if(b[f].indent>b[f-1].indent+1){var j=b[f-1].indent+1-b[f].indent;var h=b[f].indent;while(b[f]&&b[f].indent>=h){b[f].indent+=j;f++;}f--;}}var g=FCKDomTools.ArrayToList(b,c);if(d.root.nextSibling==null||d.root.nextSibling.nodeName.IEquals("br")){if(g.listNode.lastChild.nodeName.IEquals("br")){g.listNode.removeChild(g.listNode.lastChild);}}d.root.parentNode.replaceChild(g.listNode,d.root);}};var FCKJustifyCommand=function(a){this.AlignValue=a;var c=FCKConfig.ContentLangDirection.toLowerCase();this.IsDefaultAlign=(a=="left"&&c=="ltr")||(a=="right"&&c=="rtl");var b=this._CssClassName=(function(){var d=FCKConfig.JustifyClasses;if(d){switch(a){case"left":return d[0]||null;case"center":return d[1]||null;case"right":return d[2]||null;case"justify":return d[3]||null;}}return null;})();if(b&&b.length>0){this._CssClassRegex=new RegExp("(?:^|\\s+)"+b+"(?=$|\\s)");}};FCKJustifyCommand._GetClassNameRegex=function(){var a=FCKJustifyCommand._ClassRegex;if(a!=undefined){return a;}var f=[];var d=FCKConfig.JustifyClasses;if(d){for(var b=0;b<4;b++){var c=d[b];if(c&&c.length>0){f.push(c);}}}if(f.length>0){a=new RegExp("(?:^|\\s+)(?:"+f.join("|")+")(?=$|\\s)");}else{a=null;}return FCKJustifyCommand._ClassRegex=a;};FCKJustifyCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var a=new FCKDomRange(FCK.EditorWindow);a.MoveToSelection();var i=this.GetState();if(i==-1){return;}var h=a.CreateBookmark();var g=this._CssClassName;var f=new FCKDomRangeIterator(a);var d;while((d=f.GetNextParagraph())){d.removeAttribute("align");if(g){var c=d.className.replace(FCKJustifyCommand._GetClassNameRegex(),"");if(i==0){if(c.length>0){c+=" ";}d.className=c+g;}else{if(c.length==0){FCKDomTools.RemoveAttribute(d,"class");}}}else{var b=d.style;if(i==0){b.textAlign=this.AlignValue;}else{b.textAlign="";if(b.cssText.length==0){d.removeAttribute("style");}}}}a.MoveToBookmark(h);a.Select();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange");},GetState:function(){if(FCK.EditMode!=0||!FCK.EditorWindow){return -1;}var a=new FCKElementPath(FCKSelection.GetBoundaryParentElement(true));var c=a.Block||a.BlockLimit;if(!c||c.nodeName.toLowerCase()=="body"){return 0;}var b;if(FCKBrowserInfo.IsIE){b=c.currentStyle.textAlign;}else{b=FCK.EditorWindow.getComputedStyle(c,"").getPropertyValue("text-align");}b=b.replace(/(-moz-|-webkit-|start|auto)/i,"");if((!b&&this.IsDefaultAlign)||b==this.AlignValue){return 1;}return 0;}};var FCKIndentCommand=function(a,b){this.Name=a;this.Offset=b;this.IndentCSSProperty=FCKConfig.ContentLangDirection.IEquals("ltr")?"marginLeft":"marginRight";};FCKIndentCommand._InitIndentModeParameters=function(){if(FCKConfig.IndentClasses&&FCKConfig.IndentClasses.length>0){this._UseIndentClasses=true;this._IndentClassMap={};for(var a=0;a<FCKConfig.IndentClasses.length;a++){this._IndentClassMap[FCKConfig.IndentClasses[a]]=a+1;}this._ClassNameRegex=new RegExp("(?:^|\\s+)("+FCKConfig.IndentClasses.join("|")+")(?=$|\\s)");}else{this._UseIndentClasses=false;}};FCKIndentCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var a=new FCKDomRange(FCK.EditorWindow);a.MoveToSelection();var c=a.CreateBookmark();var b=FCKDomTools.GetCommonParentNode(a.StartNode||a.StartContainer,a.EndNode||a.EndContainer,["ul","ol"]);if(b){this._IndentList(a,b);}else{this._IndentBlock(a);}a.MoveToBookmark(c);a.Select();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange");},GetState:function(){if(FCK.EditMode!=0||!FCK.EditorWindow){return -1;}if(FCKIndentCommand._UseIndentClasses==undefined){FCKIndentCommand._InitIndentModeParameters();}var d=FCKSelection.GetBoundaryParentElement(true);var c=FCKSelection.GetBoundaryParentElement(false);var b=FCKDomTools.GetCommonParentNode(d,c,["ul","ol"]);if(b){if(this.Name.IEquals("outdent")){return 0;}var a=FCKTools.GetElementAscensor(d,"li");if(!a||!a.previousSibling){return -1;}return 0;}if(!FCKIndentCommand._UseIndentClasses&&this.Name.IEquals("indent")){return 0;}var j=new FCKElementPath(d);var i=j.Block||j.BlockLimit;if(!i){return -1;}if(FCKIndentCommand._UseIndentClasses){var h=i.className.match(FCKIndentCommand._ClassNameRegex);var g=0;if(h!=null){h=h[1];g=FCKIndentCommand._IndentClassMap[h];}if((this.Name=="outdent"&&g==0)||(this.Name=="indent"&&g==FCKConfig.IndentClasses.length)){return -1;}return 0;}else{var f=parseInt(i.style[this.IndentCSSProperty],10);if(isNaN(f)){f=0;}if(f<=0){return -1;}return 0;}},_IndentBlock:function(d){var c=new FCKDomRangeIterator(d);c.EnforceRealBlocks=true;d.Expand("block_contents");var b=FCKDomTools.GetCommonParents(d.StartContainer,d.EndContainer);var a=b[b.length-1];var j;while((j=c.GetNextParagraph())){if(!(j==a||j.parentNode==a)){continue;}if(FCKIndentCommand._UseIndentClasses){var i=j.className.match(FCKIndentCommand._ClassNameRegex);var h=0;if(i!=null){i=i[1];h=FCKIndentCommand._IndentClassMap[i];}if(this.Name.IEquals("outdent")){h--;}else{if(this.Name.IEquals("indent")){h++;}}h=Math.min(h,FCKConfig.IndentClasses.length);h=Math.max(h,0);var g=j.className.replace(FCKIndentCommand._ClassNameRegex,"");if(h<1){j.className=g;}else{j.className=(g.length>0?g+" ":"")+FCKConfig.IndentClasses[h-1];}}else{var f=parseInt(j.style[this.IndentCSSProperty],10);if(isNaN(f)){f=0;}f+=this.Offset;f=Math.max(f,0);f=Math.ceil(f/this.Offset)*this.Offset;j.style[this.IndentCSSProperty]=f?f+FCKConfig.IndentUnit:"";if(j.getAttribute("style")==""){j.removeAttribute("style");}}}},_IndentList:function(d,c){var b=d.StartContainer;var a=d.EndContainer;while(b&&b.parentNode!=c){b=b.parentNode;}while(a&&a.parentNode!=c){a=a.parentNode;}if(!b||!a){return;}var r=b;var q=[];var p=false;while(p==false){if(r==a){p=true;}q.push(r);r=r.nextSibling;}if(q.length<1){return;}var o=FCKDomTools.GetParents(c);for(var f=0;f<o.length;f++){if(o[f].nodeName.IEquals(["ul","ol"])){c=o[f];break;}}var n=this.Name.IEquals("indent")?1:-1;var m=q[0];var l=q[q.length-1];var k={};var j=FCKDomTools.ListToArray(c,k);var h=j[l._FCK_ListArray_Index].indent;for(var f=m._FCK_ListArray_Index;f<=l._FCK_ListArray_Index;f++){j[f].indent+=n;}for(var f=l._FCK_ListArray_Index+1;f<j.length&&j[f].indent>h;f++){j[f].indent+=n;}var g=FCKDomTools.ArrayToList(j);if(g){c.parentNode.replaceChild(g.listNode,c);}FCKDomTools.ClearAllMarkers(k);}};var FCKBlockQuoteCommand=function(){};FCKBlockQuoteCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var Y=this.GetState();var X=new FCKDomRange(FCK.EditorWindow);X.MoveToSelection();var V=X.CreateBookmark();if(FCKBrowserInfo.IsIE){var z=X.GetBookmarkNode(V,true);var y=X.GetBookmarkNode(V,false);var x;if(z&&z.parentNode.nodeName.IEquals("blockquote")&&!z.previousSibling){x=z;while((x=x.nextSibling)){if(FCKListsLib.BlockElements[x.nodeName.toLowerCase()]){FCKDomTools.MoveNode(z,x,true);}}}if(y&&y.parentNode.nodeName.IEquals("blockquote")&&!y.previousSibling){x=y;while((x=x.nextSibling)){if(FCKListsLib.BlockElements[x.nodeName.toLowerCase()]){if(x.firstChild==z){FCKDomTools.InsertAfterNode(z,y);}else{FCKDomTools.MoveNode(y,x,true);}}}}}var v=new FCKDomRangeIterator(X);var u;if(Y==0){var t=[];while((u=v.GetNextParagraph())){t.push(u);}if(t.length<1){para=X.Window.document.createElement(FCKConfig.EnterMode.IEquals("p")?"p":"div");X.InsertNode(para);para.appendChild(X.Window.document.createTextNode("\ufeff"));X.MoveToBookmark(V);X.MoveToNodeContents(para);X.Collapse(true);V=X.CreateBookmark();t.push(para);}var r=t[0].parentNode;var q=[];for(var Z=0;Z<t.length;Z++){u=t[Z];r=FCKDomTools.GetCommonParents(u.parentNode,r).pop();}while(r.nodeName.IEquals("table","tbody","tr","ol","ul")){r=r.parentNode;}var p=null;while(t.length>0){u=t.shift();while(u.parentNode!=r){u=u.parentNode;}if(u!=p){q.push(u);}p=u;}while(q.length>0){u=q.shift();if(u.nodeName.IEquals("blockquote")){var o=FCKTools.GetElementDocument(u).createDocumentFragment();while(u.firstChild){o.appendChild(u.removeChild(u.firstChild));t.push(o.lastChild);}u.parentNode.replaceChild(o,u);}else{t.push(u);}}var n=X.Window.document.createElement("blockquote");r.insertBefore(n,t[0]);while(t.length>0){u=t.shift();n.appendChild(u);}}else{if(Y==1){var m=[];var l={};while((u=v.GetNextParagraph())){var k=null;var j=null;while(u.parentNode){if(u.parentNode.nodeName.IEquals("blockquote")){k=u.parentNode;j=u;break;}u=u.parentNode;}if(k&&j&&!j._fckblockquotemoveout){m.push(j);FCKDomTools.SetElementMarker(l,j,"_fckblockquotemoveout",true);}}FCKDomTools.ClearAllMarkers(l);var h=[];var g=[],l={};var f=function(c){for(var a=0;a<c.childNodes.length;a++){if(FCKListsLib.BlockElements[c.childNodes[a].nodeName.toLowerCase()]){return false;}}return true;};while(m.length>0){var b=m.shift();var n=b.parentNode;if(b==b.parentNode.firstChild){n.parentNode.insertBefore(n.removeChild(b),n);}else{if(b==b.parentNode.lastChild){n.parentNode.insertBefore(n.removeChild(b),n.nextSibling);}else{FCKDomTools.BreakParent(b,b.parentNode,X);}}if(!n._fckbqprocessed){g.push(n);FCKDomTools.SetElementMarker(l,n,"_fckbqprocessed",true);}h.push(b);}for(var Z=g.length-1;Z>=0;Z--){var n=g[Z];if(f(n)){FCKDomTools.RemoveNode(n);}}FCKDomTools.ClearAllMarkers(l);if(FCKConfig.EnterMode.IEquals("br")){while(h.length){var b=h.shift();var ac=true;if(b.nodeName.IEquals("div")){var o=FCKTools.GetElementDocument(b).createDocumentFragment();var ab=ac&&b.previousSibling&&!FCKListsLib.BlockBoundaries[b.previousSibling.nodeName.toLowerCase()];if(ac&&ab){o.appendChild(FCKTools.GetElementDocument(b).createElement("br"));}var aa=b.nextSibling&&!FCKListsLib.BlockBoundaries[b.nextSibling.nodeName.toLowerCase()];while(b.firstChild){o.appendChild(b.removeChild(b.firstChild));}if(aa){o.appendChild(FCKTools.GetElementDocument(b).createElement("br"));}b.parentNode.replaceChild(o,b);ac=false;}}}}}X.MoveToBookmark(V);X.Select();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange");},GetState:function(){if(FCK.EditMode!=0||!FCK.EditorWindow){return -1;}var a=new FCKElementPath(FCKSelection.GetBoundaryParentElement(true));var c=a.Block||a.BlockLimit;if(!c||c.nodeName.toLowerCase()=="body"){return 0;}for(var b=0;b<a.Elements.length;b++){if(a.Elements[b].nodeName.IEquals("blockquote")){return 1;}}return 0;}};var FCKCoreStyleCommand=function(a){this.Name="CoreStyle";this.StyleName="_FCK_"+a;this.IsActive=false;FCKStyles.AttachStyleStateChange(this.StyleName,this._OnStyleStateChange,this);};FCKCoreStyleCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();if(this.IsActive){FCKStyles.RemoveStyle(this.StyleName);}else{FCKStyles.ApplyStyle(this.StyleName);}FCK.Focus();FCK.Events.FireEvent("OnSelectionChange");},GetState:function(){if(FCK.EditMode!=0){return -1;}return this.IsActive?1:0;},_OnStyleStateChange:function(a,b){this.IsActive=b;}};var FCKRemoveFormatCommand=function(){this.Name="RemoveFormat";};FCKRemoveFormatCommand.prototype={Execute:function(){FCKStyles.RemoveAll();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange");},GetState:function(){return FCK.EditorWindow?0:-1;}};var FCKCommands=FCK.Commands={};FCKCommands.LoadedCommands={};FCKCommands.RegisterCommand=function(a,b){this.LoadedCommands[a]=b;};FCKCommands.GetCommand=function(a){var b=FCKCommands.LoadedCommands[a];if(b){return b;}switch(a){case"Bold":case"Italic":case"Underline":case"StrikeThrough":case"Subscript":case"Superscript":b=new FCKCoreStyleCommand(a);break;case"RemoveFormat":b=new FCKRemoveFormatCommand();break;case"DocProps":b=new FCKDialogCommand("DocProps",FCKLang.DocProps,"dialog/fck_docprops.html",400,380,FCKCommands.GetFullPageState);break;case"Templates":b=new FCKDialogCommand("Templates",FCKLang.DlgTemplatesTitle,"dialog/fck_template.html",380,450);break;case"Link":b=new FCKDialogCommand("Link",FCKLang.DlgLnkWindowTitle,"dialog/fck_link.html",400,300);break;case"Unlink":b=new FCKUnlinkCommand();break;case"VisitLink":b=new FCKVisitLinkCommand();break;case"Anchor":b=new FCKDialogCommand("Anchor",FCKLang.DlgAnchorTitle,"dialog/fck_anchor.html",370,160);break;case"AnchorDelete":b=new FCKAnchorDeleteCommand();break;case"BulletedList":b=new FCKDialogCommand("BulletedList",FCKLang.BulletedListProp,"dialog/fck_listprop.html?UL",370,160);break;case"NumberedList":b=new FCKDialogCommand("NumberedList",FCKLang.NumberedListProp,"dialog/fck_listprop.html?OL",370,160);break;case"About":b=new FCKDialogCommand("About",FCKLang.About,"dialog/fck_about.html",420,330,function(){return 0;});break;case"Find":b=new FCKDialogCommand("Find",FCKLang.DlgFindAndReplaceTitle,"dialog/fck_replace.html",340,230,null,null,"Find");break;case"Replace":b=new FCKDialogCommand("Replace",FCKLang.DlgFindAndReplaceTitle,"dialog/fck_replace.html",340,230,null,null,"Replace");break;case"Image":b=new FCKDialogCommand("Image",FCKLang.DlgImgTitle,"dialog/fck_image.html",450,390);break;case"Flash":b=new FCKDialogCommand("Flash",FCKLang.DlgFlashTitle,"dialog/fck_flash.html",450,390);break;case"SpecialChar":b=new FCKDialogCommand("SpecialChar",FCKLang.DlgSpecialCharTitle,"dialog/fck_specialchar.html",400,290);break;case"Smiley":b=new FCKDialogCommand("Smiley",FCKLang.DlgSmileyTitle,"dialog/fck_smiley.html",FCKConfig.SmileyWindowWidth,FCKConfig.SmileyWindowHeight);break;case"Table":b=new FCKDialogCommand("Table",FCKLang.DlgTableTitle,"dialog/fck_table.html",480,250);break;case"TableProp":b=new FCKDialogCommand("Table",FCKLang.DlgTableTitle,"dialog/fck_table.html?Parent",480,250);break;case"TableCellProp":b=new FCKDialogCommand("TableCell",FCKLang.DlgCellTitle,"dialog/fck_tablecell.html",550,240);break;case"Style":b=new FCKStyleCommand();break;case"FontName":b=new FCKFontNameCommand();break;case"FontSize":b=new FCKFontSizeCommand();break;case"FontFormat":b=new FCKFormatBlockCommand();break;case"Source":b=new FCKSourceCommand();break;case"Preview":b=new FCKPreviewCommand();break;case"Save":b=new FCKSaveCommand();break;case"NewPage":b=new FCKNewPageCommand();break;case"PageBreak":b=new FCKPageBreakCommand();break;case"Rule":b=new FCKRuleCommand();break;case"Nbsp":b=new FCKNbsp();break;case"TextColor":b=new FCKTextColorCommand("ForeColor");break;case"BGColor":b=new FCKTextColorCommand("BackColor");break;case"Paste":b=new FCKPasteCommand();break;case"PasteText":b=new FCKPastePlainTextCommand();break;case"PasteWord":b=new FCKPasteWordCommand();break;case"JustifyLeft":b=new FCKJustifyCommand("left");break;case"JustifyCenter":b=new FCKJustifyCommand("center");break;case"JustifyRight":b=new FCKJustifyCommand("right");break;case"JustifyFull":b=new FCKJustifyCommand("justify");break;case"Indent":b=new FCKIndentCommand("indent",FCKConfig.IndentLength);break;case"Outdent":b=new FCKIndentCommand("outdent",FCKConfig.IndentLength*-1);break;case"Blockquote":b=new FCKBlockQuoteCommand();break;case"CreateDiv":b=new FCKDialogCommand("CreateDiv",FCKLang.CreateDiv,"dialog/fck_div.html",380,210,null,null,true);break;case"EditDiv":b=new FCKDialogCommand("EditDiv",FCKLang.EditDiv,"dialog/fck_div.html",380,210,null,null,false);break;case"DeleteDiv":b=new FCKDeleteDivCommand();break;case"TableInsertRowAfter":b=new FCKTableCommand("TableInsertRowAfter");break;case"TableInsertRowBefore":b=new FCKTableCommand("TableInsertRowBefore");break;case"TableDeleteRows":b=new FCKTableCommand("TableDeleteRows");break;case"TableInsertColumnAfter":b=new FCKTableCommand("TableInsertColumnAfter");break;case"TableInsertColumnBefore":b=new FCKTableCommand("TableInsertColumnBefore");break;case"TableDeleteColumns":b=new FCKTableCommand("TableDeleteColumns");break;case"TableInsertCellAfter":b=new FCKTableCommand("TableInsertCellAfter");break;case"TableInsertCellBefore":b=new FCKTableCommand("TableInsertCellBefore");break;case"TableDeleteCells":b=new FCKTableCommand("TableDeleteCells");break;case"TableMergeCells":b=new FCKTableCommand("TableMergeCells");break;case"TableMergeRight":b=new FCKTableCommand("TableMergeRight");break;case"TableMergeDown":b=new FCKTableCommand("TableMergeDown");break;case"TableHorizontalSplitCell":b=new FCKTableCommand("TableHorizontalSplitCell");break;case"TableVerticalSplitCell":b=new FCKTableCommand("TableVerticalSplitCell");break;case"TableDelete":b=new FCKTableCommand("TableDelete");break;case"Form":b=new FCKDialogCommand("Form",FCKLang.Form,"dialog/fck_form.html",380,210);break;case"Checkbox":b=new FCKDialogCommand("Checkbox",FCKLang.Checkbox,"dialog/fck_checkbox.html",380,200);break;case"Radio":b=new FCKDialogCommand("Radio",FCKLang.RadioButton,"dialog/fck_radiobutton.html",380,200);break;case"TextField":b=new FCKDialogCommand("TextField",FCKLang.TextField,"dialog/fck_textfield.html",380,210);break;case"Textarea":b=new FCKDialogCommand("Textarea",FCKLang.Textarea,"dialog/fck_textarea.html",380,210);break;case"HiddenField":b=new FCKDialogCommand("HiddenField",FCKLang.HiddenField,"dialog/fck_hiddenfield.html",380,190);break;case"Button":b=new FCKDialogCommand("Button",FCKLang.Button,"dialog/fck_button.html",380,210);break;case"Select":b=new FCKDialogCommand("Select",FCKLang.SelectionField,"dialog/fck_select.html",400,340);break;case"ImageButton":b=new FCKDialogCommand("ImageButton",FCKLang.ImageButton,"dialog/fck_image.html?ImageButton",450,390);break;case"SpellCheck":b=new FCKSpellCheckCommand();break;case"FitWindow":b=new FCKFitWindow();break;case"Undo":b=new FCKUndoCommand();break;case"Redo":b=new FCKRedoCommand();break;case"Copy":b=new FCKCutCopyCommand(false);break;case"Cut":b=new FCKCutCopyCommand(true);break;case"SelectAll":b=new FCKSelectAllCommand();break;case"InsertOrderedList":b=new FCKListCommand("insertorderedlist","ol");break;case"InsertUnorderedList":b=new FCKListCommand("insertunorderedlist","ul");break;case"ShowBlocks":b=new FCKShowBlockCommand("ShowBlocks",FCKConfig.StartupShowBlocks?1:0);break;case"Undefined":b=new FCKUndefinedCommand();break;case"Scayt":b=FCKScayt.CreateCommand();break;case"ScaytContext":b=FCKScayt.CreateContextCommand();break;default:if(FCKRegexLib.NamedCommands.test(a)){b=new FCKNamedCommand(a);}else{alert(FCKLang.UnknownCommand.replace(/%1/g,a));return null;}}FCKCommands.LoadedCommands[a]=b;return b;};FCKCommands.GetFullPageState=function(){return FCKConfig.FullPage?0:-1;};FCKCommands.GetBooleanState=function(a){return a?-1:0;};var FCKPanel=function(a){this.IsRTL=(FCKLang.Dir=="rtl");this.IsContextMenu=false;this._LockCounter=0;this._Window=a||window;var g;if(FCKBrowserInfo.IsIE){this._Popup=this._Window.createPopup();var f=this._Window.document;if(FCK_IS_CUSTOM_DOMAIN&&!FCKBrowserInfo.IsIE7){f.domain=FCK_ORIGINAL_DOMAIN;document.domain=FCK_ORIGINAL_DOMAIN;}g=this.Document=this._Popup.document;if(FCK_IS_CUSTOM_DOMAIN){g.domain=FCK_RUNTIME_DOMAIN;f.domain=FCK_RUNTIME_DOMAIN;document.domain=FCK_RUNTIME_DOMAIN;}FCK.IECleanup.AddItem(this,FCKPanel_Cleanup);}else{var d=this._IFrame=this._Window.document.createElement("iframe");FCKTools.ResetStyles(d);d.src="javascript:void(0)";d.allowTransparency=true;d.frameBorder="0";d.scrolling="no";d.style.width=d.style.height="0px";FCKDomTools.SetElementStyles(d,{position:"absolute",zIndex:FCKConfig.FloatingPanelsZIndex});this._Window.document.body.appendChild(d);var c=d.contentWindow;g=this.Document=c.document;var b="";if(FCKBrowserInfo.IsSafari){b='<base href="'+window.document.location+'">';}g.open();g.write("<html><head>"+b+'</head><body style="margin:0px;padding:0px;"></body></html>');g.close();if(FCKBrowserInfo.IsAIR){FCKAdobeAIR.Panel_Contructor(g,window.document.location);}FCKTools.AddEventListenerEx(c,"focus",FCKPanel_Window_OnFocus,this);FCKTools.AddEventListenerEx(c,"blur",FCKPanel_Window_OnBlur,this);}g.dir=FCKLang.Dir;FCKTools.AddEventListener(g,"contextmenu",FCKTools.CancelEvent);this.MainNode=g.body.appendChild(g.createElement("DIV"));this.MainNode.style.cssFloat=this.IsRTL?"right":"left";};FCKPanel.prototype.AppendStyleSheet=function(a){FCKTools.AppendStyleSheet(this.Document,a);};FCKPanel.prototype.Preload=function(b,c,a){if(this._Popup){this._Popup.show(b,c,0,0,a);}};FCKPanel.prototype.ResizeForSubpanel=function(b,h,g){if(!FCKBrowserInfo.IsIE7){return false;}if(!this._Popup.isOpen){this.Subpanel=null;return false;}if(h==0&&g==0){if(this.Subpanel!==b){return false;}this.Subpanel=null;this.IncreasedX=0;}else{this.Subpanel=b;if((this.IncreasedX>=h)&&(this.IncreasedY>=g)){return false;}this.IncreasedX=Math.max(this.IncreasedX,h);this.IncreasedY=Math.max(this.IncreasedY,g);}var a=this.ShowRect.x;var c=this.IncreasedX;if(this.IsRTL){a=a-c;}var f=this.ShowRect.w+c;var d=Math.max(this.ShowRect.h,this.IncreasedY);if(this.ParentPanel){this.ParentPanel.ResizeForSubpanel(this,f,d);}this._Popup.show(a,this.ShowRect.y,f,d,this.RelativeElement);return this.IsRTL;};FCKPanel.prototype.Show=function(k,i,d,c,b){var a;var p=this.MainNode;if(this._Popup){this._Popup.show(k,i,0,0,d);FCKDomTools.SetElementStyles(p,{B:c?c+"px":"",C:b?b+"px":""});a=p.offsetWidth;if(FCKBrowserInfo.IsIE7){if(this.ParentPanel&&this.ParentPanel.ResizeForSubpanel(this,a,p.offsetHeight)){FCKTools.RunFunction(this.Show,this,[k,i,d]);return;}}if(this.IsRTL){if(this.IsContextMenu){k=k-a+1;}else{if(d){k=(k*-1)+d.offsetWidth-a;}}}if(FCKBrowserInfo.IsIE7){this.ShowRect={x:k,y:i,w:a,h:p.offsetHeight};this.IncreasedX=0;this.IncreasedY=0;this.RelativeElement=d;}this._PopupArgs=[k,i,a,p.offsetHeight,d];this._Popup.show(k,i,a,p.offsetHeight,d);if(this.OnHide){if(this._Timer){CheckPopupOnHide.call(this,true);}this._Timer=FCKTools.SetInterval(CheckPopupOnHide,100,this);}}else{if(typeof(FCK.ToolbarSet.CurrentInstance.FocusManager)!="undefined"){FCK.ToolbarSet.CurrentInstance.FocusManager.Lock();}if(this.ParentPanel){this.ParentPanel.Lock();FCKPanel_Window_OnBlur(null,this.ParentPanel);}if(FCKBrowserInfo.IsGecko&&FCKBrowserInfo.IsMac){this._IFrame.scrolling="";FCKTools.RunFunction(function(){this._IFrame.scrolling="no";},this);}if(FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel&&FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel!=this){FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel.Hide(false,true);}FCKDomTools.SetElementStyles(p,{B:c?c+"px":"",C:b?b+"px":""});a=p.offsetWidth;if(!c){this._IFrame.width=1;}if(!b){this._IFrame.height=1;}a=p.offsetWidth||p.firstChild.offsetWidth;var o=FCKTools.GetDocumentPosition(this._Window,d.nodeType==9?(FCKTools.IsStrictMode(d)?d.documentElement:d.body):d);var n=FCKDomTools.GetPositionedAncestor(this._IFrame.parentNode);if(n){var m=FCKTools.GetDocumentPosition(FCKTools.GetElementWindow(n),n);o.x-=m.x;o.y-=m.y;}if(this.IsRTL&&!this.IsContextMenu){k=(k*-1);}k+=o.x;i+=o.y;if(this.IsRTL){if(this.IsContextMenu){k=k-a+1;}else{if(d){k=k+d.offsetWidth-a;}}}else{var l=FCKTools.GetViewPaneSize(this._Window);var j=FCKTools.GetScrollPosition(this._Window);var h=l.Height+j.Y;var g=l.Width+j.X;if((k+a)>g){k-=k+a-g;}if((i+p.offsetHeight)>h){i-=i+p.offsetHeight-h;}}FCKDomTools.SetElementStyles(this._IFrame,{left:k+"px",top:i+"px"});this._IFrame.contentWindow.focus();this._IsOpened=true;var f=this;this._resizeTimer=setTimeout(function(){var r=p.offsetWidth||p.firstChild.offsetWidth;var q=p.offsetHeight;f._IFrame.style.width=r+"px";f._IFrame.style.height=q+"px";},0);FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel=this;}FCKTools.RunFunction(this.OnShow,this);};FCKPanel.prototype.Hide=function(a,b){if(this._Popup){this._Popup.hide();}else{if(!this._IsOpened||this._LockCounter>0){return;}if(typeof(FCKFocusManager)!="undefined"&&!b){FCKFocusManager.Unlock();}this._IFrame.style.width=this._IFrame.style.height="0px";this._IsOpened=false;if(this._resizeTimer){clearTimeout(this._resizeTimer);this._resizeTimer=null;}if(this.ParentPanel){this.ParentPanel.Unlock();}if(!a){FCKTools.RunFunction(this.OnHide,this);}}};FCKPanel.prototype.CheckIsOpened=function(){if(this._Popup){return this._Popup.isOpen;}else{return this._IsOpened;}};FCKPanel.prototype.CreateChildPanel=function(){var a=this._Popup?FCKTools.GetDocumentWindow(this.Document):this._Window;var b=new FCKPanel(a);b.ParentPanel=this;return b;};FCKPanel.prototype.Lock=function(){this._LockCounter++;};FCKPanel.prototype.Unlock=function(){if(--this._LockCounter==0&&!this.HasFocus){this.Hide();}};function FCKPanel_Window_OnFocus(b,a){a.HasFocus=true;}function FCKPanel_Window_OnBlur(b,a){a.HasFocus=false;if(a._LockCounter==0){FCKTools.RunFunction(a.Hide,a);}}function CheckPopupOnHide(a){if(a||!this._Popup.isOpen){window.clearInterval(this._Timer);this._Timer=null;if(this._Popup&&this.ParentPanel&&!a){this.ParentPanel.ResizeForSubpanel(this,0,0);}FCKTools.RunFunction(this.OnHide,this);}}function FCKPanel_Cleanup(){this._Popup=null;this._Window=null;this.Document=null;this.MainNode=null;this.RelativeElement=null;}var FCKIcon=function(a){var b=a?typeof(a):"undefined";switch(b){case"number":this.Path=FCKConfig.SkinPath+"fck_strip.gif";this.Size=16;this.Position=a;break;case"undefined":this.Path=FCK_SPACER_PATH;break;case"string":this.Path=a;break;default:this.Path=a[0];this.Size=a[1];this.Position=a[2];}};FCKIcon.prototype.CreateIconElement=function(a){var d,b;if(this.Position){var c="-"+((this.Position-1)*this.Size)+"px";if(FCKBrowserInfo.IsIE){d=a.createElement("DIV");b=d.appendChild(a.createElement("IMG"));b.src=this.Path;b.style.top=c;}else{d=a.createElement("IMG");d.src=FCK_SPACER_PATH;d.style.backgroundPosition="0px "+c;d.style.backgroundImage='url("'+this.Path+'")';}}else{if(FCKBrowserInfo.IsIE){d=a.createElement("DIV");b=d.appendChild(a.createElement("IMG"));b.src=this.Path?this.Path:FCK_SPACER_PATH;}else{d=a.createElement("IMG");d.src=this.Path?this.Path:FCK_SPACER_PATH;}}d.className="TB_Button_Image";return d;};var FCKToolbarButtonUI=function(a,g,f,d,c,b){this.Name=a;this.Label=g||a;this.Tooltip=f||this.Label;this.Style=c||0;this.State=b||0;this.Icon=new FCKIcon(d);if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKToolbarButtonUI_Cleanup);}};FCKToolbarButtonUI.prototype._CreatePaddingElement=function(a){var b=a.createElement("IMG");b.className="TB_Button_Padding";b.src=FCK_SPACER_PATH;return b;};FCKToolbarButtonUI.prototype.Create=function(a){var h=FCKTools.GetElementDocument(a);var g=this.MainElement=h.createElement("DIV");g.title=this.Tooltip;if(FCKBrowserInfo.IsGecko){g.onmousedown=FCKTools.CancelEvent;}FCKTools.AddEventListenerEx(g,"mouseover",FCKToolbarButtonUI_OnMouseOver,this);FCKTools.AddEventListenerEx(g,"mouseout",FCKToolbarButtonUI_OnMouseOut,this);FCKTools.AddEventListenerEx(g,"click",FCKToolbarButtonUI_OnClick,this);this.ChangeState(this.State,true);if(this.Style==0&&!this.ShowArrow){g.appendChild(this.Icon.CreateIconElement(h));}else{var f=g.appendChild(h.createElement("TABLE"));f.cellPadding=0;f.cellSpacing=0;var d=f.insertRow(-1);var c=d.insertCell(-1);if(this.Style==0||this.Style==2){c.appendChild(this.Icon.CreateIconElement(h));}else{c.appendChild(this._CreatePaddingElement(h));}if(this.Style==1||this.Style==2){c=d.insertCell(-1);c.className="TB_Button_Text";c.noWrap=true;c.appendChild(h.createTextNode(this.Label));}if(this.ShowArrow){if(this.Style!=0){d.insertCell(-1).appendChild(this._CreatePaddingElement(h));}c=d.insertCell(-1);var b=c.appendChild(h.createElement("IMG"));b.src=FCKConfig.SkinPath+"images/toolbar.buttonarrow.gif";b.width=5;b.height=3;}c=d.insertCell(-1);c.appendChild(this._CreatePaddingElement(h));}a.appendChild(g);};FCKToolbarButtonUI.prototype.ChangeState=function(a,c){if(!c&&this.State==a){return;}var b=this.MainElement;if(!b){return;}switch(parseInt(a,10)){case 0:b.className="TB_Button_Off";break;case 1:b.className="TB_Button_On";break;case -1:b.className="TB_Button_Disabled";break;}this.State=a;};function FCKToolbarButtonUI_OnMouseOver(a,b){if(b.State==0){this.className="TB_Button_Off_Over";}else{if(b.State==1){this.className="TB_Button_On_Over";}}}function FCKToolbarButtonUI_OnMouseOut(a,b){if(b.State==0){this.className="TB_Button_Off";}else{if(b.State==1){this.className="TB_Button_On";}}}function FCKToolbarButtonUI_OnClick(a,b){if(b.OnClick&&b.State!=-1){b.OnClick(b);}}function FCKToolbarButtonUI_Cleanup(){this.MainElement=null;}var FCKToolbarButton=function(a,h,g,f,d,c,b){this.CommandName=a;this.Label=h;this.Tooltip=g;this.Style=f;this.SourceView=d?true:false;this.ContextSensitive=c?true:false;if(b==null){this.IconPath=FCKConfig.SkinPath+"toolbar/"+a.toLowerCase()+".gif";}else{if(typeof(b)=="number"){this.IconPath=[FCKConfig.SkinPath+"fck_strip.gif",16,b];}else{this.IconPath=b;}}};FCKToolbarButton.prototype.Create=function(a){this._UIButton=new FCKToolbarButtonUI(this.CommandName,this.Label,this.Tooltip,this.IconPath,this.Style);this._UIButton.OnClick=this.Click;this._UIButton._ToolbarButton=this;this._UIButton.Create(a);};FCKToolbarButton.prototype.RefreshState=function(){var a=this._UIButton;if(!a){return;}var b=FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName).GetState();if(b==a.State){return;}a.ChangeState(b);};FCKToolbarButton.prototype.Click=function(){var a=this._ToolbarButton||this;FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(a.CommandName).Execute();};FCKToolbarButton.prototype.Enable=function(){this.RefreshState();};FCKToolbarButton.prototype.Disable=function(){this._UIButton.ChangeState(-1);};var FCKSpecialCombo=function(a,f,d,c,b){this.FieldWidth=f||100;this.PanelWidth=d||150;this.PanelMaxHeight=c||150;this.Label="&nbsp;";this.Caption=a;this.Tooltip=a;this.Style=2;this.Enabled=true;this.Items={};this._Panel=new FCKPanel(b||window);this._Panel.AppendStyleSheet(FCKConfig.SkinEditorCSS);this._PanelBox=this._Panel.MainNode.appendChild(this._Panel.Document.createElement("DIV"));this._PanelBox.className="SC_Panel";this._PanelBox.style.width=this.PanelWidth+"px";this._PanelBox.innerHTML='<table cellpadding="0" cellspacing="0" width="100%" style="TABLE-LAYOUT: fixed"><tr><td nowrap></td></tr></table>';this._ItemsHolderEl=this._PanelBox.getElementsByTagName("TD")[0];if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKSpecialCombo_Cleanup);}};function FCKSpecialCombo_ItemOnMouseOver(){this.className+=" SC_ItemOver";}function FCKSpecialCombo_ItemOnMouseOut(){this.className=this.originalClass;}function FCKSpecialCombo_ItemOnClick(a,c,b){this.className=this.originalClass;c._Panel.Hide();c.SetLabel(this.FCKItemLabel);if(typeof(c.OnSelect)=="function"){c.OnSelect(b,this);}}FCKSpecialCombo.prototype.ClearItems=function(){if(this.Items){this.Items={};}var a=this._ItemsHolderEl;while(a.firstChild){a.removeChild(a.firstChild);}};FCKSpecialCombo.prototype.AddItem=function(a,f,d,c){var b=this._ItemsHolderEl.appendChild(this._Panel.Document.createElement("DIV"));b.className=b.originalClass="SC_Item";b.innerHTML=f;b.FCKItemLabel=d||a;b.Selected=false;if(FCKBrowserInfo.IsIE){b.style.width="100%";}if(c){b.style.backgroundColor=c;}FCKTools.AddEventListenerEx(b,"mouseover",FCKSpecialCombo_ItemOnMouseOver);FCKTools.AddEventListenerEx(b,"mouseout",FCKSpecialCombo_ItemOnMouseOut);FCKTools.AddEventListenerEx(b,"click",FCKSpecialCombo_ItemOnClick,[this,a]);this.Items[a.toString().toLowerCase()]=b;return b;};FCKSpecialCombo.prototype.SelectItem=function(a){if(typeof a=="string"){a=this.Items[a.toString().toLowerCase()];}if(a){a.className=a.originalClass="SC_ItemSelected";a.Selected=true;}};FCKSpecialCombo.prototype.SelectItemByLabel=function(a,d){for(var c in this.Items){var b=this.Items[c];if(b.FCKItemLabel==a){b.className=b.originalClass="SC_ItemSelected";b.Selected=true;if(d){this.SetLabel(a);}}}};FCKSpecialCombo.prototype.DeselectAll=function(a){for(var b in this.Items){if(!this.Items[b]){continue;}this.Items[b].className=this.Items[b].originalClass="SC_Item";this.Items[b].Selected=false;}if(a){this.SetLabel("");}};FCKSpecialCombo.prototype.SetLabelById=function(a){a=a?a.toString().toLowerCase():"";var b=this.Items[a];this.SetLabel(b?b.FCKItemLabel:"");};FCKSpecialCombo.prototype.SetLabel=function(a){a=(!a||a.length==0)?"&nbsp;":a;if(a==this.Label){return;}this.Label=a;var b=this._LabelEl;if(b){b.innerHTML=a;FCKTools.DisableSelection(b);}};FCKSpecialCombo.prototype.SetEnabled=function(a){this.Enabled=a;if(this._OuterTable){this._OuterTable.className=a?"":"SC_FieldDisabled";}};FCKSpecialCombo.prototype.Create=function(a){var h=FCKTools.GetElementDocument(a);var g=this._OuterTable=a.appendChild(h.createElement("TABLE"));g.cellPadding=0;g.cellSpacing=0;g.insertRow(-1);var f;var d;switch(this.Style){case 0:f="TB_ButtonType_Icon";d=false;break;case 1:f="TB_ButtonType_Text";d=false;break;case 2:d=true;break;}if(this.Caption&&this.Caption.length>0&&d){var c=g.rows[0].insertCell(-1);c.innerHTML=this.Caption;c.className="SC_FieldCaption";}var b=FCKTools.AppendElement(g.rows[0].insertCell(-1),"div");if(d){b.className="SC_Field";b.style.width=this.FieldWidth+"px";b.innerHTML='<table width="100%" cellpadding="0" cellspacing="0" style="TABLE-LAYOUT: fixed;"><tbody><tr><td class="SC_FieldLabel"><label>&nbsp;</label></td><td class="SC_FieldButton">&nbsp;</td></tr></tbody></table>';this._LabelEl=b.getElementsByTagName("label")[0];this._LabelEl.innerHTML=this.Label;}else{b.className="TB_Button_Off";b.innerHTML='<table title="'+this.Tooltip+'" class="'+f+'" cellspacing="0" cellpadding="0" border="0"><tr><td><img class="TB_Button_Padding" src="'+FCK_SPACER_PATH+'" /></td><td class="TB_Text">'+this.Caption+'</td><td><img class="TB_Button_Padding" src="'+FCK_SPACER_PATH+'" /></td><td class="TB_ButtonArrow"><img src="'+FCKConfig.SkinPath+'images/toolbar.buttonarrow.gif" width="5" height="3"></td><td><img class="TB_Button_Padding" src="'+FCK_SPACER_PATH+'" /></td></tr></table>';}FCKTools.AddEventListenerEx(b,"mouseover",FCKSpecialCombo_OnMouseOver,this);FCKTools.AddEventListenerEx(b,"mouseout",FCKSpecialCombo_OnMouseOut,this);FCKTools.AddEventListenerEx(b,"click",FCKSpecialCombo_OnClick,this);FCKTools.DisableSelection(this._Panel.Document.body);};function FCKSpecialCombo_Cleanup(){this._LabelEl=null;this._OuterTable=null;this._ItemsHolderEl=null;this._PanelBox=null;if(this.Items){for(var a in this.Items){this.Items[a]=null;}}}function FCKSpecialCombo_OnMouseOver(a,b){if(b.Enabled){switch(b.Style){case 0:this.className="TB_Button_On_Over";break;case 1:this.className="TB_Button_On_Over";break;case 2:this.className="SC_Field SC_FieldOver";break;}}}function FCKSpecialCombo_OnMouseOut(a,b){switch(b.Style){case 0:this.className="TB_Button_Off";break;case 1:this.className="TB_Button_Off";break;case 2:this.className="SC_Field";break;}}function FCKSpecialCombo_OnClick(d,a){if(a.Enabled){var g=a._Panel;var f=a._PanelBox;var c=a._ItemsHolderEl;var b=a.PanelMaxHeight;if(a.OnBeforeClick){a.OnBeforeClick(a);}if(FCKBrowserInfo.IsIE){g.Preload(0,this.offsetHeight,this);}if(c.offsetHeight>b){f.style.height=b+"px";}else{f.style.height="";}g.Show(0,this.offsetHeight,this);}}var FCKToolbarSpecialCombo=function(){this.SourceView=false;this.ContextSensitive=true;this.FieldWidth=null;this.PanelWidth=null;this.PanelMaxHeight=null;};FCKToolbarSpecialCombo.prototype.DefaultLabel="";function FCKToolbarSpecialCombo_OnSelect(a,b){FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName).Execute(a,b);}FCKToolbarSpecialCombo.prototype.Create=function(a){this._Combo=new FCKSpecialCombo(this.GetLabel(),this.FieldWidth,this.PanelWidth,this.PanelMaxHeight,FCKBrowserInfo.IsIE?window:FCKTools.GetElementWindow(a).parent);this._Combo.Tooltip=this.Tooltip;this._Combo.Style=this.Style;this.CreateItems(this._Combo);this._Combo.Create(a);this._Combo.CommandName=this.CommandName;this._Combo.OnSelect=FCKToolbarSpecialCombo_OnSelect;};function FCKToolbarSpecialCombo_RefreshActiveItems(a,b){a.DeselectAll();a.SelectItem(b);a.SetLabelById(b);}FCKToolbarSpecialCombo.prototype.RefreshState=function(){var a;var b=FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName).GetState();if(b!=-1){a=1;if(this.RefreshActiveItems){this.RefreshActiveItems(this._Combo,b);}else{if(this._LastValue!==b){this._LastValue=b;if(!b||b.length==0){this._Combo.DeselectAll();this._Combo.SetLabel(this.DefaultLabel);}else{FCKToolbarSpecialCombo_RefreshActiveItems(this._Combo,b);}}}}else{a=-1;}if(a==this.State){return;}if(a==-1){this._Combo.DeselectAll();this._Combo.SetLabel("");}this.State=a;this._Combo.SetEnabled(a!=-1);};FCKToolbarSpecialCombo.prototype.Enable=function(){this.RefreshState();};FCKToolbarSpecialCombo.prototype.Disable=function(){this.State=-1;this._Combo.DeselectAll();this._Combo.SetLabel("");this._Combo.SetEnabled(false);};var FCKToolbarStyleCombo=function(a,b){if(a===false){return;}this.CommandName="Style";this.Label=this.GetLabel();this.Tooltip=a?a:this.Label;this.Style=b?b:2;this.DefaultLabel=FCKConfig.DefaultStyleLabel||"";};FCKToolbarStyleCombo.prototype=new FCKToolbarSpecialCombo;FCKToolbarStyleCombo.prototype.GetLabel=function(){return FCKLang.Style;};FCKToolbarStyleCombo.prototype.GetStyles=function(){var a={};var d=FCK.ToolbarSet.CurrentInstance.Styles.GetStyles();for(var c in d){var b=d[c];if(!b.IsCore){a[c]=b;}}return a;};FCKToolbarStyleCombo.prototype.CreateItems=function(a){var h=a._Panel.Document;FCKTools.AppendStyleSheet(h,FCKConfig.ToolbarComboPreviewCSS);FCKTools.AppendStyleString(h,FCKConfig.EditorAreaStyles);h.body.className+=" ForceBaseFont";FCKConfig.ApplyBodyAttributes(h.body);var g=this.GetStyles();for(var f in g){var d=g[f];var c=d.GetType()==2?f:FCKToolbarStyleCombo_BuildPreview(d,d.Label||f);var b=a.AddItem(f,c);b.Style=d;}a.OnBeforeClick=this.StyleCombo_OnBeforeClick;};FCKToolbarStyleCombo.prototype.RefreshActiveItems=function(a){var j=FCK.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(true);if(j){var h=new FCKElementPath(j);var g=h.Elements;for(var f=0;f<g.length;f++){for(var b in a.Items){var d=a.Items[b];var c=d.Style;if(c.CheckElementRemovable(g[f],true)){a.SetLabel(c.Label||c.Name);return;}}}}a.SetLabel(this.DefaultLabel);};FCKToolbarStyleCombo.prototype.StyleCombo_OnBeforeClick=function(a){a.DeselectAll();var j;var h;var g;var f=FCK.ToolbarSet.CurrentInstance.Selection;if(f.GetType()=="Control"){j=f.GetSelectedElement();g=j.nodeName.toLowerCase();}else{j=f.GetBoundaryParentElement(true);h=new FCKElementPath(j);}for(var b in a.Items){var d=a.Items[b];var c=d.Style;if((g&&c.Element==g)||(!g&&c.GetType()!=2)){d.style.display="";if((h&&c.CheckActive(h))||(!h&&c.CheckElementRemovable(j,true))){a.SelectItem(c.Name);}}else{d.style.display="none";}}};function FCKToolbarStyleCombo_BuildPreview(a,h){var g=a.GetType();var f=[];if(g==0){f.push('<div class="BaseFont">');}var d=a.Element;if(d=="bdo"){d="span";}f=["<",d];var c=a._StyleDesc.Attributes;if(c){for(var b in c){f.push(" ",b,'="',a.GetFinalAttributeValue(b),'"');}}if(a._GetStyleText().length>0){f.push(' style="',a.GetFinalStyleValue(),'"');}f.push(">",h,"</",d,">");if(g==0){f.push("</div>");}return f.join("");}var FCKToolbarFontFormatCombo=function(a,b){if(a===false){return;}this.CommandName="FontFormat";this.Label=this.GetLabel();this.Tooltip=a?a:this.Label;this.Style=b?b:2;this.NormalLabel="Normal";this.PanelWidth=190;this.DefaultLabel=FCKConfig.DefaultFontFormatLabel||"";};FCKToolbarFontFormatCombo.prototype=new FCKToolbarStyleCombo(false);FCKToolbarFontFormatCombo.prototype.GetLabel=function(){return FCKLang.FontFormat;};FCKToolbarFontFormatCombo.prototype.GetStyles=function(){var a={};var h=FCKLang["FontFormats"].split(";");var g={p:h[0],pre:h[1],address:h[2],h1:h[3],h2:h[4],h3:h[5],h4:h[6],h5:h[7],h6:h[8],div:h[9]||(h[0]+" (DIV)")};var f=FCKConfig.FontFormats.split(";");for(var b=0;b<f.length;b++){var d=f[b];var c=FCKStyles.GetStyle("_FCK_"+d);if(c){c.Label=g[d];a["_FCK_"+d]=c;}else{alert("The FCKConfig.CoreStyles['"+d+"'] setting was not found. Please check the fckconfig.js file");}}return a;};FCKToolbarFontFormatCombo.prototype.RefreshActiveItems=function(a){var h=FCK.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(true);if(h){var g=new FCKElementPath(h);var f=g.Block;if(f){for(var b in a.Items){var d=a.Items[b];var c=d.Style;if(c.CheckElementRemovable(f)){a.SetLabel(c.Label);return;}}}}a.SetLabel(this.DefaultLabel);};FCKToolbarFontFormatCombo.prototype.StyleCombo_OnBeforeClick=function(a){a.DeselectAll();var h=FCK.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(true);if(h){var g=new FCKElementPath(h);var f=g.Block;for(var b in a.Items){var d=a.Items[b];var c=d.Style;if(c.CheckElementRemovable(f)){a.SelectItem(d);return;}}}};var FCKToolbarFontsCombo=function(a,b){this.CommandName="FontName";this.Label=this.GetLabel();this.Tooltip=a?a:this.Label;this.Style=b?b:2;this.DefaultLabel=FCKConfig.DefaultFontLabel||"";};FCKToolbarFontsCombo.prototype=new FCKToolbarFontFormatCombo(false);FCKToolbarFontsCombo.prototype.GetLabel=function(){return FCKLang.Font;};FCKToolbarFontsCombo.prototype.GetStyles=function(){var a=FCKStyles.GetStyle("_FCK_FontFace");if(!a){alert("The FCKConfig.CoreStyles['Size'] setting was not found. Please check the fckconfig.js file");return{};}var j={};var h=FCKConfig.FontNames.split(";");for(var b=0;b<h.length;b++){var g=h[b].split("/");var f=g[0];var d=g[1]||f;var c=FCKTools.CloneObject(a);c.SetVariable("Font",f);c.Label=d;j[d]=c;}return j;};FCKToolbarFontsCombo.prototype.RefreshActiveItems=FCKToolbarStyleCombo.prototype.RefreshActiveItems;FCKToolbarFontsCombo.prototype.StyleCombo_OnBeforeClick=function(a){a.DeselectAll();var g=FCKSelection.GetBoundaryParentElement(true);if(g){var f=new FCKElementPath(g);for(var b in a.Items){var d=a.Items[b];var c=d.Style;if(c.CheckActive(f)){a.SelectItem(d);return;}}}};var FCKToolbarFontSizeCombo=function(a,b){this.CommandName="FontSize";this.Label=this.GetLabel();this.Tooltip=a?a:this.Label;this.Style=b?b:2;this.DefaultLabel=FCKConfig.DefaultFontSizeLabel||"";this.FieldWidth=70;};FCKToolbarFontSizeCombo.prototype=new FCKToolbarFontFormatCombo(false);FCKToolbarFontSizeCombo.prototype.GetLabel=function(){return FCKLang.FontSize;};FCKToolbarFontSizeCombo.prototype.GetStyles=function(){var a=FCKStyles.GetStyle("_FCK_Size");if(!a){alert("The FCKConfig.CoreStyles['FontFace'] setting was not found. Please check the fckconfig.js file");return{};}var j={};var h=FCKConfig.FontSizes.split(";");for(var b=0;b<h.length;b++){var g=h[b].split("/");var f=g[0];var d=g[1]||f;var c=FCKTools.CloneObject(a);c.SetVariable("Size",f);c.Label=d;j[d]=c;}return j;};FCKToolbarFontSizeCombo.prototype.RefreshActiveItems=FCKToolbarStyleCombo.prototype.RefreshActiveItems;FCKToolbarFontSizeCombo.prototype.StyleCombo_OnBeforeClick=FCKToolbarFontsCombo.prototype.StyleCombo_OnBeforeClick;var FCKToolbarPanelButton=function(a,h,g,f,d){this.CommandName=a;var c;if(d==null){c=FCKConfig.SkinPath+"toolbar/"+a.toLowerCase()+".gif";}else{if(typeof(d)=="number"){c=[FCKConfig.SkinPath+"fck_strip.gif",16,d];}}var b=this._UIButton=new FCKToolbarButtonUI(a,h,g,c,f);b._FCKToolbarPanelButton=this;b.ShowArrow=true;b.OnClick=FCKToolbarPanelButton_OnButtonClick;};FCKToolbarPanelButton.prototype.TypeName="FCKToolbarPanelButton";FCKToolbarPanelButton.prototype.Create=function(a){a.className+="Menu";this._UIButton.Create(a);var b=FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName)._Panel;this.RegisterPanel(b);};FCKToolbarPanelButton.prototype.RegisterPanel=function(a){if(a._FCKToolbarPanelButton){return;}a._FCKToolbarPanelButton=this;var c=a.Document.body.appendChild(a.Document.createElement("div"));c.style.position="absolute";c.style.top="0px";var b=a._FCKToolbarPanelButtonLineDiv=c.appendChild(a.Document.createElement("IMG"));b.className="TB_ConnectionLine";b.style.position="absolute";b.src=FCK_SPACER_PATH;a.OnHide=FCKToolbarPanelButton_OnPanelHide;};function FCKToolbarPanelButton_OnButtonClick(a){var f=this._FCKToolbarPanelButton;var c=f._UIButton.MainElement;f._UIButton.ChangeState(1);var d=FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(f.CommandName);var b=d._Panel;b._FCKToolbarPanelButtonLineDiv.style.width=(c.offsetWidth-2)+"px";d.Execute(0,c.offsetHeight-1,c);}function FCKToolbarPanelButton_OnPanelHide(){var a=this._FCKToolbarPanelButton;a._UIButton.ChangeState(0);}FCKToolbarPanelButton.prototype.RefreshState=FCKToolbarButton.prototype.RefreshState;FCKToolbarPanelButton.prototype.Enable=FCKToolbarButton.prototype.Enable;FCKToolbarPanelButton.prototype.Disable=FCKToolbarButton.prototype.Disable;var FCKScayt;(function(){var g=[];var f=(FCK&&FCK.EditorWindow&&FCK.EditorWindow.parent.parent.scayt)?true:false;var d=false;var a=false;function j(A){if(f){return;}f=true;var z=FCK.EditorWindow.parent.parent;var y=function(){window.scayt=z.scayt;h();var B=FCKToolbarItems.LoadedItems["ScaytCombobox"];B&&B.SetEnabled(scyt_control&&scyt_control.disabled);l();};if(z.scayt){y();return;}if(FCK.Config.ScaytCustomUrl){FCK.Config.ScaytCustomUrl=new String(FCK.Config.ScaytCustomUrl).replace(new RegExp("^http[s]*://"),"");}var x=document.location.protocol;var v=FCK.Config.ScaytCustomUrl||"svc.spellchecker.net/spellcheck3/lf/scayt/scayt4.js";var u=x+"//"+v;var t=r(u).path+"/";var b=z.window.CKEDITOR||(z.window.CKEDITOR={});b._djScaytConfig={I:t,addOnLoad:function(){y();},isDebug:false};if(A){g.push(A);}i(u);}function i(b){if(!b){return false;}var u=FCK.EditorWindow.parent.parent;var t=u.document.createElement("script");t.type="text/javascript";t.src=b;u.document.getElementsByTagName("head")[0].appendChild(t);return true;}function r(t){var b=t.match(/(.*)[\/\\]([^\/\\]+\.\w+)$/);return b?{path:b[1],file:b[2]}:t;}function p(){var v={};var u=FCK.EditorWindow.parent.parent;v.srcNodeRef=FCK.EditingArea.IFrame;v.customerid=FCK.Config.ScaytCustomerid;v.customDictionaryName=FCK.Config.ScaytCustomDictionaryName;v.userDictionaryName=FCK.Config.ScaytUserDictionaryName;v.defLang=FCK.Config.ScaytDefLang;var t=u.scayt;var b=window.scayt_control=new t(v);}function h(){p();var v=window.scayt_control;if(v){v.setDisabled(false);a=true;d=!v.disabled;var t=FCKToolbarItems.LoadedItems["ScaytCombobox"];t&&t.Enable();n();}for(var b=0;b<g.length;b++){try{g[b].call(this);}catch(u){}}}var k=function(){name="Scayt";};k.prototype.Execute=function(t){switch(t){case"Options":case"Langs":case"About":if(f&&a&&!d){m("SCAYT is not enabled");break;}if(f&&a){FCKDialog.OpenDialog("Scayt","SCAYT Settings","dialog/fck_scayt.html?"+t.toLowerCase(),343,343);}break;default:if(!f){var b=this;j(function(){b.SetEnabled(!window.scayt_control.disabled);});return true;}else{if(a){if(d){this.Disable();}else{this.Enable();}n();}}}if(!f){return m("SCAYT is not loaded")||false;}if(!a){return m("SCAYT is not ready")||false;}return true;};k.prototype.Enable=function(){window.scayt_control.setDisabled(false);d=true;};k.prototype.Disable=function(){window.scayt_control.setDisabled(true);d=false;};k.prototype.SetEnabled=function(b){if(b){this.Enable();}else{this.Disable();}n();return true;};k.prototype.GetState=function(){return 0;};function n(){var b=FCKToolbarItems.GetItem("SpellCheck");if(!b||!b._Combo||!b._Combo._OuterTable){return;}var u=b._Combo._OuterTable.getElementsByTagName("img")[1];var t=b._Combo.Items["trigger"];if(d){u.style.opacity="1";t.innerHTML=q();}else{u.style.opacity="0.5";t.innerHTML=q();}}function q(){if(!a){return"<b>Enable SCAYT</b>";}return d?"<b>Disable SCAYT</b>":"<b>Enable SCAYT</b>";}var c=function(t,b){this.Command=FCKCommands.GetCommand("Scayt");this.CommandName="Scayt";this.Label=this.GetLabel();this.Tooltip=FCKLang.ScaytTitle;this.Style=1;};c.prototype=new FCKToolbarSpecialCombo;c.prototype.CreateItems=function(){this._Combo.AddItem("Trigger","<b>Enable SCAYT</b>");this._Combo.AddItem("Options",FCKLang.ScaytTitleOptions||"Options");this._Combo.AddItem("Langs",FCKLang.ScaytTitleLangs||"Languages");this._Combo.AddItem("About",FCKLang.ScaytTitleAbout||"About");};c.prototype.GetLabel=function(){var b=FCKConfig.SkinPath+"fck_strip.gif";return FCKBrowserInfo.IsIE?'<div class="TB_Button_Image"><img src="'+b+'" style="top:-192px"></div>':'<img class="TB_Button_Image" src="'+FCK_SPACER_PATH+'" style="background-position: 0px -192px;background-image: url('+b+');">';};function m(b){b&&alert(b);}var o=function(){name="ScaytContext";};o.prototype.Execute=function(b){var x=b&&b.action,u=x&&b.node,t=window.scayt_control;if(u){switch(x){case"Suggestion":t.replace(u,b.suggestion);break;case"Ignore":t.ignore(u);break;case"Ignore All":t.ignoreAll(u);break;case"Add Word":var v=FCK.EditorWindow.parent.parent;v.scayt.addWordToUserDictionary(u);break;}}};function l(){FCK.ContextMenu.RegisterListener({AddItems:function(b){var C=FCK.EditorWindow.parent.parent;var y=window.scayt_control,A=C.scayt;if(!y){return;}var B=y.getScaytNode();if(!B){return;}var z=A.getSuggestion(y.getWord(B),y.getLang());if(!z||!z.length){return;}b.AddSeparator();var v=FCK.Config.ScaytMaxSuggestions||5;var u=(v==-1)?z.length:v;for(var x=0;x<u;x+=1){if(z[x]){b.AddItem("ScaytContext",z[x],null,false,{"action":"Suggestion","node":B,"suggestion":z[x]});}}b.AddSeparator();b.AddItem("ScaytContext","Ignore",null,false,{"action":"Ignore","node":B});b.AddItem("ScaytContext","Ignore All",null,false,{"action":"Ignore All","node":B});b.AddItem("ScaytContext","Add Word",null,false,{"action":"Add Word","node":B});try{if(a&&d){y.fireOnContextMenu(null,FCK.ContextMenu._InnerContextMenu);}}catch(t){}}});FCK.Events.AttachEvent("OnPaste",function(){window.scayt_control.refresh();return true;});}FCK.Events.AttachEvent("OnAfterSetHTML",function(){if(FCKConfig.SpellChecker=="SCAYT"){if(!f&&FCK.Config.ScaytAutoStartup){j();}if(FCK.EditMode==0&&f&&a){p();}n();}});FCK.Events.AttachEvent("OnBeforeGetData",function(){a&&window.scayt_control.reset();});FCK.Events.AttachEvent("OnAfterGetData",function(){a&&window.scayt_control.refresh();});FCKScayt={CreateCommand:function(){return new k();},CreateContextCommand:function(){return new o();},CreateToolbarItem:function(){return new c();}};})();var FCKToolbarItems={};FCKToolbarItems.LoadedItems={};FCKToolbarItems.RegisterItem=function(a,b){this.LoadedItems[a]=b;};FCKToolbarItems.GetItem=function(a){var b=FCKToolbarItems.LoadedItems[a];if(b){return b;}switch(a){case"Source":b=new FCKToolbarButton("Source",FCKLang.Source,null,2,true,true,1);break;case"DocProps":b=new FCKToolbarButton("DocProps",FCKLang.DocProps,null,null,null,null,2);break;case"Save":b=new FCKToolbarButton("Save",FCKLang.Save,null,null,true,null,3);break;case"NewPage":b=new FCKToolbarButton("NewPage",FCKLang.NewPage,null,null,true,null,4);break;case"Preview":b=new FCKToolbarButton("Preview",FCKLang.Preview,null,null,true,null,5);break;case"Templates":b=new FCKToolbarButton("Templates",FCKLang.Templates,null,null,null,null,6);break;case"About":b=new FCKToolbarButton("About",FCKLang.About,null,null,true,null,47);break;case"Cut":b=new FCKToolbarButton("Cut",FCKLang.Cut,null,null,false,true,7);break;case"Copy":b=new FCKToolbarButton("Copy",FCKLang.Copy,null,null,false,true,8);break;case"Paste":b=new FCKToolbarButton("Paste",FCKLang.Paste,null,null,false,true,9);break;case"PasteText":b=new FCKToolbarButton("PasteText",FCKLang.PasteText,null,null,false,true,10);break;case"PasteWord":b=new FCKToolbarButton("PasteWord",FCKLang.PasteWord,null,null,false,true,11);break;case"Print":b=new FCKToolbarButton("Print",FCKLang.Print,null,null,false,true,12);break;case"Undo":b=new FCKToolbarButton("Undo",FCKLang.Undo,null,null,false,true,14);break;case"Redo":b=new FCKToolbarButton("Redo",FCKLang.Redo,null,null,false,true,15);break;case"SelectAll":b=new FCKToolbarButton("SelectAll",FCKLang.SelectAll,null,null,true,null,18);break;case"RemoveFormat":b=new FCKToolbarButton("RemoveFormat",FCKLang.RemoveFormat,null,null,false,true,19);break;case"FitWindow":b=new FCKToolbarButton("FitWindow",FCKLang.FitWindow,null,null,true,true,66);break;case"Bold":b=new FCKToolbarButton("Bold",FCKLang.Bold,null,null,false,true,20);break;case"Italic":b=new FCKToolbarButton("Italic",FCKLang.Italic,null,null,false,true,21);break;case"Underline":b=new FCKToolbarButton("Underline",FCKLang.Underline,null,null,false,true,22);break;case"StrikeThrough":b=new FCKToolbarButton("StrikeThrough",FCKLang.StrikeThrough,null,null,false,true,23);break;case"Subscript":b=new FCKToolbarButton("Subscript",FCKLang.Subscript,null,null,false,true,24);break;case"Superscript":b=new FCKToolbarButton("Superscript",FCKLang.Superscript,null,null,false,true,25);break;case"OrderedList":b=new FCKToolbarButton("InsertOrderedList",FCKLang.NumberedListLbl,FCKLang.NumberedList,null,false,true,26);break;case"UnorderedList":b=new FCKToolbarButton("InsertUnorderedList",FCKLang.BulletedListLbl,FCKLang.BulletedList,null,false,true,27);break;case"Outdent":b=new FCKToolbarButton("Outdent",FCKLang.DecreaseIndent,null,null,false,true,28);break;case"Indent":b=new FCKToolbarButton("Indent",FCKLang.IncreaseIndent,null,null,false,true,29);break;case"Blockquote":b=new FCKToolbarButton("Blockquote",FCKLang.Blockquote,null,null,false,true,73);break;case"CreateDiv":b=new FCKToolbarButton("CreateDiv",FCKLang.CreateDiv,null,null,false,true,74);break;case"Link":b=new FCKToolbarButton("Link",FCKLang.InsertLinkLbl,FCKLang.InsertLink,null,false,true,34);break;case"Unlink":b=new FCKToolbarButton("Unlink",FCKLang.RemoveLink,null,null,false,true,35);break;case"Anchor":b=new FCKToolbarButton("Anchor",FCKLang.Anchor,null,null,null,null,36);break;case"Image":b=new FCKToolbarButton("Image",FCKLang.InsertImageLbl,FCKLang.InsertImage,null,false,true,37);break;case"Flash":b=new FCKToolbarButton("Flash",FCKLang.InsertFlashLbl,FCKLang.InsertFlash,null,false,true,38);break;case"Table":b=new FCKToolbarButton("Table",FCKLang.InsertTableLbl,FCKLang.InsertTable,null,false,true,39);break;case"SpecialChar":b=new FCKToolbarButton("SpecialChar",FCKLang.InsertSpecialCharLbl,FCKLang.InsertSpecialChar,null,false,true,42);break;case"Smiley":b=new FCKToolbarButton("Smiley",FCKLang.InsertSmileyLbl,FCKLang.InsertSmiley,null,false,true,41);break;case"PageBreak":b=new FCKToolbarButton("PageBreak",FCKLang.PageBreakLbl,FCKLang.PageBreak,null,false,true,43);break;case"Rule":b=new FCKToolbarButton("Rule",FCKLang.InsertLineLbl,FCKLang.InsertLine,null,false,true,40);break;case"JustifyLeft":b=new FCKToolbarButton("JustifyLeft",FCKLang.LeftJustify,null,null,false,true,30);break;case"JustifyCenter":b=new FCKToolbarButton("JustifyCenter",FCKLang.CenterJustify,null,null,false,true,31);break;case"JustifyRight":b=new FCKToolbarButton("JustifyRight",FCKLang.RightJustify,null,null,false,true,32);break;case"JustifyFull":b=new FCKToolbarButton("JustifyFull",FCKLang.BlockJustify,null,null,false,true,33);break;case"Style":b=new FCKToolbarStyleCombo();break;case"FontName":b=new FCKToolbarFontsCombo();break;case"FontSize":b=new FCKToolbarFontSizeCombo();break;case"FontFormat":b=new FCKToolbarFontFormatCombo();break;case"TextColor":b=new FCKToolbarPanelButton("TextColor",FCKLang.TextColor,null,null,45);break;case"BGColor":b=new FCKToolbarPanelButton("BGColor",FCKLang.BGColor,null,null,46);break;case"Find":b=new FCKToolbarButton("Find",FCKLang.Find,null,null,null,null,16);break;case"Replace":b=new FCKToolbarButton("Replace",FCKLang.Replace,null,null,null,null,17);break;case"Form":b=new FCKToolbarButton("Form",FCKLang.Form,null,null,null,null,48);break;case"Checkbox":b=new FCKToolbarButton("Checkbox",FCKLang.Checkbox,null,null,null,null,49);break;case"Radio":b=new FCKToolbarButton("Radio",FCKLang.RadioButton,null,null,null,null,50);break;case"TextField":b=new FCKToolbarButton("TextField",FCKLang.TextField,null,null,null,null,51);break;case"Textarea":b=new FCKToolbarButton("Textarea",FCKLang.Textarea,null,null,null,null,52);break;case"HiddenField":b=new FCKToolbarButton("HiddenField",FCKLang.HiddenField,null,null,null,null,56);break;case"Button":b=new FCKToolbarButton("Button",FCKLang.Button,null,null,null,null,54);break;case"Select":b=new FCKToolbarButton("Select",FCKLang.SelectionField,null,null,null,null,53);break;case"ImageButton":b=new FCKToolbarButton("ImageButton",FCKLang.ImageButton,null,null,null,null,55);break;case"ShowBlocks":b=new FCKToolbarButton("ShowBlocks",FCKLang.ShowBlocks,null,null,null,true,72);break;case"SpellCheck":if(FCKConfig.SpellChecker=="SCAYT"){b=FCKScayt.CreateToolbarItem();}else{b=new FCKToolbarButton("SpellCheck",FCKLang.SpellCheck,null,null,null,null,13);}break;default:alert(FCKLang.UnknownToolbarItem.replace(/%1/g,a));return null;}FCKToolbarItems.LoadedItems[a]=b;return b;};var FCKToolbar=function(){this.Items=[];};FCKToolbar.prototype.AddItem=function(a){return this.Items[this.Items.length]=a;};FCKToolbar.prototype.AddButton=function(a,h,g,f,d,c){if(typeof(f)=="number"){f=[this.DefaultIconsStrip,this.DefaultIconSize,f];}var b=new FCKToolbarButtonUI(a,h,g,f,d,c);b._FCKToolbar=this;b.OnClick=FCKToolbar_OnItemClick;return this.AddItem(b);};function FCKToolbar_OnItemClick(a){var b=a._FCKToolbar;if(b.OnItemClick){b.OnItemClick(b,a);}}FCKToolbar.prototype.AddSeparator=function(){this.AddItem(new FCKToolbarSeparator());};FCKToolbar.prototype.Create=function(a){var g=FCKTools.GetElementDocument(a);var d=g.createElement("table");d.className="TB_Toolbar";d.style.styleFloat=d.style.cssFloat=(FCKLang.Dir=="ltr"?"left":"right");d.dir=FCKLang.Dir;d.cellPadding=0;d.cellSpacing=0;var f=d.insertRow(-1);var c;if(!this.HideStart){c=f.insertCell(-1);c.appendChild(g.createElement("div")).className="TB_Start";}for(var b=0;b<this.Items.length;b++){this.Items[b].Create(f.insertCell(-1));}if(!this.HideEnd){c=f.insertCell(-1);c.appendChild(g.createElement("div")).className="TB_End";}a.appendChild(d);};var FCKToolbarSeparator=function(){};FCKToolbarSeparator.prototype.Create=function(a){FCKTools.AppendElement(a,"div").className="TB_Separator";};var FCKToolbarBreak=function(){};FCKToolbarBreak.prototype.Create=function(a){var b=a.ownerDocument.createElement("div");b.style.clear=b.style.cssFloat=FCKLang.Dir=="rtl"?"right":"left";a.appendChild(b);};function FCKToolbarSet_Create(A){var B;var C=A||FCKConfig.ToolbarLocation;switch(C){case"In":document.getElementById("xToolbarRow").style.display="";B=new FCKToolbarSet(document);break;case"None":B=new FCKToolbarSet(document);break;default:FCK.Events.AttachEvent("OnBlur",FCK_OnBlur);FCK.Events.AttachEvent("OnFocus",FCK_OnFocus);var D;var E=C.match(/^Out:(.+)\((\w+)\)$/);if(E){if(FCKBrowserInfo.IsAIR){FCKAdobeAIR.ToolbarSet_GetOutElement(window,E);}else{D=eval("parent."+E[1]).document.getElementById(E[2]);}}else{E=C.match(/^Out:(\w+)$/);if(E){D=parent.document.getElementById(E[1]);}}if(!D){alert('Invalid value for "ToolbarLocation"');return arguments.callee("In");}B=D.__FCKToolbarSet;if(B){break;}var F=FCKTools.GetElementDocument(D).createElement("iframe");F.src="javascript:void(0)";F.frameBorder=0;F.width="100%";F.height="10";D.appendChild(F);F.unselectable="on";var G=F.contentWindow.document;var H="";if(FCKBrowserInfo.IsSafari){H='<base href="'+window.document.location+'">';}G.open();G.write("<html><head>"+H+'<script type="text/javascript"> var adjust = function() { window.frameElement.height = document.body.scrollHeight ; }; window.onresize = window.onload = function(){var timer = null;var lastHeight = -1;var lastChange = 0;var poller = function(){var currentHeight = document.body.scrollHeight || 0;var currentTime = (new Date()).getTime();if (currentHeight != lastHeight){lastChange = currentTime;adjust();lastHeight = document.body.scrollHeight;}if (lastChange < currentTime - 1000) clearInterval(timer);};timer = setInterval(poller, 100);}<\/script></head><body style="overflow: hidden">'+document.getElementById("xToolbarSpace").innerHTML+"</body></html>");G.close();if(FCKBrowserInfo.IsAIR){FCKAdobeAIR.ToolbarSet_InitOutFrame(G);}FCKTools.AddEventListener(G,"contextmenu",FCKTools.CancelEvent);FCKTools.AppendStyleSheet(G,FCKConfig.SkinEditorCSS);B=D.__FCKToolbarSet=new FCKToolbarSet(G);B._IFrame=F;if(FCK.IECleanup){FCK.IECleanup.AddItem(D,FCKToolbarSet_Target_Cleanup);}}B.CurrentInstance=FCK;if(!B.ToolbarItems){B.ToolbarItems=FCKToolbarItems;}FCK.AttachToOnSelectionChange(B.RefreshItemsState);return B;}function FCK_OnBlur(a){var b=a.ToolbarSet;if(b.CurrentInstance==a){b.Disable();}}function FCK_OnFocus(a){var c=a.ToolbarSet;var b=a||FCK;c.CurrentInstance.FocusManager.RemoveWindow(c._IFrame.contentWindow);c.CurrentInstance=b;b.FocusManager.AddWindow(c._IFrame.contentWindow,true);c.Enable();}function FCKToolbarSet_Cleanup(){this._TargetElement=null;this._IFrame=null;}function FCKToolbarSet_Target_Cleanup(){this.__FCKToolbarSet=null;}var FCKToolbarSet=function(a){this._Document=a;this._TargetElement=a.getElementById("xToolbar");var c=a.getElementById("xExpandHandle");var b=a.getElementById("xCollapseHandle");c.title=FCKLang.ToolbarExpand;FCKTools.AddEventListener(c,"click",FCKToolbarSet_Expand_OnClick);b.title=FCKLang.ToolbarCollapse;FCKTools.AddEventListener(b,"click",FCKToolbarSet_Collapse_OnClick);if(!FCKConfig.ToolbarCanCollapse||FCKConfig.ToolbarStartExpanded){this.Expand();}else{this.Collapse();}b.style.display=FCKConfig.ToolbarCanCollapse?"":"none";if(FCKConfig.ToolbarCanCollapse){b.style.display="";}else{a.getElementById("xTBLeftBorder").style.display="";}this.Toolbars=[];this.IsLoaded=false;if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKToolbarSet_Cleanup);}};function FCKToolbarSet_Expand_OnClick(){FCK.ToolbarSet.Expand();}function FCKToolbarSet_Collapse_OnClick(){FCK.ToolbarSet.Collapse();}FCKToolbarSet.prototype.Expand=function(){this._ChangeVisibility(false);};FCKToolbarSet.prototype.Collapse=function(){this._ChangeVisibility(true);};FCKToolbarSet.prototype._ChangeVisibility=function(a){this._Document.getElementById("xCollapsed").style.display=a?"":"none";this._Document.getElementById("xExpanded").style.display=a?"none":"";if(window.onresize){FCKTools.RunFunction(window.onresize);}};FCKToolbarSet.prototype.Load=function(b){this.Name=b;this.Items=[];this.ItemsWysiwygOnly=[];this.ItemsContextSensitive=[];this._TargetElement.innerHTML="";var i=FCKConfig.ToolbarSets[b];if(!i){alert(FCKLang.UnknownToolbarSet.replace(/%1/g,b));return;}this.Toolbars=[];for(var a=0;a<i.length;a++){var h=i[a];if(!h){continue;}var g;if(typeof(h)=="string"){if(h=="/"){g=new FCKToolbarBreak();}}else{g=new FCKToolbar();for(var c=0;c<h.length;c++){var f=h[c];if(f=="-"){g.AddSeparator();}else{var d=FCKToolbarItems.GetItem(f);if(d){g.AddItem(d);this.Items.push(d);if(!d.SourceView){this.ItemsWysiwygOnly.push(d);}if(d.ContextSensitive){this.ItemsContextSensitive.push(d);}}}}}g.Create(this._TargetElement);this.Toolbars[this.Toolbars.length]=g;}FCKTools.DisableSelection(this._Document.getElementById("xCollapseHandle").parentNode);if(FCK.Status!=2){FCK.Events.AttachEvent("OnStatusChange",this.RefreshModeState);}else{this.RefreshModeState();}this.IsLoaded=true;this.IsEnabled=true;FCKTools.RunFunction(this.OnLoad);};FCKToolbarSet.prototype.Enable=function(){if(this.IsEnabled){return;}this.IsEnabled=true;var a=this.Items;for(var b=0;b<a.length;b++){a[b].RefreshState();}};FCKToolbarSet.prototype.Disable=function(){if(!this.IsEnabled){return;}this.IsEnabled=false;var a=this.Items;for(var b=0;b<a.length;b++){a[b].Disable();}};FCKToolbarSet.prototype.RefreshModeState=function(a){if(FCK.Status!=2){return;}var f=a?a.ToolbarSet:this;var d=f.ItemsWysiwygOnly;if(FCK.EditMode==0){for(var c=0;c<d.length;c++){d[c].Enable();}f.RefreshItemsState(a);}else{f.RefreshItemsState(a);for(var b=0;b<d.length;b++){d[b].Disable();}}};FCKToolbarSet.prototype.RefreshItemsState=function(a){var c=(a?a.ToolbarSet:this).ItemsContextSensitive;for(var b=0;b<c.length;b++){c[b].RefreshState();}};var FCKDialog=(function(){var a;var i;var h;var g=window.parent;while(g.parent&&g.parent!=g){try{if(g.parent.document.domain!=document.domain){break;}if(g.parent.document.getElementsByTagName("frameset").length>0){break;}}catch(f){break;}g=g.parent;}var d=g.document;var c=function(){if(!i){i=FCKConfig.FloatingPanelsZIndex+999;}return ++i;};var b=function(){if(!h){return;}var j=FCKTools.IsStrictMode(d)?d.documentElement:d.body;FCKDomTools.SetElementStyles(h,{"width":Math.max(j.scrollWidth,j.clientWidth,d.scrollWidth||0)-1+"px","height":Math.max(j.scrollHeight,j.clientHeight,d.scrollHeight||0)-1+"px"});};return{OpenDialog:function(m,j,x,l,y,n,k){if(!a){this.DisplayMainCover();}var v={Title:j,Page:x,Editor:window,CustomValue:n,TopWindow:g};FCK.ToolbarSet.CurrentInstance.Selection.Save(true);var u=FCKTools.GetViewPaneSize(g);var t={"X":0,"Y":0};var r=FCKBrowserInfo.IsIE&&(!FCKBrowserInfo.IsIE7||!FCKTools.IsStrictMode(g.document));if(r){t=FCKTools.GetScrollPosition(g);}var q=Math.max(t.Y+(u.Height-y-20)/2,0);var p=Math.max(t.X+(u.Width-l-20)/2,0);var o=d.createElement("iframe");FCKTools.ResetStyles(o);o.src=FCKConfig.BasePath+"fckdialog.html";o.frameBorder=0;o.allowTransparency=true;FCKDomTools.SetElementStyles(o,{"position":(r)?"absolute":"fixed","top":q+"px","left":p+"px","width":l+"px","height":y+"px","zIndex":c()});o._DialogArguments=v;d.body.appendChild(o);o._ParentDialog=a;a=o;},OnDialogClose:function(k){var j=k.frameElement;FCKDomTools.RemoveNode(j);if(j._ParentDialog){a=j._ParentDialog;j._ParentDialog.contentWindow.SetEnabled(true);}else{if(!FCKBrowserInfo.IsIE){FCK.Focus();}this.HideMainCover();setTimeout(function(){a=null;},0);FCK.ToolbarSet.CurrentInstance.Selection.Release();}},DisplayMainCover:function(){h=d.createElement("div");FCKTools.ResetStyles(h);FCKDomTools.SetElementStyles(h,{"position":"absolute","zIndex":c(),"top":"0px","left":"0px","backgroundColor":FCKConfig.BackgroundBlockerColor});FCKDomTools.SetOpacity(h,FCKConfig.BackgroundBlockerOpacity);if(FCKBrowserInfo.IsIE&&!FCKBrowserInfo.IsIE7){var k=d.createElement("iframe");FCKTools.ResetStyles(k);k.hideFocus=true;k.frameBorder=0;k.src=FCKTools.GetVoidUrl();FCKDomTools.SetElementStyles(k,{"width":"100%","height":"100%","position":"absolute","left":"0px","top":"0px","filter":"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});h.appendChild(k);}FCKTools.AddEventListener(g,"resize",b);b();d.body.appendChild(h);FCKFocusManager.Lock();var j=FCK.ToolbarSet.CurrentInstance.GetInstanceObject("frameElement");j._fck_originalTabIndex=j.tabIndex;j.tabIndex=-1;},HideMainCover:function(){FCKDomTools.RemoveNode(h);FCKFocusManager.Unlock();var j=FCK.ToolbarSet.CurrentInstance.GetInstanceObject("frameElement");j.tabIndex=j._fck_originalTabIndex;FCKDomTools.ClearElementJSProperty(j,"_fck_originalTabIndex");},GetCover:function(){return h;}};})();var FCKMenuItem=function(a,g,f,d,c,b){this.Name=g;this.Label=f||g;this.IsDisabled=c;this.Icon=new FCKIcon(d);this.SubMenu=new FCKMenuBlockPanel();this.SubMenu.Parent=a;this.SubMenu.OnClick=FCKTools.CreateEventListener(FCKMenuItem_SubMenu_OnClick,this);this.CustomData=b;if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKMenuItem_Cleanup);}};FCKMenuItem.prototype.AddItem=function(a,f,d,c,b){this.HasSubMenu=true;return this.SubMenu.AddItem(a,f,d,c,b);};FCKMenuItem.prototype.AddSeparator=function(){this.SubMenu.AddSeparator();};FCKMenuItem.prototype.Create=function(a){var g=this.HasSubMenu;var f=FCKTools.GetElementDocument(a);var b=this.MainElement=a.insertRow(-1);b.className=this.IsDisabled?"MN_Item_Disabled":"MN_Item";if(!this.IsDisabled){FCKTools.AddEventListenerEx(b,"mouseover",FCKMenuItem_OnMouseOver,[this]);FCKTools.AddEventListenerEx(b,"click",FCKMenuItem_OnClick,[this]);if(!g){FCKTools.AddEventListenerEx(b,"mouseout",FCKMenuItem_OnMouseOut,[this]);}}var d=b.insertCell(-1);d.className="MN_Icon";d.appendChild(this.Icon.CreateIconElement(f));d=b.insertCell(-1);d.className="MN_Label";d.noWrap=true;d.appendChild(f.createTextNode(this.Label));d=b.insertCell(-1);if(g){d.className="MN_Arrow";var c=d.appendChild(f.createElement("IMG"));c.src=FCK_IMAGES_PATH+"arrow_"+FCKLang.Dir+".gif";c.width=4;c.height=7;this.SubMenu.Create();this.SubMenu.Panel.OnHide=FCKTools.CreateEventListener(FCKMenuItem_SubMenu_OnHide,this);}};FCKMenuItem.prototype.Activate=function(){this.MainElement.className="MN_Item_Over";if(this.HasSubMenu){this.SubMenu.Show(this.MainElement.offsetWidth+2,-2,this.MainElement);}FCKTools.RunFunction(this.OnActivate,this);};FCKMenuItem.prototype.Deactivate=function(){this.MainElement.className="MN_Item";if(this.HasSubMenu){this.SubMenu.Hide();}};function FCKMenuItem_SubMenu_OnClick(a,b){FCKTools.RunFunction(b.OnClick,b,[a]);}function FCKMenuItem_SubMenu_OnHide(a){a.Deactivate();}function FCKMenuItem_OnClick(a,b){if(b.HasSubMenu){b.Activate();}else{b.Deactivate();FCKTools.RunFunction(b.OnClick,b,[b]);}}function FCKMenuItem_OnMouseOver(a,b){b.Activate();}function FCKMenuItem_OnMouseOut(a,b){b.Deactivate();}function FCKMenuItem_Cleanup(){this.MainElement=null;}var FCKMenuBlock=function(){this._Items=[];};FCKMenuBlock.prototype.Count=function(){return this._Items.length;};FCKMenuBlock.prototype.AddItem=function(a,g,f,d,c){var b=new FCKMenuItem(this,a,g,f,d,c);b.OnClick=FCKTools.CreateEventListener(FCKMenuBlock_Item_OnClick,this);b.OnActivate=FCKTools.CreateEventListener(FCKMenuBlock_Item_OnActivate,this);this._Items.push(b);return b;};FCKMenuBlock.prototype.AddSeparator=function(){this._Items.push(new FCKMenuSeparator());};FCKMenuBlock.prototype.RemoveAllItems=function(){this._Items=[];var a=this._ItemsTable;if(a){while(a.rows.length>0){a.deleteRow(0);}}};FCKMenuBlock.prototype.Create=function(a){if(!this._ItemsTable){if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKMenuBlock_Cleanup);}this._Window=FCKTools.GetElementWindow(a);var g=FCKTools.GetElementDocument(a);var f=a.appendChild(g.createElement("table"));f.cellPadding=0;f.cellSpacing=0;FCKTools.DisableSelection(f);var d=f.insertRow(-1).insertCell(-1);d.className="MN_Menu";var c=this._ItemsTable=d.appendChild(g.createElement("table"));c.cellPadding=0;c.cellSpacing=0;}for(var b=0;b<this._Items.length;b++){this._Items[b].Create(this._ItemsTable);}};function FCKMenuBlock_Item_OnClick(a,b){if(b.Hide){b.Hide();}FCKTools.RunFunction(b.OnClick,b,[a]);}function FCKMenuBlock_Item_OnActivate(a){var b=a._ActiveItem;if(b&&b!=this){if(!FCKBrowserInfo.IsIE&&b.HasSubMenu&&!this.HasSubMenu){a._Window.focus();a.Panel.HasFocus=true;}b.Deactivate();}a._ActiveItem=this;}function FCKMenuBlock_Cleanup(){this._Window=null;this._ItemsTable=null;}var FCKMenuSeparator=function(){};FCKMenuSeparator.prototype.Create=function(a){var d=FCKTools.GetElementDocument(a);var b=a.insertRow(-1);var c=b.insertCell(-1);c.className="MN_Separator MN_Icon";c=b.insertCell(-1);c.className="MN_Separator";c.appendChild(d.createElement("DIV")).className="MN_Separator_Line";c=b.insertCell(-1);c.className="MN_Separator";c.appendChild(d.createElement("DIV")).className="MN_Separator_Line";};var FCKMenuBlockPanel=function(){FCKMenuBlock.call(this);};FCKMenuBlockPanel.prototype=new FCKMenuBlock();FCKMenuBlockPanel.prototype.Create=function(){var a=this.Panel=(this.Parent&&this.Parent.Panel?this.Parent.Panel.CreateChildPanel():new FCKPanel());a.AppendStyleSheet(FCKConfig.SkinEditorCSS);FCKMenuBlock.prototype.Create.call(this,a.MainNode);};FCKMenuBlockPanel.prototype.Show=function(b,c,a){if(!this.Panel.CheckIsOpened()){this.Panel.Show(b,c,a);}};FCKMenuBlockPanel.prototype.Hide=function(){if(this.Panel.CheckIsOpened()){this.Panel.Hide();}};var FCKContextMenu=function(a,d){this.CtrlDisable=false;var c=this._Panel=new FCKPanel(a);c.AppendStyleSheet(FCKConfig.SkinEditorCSS);c.IsContextMenu=true;if(FCKBrowserInfo.IsGecko){c.Document.addEventListener("draggesture",function(f){f.preventDefault();return false;},true);}var b=this._MenuBlock=new FCKMenuBlock();b.Panel=c;b.OnClick=FCKTools.CreateEventListener(FCKContextMenu_MenuBlock_OnClick,this);this._Redraw=true;};FCKContextMenu.prototype.SetMouseClickWindow=function(a){if(!FCKBrowserInfo.IsIE){this._Document=a.document;if(FCKBrowserInfo.IsOpera&&!("oncontextmenu" in document.createElement("foo"))){this._Document.addEventListener("mousedown",FCKContextMenu_Document_OnMouseDown,false);this._Document.addEventListener("mouseup",FCKContextMenu_Document_OnMouseUp,false);}this._Document.addEventListener("contextmenu",FCKContextMenu_Document_OnContextMenu,false);}};FCKContextMenu.prototype.AddItem=function(a,g,f,d,c){var b=this._MenuBlock.AddItem(a,g,f,d,c);this._Redraw=true;return b;};FCKContextMenu.prototype.AddSeparator=function(){this._MenuBlock.AddSeparator();this._Redraw=true;};FCKContextMenu.prototype.RemoveAllItems=function(){this._MenuBlock.RemoveAllItems();this._Redraw=true;};FCKContextMenu.prototype.AttachToElement=function(a){if(FCKBrowserInfo.IsIE){FCKTools.AddEventListenerEx(a,"contextmenu",FCKContextMenu_AttachedElement_OnContextMenu,this);}else{a._FCKContextMenu=this;}};function FCKContextMenu_Document_OnContextMenu(b){if(FCKConfig.BrowserContextMenu){return true;}var a=b.target;while(a){if(a._FCKContextMenu){if(a._FCKContextMenu.CtrlDisable&&(b.ctrlKey||b.metaKey)){return true;}FCKTools.CancelEvent(b);FCKContextMenu_AttachedElement_OnContextMenu(b,a._FCKContextMenu,a);return false;}a=a.parentNode;}return true;}var FCKContextMenu_OverrideButton;function FCKContextMenu_Document_OnMouseDown(c){if(!c||c.button!=2){return false;}if(FCKConfig.BrowserContextMenu){return true;}var a=c.target;while(a){if(a._FCKContextMenu){if(a._FCKContextMenu.CtrlDisable&&(c.ctrlKey||c.metaKey)){return true;}var f=FCKContextMenu_OverrideButton;if(!f){var d=FCKTools.GetElementDocument(c.target);f=FCKContextMenu_OverrideButton=d.createElement("input");f.type="button";var b=d.createElement("p");d.body.appendChild(b);b.appendChild(f);}f.style.cssText="position:absolute;top:"+(c.clientY-2)+"px;left:"+(c.clientX-2)+"px;width:5px;height:5px;opacity:0.01";}a=a.parentNode;}return false;}function FCKContextMenu_Document_OnMouseUp(b){if(FCKConfig.BrowserContextMenu){return true;}var a=FCKContextMenu_OverrideButton;if(a){var c=a.parentNode;c.parentNode.removeChild(c);FCKContextMenu_OverrideButton=undefined;if(b&&b.button==2){FCKContextMenu_Document_OnContextMenu(b);return false;}}return true;}function FCKContextMenu_AttachedElement_OnContextMenu(b,g,d){if((g.CtrlDisable&&(b.ctrlKey||b.metaKey))||FCKConfig.BrowserContextMenu){return true;}var c=d||this;if(g.OnBeforeOpen){g.OnBeforeOpen.call(g,c);}if(g._MenuBlock.Count()==0){return false;}if(g._Redraw){g._MenuBlock.Create(g._Panel.MainNode);g._Redraw=false;}FCKTools.DisableSelection(g._Panel.Document.body);var a=0;var f=0;if(FCKBrowserInfo.IsIE){a=b.screenX;f=b.screenY;}else{if(FCKBrowserInfo.IsSafari){a=b.clientX;f=b.clientY;}else{a=b.pageX;f=b.pageY;}}g._Panel.Show(a,f,b.currentTarget||null);return false;}function FCKContextMenu_MenuBlock_OnClick(a,b){b._Panel.Hide();FCKTools.RunFunction(b.OnItemClick,b,a);}FCK.ContextMenu={};FCK.ContextMenu.Listeners=[];FCK.ContextMenu.RegisterListener=function(a){if(a){this.Listeners.push(a);}};function FCK_ContextMenu_Init(){var a=FCK.ContextMenu._InnerContextMenu=new FCKContextMenu(FCKBrowserInfo.IsIE?window:window.parent,FCKLang.Dir);a.CtrlDisable=FCKConfig.BrowserContextMenuOnCtrl;a.OnBeforeOpen=FCK_ContextMenu_OnBeforeOpen;a.OnItemClick=FCK_ContextMenu_OnItemClick;var c=FCK.ContextMenu;for(var b=0;b<FCKConfig.ContextMenu.length;b++){c.RegisterListener(FCK_ContextMenu_GetListener(FCKConfig.ContextMenu[b]));}}function FCK_ContextMenu_GetListener(a){switch(a){case"Generic":return{AddItems:function(d,b,c){d.AddItem("Cut",FCKLang.Cut,7,FCKCommands.GetCommand("Cut").GetState()==-1);d.AddItem("Copy",FCKLang.Copy,8,FCKCommands.GetCommand("Copy").GetState()==-1);d.AddItem("Paste",FCKLang.Paste,9,FCKCommands.GetCommand("Paste").GetState()==-1);}};case"Table":return{AddItems:function(g,b,c){var h=(c=="TABLE");var f=(!h&&FCKSelection.HasAncestorNode("TABLE"));if(f){g.AddSeparator();var d=g.AddItem("Cell",FCKLang.CellCM);d.AddItem("TableInsertCellBefore",FCKLang.InsertCellBefore,69);d.AddItem("TableInsertCellAfter",FCKLang.InsertCellAfter,58);d.AddItem("TableDeleteCells",FCKLang.DeleteCells,59);if(FCKBrowserInfo.IsGecko){d.AddItem("TableMergeCells",FCKLang.MergeCells,60,FCKCommands.GetCommand("TableMergeCells").GetState()==-1);}else{d.AddItem("TableMergeRight",FCKLang.MergeRight,60,FCKCommands.GetCommand("TableMergeRight").GetState()==-1);d.AddItem("TableMergeDown",FCKLang.MergeDown,60,FCKCommands.GetCommand("TableMergeDown").GetState()==-1);}d.AddItem("TableHorizontalSplitCell",FCKLang.HorizontalSplitCell,61,FCKCommands.GetCommand("TableHorizontalSplitCell").GetState()==-1);d.AddItem("TableVerticalSplitCell",FCKLang.VerticalSplitCell,61,FCKCommands.GetCommand("TableVerticalSplitCell").GetState()==-1);d.AddSeparator();d.AddItem("TableCellProp",FCKLang.CellProperties,57,FCKCommands.GetCommand("TableCellProp").GetState()==-1);g.AddSeparator();d=g.AddItem("Row",FCKLang.RowCM);d.AddItem("TableInsertRowBefore",FCKLang.InsertRowBefore,70);d.AddItem("TableInsertRowAfter",FCKLang.InsertRowAfter,62);d.AddItem("TableDeleteRows",FCKLang.DeleteRows,63);g.AddSeparator();d=g.AddItem("Column",FCKLang.ColumnCM);d.AddItem("TableInsertColumnBefore",FCKLang.InsertColumnBefore,71);d.AddItem("TableInsertColumnAfter",FCKLang.InsertColumnAfter,64);d.AddItem("TableDeleteColumns",FCKLang.DeleteColumns,65);}if(h||f){g.AddSeparator();g.AddItem("TableDelete",FCKLang.TableDelete);g.AddItem("TableProp",FCKLang.TableProperties,39);}}};case"Link":return{AddItems:function(h,b,c){var g=(c=="A"||FCKSelection.HasAncestorNode("A"));if(g||FCK.GetNamedCommandState("Unlink")!=-1){var f=FCKSelection.MoveToAncestorNode("A");var d=(f&&f.name.length>0&&f.href.length==0);if(d){return;}h.AddSeparator();h.AddItem("VisitLink",FCKLang.VisitLink);h.AddSeparator();if(g){h.AddItem("Link",FCKLang.EditLink,34);}h.AddItem("Unlink",FCKLang.RemoveLink,35);}}};case"Image":return{AddItems:function(d,b,c){if(c=="IMG"&&!b.getAttribute("_fckfakelement")){d.AddSeparator();d.AddItem("Image",FCKLang.ImageProperties,37);}}};case"Anchor":return{AddItems:function(g,b,c){var f=FCKSelection.MoveToAncestorNode("A");var d=(f&&f.name.length>0);if(d||(c=="IMG"&&b.getAttribute("_fckanchor"))){g.AddSeparator();g.AddItem("Anchor",FCKLang.AnchorProp,36);g.AddItem("AnchorDelete",FCKLang.AnchorDelete);}}};case"Flash":return{AddItems:function(d,b,c){if(c=="IMG"&&b.getAttribute("_fckflash")){d.AddSeparator();d.AddItem("Flash",FCKLang.FlashProperties,38);}}};case"Form":return{AddItems:function(d,b,c){if(FCKSelection.HasAncestorNode("FORM")){d.AddSeparator();d.AddItem("Form",FCKLang.FormProp,48);}}};case"Checkbox":return{AddItems:function(d,b,c){if(c=="INPUT"&&b.type=="checkbox"){d.AddSeparator();d.AddItem("Checkbox",FCKLang.CheckboxProp,49);}}};case"Radio":return{AddItems:function(d,b,c){if(c=="INPUT"&&b.type=="radio"){d.AddSeparator();d.AddItem("Radio",FCKLang.RadioButtonProp,50);}}};case"TextField":return{AddItems:function(d,b,c){if(c=="INPUT"&&(b.type=="text"||b.type=="password")){d.AddSeparator();d.AddItem("TextField",FCKLang.TextFieldProp,51);}}};case"HiddenField":return{AddItems:function(d,b,c){if(c=="IMG"&&b.getAttribute("_fckinputhidden")){d.AddSeparator();d.AddItem("HiddenField",FCKLang.HiddenFieldProp,56);}}};case"ImageButton":return{AddItems:function(d,b,c){if(c=="INPUT"&&b.type=="image"){d.AddSeparator();d.AddItem("ImageButton",FCKLang.ImageButtonProp,55);}}};case"Button":return{AddItems:function(d,b,c){if(c=="INPUT"&&(b.type=="button"||b.type=="submit"||b.type=="reset")){d.AddSeparator();d.AddItem("Button",FCKLang.ButtonProp,54);}}};case"Select":return{AddItems:function(d,b,c){if(c=="SELECT"){d.AddSeparator();d.AddItem("Select",FCKLang.SelectionFieldProp,53);}}};case"Textarea":return{AddItems:function(d,b,c){if(c=="TEXTAREA"){d.AddSeparator();d.AddItem("Textarea",FCKLang.TextareaProp,52);}}};case"BulletedList":return{AddItems:function(d,b,c){if(FCKSelection.HasAncestorNode("UL")){d.AddSeparator();d.AddItem("BulletedList",FCKLang.BulletedListProp,27);}}};case"NumberedList":return{AddItems:function(d,b,c){if(FCKSelection.HasAncestorNode("OL")){d.AddSeparator();d.AddItem("NumberedList",FCKLang.NumberedListProp,26);}}};case"DivContainer":return{AddItems:function(f,b,d){var c=FCKDomTools.GetSelectedDivContainers();if(c.length>0){f.AddSeparator();f.AddItem("EditDiv",FCKLang.EditDiv,75);f.AddItem("DeleteDiv",FCKLang.DeleteDiv,76);}}};}return null;}function FCK_ContextMenu_OnBeforeOpen(){FCK.Events.FireEvent("OnSelectionChange");var a,b;if((a=FCKSelection.GetSelectedElement())){b=a.tagName;}var f=FCK.ContextMenu._InnerContextMenu;f.RemoveAllItems();var d=FCK.ContextMenu.Listeners;for(var c=0;c<d.length;c++){d[c].AddItems(f,a,b);}}function FCK_ContextMenu_OnItemClick(a){if(!FCKBrowserInfo.IsIE){FCK.Focus();}FCKCommands.GetCommand(a.Name).Execute(a.CustomData);}var FCKHtmlIterator=function(a){this._sourceHtml=a;};FCKHtmlIterator.prototype={Next:function(){var a=this._sourceHtml;if(a==null){return null;}var d=FCKRegexLib.HtmlTag.exec(a);var c=false;var b="";if(d){if(d.index>0){b=a.substr(0,d.index);this._sourceHtml=a.substr(d.index);}else{c=true;b=d[0];this._sourceHtml=a.substr(d[0].length);}}else{b=a;this._sourceHtml=null;}return{"isTag":c,"value":b};},Each:function(a){var b;while((b=this.Next())){a(b.isTag,b.value);}}};var FCKHtmlIterator=function(a){this._sourceHtml=a;};FCKHtmlIterator.prototype={Next:function(){var a=this._sourceHtml;if(a==null){return null;}var d=FCKRegexLib.HtmlTag.exec(a);var c=false;var b="";if(d){if(d.index>0){b=a.substr(0,d.index);this._sourceHtml=a.substr(d.index);}else{c=true;b=d[0];this._sourceHtml=a.substr(d[0].length);}}else{b=a;this._sourceHtml=null;}return{"isTag":c,"value":b};},Each:function(a){var b;while((b=this.Next())){a(b.isTag,b.value);}}};var FCKPlugin=function(a,c,b){this.Name=a;this.BasePath=b?b:FCKConfig.PluginsPath;this.Path=this.BasePath+a+"/";if(!c||c.length==0){this.AvailableLangs=[];}else{this.AvailableLangs=c.split(",");}};FCKPlugin.prototype.Load=function(){if(this.AvailableLangs.length>0){var a;if(this.AvailableLangs.IndexOf(FCKLanguageManager.ActiveLanguage.Code)>=0){a=FCKLanguageManager.ActiveLanguage.Code;}else{a=this.AvailableLangs[0];}LoadScript(this.Path+"lang/"+a+".js");}LoadScript(this.Path+"fckplugin.js");};var FCKPlugins=FCK.Plugins={};FCKPlugins.ItemsCount=0;FCKPlugins.Items={};FCKPlugins.Load=function(){var a=FCKPlugins.Items;for(var b=0;b<FCKConfig.Plugins.Items.length;b++){var f=FCKConfig.Plugins.Items[b];var d=a[f[0]]=new FCKPlugin(f[0],f[1],f[2]);FCKPlugins.ItemsCount++;}for(var c in a){a[c].Load();}FCKPlugins.Load=null;};