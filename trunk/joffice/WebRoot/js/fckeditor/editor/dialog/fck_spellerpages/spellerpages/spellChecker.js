function spellChecker(a){this.popUpUrl="fck_spellerpages/spellerpages/spellchecker.html";this.popUpName="spellchecker";this.popUpProps=null;this.replWordFlag="R";this.ignrWordFlag="I";this.replAllFlag="RA";this.ignrAllFlag="IA";this.fromReplAll="~RA";this.fromIgnrAll="~IA";this.wordFlags=new Array();this.currentTextIndex=0;this.currentWordIndex=0;this.spellCheckerWin=null;this.controlWin=null;this.wordWin=null;this.textArea=a;this.textInputs=arguments;this._spellcheck=_spellcheck;this._getSuggestions=_getSuggestions;this._setAsIgnored=_setAsIgnored;this._getTotalReplaced=_getTotalReplaced;this._setWordText=_setWordText;this._getFormInputs=_getFormInputs;this.openChecker=openChecker;this.startCheck=startCheck;this.checkTextBoxes=checkTextBoxes;this.checkTextAreas=checkTextAreas;this.spellCheckAll=spellCheckAll;this.ignoreWord=ignoreWord;this.ignoreAll=ignoreAll;this.replaceWord=replaceWord;this.replaceAll=replaceAll;this.terminateSpell=terminateSpell;this.undo=undo;window.speller=this;}function checkTextBoxes(){this.textInputs=this._getFormInputs("^text$");this.openChecker();}function checkTextAreas(){this.textInputs=this._getFormInputs("^textarea$");this.openChecker();}function spellCheckAll(){this.textInputs=this._getFormInputs("^text(area)?$");this.openChecker();}function openChecker(){this.spellCheckerWin=window.open(this.popUpUrl,this.popUpName,this.popUpProps);if(!this.spellCheckerWin.opener){this.spellCheckerWin.opener=window;}}function startCheck(a,c){this.wordWin=a;this.controlWin=c;this.wordWin.resetForm();this.controlWin.resetForm();this.currentTextIndex=0;this.currentWordIndex=0;this.wordFlags=new Array(this.wordWin.textInputs.length);for(var b=0;b<this.wordFlags.length;b++){this.wordFlags[b]=[];}this._spellcheck();return true;}function ignoreWord(){var a=this.currentWordIndex;var b=this.currentTextIndex;if(!this.wordWin){alert("Error: Word frame not available.");return false;}if(!this.wordWin.getTextVal(b,a)){alert('Error: "Not in dictionary" text is missing.');return false;}if(this._setAsIgnored(b,a,this.ignrWordFlag)){this.currentWordIndex++;this._spellcheck();}return true;}function ignoreAll(){var a=this.currentWordIndex;var d=this.currentTextIndex;if(!this.wordWin){alert("Error: Word frame not available.");return false;}var e=this.wordWin.getTextVal(d,a);if(!e){alert('Error: "Not in dictionary" text is missing');return false;}this._setAsIgnored(d,a,this.ignrAllFlag);for(var c=d;c<this.wordWin.textInputs.length;c++){for(var b=0;b<this.wordWin.totalWords(c);b++){if((c==d&&b>a)||c>d){if((this.wordWin.getTextVal(c,b)==e)&&(!this.wordFlags[c][b])){this._setAsIgnored(c,b,this.fromIgnrAll);}}}}this.currentWordIndex++;this._spellcheck();return true;}function replaceWord(){var b=this.currentWordIndex;var c=this.currentTextIndex;if(!this.wordWin){alert("Error: Word frame not available.");return false;}if(!this.wordWin.getTextVal(c,b)){alert('Error: "Not in dictionary" text is missing');return false;}if(!this.controlWin.replacementText){return false;}var a=this.controlWin.replacementText;if(a.value){var d=new String(a.value);if(this._setWordText(c,b,d,this.replWordFlag)){this.currentWordIndex++;this._spellcheck();}}return true;}function replaceAll(){var e=this.currentTextIndex;var b=this.currentWordIndex;if(!this.wordWin){alert("Error: Word frame not available.");return false;}var g=this.wordWin.getTextVal(e,b);if(!g){alert('Error: "Not in dictionary" text is missing');return false;}var a=this.controlWin.replacementText;if(!a.value){return false;}var f=new String(a.value);this._setWordText(e,b,f,this.replAllFlag);for(var d=e;d<this.wordWin.textInputs.length;d++){for(var c=0;c<this.wordWin.totalWords(d);c++){if((d==e&&c>b)||d>e){if((this.wordWin.getTextVal(d,c)==g)&&(!this.wordFlags[d][c])){this._setWordText(d,c,f,this.fromReplAll);}}}}this.currentWordIndex++;this._spellcheck();return true;}function terminateSpell(){var c="";var a=this._getTotalReplaced();if(a==0){if(!this.wordWin){c="";}else{if(this.wordWin.totalMisspellings()){c+=FCKLang.DlgSpellNoChanges;}else{c+=FCKLang.DlgSpellNoMispell;}}}else{if(a==1){c+=FCKLang.DlgSpellOneChange;}else{c+=FCKLang.DlgSpellManyChanges.replace(/%1/g,a);}}if(c){alert(c);}if(a>0){for(var b=0;b<this.textInputs.length;b++){if(this.wordWin){if(this.wordWin.textInputs[b]){this.textInputs[b].value=this.wordWin.textInputs[b];}}}}if(typeof(this.OnFinished)=="function"){this.OnFinished(a);}return true;}function undo(){var f=this.currentTextIndex;var b=this.currentWordIndex;if(this.wordWin.totalPreviousWords(f,b)>0){this.wordWin.removeFocus(f,b);do{if(this.currentWordIndex==0&&this.currentTextIndex>0){this.currentTextIndex--;this.currentWordIndex=this.wordWin.totalWords(this.currentTextIndex)-1;if(this.currentWordIndex<0){this.currentWordIndex=0;}}else{if(this.currentWordIndex>0){this.currentWordIndex--;}}}while(this.wordWin.totalWords(this.currentTextIndex)==0||this.wordFlags[this.currentTextIndex][this.currentWordIndex]==this.fromIgnrAll||this.wordFlags[this.currentTextIndex][this.currentWordIndex]==this.fromReplAll);var h=this.currentTextIndex;var a=this.currentWordIndex;var c=this.wordWin.originalSpellings[h][a];if(this.wordWin.totalPreviousWords(h,a)==0){this.controlWin.disableUndo();}var e,d,g;switch(this.wordFlags[h][a]){case this.replAllFlag:for(e=h;e<this.wordWin.textInputs.length;e++){for(d=0;d<this.wordWin.totalWords(e);d++){if((e==h&&d>=a)||e>h){g=this.wordWin.originalSpellings[e][d];if(g==c){this._setWordText(e,d,g,undefined);}}}}break;case this.ignrAllFlag:for(e=h;e<this.wordWin.textInputs.length;e++){for(d=0;d<this.wordWin.totalWords(e);d++){if((e==h&&d>=a)||e>h){g=this.wordWin.originalSpellings[e][d];if(g==c){this.wordFlags[e][d]=undefined;}}}}break;case this.replWordFlag:this._setWordText(h,a,c,undefined);break;}this.wordFlags[h][a]=undefined;this._spellcheck();}}function _spellcheck(){var b=this.wordWin;if(this.currentWordIndex==b.totalWords(this.currentTextIndex)){this.currentTextIndex++;this.currentWordIndex=0;if(this.currentTextIndex<this.wordWin.textInputs.length){this._spellcheck();return;}else{this.terminateSpell();return;}}if(this.currentWordIndex>0){this.controlWin.enableUndo();}if(this.wordFlags[this.currentTextIndex][this.currentWordIndex]){this.currentWordIndex++;this._spellcheck();}else{var a=b.getTextVal(this.currentTextIndex,this.currentWordIndex);if(a){this.controlWin.evaluatedText.value=a;b.setFocus(this.currentTextIndex,this.currentWordIndex);this._getSuggestions(this.currentTextIndex,this.currentWordIndex);}}}function _getSuggestions(d,a){this.controlWin.clearSuggestions();var c=this.wordWin.suggestions[d][a];if(c){for(var b=0;b<c.length;b++){this.controlWin.addSuggestion(c[b]);}}this.controlWin.selectDefaultSuggestion();}function _setAsIgnored(c,b,a){this.wordWin.removeFocus(c,b);this.wordFlags[c][b]=a;return true;}function _getTotalReplaced(){var c=0;for(var b=0;b<this.wordFlags.length;b++){for(var a=0;a<this.wordFlags[b].length;a++){if((this.wordFlags[b][a]==this.replWordFlag)||(this.wordFlags[b][a]==this.replAllFlag)||(this.wordFlags[b][a]==this.fromReplAll)){c++;}}}return c;}function _setWordText(d,b,c,a){this.wordWin.setText(d,b,c);this.wordFlags[d][b]=a;return true;}function _getFormInputs(b){var a=new Array();for(var d=0;d<document.forms.length;d++){for(var c=0;c<document.forms[d].elements.length;c++){if(document.forms[d].elements[c].type.match(b)){a[a.length]=document.forms[d].elements[c];}}}return a;}