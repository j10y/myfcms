var DutySystemForm=function(a){this.systemId=a;var b=this.setup();var c=new Ext.Window({id:"DutySystemFormWin",title:"班制定义详细信息",width:830,iconCls:"btn-clock",height:230,modal:true,layout:"fit",buttonAlign:"center",items:[this.setup()],buttons:[{text:"保存",iconCls:"btn-save",handler:function(){var f=Ext.getCmp("DutySystemForm");if(f.getForm().isValid()){var k=[];var e=Ext.getCmp("DutySystemSettingGird").getStore();var j=true;for(i=0,cnt=e.getCount();i<cnt;i+=1){var d=e.getAt(i);for(var g=0;g<7;g++){var h=d.get("day"+g);if(h==null||h==""){j=false;break;}}k.push(d.data);}if(!j){alert("没有完全设置星期的班次!");return;}f.getForm().submit({method:"post",waitMsg:"正在提交数据...",params:{data:Ext.encode(k)},success:function(l,m){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("DutySystemGrid").getStore().reload();c.close();},failure:function(l,m){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});c.close();}});}}},{text:"取消",iconCls:"btn-cancel",handler:function(){c.close();}}]});c.show();};DutySystemForm.prototype.setup=function(){var b=DutySystemForm.grid(this.systemId);var a=new Ext.FormPanel({url:__ctxPath+"/personal/saveDutySystem.do",layout:"form",id:"DutySystemForm",border:false,defaults:{anchor:"98%,98%"},bodyStyle:"padding:5px;",defaultType:"textfield",items:[{name:"dutySystem.systemId",id:"systemId",xtype:"hidden",value:this.systemId==null?"":this.systemId},{fieldLabel:"班制名称",name:"dutySystem.systemName",id:"systemName",allowBlank:false},{xtype:"radiogroup",fieldLabel:"是否缺省",autoHeight:true,columns:2,items:[{boxLabel:"是",name:"dutySystem.isDefault",inputValue:1,id:"isDefault1",checked:true},{boxLabel:"否",name:"dutySystem.isDefault",inputValue:0,id:"isDefault0"}]},b]});if(this.systemId!=null&&this.systemId!=undefined){a.getForm().load({deferredRender:false,url:__ctxPath+"/personal/getDutySystem.do?systemId="+this.systemId,waitMsg:"正在载入数据...",success:function(c,e){var d=e.result.data;if(d.isDefault==1){Ext.getCmp("isDefault1").setValue(true);}else{Ext.getCmp("isDefault0").setValue(true);}},failure:function(c,d){Ext.ux.Toast.msg("编辑","载入失败");}});}return a;};DutySystemForm.grid=function(a){if(a==undefined){a="";}var c=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/personal/settingDutySystem.do?systemId="+a}),reader:new Ext.data.JsonReader({root:"result",fields:["day0","day1","day2","day3","day4","day5","day6","dayId0","dayId1","dayId2","dayId3","dayId4","dayId5","dayId6"]})});c.load();var f=0;var d=0;var b=new Ext.form.TriggerField({onTriggerClick:function(g){DutySectionSelector.getView(function(m,n){var l=Ext.getCmp("DutySystemSettingGird");var j=l.getStore();var h=j.getAt(0);var k=(d-1)/2;h.set("dayId"+k,m);h.set("day"+k,n);}).show();}});var e=new Ext.grid.EditorGridPanel({id:"DutySystemSettingGird",region:"center",title:"班次设置",height:100,store:c,columns:[new Ext.grid.RowNumberer(),{header:"周日",dataIndex:"day0",editor:b},{dataIndex:"dayId0",hidden:true},{header:"周一",dataIndex:"day1",editor:b},{dataIndex:"dayId1",hidden:true},{header:"周二",dataIndex:"day2",editor:b},{dataIndex:"dayId2",hidden:true},{header:"周三",dataIndex:"day3",editor:b},{dataIndex:"dayId3",hidden:true},{header:"周四",dataIndex:"day4",editor:b},{dataIndex:"dayId4",hidden:true},{header:"周五",dataIndex:"day5",editor:b},{dataIndex:"dayId5",hidden:true},{header:"周六",dataIndex:"day6",editor:b},{dataIndex:"dayId6",hidden:true}]});e.on("cellclick",function(g,k,h,j){f=k;d=h;});return e;};