Ext.ns("SharedPhoneBookView");SharedPhoneBookView=Ext.extend(Ext.Panel,{searchPanel:null,gridPanel:null,store:null,constructor:function(a){Ext.applyIf(this,a);this.initUI();SharedPhoneBookView.superclass.constructor.call(this,{id:"SharedPhoneBookView",iconCls:"menu-phonebook-shared",title:"共享联系人列表",autoScroll:true,items:[this.searchPanel,this.gridPanel]});},initUI:function(){this.searchPanel=new Ext.FormPanel({id:"PhoneSearchForm",height:40,frame:false,border:false,layout:"hbox",layoutConfig:{padding:"5",align:"middle"},defaults:{xtype:"label",margins:{top:0,right:4,bottom:4,left:4}},items:[{text:"请输入查询条件:"},{text:"姓名"},{xtype:"textfield",name:"fullname"},{text:"共享人"},{xtype:"textfield",name:"sharedUser"},{xtype:"button",text:"查询",iconCls:"search",handler:this.search.createCallback(this)}]});this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/communicate/sharePhoneBook.do"}),reader:new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",id:"id",fields:[{name:"phoneId",type:"int"},"fullname","title","birthday","nickName","duty","spouse","childs","companyName","companyAddress","companyPhone","companyFax","homeAddress","homeZip","mobile","phone","email","qqNumber","msn","note",{name:"sharefullname",mapping:"appUser.fullname"},"groupId","isShared"]}),remoteSort:true});this.store.setDefaultSort("phoneId","desc");var a=new Ext.grid.ColumnModel({columns:[new Ext.grid.RowNumberer(),{header:"phoneId",dataIndex:"phoneId",hidden:true},{header:"名字",dataIndex:"fullname"},{header:"职位",dataIndex:"duty"},{header:"电话",dataIndex:"mobile"},{header:"共享人",dataIndex:"sharefullname"}],defaults:{sortable:true,menuDisabled:false,width:100}});this.store.load({params:{start:0,limit:25}});this.gridPanel=new Ext.grid.GridPanel({id:"PhoneBookGrid",store:this.store,trackMouseOver:true,disableSelection:false,loadMask:true,autoHeight:true,cm:a,viewConfig:{forceFit:true,enableRowBody:false,showPreview:false},bbar:new Ext.PagingToolbar({pageSize:25,store:this.store,displayInfo:true,displayMsg:"当前显示从{0}至{1}， 共{2}条记录",emptyMsg:"当前没有记录"})});this.gridPanel.addListener("rowdblclick",function(c,b,d){c.getSelectionModel().each(function(f){var e=Ext.getCmp("SharedPhoneBookWin");if(e==null){SharedPhoneBookView.read(f.data.phoneId);}});});},search:function(b){var a=b.searchPanel;var c=b.gridPanel;if(a.getForm().isValid()){a.getForm().submit({waitMsg:"正在提交查询",url:__ctxPath+"/communicate/sharePhoneBook.do",success:function(e,f){var d=Ext.util.JSON.decode(f.response.responseText);c.getStore().loadData(d);}});}}});SharedPhoneBookView.read=function(a){new SharedPhoneBookWin({phoneId:a}).show();};