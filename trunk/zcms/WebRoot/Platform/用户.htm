<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
 


















<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>用户</title>
<link href="../Include/Default.css" rel="stylesheet" type="text/css" />
<script src="../Framework/Main.js"></script>
<script>
function add(){
	var diag = new Dialog("Diag1");
	diag.Width = 600;
	diag.Height = 380;
	diag.Title = "新建"+this.document.title;
	diag.URL = "Platform/UserAddDialog.jsp";
	diag.onLoad = function(){
		$DW.$NS("IsBranchAdmin","N");
		$DW.$NS("Status","N");
		$DW.$S("Password","");
		$DW.$("UserName").focus();
	};
	diag.OKEvent = addSave;
	diag.show();
}

function addSave(){
	var dc = $DW.Form.getData("form2");
	if($DW.Verify.hasError()){
	  return;
     }
	if ($DW.$V("ConfirmPassword") != $DW.$V("Password")){
	   Dialog.alert("两次输入密码不相同，请重新输入...");
	   return ;
	}
	Server.sendRequest("com.zving.platform.UserList.add",dc,function(response){
		Dialog.alert(response.Message,function(){
			if(response.Status==1){
				$D.close();
				DataGrid.loadData('dg1');
			}
		});	
	});
}

function save(){
	DataGrid.save("dg1","com.zving.platform.UserList.dg1Edit",function(){DataGrid.loadData('dg1');});
}

function del(){
	var arr = DataGrid.getSelectedValue("dg1");
	if(!arr||arr.length==0){
		Dialog.alert("请先选择要删除的用户！");
		return;
	}
	Dialog.confirm("您确认要删除这些用户吗？</br><b style='color:#F00'>"+arr.join(',</br>')+"</b>",function(){
		var dc = new DataCollection();
		dc.add("UserNames",arr.join());
		Server.sendRequest("com.zving.platform.UserList.del",dc,function(response){
			Dialog.alert(response.Message,function(){
				if(response.Status==1){
					DataGrid.loadData('dg1');
				}
			});
		});
	});
}

function stopUser(){
	var arr = DataGrid.getSelectedValue("dg1");
	if(!arr||arr.length==0){
		Dialog.alert("请先选择要停用的用户！");
		return;
	}
	Dialog.confirm("您确认要停用这些用户吗？</br><b style='color:#F00'>"+arr.join(',</br>')+"</b>",function(){
		var dc = new DataCollection();
		dc.add("UserNames",arr.join());
		Server.sendRequest("com.zving.platform.UserList.stopUser",dc,function(response){
			Dialog.alert(response.Message,function(){
				if(response.Status==1){
					DataGrid.loadData('dg1');
				}
			});
		});
	});
}

function setPriv(){
	var arr = DataGrid.getSelectedValue("dg1");
	if(!arr||arr.length==0){
		Dialog.alert("请先选择要编辑的用户！");
		return;
	}
	var diag = new Dialog("Diag1");
	diag.Width = 700;
	diag.Height = 400;
	diag.Title = "设置用户"+arr[0]+"权限";
	diag.URL = "Platform/UserTab.jsp?UserName="+arr[0];
	diag.show();
	diag.OKButton.hide();
	diag.CancelButton.value="关闭"; 
}

function doSearch(){
	var name = "";
	if ($V("SearchUserName") != "请输入用户名或真实姓名") {
		name = $V("SearchUserName").trim();
	}
	DataGrid.setParam("dg1",Constant.PageIndex,0);
	DataGrid.setParam("dg1","SearchUserName",name);
	DataGrid.loadData("dg1");
}

document.onkeydown = function(event){
	event = getEvent(event);
	if(event.keyCode==13){
		var ele = event.srcElement || event.target;
		if(ele.id == 'SearchUserName'||ele.id == 'Submitbutton'){
			doSearch();
		}
	}
}

function delKeyWord() {
	if ($V("SearchUserName") == "请输入用户名或真实姓名") {
		$S("SearchUserName","");
	}
}

function edit(){
	var arr = DataGrid.getSelectedValue("dg1");
	if(!arr||arr.length==0){
		Dialog.alert("请先选择要编辑的用户！");
		return;
	}
	var diag = new Dialog("Diag1");
	diag.Width = 600;
	diag.Height = 380;
	diag.Title = "编辑用户"+arr[0];
	diag.URL = "Platform/UserEditDialog.jsp?UserName="+arr[0];
	diag.onLoad = function(){
		$DW.$("RealName").focus();
	};
	diag.OKEvent = editSave;
	diag.show();
}

function editSave(){
	var dc = $DW.Form.getData("form2");
	if($DW.Verify.hasError()){
	  return;
    }
    if ($DW.$V("NewConfirmPassword") != $DW.$V("NewPassword")){
	   Dialog.alert("两次输入密码不相同，请重新输入",function(){
	       $DW.$S("NewPassword","");
		   $DW.$S("NewConfirmPassword","");
		   return;
	   });
	   return;
	}
	Server.sendRequest("com.zving.platform.UserList.save",dc,function(response){
		Dialog.alert(response.Message,function(){
			if(response.Status==1){
				$D.close();
				DataGrid.loadData("dg1");
			}
		})
	});
}
</script>
</head>
<body>
<table width="100%" border="0" cellspacing="6" cellpadding="0" style="border-collapse: separate; border-spacing: 6px;">
		<tr valign="top">
			<td>
			<table width="100%" border="0" cellspacing="0" cellpadding="6" class="blockTable">
				<tr>
					<td valign="middle" class="blockTd"><img
						src="../Icons/icon021a1.gif" /> 用户列表</td>
				</tr>
				<tr>
					<td style="padding:0 8px 4px;"><a href='javascript:void(0);' ztype='zPushBtn' class='zPushBtn' hidefocus='true' tabindex='-1' onselectstart='return false' id='' onClick="add();return false;" ><img src="../Icons/icon021a2.gif"/><b>新建&nbsp;</b></a>
				<a href='javascript:void(0);' ztype='zPushBtn' class='zPushBtn' hidefocus='true' tabindex='-1' onselectstart='return false' id='' onClick="edit();return false;" ><img src="../Icons/icon021a4.gif"/><b>编辑&nbsp;</b></a>
				<a href='javascript:void(0);' ztype='zPushBtn' class='zPushBtn' hidefocus='true' tabindex='-1' onselectstart='return false' id='' onClick="stopUser();return false;" ><img src="../Icons/icon021a8.gif"/><b>停用&nbsp;</b></a>
				<a href='javascript:void(0);' ztype='zPushBtn' class='zPushBtn' hidefocus='true' tabindex='-1' onselectstart='return false' id='' onClick="del();return false;" ><img src="../Icons/icon021a3.gif"/><b>删除&nbsp;</b></a>
				<a href='javascript:void(0);' ztype='zPushBtn' class='zPushBtn' hidefocus='true' tabindex='-1' onselectstart='return false' id='' onClick="setPriv();return false;" ><img src="../Icons/icon021a9.gif"/><b>修改权限&nbsp;</b></a>				
				<div style="float: right; white-space: nowrap;">
				  <input name="SearchUserName" type="text" id="SearchUserName" value="请输入用户名或真实姓名" onFocus="delKeyWord();" style="width:150px">
            	  <input type="button" name="Submitbutton" id="Submitbutton" value="查询" onClick="doSearch()">
            	</div>
				</td>
			</tr>
			<tr>
				<td style="padding-top:0px;padding-left:6px;padding-right:6px;padding-bottom:8px;">
				<table width="100%" cellpadding="2" cellspacing="0" class="dataTable" sortstring="" id="dg1" page="true" size="0" method="com.zving.platform.UserList.dg1DataBind" multiselect="true" autofill="true" scroll="false" lazy="false" cachesize="0">
<tr ztype="head" class="dataTableHead">
<td width="4%" ztype="RowNo">序号</td>
<td width="4%" ztype="selector" field="UserName"><input type='checkbox' value='*' id='dg1_AllCheck' onclick="DataGrid.onAllCheckClick('dg1')"/></td>
<td width="17%"><b>用户名</b></td>
<td width="16%"><b>真实姓名</b></td>
<td width="9%"><b>用户状态</b></td>
<td width="9%"><b>所属机构</b></td>
<td width="17%"><b>电子邮件</b></td>
<td width="15%"><b>联系电话</b></td>
<td width="18%"><b>手机号码</b></td>
</tr>
<tr ondblclick="edit(this)" style="background-color:#F9FBFC" onclick="DataGrid.onRowClick(this,event);" oncontextmenu="DataGrid._onContextMenu(this,event)">
<td rowno="1">1</td>
<td onclick="DataGrid.onSelectorClick(this,event);" ondblclick="stopEvent(event);"><input type='checkbox' name='dg1_RowCheck' id='dg1_RowCheck1' value='administrator'></td>
<td>administrator</td>
<td>超级管理员</td>
<td>正常</td>
<td>泽元软件</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr ondblclick="edit(this)" style="background-color:#FFFFFF" onclick="DataGrid.onRowClick(this,event);" oncontextmenu="DataGrid._onContextMenu(this,event)">
<td rowno="2">2</td>
<td onclick="DataGrid.onSelectorClick(this,event);" ondblclick="stopEvent(event);"><input type='checkbox' name='dg1_RowCheck' id='dg1_RowCheck2' value='admin'></td>
<td>admin</td>
<td>admin</td>
<td>正常</td>
<td>泽元软件</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr ondblclick="edit(this)" style="background-color:#F9FBFC" onclick="DataGrid.onRowClick(this,event);" oncontextmenu="DataGrid._onContextMenu(this,event)">
<td rowno="3">3</td>
<td onclick="DataGrid.onSelectorClick(this,event);" ondblclick="stopEvent(event);"><input type='checkbox' name='dg1_RowCheck' id='dg1_RowCheck3' value='audit1'></td>
<td>audit1</td>
<td>审核员1</td>
<td>正常</td>
<td>泽元软件</td>
<td>sdf@zvon.com</td>
<td>01087654321</td>
<td>13912345678</td>
</tr>
<tr ondblclick="edit(this)" style="background-color:#FFFFFF" onclick="DataGrid.onRowClick(this,event);" oncontextmenu="DataGrid._onContextMenu(this,event)">
<td rowno="4">4</td>
<td onclick="DataGrid.onSelectorClick(this,event);" ondblclick="stopEvent(event);"><input type='checkbox' name='dg1_RowCheck' id='dg1_RowCheck4' value='edit1'></td>
<td>edit1</td>
<td>编辑1</td>
<td>正常</td>
<td>泽元软件</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr ztype="blank" height="253">
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<script>Page.onLoad(DataGrid_dg1_Init,9);function DataGrid_dg1_Init(){var _Zving_Cols = [["UserName",1],["RealName",1],["Password",1],["BranchInnerCode",1],["IsBranchAdmin",1],["Status",1],["Type",1],["Email",1],["Tel",1],["Mobile",1],["Prop1",1],["Prop2",1],["Prop6",1],["Prop5",1],["Prop4",1],["Prop3",1],["Memo",1],["AddTime",0],["AddUser",1],["ModifyTime",0],["ModifyUser",1],["BranchInnerCodeName",1],["StatusName",1],["_RowNo",8]]
var _Zving_Values = [["administrator","超级管理员","200ceb26807d6bf99fd6f4f0d1ca54d4","0001","Y","N","0","","","","","","","","","","","2009-04-23 19:45:26","admin","","","泽元软件","正常",1],
["admin","admin","21232f297a57a5a743894a0e4a801fc3","0001","Y","N","0","","","","","","","","","","","2008-09-19 00:00:00","admin","2009-07-06 10:03:41","admin","泽元软件","正常",2],
["audit1","审核员1","21232f297a57a5a743894a0e4a801fc3","0001","N","N","0","sdf@zvon.com","01087654321","13912345678","","","","","","","","2008-04-07 19:27:09","admin","2009-05-12 11:44:00","admin","泽元软件","正常",3],
["edit1","编辑1","3c4a359ade745c27537e3b08672425cb","0001","N","N","0","","","","","","","","","","","2008-04-07 19:26:19","admin","2010-03-20 07:59:35","admin","泽元软件","正常",4]];
$('dg1').DataSource = new DataTable();;$('dg1').DataSource.init(_Zving_Cols,_Zving_Values);var _Zving_Arr = [];_Zving_Arr.push("&nbsp;");_Zving_Arr.push("&nbsp;");_Zving_Arr.push("$\{UserName}");_Zving_Arr.push("$\{RealName}");_Zving_Arr.push("$\{StatusName}");_Zving_Arr.push("$\{BranchInnercodeName}");_Zving_Arr.push("$\{Email}");_Zving_Arr.push("$\{Tel}");_Zving_Arr.push("$\{Mobile}");$('dg1').TemplateArray = _Zving_Arr;$('dg1').TagBody = "&lt;table&nbsp;width=&quot;100%&quot;&nbsp;cellpadding=&quot;2&quot;&nbsp;cellspacing=&quot;0&quot;&nbsp;class=&quot;dataTable&quot;&gt;&nbsp;&lt;tr&nbsp;ztype=&quot;head&quot;&nbsp;class=&quot;dataTableHead&quot;&gt;&nbsp;&lt;td&nbsp;width=&quot;4%&quot;&nbsp;ztype=&quot;RowNo&quot;&gt;&#24207;&#21495;&lt;/td&gt;&nbsp;&lt;td&nbsp;width=&quot;4%&quot;&nbsp;ztype=&quot;selector&quot;&nbsp;field=&quot;UserName&quot;&gt;&amp;nbsp;&lt;/td&gt;&nbsp;&lt;td&nbsp;width=&quot;17%&quot;&nbsp;&gt;&lt;b&gt;&#29992;&#25143;&#21517;&lt;/b&gt;&lt;/td&gt;&nbsp;&lt;td&nbsp;width=&quot;16%&quot;&nbsp;&gt;&lt;b&gt;&#30495;&#23454;&#22995;&#21517;&lt;/b&gt;&lt;/td&gt;&nbsp;&lt;td&nbsp;width=&quot;9%&quot;&nbsp;&gt;&lt;b&gt;&#29992;&#25143;&#29366;&#24577;&lt;/b&gt;&lt;/td&gt;&nbsp;&lt;td&nbsp;width=&quot;9%&quot;&nbsp;&gt;&lt;b&gt;&#25152;&#23646;&#26426;&#26500;&lt;/b&gt;&lt;/td&gt;&nbsp;&lt;td&nbsp;width=&quot;17%&quot;&nbsp;&gt;&lt;b&gt;&#30005;&#23376;&#37038;&#20214;&lt;/b&gt;&lt;/td&gt;&nbsp;&lt;td&nbsp;width=&quot;15%&quot;&nbsp;&gt;&lt;b&gt;&#32852;&#31995;&#30005;&#35805;&lt;/b&gt;&lt;/td&gt;&nbsp;&lt;td&nbsp;width=&quot;18%&quot;&nbsp;&gt;&lt;b&gt;&#25163;&#26426;&#21495;&#30721;&lt;/b&gt;&lt;/td&gt;&nbsp;&lt;/tr&gt;&nbsp;&lt;tr&nbsp;onDblClick=&quot;edit(this)&quot;&nbsp;style1=&quot;background-color:#FFFFFF&quot;&nbsp;style2=&quot;background-color:#F9FBFC&quot;&gt;&nbsp;&lt;td&nbsp;&gt;&amp;nbsp;&lt;/td&gt;&nbsp;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&nbsp;&lt;td&gt;$\{UserName}&lt;/td&gt;&nbsp;&lt;td&gt;$\{RealName}&lt;/td&gt;&nbsp;&lt;td&gt;$\{StatusName}&lt;/td&gt;&nbsp;&lt;td&gt;$\{BranchInnercodeName}&lt;/td&gt;&nbsp;&lt;td&gt;$\{Email}&lt;/td&gt;&nbsp;&lt;td&gt;$\{Tel}&lt;/td&gt;&nbsp;&lt;td&gt;$\{Mobile}&lt;/td&gt;&nbsp;&lt;/tr&gt;&nbsp;&lt;tr&nbsp;ztype=&quot;pagebar&quot;&gt;&nbsp;&lt;td&nbsp;colspan=&quot;8&quot;&nbsp;align=&quot;center&quot;&gt;$\{PageBar}&lt;/td&gt;&nbsp;&lt;/tr&gt;&nbsp;&lt;/table&gt;";DataGrid.setParam('dg1','_ZVING_PAGEINDEX',0);DataGrid.setParam('dg1','_ZVING_PAGETOTAL',4);DataGrid.setParam('dg1','_ZVING_SIZE',15);DataGrid.setParam('dg1','_ZVING_MULTISELECT','true');DataGrid.setParam('dg1','_ZVING_AUTOFILL','true');DataGrid.setParam('dg1','_ZVING_SCROLL','false');DataGrid.setParam('dg1','_ZVING_LAZY','false');DataGrid.init('dg1');}</script>
<tr ztype="pagebar" dragover="DataGrid.dragOver" dragout="DataGrid.dragOut" dragend="DataGrid.dragEnd">
<td colspan="9" align="center" id="dg1_PageBar"><div style='float:right;font-family:Tahoma'>第一页&nbsp;|&nbsp;上一页&nbsp;|&nbsp;下一页&nbsp;|&nbsp;最末页&nbsp;&nbsp;&nbsp;&nbsp;转到第&nbsp;<input id='_PageBar_Index' type='text' class='inputText' style='width:40px' onKeyUp="value=value.replace(/\D/g,'')">&nbsp;页&nbsp;&nbsp;<input type='button' onclick="if(!/^\d+$/.test($V('_PageBar_Index'))||$V('_PageBar_Index')<1||$V('_PageBar_Index')>1){alert('错误的页码');$('_PageBar_Index').focus();}else{var pageIndex = ($V('_PageBar_Index')-1)>0?$V('_PageBar_Index')-1:0;DataGrid.setParam('dg1','_ZVING_PAGEINDEX',pageIndex);DataGrid.loadData('dg1');}" class='inputButton' value='跳转'></div><div style='float:left;font-family:Tahoma'>共 4 条记录，每页 15 条，当前第 1 / 1 页</div></td>
</tr>
</table>
				</td>
			</tr>
		</table> 
      	</td>
      </tr>
    </table>
</body>
</html>
