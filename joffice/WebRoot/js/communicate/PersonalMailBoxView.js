Ext.ns("MailFolder");var PersonalMailBoxView=function(){var e;var h=new MailView();var c=new Ext.tree.TreePanel({collapsible:true,region:"west",title:"我的邮箱目录",width:180,autoScroll:true,id:"leftMailBoxTree",split:true,layout:"fit",tbar:new Ext.Toolbar({items:[{text:"收邮件",iconCls:"btn-mail_receive",handler:function(){h.setFolderId(1);Ext.getCmp("MailView").setTitle("[收件箱]");var l=Ext.getCmp("MailGrid");var k=l.getStore();k.url=__ctxPath+"/communicate/listMail.do";k.baseParams={folderId:1};k.reload({params:{start:0,limit:25}});}},{text:"发邮件",iconCls:"btn-mail_send",handler:function(){var k=Ext.getCmp("centerTabPanel");var l=Ext.getCmp("MailForm");if(l==null){l=new MailForm("","","");k.add(l);k.activate(l);}else{k.remove(l);l=new MailForm("","","");k.add(l);k.activate(l);}}},{xtype:"button",iconCls:"btn-refresh",text:"刷新",handler:function(){c.root.reload();}}]}),loader:new Ext.tree.TreeLoader({url:__ctxPath+"/communicate/listMailFolder.do"}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false,listeners:{"click":function(o){if(o!=null){h.setFolderId(o.id);var n=Ext.getCmp("MailCenterView");var l=Ext.getCmp("MailView");var m=Ext.getCmp("ShowMailDetail");if(m!=null){n.remove("ShowMailDetail");l.show();n.doLayout();}if(o.id!=0){Ext.getCmp("MailView").setTitle("["+o.text+"]");var p=Ext.getCmp("MailGrid");var k=p.getStore();k.url=__ctxPath+"/communicate/listMail.do";k.baseParams={folderId:o.id};k.reload({params:{start:0,limit:25}});}}}}});function b(k,l){e=new Ext.tree.TreeNode({id:k.id,text:k.text});f.showAt(l.getXY());}c.on("contextmenu",b,c);var f=new Ext.menu.Menu({tbar:new Ext.Toolbar({items:[{text:"刷新",handler:function(){alert("refresh");}}]}),id:"MailFolderTreeMenu",items:[{text:"新建目录",scope:this,iconCls:"btn-add",handler:j},{text:"修改目录",scope:this,iconCls:"btn-edit",handler:g},{text:"删除目录",scope:this,iconCls:"btn-delete",handler:d}]});function j(k){var l=e.id;new MailFolderForm(null,l);}function g(){var k=e.id;if(k>4){new MailFolderForm(k);}}function d(){var k=e.id;if(k>4){Ext.Ajax.request({url:__ctxPath+"/communicate/countMailFolder.do",params:{folderId:k},method:"post",success:function(l,n){var m=Ext.util.JSON.decode(l.responseText);if(m.count==0){Ext.Ajax.request({url:__ctxPath+"/communicate/removeMailFolder.do",params:{folderId:k},method:"post",success:function(o,p){Ext.ux.Toast.msg("操作信息","成功删除目录！");c.root.reload();},failure:function(o,p){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});}else{Ext.Msg.confirm("警告信息","该文件夹及其子目录下还有"+m.count+"封邮件,确定要删除吗?",function(o){if(o=="yes"){Ext.Ajax.request({url:__ctxPath+"/communicate/removeMailFolder.do",params:{folderId:k,count:m.count},method:"post",success:function(p,q){Ext.ux.Toast.msg("操作信息","成功删除目录！");c.root.reload();},failure:function(p,q){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});}});}},failure:function(l,m){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});}}var i=new Ext.Panel({id:"MailCenterView",region:"center",autoScroll:true,layout:"fit",items:[h.getView()]});var a=new Ext.Panel({title:"我的邮箱",iconCls:"menu-mail_box",layout:"border",id:"PersonalMailBoxView",items:[c,i]});return a;};