var FCKBlockQuoteCommand=function(){};FCKBlockQuoteCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var e=this.GetState();var o=new FCKDomRange(FCK.EditorWindow);o.MoveToSelection();var h=o.CreateBookmark();if(FCKBrowserInfo.IsIE){var m=o.GetBookmarkNode(h,true);var c=o.GetBookmarkNode(h,false);var d;if(m&&m.parentNode.nodeName.IEquals("blockquote")&&!m.previousSibling){d=m;while((d=d.nextSibling)){if(FCKListsLib.BlockElements[d.nodeName.toLowerCase()]){FCKDomTools.MoveNode(m,d,true);}}}if(c&&c.parentNode.nodeName.IEquals("blockquote")&&!c.previousSibling){d=c;while((d=d.nextSibling)){if(FCKListsLib.BlockElements[d.nodeName.toLowerCase()]){if(d.firstChild==m){FCKDomTools.InsertAfterNode(m,c);}else{FCKDomTools.MoveNode(c,d,true);}}}}}var s=new FCKDomRangeIterator(o);var k;if(e==FCK_TRISTATE_OFF){var l=[];while((k=s.GetNextParagraph())){l.push(k);}if(l.length<1){para=o.Window.document.createElement(FCKConfig.EnterMode.IEquals("p")?"p":"div");o.InsertNode(para);para.appendChild(o.Window.document.createTextNode("\ufeff"));o.MoveToBookmark(h);o.MoveToNodeContents(para);o.Collapse(true);h=o.CreateBookmark();l.push(para);}var n=l[0].parentNode;var y=[];for(var w=0;w<l.length;w++){k=l[w];n=FCKDomTools.GetCommonParents(k.parentNode,n).pop();}while(n.nodeName.IEquals("table","tbody","tr","ol","ul")){n=n.parentNode;}var x=null;while(l.length>0){k=l.shift();while(k.parentNode!=n){k=k.parentNode;}if(k!=x){y.push(k);}x=k;}while(y.length>0){k=y.shift();if(k.nodeName.IEquals("blockquote")){var b=FCKTools.GetElementDocument(k).createDocumentFragment();while(k.firstChild){b.appendChild(k.removeChild(k.firstChild));l.push(b.lastChild);}k.parentNode.replaceChild(b,k);}else{l.push(k);}}var t=o.Window.document.createElement("blockquote");n.insertBefore(t,l[0]);while(l.length>0){k=l.shift();t.appendChild(k);}}else{if(e==FCK_TRISTATE_ON){var z=[];var v={};while((k=s.GetNextParagraph())){var A=null;var q=null;while(k.parentNode){if(k.parentNode.nodeName.IEquals("blockquote")){A=k.parentNode;q=k;break;}k=k.parentNode;}if(A&&q&&!q._fckblockquotemoveout){z.push(q);FCKDomTools.SetElementMarker(v,q,"_fckblockquotemoveout",true);}}FCKDomTools.ClearAllMarkers(v);var a=[];var j=[],v={};var p=function(C){for(var B=0;B<C.childNodes.length;B++){if(FCKListsLib.BlockElements[C.childNodes[B].nodeName.toLowerCase()]){return false;}}return true;};while(z.length>0){var u=z.shift();var t=u.parentNode;if(u==u.parentNode.firstChild){t.parentNode.insertBefore(t.removeChild(u),t);}else{if(u==u.parentNode.lastChild){t.parentNode.insertBefore(t.removeChild(u),t.nextSibling);}else{FCKDomTools.BreakParent(u,u.parentNode,o);}}if(!t._fckbqprocessed){j.push(t);FCKDomTools.SetElementMarker(v,t,"_fckbqprocessed",true);}a.push(u);}for(var w=j.length-1;w>=0;w--){var t=j[w];if(p(t)){FCKDomTools.RemoveNode(t);}}FCKDomTools.ClearAllMarkers(v);if(FCKConfig.EnterMode.IEquals("br")){while(a.length){var u=a.shift();var g=true;if(u.nodeName.IEquals("div")){var b=FCKTools.GetElementDocument(u).createDocumentFragment();var r=g&&u.previousSibling&&!FCKListsLib.BlockBoundaries[u.previousSibling.nodeName.toLowerCase()];if(g&&r){b.appendChild(FCKTools.GetElementDocument(u).createElement("br"));}var f=u.nextSibling&&!FCKListsLib.BlockBoundaries[u.nextSibling.nodeName.toLowerCase()];while(u.firstChild){b.appendChild(u.removeChild(u.firstChild));}if(f){b.appendChild(FCKTools.GetElementDocument(u).createElement("br"));}u.parentNode.replaceChild(b,u);g=false;}}}}}o.MoveToBookmark(h);o.Select();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange");},GetState:function(){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG||!FCK.EditorWindow){return FCK_TRISTATE_DISABLED;}var c=new FCKElementPath(FCKSelection.GetBoundaryParentElement(true));var b=c.Block||c.BlockLimit;if(!b||b.nodeName.toLowerCase()=="body"){return FCK_TRISTATE_OFF;}for(var a=0;a<c.Elements.length;a++){if(c.Elements[a].nodeName.IEquals("blockquote")){return FCK_TRISTATE_ON;}}return FCK_TRISTATE_OFF;}};