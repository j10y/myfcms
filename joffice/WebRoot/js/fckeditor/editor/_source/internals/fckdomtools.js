var FCKDomTools={MoveChildren:function(c,d,b){if(c==d){return;}var a;if(b){while((a=c.lastChild)){d.insertBefore(c.removeChild(a),d.firstChild);}}else{while((a=c.firstChild)){d.appendChild(c.removeChild(a));}}},MoveNode:function(b,c,a){if(a){c.insertBefore(FCKDomTools.RemoveNode(b),c.firstChild);}else{c.appendChild(FCKDomTools.RemoveNode(b));}},TrimNode:function(a){this.LTrimNode(a);this.RTrimNode(a);},LTrimNode:function(c){var d;while((d=c.firstChild)){if(d.nodeType==3){var b=d.nodeValue.LTrim();var a=d.nodeValue.length;if(b.length==0){c.removeChild(d);continue;}else{if(b.length<a){d.splitText(a-b.length);c.removeChild(c.firstChild);}}}break;}},RTrimNode:function(c){var d;while((d=c.lastChild)){if(d.nodeType==3){var b=d.nodeValue.RTrim();var a=d.nodeValue.length;if(b.length==0){d.parentNode.removeChild(d);continue;}else{if(b.length<a){d.splitText(b.length);c.lastChild.parentNode.removeChild(c.lastChild);}}}break;}if(!FCKBrowserInfo.IsIE&&!FCKBrowserInfo.IsOpera){d=c.lastChild;if(d&&d.nodeType==1&&d.nodeName.toLowerCase()=="br"){d.parentNode.removeChild(d);}}},RemoveNode:function(b,c){if(c){var a;while((a=b.firstChild)){b.parentNode.insertBefore(b.removeChild(a),b);}}return b.parentNode.removeChild(b);},GetFirstChild:function(c,a){if(typeof(a)=="string"){a=[a];}var b=c.firstChild;while(b){if(b.nodeType==1&&b.tagName.Equals.apply(b.tagName,a)){return b;}b=b.nextSibling;}return null;},GetLastChild:function(c,a){if(typeof(a)=="string"){a=[a];}var b=c.lastChild;while(b){if(b.nodeType==1&&(!a||b.tagName.Equals(a))){return b;}b=b.previousSibling;}return null;},GetPreviousSourceElement:function(c,d,a,b){if(!c){return null;}if(a&&c.nodeType==1&&c.nodeName.IEquals(a)){return null;}if(c.previousSibling){c=c.previousSibling;}else{return this.GetPreviousSourceElement(c.parentNode,d,a,b);}while(c){if(c.nodeType==1){if(a&&c.nodeName.IEquals(a)){break;}if(!b||!c.nodeName.IEquals(b)){return c;}}else{if(d&&c.nodeType==3&&c.nodeValue.RTrim().length>0){break;}}if(c.lastChild){c=c.lastChild;}else{return this.GetPreviousSourceElement(c,d,a,b);}}return null;},GetNextSourceElement:function(d,e,b,c,a){while((d=this.GetNextSourceNode(d,a))){if(d.nodeType==1){if(b&&d.nodeName.IEquals(b)){break;}if(c&&d.nodeName.IEquals(c)){return this.GetNextSourceElement(d,e,b,c);}return d;}else{if(e&&d.nodeType==3&&d.nodeValue.RTrim().length>0){break;}}}return null;},GetNextSourceNode:function(c,a,b,d){if(!c){return null;}var e;if(!a&&c.firstChild){e=c.firstChild;}else{if(d&&c==d){return null;}e=c.nextSibling;if(!e&&(!d||d!=c.parentNode)){return this.GetNextSourceNode(c.parentNode,true,b,d);}}if(b&&e&&e.nodeType!=b){return this.GetNextSourceNode(e,false,b,d);}return e;},GetPreviousSourceNode:function(c,a,b,d){if(!c){return null;}var e;if(!a&&c.lastChild){e=c.lastChild;}else{if(d&&c==d){return null;}e=c.previousSibling;if(!e&&(!d||d!=c.parentNode)){return this.GetPreviousSourceNode(c.parentNode,true,b,d);}}if(b&&e&&e.nodeType!=b){return this.GetPreviousSourceNode(e,false,b,d);}return e;},InsertAfterNode:function(b,a){return b.parentNode.insertBefore(a,b.nextSibling);},GetParents:function(b){var a=new Array();while(b){a.unshift(b);b=b.parentNode;}return a;},GetCommonParents:function(c,b){var f=this.GetParents(c);var e=this.GetParents(b);var a=[];for(var d=0;d<f.length;d++){if(f[d]==e[d]){a.push(f[d]);}}return a;},GetCommonParentNode:function(b,a,e){var f={};if(!e.pop){e=[e];}while(e.length>0){f[e.pop().toLowerCase()]=1;}var d=this.GetCommonParents(b,a);var c=null;while((c=d.pop())){if(f[c.nodeName.toLowerCase()]){return c;}}return null;},GetIndexOf:function(c){var b=c.parentNode?c.parentNode.firstChild:null;var a=-1;while(b){a++;if(b==c){return a;}b=b.nextSibling;}return -1;},PaddingNode:null,EnforcePaddingNode:function(d,a){try{if(!d||!d.body){return;}}catch(c){return;}this.CheckAndRemovePaddingNode(d,a,true);try{if(d.body.lastChild&&(d.body.lastChild.nodeType!=1||d.body.lastChild.tagName.toLowerCase()==a.toLowerCase())){return;}}catch(c){return;}var b=d.createElement(a);if(FCKBrowserInfo.IsGecko&&FCKListsLib.NonEmptyBlockElements[a]){FCKTools.AppendBogusBr(b);}this.PaddingNode=b;if(d.body.childNodes.length==1&&d.body.firstChild.nodeType==1&&d.body.firstChild.tagName.toLowerCase()=="br"&&(d.body.firstChild.getAttribute("_moz_dirty")!=null||d.body.firstChild.getAttribute("type")=="_moz")){d.body.replaceChild(b,d.body.firstChild);}else{d.body.appendChild(b);}},CheckAndRemovePaddingNode:function(f,c,b){var a=this.PaddingNode;if(!a){return;}try{if(a.parentNode!=f.body||a.tagName.toLowerCase()!=c||(a.childNodes.length>1)||(a.firstChild&&a.firstChild.nodeValue!="\xa0"&&String(a.firstChild.tagName).toLowerCase()!="br")){this.PaddingNode=null;return;}}catch(d){this.PaddingNode=null;return;}if(!b){if(a.parentNode.childNodes.length>1){a.parentNode.removeChild(a);}this.PaddingNode=null;}},HasAttribute:function(c,b){if(c.hasAttribute){return c.hasAttribute(b);}else{var a=c.attributes[b];return(a!=undefined&&a.specified);}},HasAttributes:function(c){var a=c.attributes;for(var b=0;b<a.length;b++){if(FCKBrowserInfo.IsIE){var d=a[b].nodeName;if(d.StartsWith("_fck")){continue;}if(d=="class"){if(c.className.length>0){return true;}continue;}}if(a[b].specified){return true;}}return false;},RemoveAttribute:function(b,a){if(FCKBrowserInfo.IsIE&&a.toLowerCase()=="class"){a="className";}return b.removeAttribute(a,0);},RemoveAttributes:function(c,a){for(var b=0;b<a.length;b++){this.RemoveAttribute(c,a[b]);}},GetAttributeValue:function(b,a){var c=a;if(typeof a=="string"){a=b.attributes[a];}else{c=a.nodeName;}if(a&&a.specified){if(c=="style"){return b.style.cssText;}else{if(c=="class"||c.indexOf("on")==0){return a.nodeValue;}else{return b.getAttribute(c,2);}}}return null;},Contains:function(b,a){if(b.contains&&a.nodeType==1){return b.contains(a);}while((a=a.parentNode)){if(a==b){return true;}}return false;},BreakParent:function(c,e,d){var a=d||new FCKDomRange(FCKTools.GetElementWindow(c));a.SetStart(c,4);a.SetEnd(e,4);var b=a.ExtractContents();a.InsertNode(c.parentNode.removeChild(c));b.InsertAfterNode(c);a.Release(!!d);},GetNodeAddress:function(f,g){var c=[];while(f&&f!=FCKTools.GetElementDocument(f).documentElement){var a=f.parentNode;var b=-1;for(var d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];if(g===true&&e.nodeType==3&&e.previousSibling&&e.previousSibling.nodeType==3){continue;}b++;if(a.childNodes[d]==f){break;}}c.unshift(b);f=f.parentNode;}return c;},GetNodeFromAddress:function(f,e,g){var h=f.documentElement;for(var b=0;b<e.length;b++){var c=e[b];if(!g){h=h.childNodes[c];continue;}var d=-1;for(var a=0;a<h.childNodes.length;a++){var k=h.childNodes[a];if(g===true&&k.nodeType==3&&k.previousSibling&&k.previousSibling.nodeType==3){continue;}d++;if(d==c){h=k;break;}}}return h;},CloneElement:function(a){a=a.cloneNode(false);a.removeAttribute("id",false);return a;},ClearElementJSProperty:function(b,a){if(FCKBrowserInfo.IsIE){b.removeAttribute(a);}else{delete b[a];}},SetElementMarker:function(a,c,b,d){var e=String(parseInt(Math.random()*4294967295,10));c._FCKMarkerId=e;c[b]=d;if(!a[e]){a[e]={"element":c,"markers":{}};}a[e]["markers"][b]=d;},ClearElementMarkers:function(a,d,c){var e=d._FCKMarkerId;if(!e){return;}this.ClearElementJSProperty(d,"_FCKMarkerId");for(var b in a[e]["markers"]){this.ClearElementJSProperty(d,b);}if(c){delete a[e];}},ClearAllMarkers:function(a){for(var b in a){this.ClearElementMarkers(a,a[b]["element"],true);}},ListToArray:function(c,d,k,h,l){if(!c.nodeName.IEquals(["ul","ol"])){return[];}if(!h){h=0;}if(!k){k=[];}for(var f=0;f<c.childNodes.length;f++){var a=c.childNodes[f];if(!a.nodeName.IEquals("li")){continue;}var g={"parent":c,"indent":h,"contents":[]};if(!l){g.grandparent=c.parentNode;if(g.grandparent&&g.grandparent.nodeName.IEquals("li")){g.grandparent=g.grandparent.parentNode;}}else{g.grandparent=l;}if(d){this.SetElementMarker(d,a,"_FCK_ListArray_Index",k.length);}k.push(g);for(var e=0;e<a.childNodes.length;e++){var b=a.childNodes[e];if(b.nodeName.IEquals(["ul","ol"])){this.ListToArray(b,d,k,h+1,g.grandparent);}else{g.contents.push(b);}}}return k;},ArrayToList:function(d,e,k){if(k==undefined){k=0;}if(!d||d.length<k+1){return null;}var m=FCKTools.GetElementDocument(d[k].parent);var b=m.createDocumentFragment();var c=null;var j=k;var n=Math.max(d[k].indent,0);var l=null;while(true){var o=d[j];if(o.indent==n){if(!c||d[j].parent.nodeName!=c.nodeName){c=d[j].parent.cloneNode(false);b.appendChild(c);}l=m.createElement("li");c.appendChild(l);for(var g=0;g<o.contents.length;g++){l.appendChild(o.contents[g].cloneNode(true));}j++;}else{if(o.indent==Math.max(n,0)+1){var h=this.ArrayToList(d,null,j);l.appendChild(h.listNode);j=h.nextIndex;}else{if(o.indent==-1&&k==0&&o.grandparent){var l;if(o.grandparent.nodeName.IEquals(["ul","ol"])){l=m.createElement("li");}else{if(FCKConfig.EnterMode.IEquals(["div","p"])&&!o.grandparent.nodeName.IEquals("td")){l=m.createElement(FCKConfig.EnterMode);}else{l=m.createDocumentFragment();}}for(var g=0;g<o.contents.length;g++){l.appendChild(o.contents[g].cloneNode(true));}if(l.nodeType==11){if(l.lastChild&&l.lastChild.getAttribute&&l.lastChild.getAttribute("type")=="_moz"){l.removeChild(l.lastChild);}l.appendChild(m.createElement("br"));}if(l.nodeName.IEquals(FCKConfig.EnterMode)&&l.firstChild){this.TrimNode(l);if(FCKListsLib.BlockBoundaries[l.firstChild.nodeName.toLowerCase()]){var f=m.createDocumentFragment();while(l.firstChild){f.appendChild(l.removeChild(l.firstChild));}l=f;}}if(FCKBrowserInfo.IsGeckoLike&&l.nodeName.IEquals(["div","p"])){FCKTools.AppendBogusBr(l);}b.appendChild(l);c=null;j++;}else{return null;}}}if(d.length<=j||Math.max(d[j].indent,0)<n){break;}}if(e){var a=b.firstChild;while(a){if(a.nodeType==1){this.ClearElementMarkers(e,a);}a=this.GetNextSourceNode(a);}}return{"listNode":b,"nextIndex":j};},GetNextSibling:function(b,a){b=b.nextSibling;while(b&&!a&&b.nodeType!=1&&(b.nodeType!=3||b.nodeValue.length==0)){b=b.nextSibling;}return b;},GetPreviousSibling:function(b,a){b=b.previousSibling;while(b&&!a&&b.nodeType!=1&&(b.nodeType!=3||b.nodeValue.length==0)){b=b.previousSibling;}return b;},CheckIsEmptyElement:function(c,b){var d=c.firstChild;var a;while(d){if(d.nodeType==1){if(a||!FCKListsLib.InlineNonEmptyElements[d.nodeName.toLowerCase()]){return false;}if(!b||b(d)===true){a=d;}}else{if(d.nodeType==3&&d.nodeValue.length>0){return false;}}d=d.nextSibling;}return a?this.CheckIsEmptyElement(a,b):true;},SetElementStyles:function(c,a){var d=c.style;for(var b in a){d[b]=a[b];}},SetOpacity:function(b,a){if(FCKBrowserInfo.IsIE){a=Math.round(a*100);b.style.filter=(a>100?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+a+")");}else{b.style.opacity=a;}},GetCurrentElementStyle:function(b,a){if(FCKBrowserInfo.IsIE){return b.currentStyle[a];}else{return b.ownerDocument.defaultView.getComputedStyle(b,"").getPropertyValue(a);}},GetPositionedAncestor:function(b){var a=b;while(a!=FCKTools.GetElementDocument(a).documentElement){if(this.GetCurrentElementStyle(a,"position")!="static"){return a;}if(a==FCKTools.GetElementDocument(a).documentElement&&currentWindow!=w){a=currentWindow.frameElement;}else{a=a.parentNode;}}return null;},ScrollIntoView:function(b,e){var d=FCKTools.GetElementWindow(b);var g=FCKTools.GetViewPaneSize(d).Height;var f=g*-1;if(e===false){f+=b.offsetHeight||0;f+=parseInt(this.GetCurrentElementStyle(b,"marginBottom")||0,10)||0;}var c=FCKTools.GetDocumentPosition(d,b);f+=c.y;var a=FCKTools.GetScrollPosition(d).Y;if(f>0&&(f>a||f<a-g)){d.scrollTo(0,f);}},CheckIsEditable:function(a){var c=a.nodeName.toLowerCase();var b=FCK.DTD[c]||FCK.DTD.span;return(b["#"]&&!FCKListsLib.NonEditableElements[c]);},GetSelectedDivContainers:function(){var f=[];var b=new FCKDomRange(FCK.EditorWindow);b.MoveToSelection();var d=b.GetTouchedStartNode();var a=b.GetTouchedEndNode();var e=d;if(d==a){while(a.nodeType==1&&a.lastChild){a=a.lastChild;}a=FCKDomTools.GetNextSourceNode(a);}while(e&&e!=a){if(e.nodeType!=3||!/^[ \t\n]*$/.test(e.nodeValue)){var g=new FCKElementPath(e);var c=g.BlockLimit;if(c&&c.nodeName.IEquals("div")&&f.IndexOf(c)==-1){f.push(c);}}e=FCKDomTools.GetNextSourceNode(e);}return f;}};