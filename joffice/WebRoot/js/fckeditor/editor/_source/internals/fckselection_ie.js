FCKSelection.GetType=function(){try{var b=FCKSelection.GetSelection().type;if(b=="Control"||b=="Text"){return b;}if(this.GetSelection().createRange().parentElement){return"Text";}}catch(a){}return"None";};FCKSelection.GetSelectedElement=function(){if(this.GetType()=="Control"){var a=this.GetSelection().createRange();if(a&&a.item){return this.GetSelection().createRange().item(0);}}return null;};FCKSelection.GetParentElement=function(){switch(this.GetType()){case"Control":var a=FCKSelection.GetSelectedElement();return a?a.parentElement:null;case"None":return null;default:return this.GetSelection().createRange().parentElement();}};FCKSelection.GetBoundaryParentElement=function(b){switch(this.GetType()){case"Control":var c=FCKSelection.GetSelectedElement();return c?c.parentElement:null;case"None":return null;default:var d=FCK.EditorDocument;var a=d.selection.createRange();a.collapse(b!==false);var c=a.parentElement();return FCKTools.GetElementDocument(c)==d?c:null;}};FCKSelection.SelectNode=function(a){FCK.Focus();this.GetSelection().empty();var c;try{c=FCK.EditorDocument.body.createControlRange();c.addElement(a);c.select();}catch(b){c=FCK.EditorDocument.body.createTextRange();c.moveToElementText(a);c.select();}};FCKSelection.Collapse=function(a){FCK.Focus();if(this.GetType()=="Text"){var b=this.GetSelection().createRange();b.collapse(a==null||a===true);b.select();}};FCKSelection.HasAncestorNode=function(c){var a;if(this.GetSelection().type=="Control"){a=this.GetSelectedElement();}else{var b=this.GetSelection().createRange();a=b.parentElement();}while(a){if(a.nodeName.IEquals(c)){return true;}a=a.parentNode;}return false;};FCKSelection.MoveToAncestorNode=function(c){var b,a;if(!FCK.EditorDocument){return null;}if(this.GetSelection().type=="Control"){a=this.GetSelection().createRange();for(i=0;i<a.length;i++){if(a(i).parentNode){b=a(i).parentNode;break;}}}else{a=this.GetSelection().createRange();b=a.parentElement();}while(b&&!b.nodeName.Equals(c)){b=b.parentNode;}return b;};FCKSelection.Delete=function(){var a=this.GetSelection();if(a.type.toLowerCase()!="none"){a.clear();}return a;};FCKSelection.GetSelection=function(){this.Restore();return FCK.EditorDocument.selection;};FCKSelection.Save=function(b){var d=FCK.EditorDocument;if(!d){return;}if(this.locked){return;}this.locked=!!b;var c=d.selection;var a;if(c){try{a=c.createRange();}catch(f){}if(a){if(a.parentElement&&FCKTools.GetElementDocument(a.parentElement())!=d){a=null;}else{if(a.item&&FCKTools.GetElementDocument(a.item(0))!=d){a=null;}}}}this.SelectionData=a;};FCKSelection._GetSelectionDocument=function(b){var a=b.createRange();if(!a){return null;}else{if(a.item){return FCKTools.GetElementDocument(a.item(0));}else{return FCKTools.GetElementDocument(a.parentElement());}}};FCKSelection.Restore=function(){if(this.SelectionData){FCK.IsSelectionChangeLocked=true;try{if(String(this._GetSelectionDocument(FCK.EditorDocument.selection).body.contentEditable)=="true"){FCK.IsSelectionChangeLocked=false;return;}this.SelectionData.select();}catch(a){}FCK.IsSelectionChangeLocked=false;}};FCKSelection.Release=function(){this.locked=false;delete this.SelectionData;};