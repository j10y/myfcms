var FCKPanel=function(f){this.IsRTL=(FCKLang.Dir=="rtl");this.IsContextMenu=false;this._LockCounter=0;this._Window=f||window;var c;if(FCKBrowserInfo.IsIE){this._Popup=this._Window.createPopup();var e=this._Window.document;if(FCK_IS_CUSTOM_DOMAIN&&!FCKBrowserInfo.IsIE7){e.domain=FCK_ORIGINAL_DOMAIN;document.domain=FCK_ORIGINAL_DOMAIN;}c=this.Document=this._Popup.document;if(FCK_IS_CUSTOM_DOMAIN){c.domain=FCK_RUNTIME_DOMAIN;e.domain=FCK_RUNTIME_DOMAIN;document.domain=FCK_RUNTIME_DOMAIN;}FCK.IECleanup.AddItem(this,FCKPanel_Cleanup);}else{var b=this._IFrame=this._Window.document.createElement("iframe");FCKTools.ResetStyles(b);b.src="javascript:void(0)";b.allowTransparency=true;b.frameBorder="0";b.scrolling="no";b.style.width=b.style.height="0px";FCKDomTools.SetElementStyles(b,{position:"absolute",zIndex:FCKConfig.FloatingPanelsZIndex});this._Window.document.body.appendChild(b);var d=b.contentWindow;c=this.Document=d.document;var a="";if(FCKBrowserInfo.IsSafari){a='<base href="'+window.document.location+'">';}c.open();c.write("<html><head>"+a+'</head><body style="margin:0px;padding:0px;"></body></html>');c.close();if(FCKBrowserInfo.IsAIR){FCKAdobeAIR.Panel_Contructor(c,window.document.location);}FCKTools.AddEventListenerEx(d,"focus",FCKPanel_Window_OnFocus,this);FCKTools.AddEventListenerEx(d,"blur",FCKPanel_Window_OnBlur,this);}c.dir=FCKLang.Dir;FCKTools.AddEventListener(c,"contextmenu",FCKTools.CancelEvent);this.MainNode=c.body.appendChild(c.createElement("DIV"));this.MainNode.style.cssFloat=this.IsRTL?"right":"left";};FCKPanel.prototype.AppendStyleSheet=function(a){FCKTools.AppendStyleSheet(this.Document,a);};FCKPanel.prototype.Preload=function(a,c,b){if(this._Popup){this._Popup.show(a,c,0,0,b);}};FCKPanel.prototype.ResizeForSubpanel=function(e,f,c){if(!FCKBrowserInfo.IsIE7){return false;}if(!this._Popup.isOpen){this.Subpanel=null;return false;}if(f==0&&c==0){if(this.Subpanel!==e){return false;}this.Subpanel=null;this.IncreasedX=0;}else{this.Subpanel=e;if((this.IncreasedX>=f)&&(this.IncreasedY>=c)){return false;}this.IncreasedX=Math.max(this.IncreasedX,f);this.IncreasedY=Math.max(this.IncreasedY,c);}var b=this.ShowRect.x;var d=this.IncreasedX;if(this.IsRTL){b=b-d;}var g=this.ShowRect.w+d;var a=Math.max(this.ShowRect.h,this.IncreasedY);if(this.ParentPanel){this.ParentPanel.ResizeForSubpanel(this,g,a);}this._Popup.show(b,this.ShowRect.y,g,a,this.RelativeElement);return this.IsRTL;};FCKPanel.prototype.Show=function(k,i,e,c,o){var j;var m=this.MainNode;if(this._Popup){this._Popup.show(k,i,0,0,e);FCKDomTools.SetElementStyles(m,{width:c?c+"px":"",height:o?o+"px":""});j=m.offsetWidth;if(FCKBrowserInfo.IsIE7){if(this.ParentPanel&&this.ParentPanel.ResizeForSubpanel(this,j,m.offsetHeight)){FCKTools.RunFunction(this.Show,this,[k,i,e]);return;}}if(this.IsRTL){if(this.IsContextMenu){k=k-j+1;}else{if(e){k=(k*-1)+e.offsetWidth-j;}}}if(FCKBrowserInfo.IsIE7){this.ShowRect={x:k,y:i,w:j,h:m.offsetHeight};this.IncreasedX=0;this.IncreasedY=0;this.RelativeElement=e;}this._PopupArgs=[k,i,j,m.offsetHeight,e];this._Popup.show(k,i,j,m.offsetHeight,e);if(this.OnHide){if(this._Timer){CheckPopupOnHide.call(this,true);}this._Timer=FCKTools.SetInterval(CheckPopupOnHide,100,this);}}else{if(typeof(FCK.ToolbarSet.CurrentInstance.FocusManager)!="undefined"){FCK.ToolbarSet.CurrentInstance.FocusManager.Lock();}if(this.ParentPanel){this.ParentPanel.Lock();FCKPanel_Window_OnBlur(null,this.ParentPanel);}if(FCKBrowserInfo.IsGecko&&FCKBrowserInfo.IsMac){this._IFrame.scrolling="";FCKTools.RunFunction(function(){this._IFrame.scrolling="no";},this);}if(FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel&&FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel!=this){FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel.Hide(false,true);}FCKDomTools.SetElementStyles(m,{width:c?c+"px":"",height:o?o+"px":""});j=m.offsetWidth;if(!c){this._IFrame.width=1;}if(!o){this._IFrame.height=1;}j=m.offsetWidth||m.firstChild.offsetWidth;var l=FCKTools.GetDocumentPosition(this._Window,e.nodeType==9?(FCKTools.IsStrictMode(e)?e.documentElement:e.body):e);var d=FCKDomTools.GetPositionedAncestor(this._IFrame.parentNode);if(d){var a=FCKTools.GetDocumentPosition(FCKTools.GetElementWindow(d),d);l.x-=a.x;l.y-=a.y;}if(this.IsRTL&&!this.IsContextMenu){k=(k*-1);}k+=l.x;i+=l.y;if(this.IsRTL){if(this.IsContextMenu){k=k-j+1;}else{if(e){k=k+e.offsetWidth-j;}}}else{var f=FCKTools.GetViewPaneSize(this._Window);var g=FCKTools.GetScrollPosition(this._Window);var b=f.Height+g.Y;var n=f.Width+g.X;if((k+j)>n){k-=k+j-n;}if((i+m.offsetHeight)>b){i-=i+m.offsetHeight-b;}}FCKDomTools.SetElementStyles(this._IFrame,{left:k+"px",top:i+"px"});this._IFrame.contentWindow.focus();this._IsOpened=true;var h=this;this._resizeTimer=setTimeout(function(){var p=m.offsetWidth||m.firstChild.offsetWidth;var q=m.offsetHeight;h._IFrame.style.width=p+"px";h._IFrame.style.height=q+"px";},0);FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel=this;}FCKTools.RunFunction(this.OnShow,this);};FCKPanel.prototype.Hide=function(a,b){if(this._Popup){this._Popup.hide();}else{if(!this._IsOpened||this._LockCounter>0){return;}if(typeof(FCKFocusManager)!="undefined"&&!b){FCKFocusManager.Unlock();}this._IFrame.style.width=this._IFrame.style.height="0px";this._IsOpened=false;if(this._resizeTimer){clearTimeout(this._resizeTimer);this._resizeTimer=null;}if(this.ParentPanel){this.ParentPanel.Unlock();}if(!a){FCKTools.RunFunction(this.OnHide,this);}}};FCKPanel.prototype.CheckIsOpened=function(){if(this._Popup){return this._Popup.isOpen;}else{return this._IsOpened;}};FCKPanel.prototype.CreateChildPanel=function(){var a=this._Popup?FCKTools.GetDocumentWindow(this.Document):this._Window;var b=new FCKPanel(a);b.ParentPanel=this;return b;};FCKPanel.prototype.Lock=function(){this._LockCounter++;};FCKPanel.prototype.Unlock=function(){if(--this._LockCounter==0&&!this.HasFocus){this.Hide();}};function FCKPanel_Window_OnFocus(b,a){a.HasFocus=true;}function FCKPanel_Window_OnBlur(b,a){a.HasFocus=false;if(a._LockCounter==0){FCKTools.RunFunction(a.Hide,a);}}function CheckPopupOnHide(a){if(a||!this._Popup.isOpen){window.clearInterval(this._Timer);this._Timer=null;if(this._Popup&&this.ParentPanel&&!a){this.ParentPanel.ResizeForSubpanel(this,0,0);}FCKTools.RunFunction(this.OnHide,this);}}function FCKPanel_Cleanup(){this._Popup=null;this._Window=null;this.Document=null;this.MainNode=null;this.RelativeElement=null;}