var WorkPlanForm=function(c){this.planId=c;var a=this.setup();var b=new Ext.Window({id:"WorkPlanFormWin",title:"工作计划详细信息",width:880,height:450,modal:true,layout:"anchor",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center",items:[this.setup()],buttons:[{text:"保存",iconCls:"btn-save",handler:function(){var d=Ext.getCmp("WorkPlanForm");if(d.getForm().isValid()){d.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(e,f){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("WorkPlanGrid").getStore().reload();b.close();},failure:function(e,f){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});b.close();}});}}},{text:"取消",iconCls:"btn-cancel",handler:function(){b.close();}}]});b.show();};WorkPlanForm.prototype.setup=function(){var a=new Ext.FormPanel({url:__ctxPath+"/task/saveWorkPlan.do",layout:"column",id:"WorkPlanForm",frame:true,defaults:{anchor:"98%,98%"},formId:"WorkPlanFormId",defaultType:"textfield",items:[{name:"workPlan.planId",id:"planId",xtype:"hidden",value:this.planId==null?"":this.planId},{name:"issueScopeIds",id:"issueScopeIds",xtype:"hidden"},{name:"participantsIds",id:"participantsIds",xtype:"hidden"},{name:"principalIds",id:"principalIds",xtype:"hidden"},{layout:"form",defaultType:"textfield",columnWidth:0.5,xtype:"container",labelWidth:60,items:[{fieldLabel:"计划名称",name:"workPlan.planName",width:348,id:"planName"},{xtype:"container",height:26,layout:"column",style:"padding-left:0px;",defaultType:"label",items:[{text:"时间范围:",width:61,style:"padding-left:0px;padding-top:3px;"},{text:"从",style:"padding-left:0px;padding-top:3px;"},{xtype:"datefield",width:149,format:"Y-m-d",editable:false,name:"workPlan.startTime",id:"startTime"},{text:"至",style:"padding-left:0px;padding-top:3px;"},{xtype:"datefield",width:149,format:"Y-m-d",editable:false,name:"workPlan.endTime",id:"endTime"}]},{fieldLabel:"计划内容",name:"workPlan.planContent",xtype:"htmleditor",height:250,width:348,id:"planContent"},{layout:"column",style:"padding-left:0px;",width:500,xtype:"container",items:[{columnWidth:0.7,style:"padding-left:0px;",layout:"form",items:[{fieldLabel:"附件",xtype:"panel",id:"planFilePanel",frame:true,height:80,autoScroll:true,html:""}]},{columnWidth:0.3,items:[{xtype:"button",text:"添加附件",handler:function(){var b=App.createUploadDialog({file_cat:"task",callback:function(f){var c=Ext.getCmp("planFileIds");var e=Ext.getCmp("planFilePanel");for(var d=0;d<f.length;d++){if(c.getValue()!=""){c.setValue(c.getValue()+",");}c.setValue(c.getValue()+f[d].fileId);Ext.DomHelper.append(e.body,'<span><a href="#" onclick="FileAttachDetail.show('+f[d].fileId+')">'+f[d].filename+'</a> <img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removePlanFile(this,'+f[d].fileId+')"/>&nbsp;|&nbsp;</span>');}}});b.show(this);}},{xtype:"button",text:"清除附件",handler:function(){var c=Ext.getCmp("planFileIds");var b=Ext.getCmp("planFilePanel");b.body.update("");c.setValue("");}},{xtype:"hidden",id:"planFileIds",name:"planFileIds"}]}]}]},{layout:"form",columnWidth:0.5,xtype:"container",items:[{fieldLabel:"计划类型",hiddenName:"workPlan.planType.typeId",xtype:"combo",width:273,editable:false,triggerAction:"all",id:"typeId",displayField:"name",valueField:"id",mode:"local",store:new Ext.data.SimpleStore({autoLoad:true,url:__ctxPath+"/task/comboPlanType.do",fields:["id","name"]})},{xtype:"container",style:"padding-left:0px;padding-bottom:3px;",layout:"column",items:[{xtype:"label",style:"padding-left:0px;",text:"发布范围:",width:101},{xtype:"textfield",name:"workPlan.issueScope",id:"issueScope",readOnly:true},{xtype:"button",text:"选择部门",iconCls:"btn-select",handler:function(){DepSelector.getView(function(c,b){Ext.getCmp("issueScope").setValue(b);Ext.getCmp("issueScopeIds").setValue(c);}).show();}},{xtype:"button",text:"清除记录"}]},{xtype:"container",layout:"column",style:"padding-left:0px;padding-bottom:3px;",items:[{xtype:"label",text:"参与人:",style:"padding-left:0px;",width:101},{xtype:"textfield",name:"workPlan.participants",id:"participants",readOnly:true},{xtype:"button",text:"选择人员",iconCls:"btn-select",handler:function(){UserSelector.getView(function(c,b){Ext.getCmp("participants").setValue(b);Ext.getCmp("participantsIds").setValue(c);}).show();}},{xtype:"button",text:"清除记录"}]},{xtype:"container",layout:"column",style:"padding-left:0px;padding-bottom:3px;",items:[{xtype:"label",text:"负责人:",style:"padding-left:0px;",width:101},{xtype:"textfield",name:"workPlan.principal",id:"principal",readOnly:true},{xtype:"button",text:"选择人员",iconCls:"btn-select",handler:function(){UserSelector.getView(function(c,b){Ext.getCmp("principal").setValue(b);Ext.getCmp("principalIds").setValue(c);}).show();}},{xtype:"button",text:"清除记录"}]},{xtype:"radiogroup",fieldLabel:"是否启用",autoHeight:true,columns:2,items:[{boxLabel:"是",name:"workPlan.status",inputValue:1,id:"status1",checked:true},{boxLabel:"否",name:"workPlan.status",inputValue:0,id:"status0"}]},{xtype:"radiogroup",fieldLabel:"是否为个人计划",autoHeight:true,columns:2,items:[{boxLabel:"个人",name:"workPlan.isPersonal",inputValue:0,id:"isPersonal0",checked:true},{boxLabel:"部门",name:"workPlan.isPersonal",inputValue:1,id:"isPersonal1"}]},{fieldLabel:"图标",hiddenName:"workPlan.icon",id:"icon",xtype:"iconcomb",mode:"local",anchor:"92.5%",allowBlank:false,editable:false,store:new Ext.data.SimpleStore({fields:["countryCode","countryName"],data:[["ux-flag-de","日常计划"],["ux-flag-us","重要计划"],["ux-flag-fr","特殊计划"]]}),valueField:"countryCode",displayField:"countryName",triggerAction:"all",mode:"local"},{fieldLabel:"备注",name:"workPlan.note",xtype:"textarea",id:"note",width:273,height:180}]}]});if(this.planId!=null&&this.planId!="undefined"){a.getForm().load({deferredRender:false,url:__ctxPath+"/task/getWorkPlan.do?planId="+this.planId,waitMsg:"正在载入数据...",success:function(c,e){var d=e.result.data.startTime;var f=e.result.data.status;var k=e.result.data.isPersonal;Ext.getCmp("status"+f).setValue(true);Ext.getCmp("isPersonal"+k).setValue(true);var h=e.result.data.endTime;var b=e.result.data.planType.typeId;Ext.getCmp("typeId").setValue(b);var l=e.result.data.planFiles;Ext.getCmp("startTime").setValue(new Date(getDateFromFormat(d,"yyyy-MM-dd H:mm:ss")));Ext.getCmp("endTime").setValue(new Date(getDateFromFormat(h,"yyyy-MM-dd H:mm:ss")));var j=Ext.getCmp("planFilePanel");var m=Ext.getCmp("planFileIds");for(var g=0;g<l.length;g++){if(m.getValue()!=""){m.setValue(m.getValue()+",");}m.setValue(m.getValue()+l[g].fileId);Ext.DomHelper.append(j.body,'<span><a href="#" onclick="FileAttachDetail.show('+l[g].fileId+')">'+l[g].fileName+'</a><img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removePlanFile(this,'+l[g].fileId+')"/>&nbsp;|&nbsp;</span>');}},failure:function(b,c){Ext.ux.Toast.msg("编辑","载入失败");}});}return a;};function removePlanFile(e,a){var b=Ext.getCmp("planFileIds");var d=b.getValue();if(d.indexOf(",")<0){b.setValue("");}else{d=d.replace(","+a,"").replace(a+",","");b.setValue(d);}var c=Ext.get(e.parentNode);c.remove();}