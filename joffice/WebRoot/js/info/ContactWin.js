var ContactWin=function(){var a=this.initWin();var b=new Ext.Window({title:"选择联系人",width:440,height:500,items:[a],buttonAlign:"center",buttons:[{text:"确认",handler:function(){var d=Ext.getCmp("contactGrid");var o=d.getSelectionModel().getSelections();if(o.length==0){Ext.ux.Toast.msg("信息","请选择要添加的联系人！");return;}var n="";var m="";var k=Ext.getCmp("userFullname");var l=Ext.getCmp("userId");for(var h=0;h<o.length;h++){var c=l.getValue().split(",");var e=o[h].data.userId;var f=false;for(var g=0;g<c.length;g++){if(c[g]==e){f=true;Ext.ux.Toast.msg("警告","已经存在了");return f;}}if(!f){n=n+e+",";m=m+o[h].data.fullname+",";}}l.setValue(l.getValue()+n);k.setValue(k.getValue()+m);}},{text:"关闭",handler:function(){b.close();}}]});b.show();};ContactWin.prototype.initWin=function(){var c=this.initData();c.load({params:{start:0,limit:10}});var h=new Ext.grid.CheckboxSelectionModel();var b=new Ext.grid.ColumnModel({columns:[h,new Ext.grid.RowNumberer(),{header:"用户名",dataIndex:"fullname",width:60}],defaults:{sortable:true,menuDisabled:true,width:100},listeners:{hiddenchange:function(i,j,k){saveConfig(j,k);}}});var f=new Ext.tree.TreePanel({id:"treePanels",title:"按部门分类 ",loader:new Ext.tree.TreeLoader({url:__ctxPath+"/system/listDepartment.do"}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false,listeners:{"click":ContactWin.clickNode}});var e=new Ext.tree.TreePanel({id:"rolePanel",title:"按角色分类 ",loader:new Ext.tree.TreeLoader({url:__ctxPath+"/system/treeAppRole.do"}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false,listeners:{"click":ContactWin.clickRoleNode}});var d=new Ext.Panel({id:"onlinePanel",title:"在线人员  "});var g=new Ext.grid.GridPanel({id:"contactGrid",height:400,store:c,shim:true,trackMouseOver:true,disableSelection:false,loadMask:true,cm:b,sm:h,viewConfig:{forceFit:true,enableRowBody:false,showPreview:false},bbar:new Ext.PagingToolbar({pageSize:10,store:c,displayInfo:true,displayMsg:"当前显示从{0}至{1}， 共{2}条记录",emptyMsg:"当前没有记录"})});var a=new Ext.Panel({id:"contactPanel",width:400,height:420,layout:"border",border:false,items:[{region:"west",split:true,collapsible:true,width:150,margins:"5 0 5 5",layout:"accordion",items:[f,e,d]},{region:"center",margins:"5 0 5 5",width:220,items:[g]}]});return a;};ContactWin.prototype.initData=function(){var a=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/system/selectAppUser.do"}),reader:new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",id:"id",fields:[{name:"userId",type:"int"},"fullname"]}),remoteSort:true});a.setDefaultSort("id","desc");return a;};ContactWin.clickNode=function(b){if(b!=null){var c=Ext.getCmp("contactGrid");var a=c.getStore();a.url=__ctxPath+"/system/selectAppUser.do";a.baseParams={depId:b.id};a.params={start:0,limit:10};a.reload({params:{start:0,limit:10}});}};ContactWin.clickRoleNode=function(b){if(b!=null){var c=Ext.getCmp("contactGrid");var a=c.getStore();a.url=__ctxPath+"/system/findAppUser.do";a.baseParams={roleId:b.id};a.params={start:0,limit:10};a.reload({params:{start:0,limit:10}});}};