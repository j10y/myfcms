Ext.namespace("e2cs.schedviews");e2cs.schedviews.subView={Day:0,Week:1,Month:2,TwoMonths:3,Quarter:4};e2cs.schedviews.Units={Hours:0,Days:1,Weeks:2};Ext.ECalendar.scheduleview=function(a){Ext.apply(this,a);this.addEvents("headerClick","beforePeriodChange","afterPeriodChange");Ext.ECalendar.scheduleview.superclass.constructor.call(this);};Ext.extend(Ext.ECalendar.scheduleview,Ext.util.Observable,{referid:"schedule",header:true,headerFormat:"M-Y",headerButtons:true,headerAction:"gotoview",periodSelector:false,blankzonebg:"#6C90B4",blankHTML:"",listItems:{headerTitle:"Events on the period",periodFormats:{Day:"l - d - F  - Y",DayScheduler_format:"d",hourFormat:"h:i a",startTime:"7:00:00 am",endTime:"10:00:00 pm",WeekTPL:'<tpl for=".">'+e2cs.cal_locale.scheduler_headerListStrings.week+" {numweek} "+e2cs.cal_locale.scheduler_headerListStrings.start+"{datestart} "+e2cs.cal_locale.scheduler_headerListStrings.end+" {dateend}</tpl>",WeekFormat:"W",DatesFormat:"d/m/Y",Month:"M-Y",TwoMonthsTPL:'<tpl for=".">'+e2cs.cal_locale.scheduler_headerListStrings.period+" {numperiod} "+e2cs.cal_locale.scheduler_headerListStrings.start+" {datestart} "+e2cs.cal_locale.scheduler_headerListStrings.end+" {dateend}</tpl>",QuarterTPL:'<tpl for=".">'+e2cs.cal_locale.scheduler_headerListStrings.period+" {numperiod} "+e2cs.cal_locale.scheduler_headerListStrings.start+" {datestart} "+e2cs.cal_locale.scheduler_headerListStrings.end+" {dateend}</tpl>"},useStoreColor:false,descriptionWidth:250,parentLists:false,launchEventOn:"click",editableEvents:false,moreMenuItems:[],ShowMenuItems:[1,1,1,1,1,1,1,1],taskdd_ShowMenuItems:[1,1,1],taskdd_BaseColor:"#ffffff",taskdd_clsOver:"",taskdd_showqtip:true,taskdd_shownames:true},listbody:{periodType:e2cs.schedviews.subView.Month,headerUnit:e2cs.schedviews.Units.Days,headerUnitWidth:25},contextMenuLabels:e2cs.cal_locale.contextMenuLabelsSchedule,thisview:null,init:function(b,a){this.calx=b;this.datetohandle=a;if(this.listbody.periodType>=1||this.listbody.periodType<=4){if(this.listbody.headerUnit==0){this.listbody.headerUnit=1;}}if(this.listbody.periodType==1||this.listbody.periodType==2){if(this.listbody.headerUnit!=1){this.listbody.headerUnit=1;}}if(this.listbody.periodType==0&&this.listbody.headerUnit!=0){this.listbody.headerUnit=0;}},refreshView:function(){this.render();},render:function(){var a=new Ext.LoadMask(this.calx.id,{removeMask:true,msg:e2cs.cal_locale.loadmaskText});a.show();this.datetohandle=this.calx.currentdate;var j=Ext.get(this.calx.body);var z=j.dom.childNodes.length;if(z){for(var t=z;t<z;t++){j.dom.removeChild(j.dom.childNodes[0]);}}j.update("");var p='<div id="'+this.calx.id+'-main-calendar-header"></div>';p+='<div id="'+this.calx.id+'-main-calendar-sched-body"></div>';j.update(p);if(this.header){var s=Ext.get(this.calx.id+"-main-calendar-header");var l=s.wrap({tag:"div",cls:"x-calendar-sched-header",html:""});if(this.headerButtons){var m=l.createChild({id:this.calx.id+"-btn-nm",tag:"div",cls:"x-calendar-sched-next",html:""});var h=l.createChild({id:this.calx.id+"-btn-pm",tag:"div",cls:"x-calendar-sched-previous",html:""});h.dom["qtip"]=e2cs.cal_locale.headerTooltipsScheduler.prev;h.addListener("click",this.onclickprev_period,this);h.addClassOnOver("x-calendar-sched-previous-over");m.dom["qtip"]=e2cs.cal_locale.headerTooltipsScheduler.next;m.addListener("click",this.onclicknext_period,this);m.addClassOnOver("x-calendar-sched-next-over");}var k=this.getHeaderLabel();var B=l.createChild({tag:"div",id:"header",html:""+k+""});}this.numelements=0;var d=this.genSchedbodyHeader();var o=Ext.get(this.calx.id+"-main-calendar-sched-body");if(this.calx.ownerCt!=undefined){if(this.calx.ownerCt.ctype&&this.calx.ownerCt.ctype=="Ext.Component"){this.calx.height=this.calx.ownerCt.getInnerHeight();}}anchoCalendar=Ext.get(this.calx.body).getWidth();if(Ext.isIE){o.setWidth(anchoCalendar,false);}if(this.calx.border){anchoCalendar+=(-2);}anchotable2cntheaders=anchoCalendar-this.listItems.descriptionWidth;countxvalwidth=(this.listbody.headerUnitWidth*this.numelements);var n={TABLEXXW1:anchoCalendar,TDXXVAL2:anchotable2cntheaders,TDXXVAL3:countxvalwidth};var w=new Ext.XTemplate('<tpl for=".">'+d+"</tpl>");var e=w.applyTemplate(n);var b=o.wrap({tag:"div",cls:"x-calendar-sched-body-header",html:e});Ext.get(this.calx.id+"-container_header_sched_base").setStyle("background-color",this.blankzonebg);if(Ext.isIE){b.setStyle("overflow","hidden");b.setWidth(anchoCalendar,false);this.refercolmns=Ext.select("div.sched_hdrbody_vals_IE",true);}else{this.refercolmns=Ext.select("div.sched_hdrbody_vals",true);}this.refercolmns.each(function(D,i,C){if(D.id.indexOf(this.calx.id+"-tdsched_valcols-")+1>=1){if(Ext.isIE){D.addClassOnOver("sched_hdrbody_valsover_IE");}else{D.addClassOnOver("sched_hdrbody_valsover");}D.addListener("click",this.onclick_myheadersvalues,this);}},this);var A=this.getTasksforPeriod();if(A.length>0){var c=this.genShedContentList(A);var g={ANCHO1TOTAL:countxvalwidth+this.listItems.descriptionWidth,ANCHOREFLIST:this.listItems.descriptionWidth,anchocolgrids:countxvalwidth,TOPcontenedorTASKS:100};var y=new Ext.XTemplate('<tpl for=".">'+c+"</tpl>");var f=y.applyTemplate(g);o.insertHtml("beforeEnd",f,false);if(this.calx.ownerCt!=undefined){var u=0;if(this.calx.header){u+=27;}if(this.calx.showCal_tbar){u+=26;}if(this.header){u+=47;}var r=this.calx.ownerCt.getInnerHeight()-u;Ext.get(this.calx.id+"-body-sched-container-list").setStyle("height",r+"px");}else{if(this.header){Ext.get(this.calx.id+"-body-sched-container-list").setStyle("height",(Ext.get(this.calx.body).getHeight()-47)+"px");}else{Ext.get(this.calx.id+"-body-sched-container-list").setStyle("height",(Ext.get(this.calx.body).getHeight()-23)+"px");}}if(Ext.isIE){Ext.get(this.calx.id+"-body-sched-container-list").setWidth(anchoCalendar,false);Ext.get(this.calx.id+"-body-sched-container-list").setStyle("overflow","auto");}Ext.get(this.calx.id+"-body-sched-container-list").setStyle("background-color",this.blankzonebg);Ext.get(this.calx.id+"body-sched-insider").setStyle("height",(Ext.get(this.calx.id+"-skeleton_sched").getHeight()+1)+"px");Ext.get(this.calx.id+"body-sched-insider").setStyle("width",(countxvalwidth+this.listItems.descriptionWidth)+"px");Ext.get(this.calx.id+"body-sched-insider").setStyle("background-color","#FFFFFF");myscrollelement=Ext.get(this.calx.id+"-body-sched-container-list");mycalendartmp=this.calx;myscrollelement.on("scroll",function(){var i=this.dom.scrollLeft;Ext.get(mycalendartmp.id+"-subcontainer_sched_headers").setStyle("margin-left","-"+i+"px");},myscrollelement);var x=Ext.get(this.calx.id+"-skeleton_sched").getHeight();var v=Ext.get(this.calx.id+"-taskdd-container");v.setStyle("top","-"+x+"px");v.setStyle("height",x+"px");this.refertasks=Ext.select("div.sched_lisItem_div",true);this.refertasks.each(function(D,i,C){if(D.id.indexOf(this.calx.id+"-eventno-")+1>=1){D.addClassOnOver("sched_listItem_mouseOver");if(this.listItems.launchEventOn!=""){D.addListener(this.listItems.launchEventOn,this.onclick_listItems,this);}if(this.listItems.editableEvents){if(Ext.isOpera){D.addListener("mousedown",this.operabuttons_for_listItem,this);}else{D.addListener("contextmenu",this.oncontextmenu_for_lisItem,this,{stopPropagation:true,normalized:true,preventDefault:true});}}}},this);myddcontainer=Ext.get(this.calx.id+"-taskdd-container");this.createTasksDD(A,myddcontainer);}else{notaskhtml=this.genShedNoContentScreen();o.insertHtml("beforeEnd",notaskhtml,false);if(this.header){Ext.get(this.calx.id+"-body-sched-no-task-screen").setStyle("height",(Ext.get(this.calx.body).getHeight()-46)+"px");}else{Ext.get(this.calx.id+"-body-sched-no-task-screen").setStyle("height",(Ext.get(this.calx.body).getHeight()-23)+"px");}Ext.get(this.calx.id+"-body-sched-no-task-screen").setStyle("background-color",this.blankzonebg);var q=Ext.DomQuery.selectNode("div[id="+this.calx.id+"_addevent_element_screen]");if(q!=undefined){Ext.get(q.id).addListener("click",this.neweventlaunch,this);}}a.hide();},operabuttons_for_listItem:function(b,c,a){if(b.button==2){this.oncontextmenu_for_lisItem(b,c,a);}},operabuttons_for_taskdd:function(b,c,a){if(b.button==2){this.oncontextmenu_for_taskdd(b,c,a);}},oncontextmenu_for_lisItem:function(f,d,g){if(d.id.indexOf(this.calx.id+"-eventno-")+1>=1){}else{return false;}f.stopEvent();if(this.menu_listItem){this.menu_listItem.removeAll();}var c=d.id.replace(this.calx.id+"-eventno-","");var h=parseInt(c);var j=this.calx.store.getById(h).data;tmpmenuobjs=[];if(this.listItems.ShowMenuItems[0]){buttonx1=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-Add",iconCls:"x-calendar-sched-btnmv_add",text:e2cs.cal_locale.contextMenuLabelsSchedule.taskAdd});buttonx1.addListener("click",function(){this.neweventlaunch();},this);tmpmenuobjs.push(buttonx1);}if(this.listItems.ShowMenuItems[2]){buttonx3=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-Delete",iconCls:"x-calendar-sched-btnmv_delete",text:e2cs.cal_locale.contextMenuLabelsSchedule.taskDelete+" "+h+" "});buttonx3.addListener("click",function(){var k=this.getTaskarray(j);var i=this.calx.fireEvent("beforeTaskDelete",k,this.vday);if(i){if(this.calx.fireEvent("onTaskDelete",k)==true){this.calx.fireEvent("afterTaskDelete",k,true);}else{this.calx.fireEvent("afterTaskDelete",null,false);}}},this);tmpmenuobjs.push(buttonx3);}if(this.listItems.ShowMenuItems[1]){buttonx2=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-Edit",iconCls:"x-calendar-sched-btnmv_edit",text:e2cs.cal_locale.contextMenuLabelsSchedule.taskEdit+" "+h+" "});buttonx2.addListener("click",function(){var k=this.getTaskarray(j);var i=this.calx.fireEvent("beforeTaskEdit",k,this.vday);if(i){if(this.calx.fireEvent("onTaskEdit",k)==true){this.calx.fireEvent("afterTaskEdit",k,true);}else{this.calx.fireEvent("afterTaskEdit",null,false);}}},this);tmpmenuobjs.push(buttonx2);}if(this.listItems.ShowMenuItems[0]||this.listItems.ShowMenuItems[1]||this.listItems.ShowMenuItems[2]){button_sep_one=new Ext.menu.Separator({});tmpmenuobjs.push(button_sep_one);}if(this.listItems.ShowMenuItems[3]){buttonx4=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-gnp",iconCls:"x-calendar-sched-btnmv_nextperiod",text:e2cs.cal_locale.contextMenuLabelsSchedule.NextPeriod});buttonx4.addListener("click",this.onclicknext_period,this);tmpmenuobjs.push(buttonx4);}if(this.listItems.ShowMenuItems[4]){buttonx5=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-gpp",iconCls:"x-calendar-sched-btnmv_prevperiod",text:e2cs.cal_locale.contextMenuLabelsSchedule.PreviousPeriod});buttonx5.addListener("click",this.onclickprev_period,this);tmpmenuobjs.push(buttonx5);}if(this.listItems.ShowMenuItems[3]||this.listItems.ShowMenuItems[4]){button_sep_two=new Ext.menu.Separator({});tmpmenuobjs.push(button_sep_two);}if(this.listItems.ShowMenuItems[5]&&this.listItems.ShowMenuItems[6]&&this.listItems.ShowMenuItems[7]){}else{if(this.listItems.ShowMenuItems[3]&&this.listItems.ShowMenuItems[4]){}else{if(this.listItems.ShowMenuItems[0]&&this.listItems.ShowMenuItems[1]&&this.listItems.ShowMenuItems[2]){}else{tmpmenuobjs.pop();}}}if(this.listItems.ShowMenuItems[5]){buttonx6=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-chgm",iconCls:"x-calendar-sched-btnmv_viewmonth",text:e2cs.cal_locale.contextMenuLabelsSchedule.chgmview});buttonx6.addListener("click",function(){this.changeCalview(0);},this);tmpmenuobjs.push(buttonx6);}if(this.listItems.ShowMenuItems[6]){buttonx6=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-chgw",iconCls:"x-calendar-sched-btnmv_viewweek",text:e2cs.cal_locale.contextMenuLabelsSchedule.chgwview});buttonx6.addListener("click",function(){this.changeCalview(1);},this);tmpmenuobjs.push(buttonx6);}if(this.listItems.ShowMenuItems[7]){buttonx7=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-chgd",iconCls:"x-calendar-sched-btnmv_viewday",text:e2cs.cal_locale.contextMenuLabelsSchedule.chgdview});buttonx7.addListener("click",function(){this.changeCalview(2);},this);tmpmenuobjs.push(buttonx7);}if((this.listItems.ShowMenuItems[5]||this.listItems.ShowMenuItems[6]||this.listItems.ShowMenuItems[7])&&this.listItems.moreMenuItems.length>0){button_sep_three=new Ext.menu.Separator({});tmpmenuobjs.push(button_sep_three);}if(this.listItems.moreMenuItems.length>0){for(var e=0;e<this.listItems.moreMenuItems.length;e++){var a=this.listItems.moreMenuItems[e].id;this.listItems.moreMenuItems[e].rendered=false;this.listItems.moreMenuItems[e].addListener("click",function(i){this.onCustomMenuAction(i.id,Ext.get(d));},this);tmpmenuobjs.push(this.listItems.moreMenuItems[e]);}}this.menu_listItem=new Ext.menu.Menu({id:this.calx.id+"-contextmenu-listItem-sel",shadow:true,items:[]});var b=tmpmenuobjs.length;for(var e=0;e<b;e++){this.menu_listItem.add(tmpmenuobjs[e]);}this.menu_listItem.on("hide",this.onContextHide,this);this.menu_listItem.showAt([f.getPageX(),f.getPageY()]);},oncontextmenu_for_taskdd:function(k,e,l){if(e.id.indexOf(this.calx.id+"-shced-taskdd-")+1>=1){}else{return false;}if(this.listItems.taskdd_ShowMenuItems[0]==false&&this.listItems.taskdd_ShowMenuItems[1]==false&&this.listItems.taskdd_ShowMenuItems[2]==false&&this.listItems.moreMenuItems.length>0){return false;}k.stopEvent();if(this.taskmenu_listItem){this.taskmenu_listItem.removeAll();}var c=e.id.replace(this.calx.id+"-shced-taskdd-","");var m=parseInt(c);var p=this.calx.store.getById(m).data;var n=this.getTaskarray(p);var f=[];var o=this.listItems.taskdd_ShowMenuItems;var h=[];var b=this.listItems.moreMenuItems;var d=this.calx.fireEvent("beforeContextMenuTask","schedule-task",n,o,h);if(d==false){if(h[0]==false){if(h[1]==true){if(h[2]==true){var b=h[3];}var o=h[4];}else{var b=this.listItems.moreMenuItems;var o=this.listItems.taskdd_ShowMenuItems;}}else{return false;}}else{var b=this.listItems.moreMenuItems;}if(o[0]){buttonx1=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-Add",iconCls:"x-calendar-sched-btnmv_add",text:e2cs.cal_locale.contextMenuLabelsSchedule.taskAdd});buttonx1.addListener("click",function(){this.neweventlaunch();},this);f.push(buttonx1);}if(o[2]){buttonx3=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-Delete",iconCls:"x-calendar-sched-btnmv_delete",text:e2cs.cal_locale.contextMenuLabelsSchedule.taskDelete+" "+m+" "});buttonx3.addListener("click",function(){var q=this.getTaskarray(p);var i=this.calx.fireEvent("beforeTaskDelete",q,this.vday);if(i){if(this.calx.fireEvent("onTaskDelete",q)==true){this.calx.fireEvent("afterTaskDelete",q,true);}else{this.calx.fireEvent("afterTaskDelete",null,false);}}},this);f.push(buttonx3);}if(o[1]){buttonx2=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-Edit",iconCls:"x-calendar-sched-btnmv_edit",text:e2cs.cal_locale.contextMenuLabelsSchedule.taskEdit+" "+m+" "});buttonx2.addListener("click",function(){var q=this.getTaskarray(p);var i=this.calx.fireEvent("beforeTaskEdit",q,this.vday);if(i){if(this.calx.fireEvent("onTaskEdit",q)==true){this.calx.fireEvent("afterTaskEdit",q,true);}else{this.calx.fireEvent("afterTaskEdit",null,false);}}},this);f.push(buttonx2);}if((o[0]||o[1]||o[2])&&b.length>0){button_sep_one=new Ext.menu.Separator({});f.push(button_sep_one);}if(b.length>0){for(var g=0;g<b.length;g++){b[g].rendered=false;if(b[g].menu==undefined){if(b[g].ctype=="Ext.menu.Item"){b[g].addListener("click",function(q,i){this.onCustomMenuAction(q.id,Ext.get(e));},this);}else{}f.push(b[g]);}else{for(var j=0;j<b[g].menu.items.length;j++){b[g].menu.items.items[j].rendered=false;if(b[g].menu.items.items[j].ctype=="Ext.menu.Item"){b[g].menu.items.items[j].addListener("click",function(q,i){this.onCustomMenuAction(q.id,Ext.get(e));},this);}else{}}f.push(b[g]);}}}this.taskmenu_listItem=new Ext.menu.Menu({id:this.calx.id+"-contextmenu-listItem-taskdd-sel",shadow:true,items:[]});var a=f.length;for(var g=0;g<a;g++){this.taskmenu_listItem.add(f[g]);}this.taskmenu_listItem.on("hide",this.onContextHide,this);this.taskmenu_listItem.showAt([k.getPageX(),k.getPageY()]);},onContextHide:function(){},onCustomMenuAction:function(e,b){if(b.id.indexOf(this.calx.id+"-eventno-")+1>=1){var d=b.id.replace(this.calx.id+"-eventno-","");var a=parseInt(d);var c=this.getTaskarray(this.calx.store.getById(a).data);this.calx.fireEvent("customMenuAction",e,"scheduler",c,b,this);}if(b.id.indexOf(this.calx.id+"-shced-taskdd-")+1>=1){var d=b.id.replace(this.calx.id+"-shced-taskdd-","");var a=parseInt(d);var c=this.getTaskarray(this.calx.store.getById(a).data);this.calx.fireEvent("customMenuAction",e,"scheduler",c,b,this);}this.taskmenu_listItem.hide();},onclick_myheadersvalues:function(e,f,c){if(f.id.indexOf("hour-")+1>0){var d=f.id.replace("hour-"+this.calx.id+"-tdsched_valcols-","");d=d.substr(d.indexOf("-")+1);if(this.headerAction=="gotoview"){if(this.calx.viewday!=null||this.calx.viewday!=undefined){if(this.calx.fireEvent("beforeChangeView","day","schedule",this.calx)==false){return false;}else{this.calx.currentdate=new Date(d);this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);this.calx.currentView="day";this.calx.viewday.render();this.calx.fireEvent("onChangeView","day","schedule",this);}}}else{mydatetohandledt=new Date(d);if(this.headerAction=="event"){this.fireEvent("headerClick","hour",mydatetohandledt,this,this.calx);}}}if(f.id.indexOf("days-")+1>0){var d=f.id.replace("days-"+this.calx.id+"-tdsched_valcols-","");if(this.headerAction=="gotoview"){if(this.calx.viewday!=null||this.calx.viewday!=undefined){if(this.calx.fireEvent("beforeChangeView","day","schedule",this.calx)==false){return false;}else{this.calx.currentdate=new Date(d);this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);this.calx.currentView="day";this.calx.viewday.render();this.calx.fireEvent("onChangeView","day","schedule",this);}}}else{mydatetohandledt=new Date(d);if(this.headerAction=="event"){this.fireEvent("headerClick","day",mydatetohandledt,this,this.calx);}}}if(f.id.indexOf("weeks-")+1>0){var b=f.id.replace("weeks-"+this.calx.id+"-tdsched_valcols-","");var a=this.calx.getDateRangeOfWeek(b);if(this.headerAction=="gotoview"){if(this.calx.viewweek!=null||this.calx.viewweek!=undefined){if(this.calx.fireEvent("beforeChangeView","week","schedule",this.calx)==false){return false;}else{this.calx.currentdate=new Date(a[0]);this.calx.currentView="week";this.calx.viewweek.render();this.calx.fireEvent("onChangeView","week","schedule",this);}}}else{if(this.headerAction=="event"){this.fireEvent("headerClick","week",a,this,this.calx);}}}},onclick_listItems:function(f,g,c){var e=g.id.replace(this.calx.id+"-eventno-","");var b=parseInt(e);var d=this.calx.store.getById(b).data;var a=this.getTaskarray(d);this.calx.fireEvent("taskDblClick",a,this,this.calx,"schedule");},onclick_taskItems:function(f,g,c){var e=g.id.replace(this.calx.id+"-shced-taskdd-","");var b=parseInt(e);var d=this.calx.store.getById(b).data;var a=this.getTaskarray(d);this.calx.fireEvent("taskDblClick",a,this,this.calx,"schedule");},neweventlaunch:function(){refdate=new Date(this.calx.currentdate);this.calx.fireEvent("taskAdd",refdate);},changeCalview:function(a){if(a==0){varview="month";}else{if(a==1){varview="week";}else{varview="day";}}this.calx.changeView(varview);},onclickprev_period:function(){refdate=new Date(this.calx.currentdate);var d=this.listbody.periodType;if(d<0||d>4){d=2;}switch(d){case 0:var f=refdate.add(Date.DAY,-1);var a=this.fireEvent("beforePeriodChange",0,refdate,f);if(a){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=f;this.datetohandle=f;this.render();myMask.hide();this.fireEvent("afterPeriodChange",0,f);}break;case 1:var b=refdate.format("W");var e=parseInt(b)-1;var c=this.calx.getDateRangeOfWeek(parseInt(b));var h=this.calx.getDateRangeOfWeek(e);var a=this.fireEvent("beforePeriodChange",1,c,h);if(a){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(h[0]);}this.calx.currentdate=h[0];this.render();this.fireEvent("afterPeriodChange",1,h);}break;case 2:var g=refdate.add(Date.MONTH,-1);var a=this.fireEvent("beforePeriodChange",2,refdate,g);if(a){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=g;this.render();this.fireEvent("afterPeriodChange",2,g);}break;case 3:var g=refdate.add(Date.MONTH,-2);var a=this.fireEvent("beforePeriodChange",3,refdate,g);if(a){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=g;this.render();this.fireEvent("afterPeriodChange",3,g);}break;case 4:var g=refdate.add(Date.MONTH,-3);var a=this.fireEvent("beforePeriodChange",4,refdate,g);if(a){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=g;this.render();this.fireEvent("afterPeriodChange",4,g);}break;}},onclicknext_period:function(){refdate=new Date(this.calx.currentdate);var d=this.listbody.periodType;if(d<0||d>4){d=2;}switch(d){case 0:var f=refdate.add(Date.DAY,+1);var a=this.fireEvent("beforePeriodChange",0,refdate,f);if(a){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=f;this.datetohandle=f;this.render();this.fireEvent("afterPeriodChange",0,f);}break;case 1:var b=refdate.format("W");var e=parseInt(b)+1;var c=this.calx.getDateRangeOfWeek(parseInt(b));var h=this.calx.getDateRangeOfWeek(e);var a=this.fireEvent("beforePeriodChange",1,c,h);if(a){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(h[0]);}this.calx.currentdate=h[0];this.render();this.fireEvent("afterPeriodChange",1,h);}break;case 2:var g=refdate.add(Date.MONTH,+1);var a=this.fireEvent("beforePeriodChange",2,refdate,g);if(a){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=g;this.render();this.fireEvent("afterPeriodChange",2,g);}break;case 3:var g=refdate.add(Date.MONTH,+2);var a=this.fireEvent("beforePeriodChange",3,refdate,g);if(a){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=g;this.render();this.fireEvent("afterPeriodChange",3,g);}break;case 4:var g=refdate.add(Date.MONTH,+3);var a=this.fireEvent("beforePeriodChange",4,refdate,g);if(a){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=g;this.render();this.fireEvent("afterPeriodChange",4,g);}break;}},getDatesforWeek:function(c){var b=new Date(c).getDay();b=((b==0)?6:b-1);var d=new Date(c.add(Date.DAY,-b).format("m/d/Y")+" "+this.listItems.periodFormats.startTime);var a=new Date(c.add(Date.DAY,-b+6).format("m/d/Y")+" "+this.listItems.periodFormats.endTime);return[d,a];},getDatesforBimonth:function(b){var c=new Date(b);var a=c.getMonth();var f=(Math.floor(a/2)+1);var d=(f*2)-1;var e=(f*2);datestarts=new Date(d+"/01/"+c.getUTCFullYear()+" "+this.listItems.periodFormats.startTime);tmpdate=new Date(e+"/01/"+c.getUTCFullYear());tmplastday=tmpdate.getLastDateOfMonth();dateends=new Date(e+"/"+tmplastday.getUTCDate()+"/"+c.getUTCFullYear()+" "+this.listItems.periodFormats.endTime);return[datestarts,dateends];},getDatesForQuarter:function(b){var d=new Date(b);var a=d.getMonth();var c=Math.floor(a/3)+1;var e=(c*3)-2;var f=(c*3);datestarts=new Date(e+"/01/"+d.getUTCFullYear()+" "+this.listItems.periodFormats.startTime);tmpdate=new Date(f+"/01/"+d.getUTCFullYear());tmplastday=tmpdate.getLastDateOfMonth();dateends=new Date(f+"/"+tmplastday.getUTCDate()+"/"+d.getUTCFullYear()+" "+this.listItems.periodFormats.endTime);return[datestarts,dateends];},getTaskarray:function(b){var a=[];a[0]=b[this.calx.fieldsRefer.id];a[1]=b[this.calx.fieldsRefer.id];a[2]=b[this.calx.fieldsRefer.subject];a[3]=b[this.calx.fieldsRefer.startdate];a[4]=b[this.calx.fieldsRefer.enddate];a[5]=b[this.calx.fieldsRefer.description];a[6]=this.calx.store.indexOfId(b[this.calx.fieldsRefer.id]);a[7]=b[this.calx.fieldsRefer.location];a[8]=b[this.calx.fieldsRefer.alldaytask];a[9]=b[this.calx.fieldsRefer.isHoliday];return a;},getHeaderLabel:function(){var h="";var a=this.listbody.periodType;if(a<0||a>4){a=2;}var c=new Date(this.calx.currentdate);switch(a){case 0:h=c.format(this.listItems.periodFormats.Day);break;case 1:var i=c.format(this.listItems.periodFormats.WeekFormat);var g=this.getDatesforWeek(c);var k={numweek:i,datestart:g[0].format(this.listItems.periodFormats.DatesFormat),dateend:g[1].format(this.listItems.periodFormats.DatesFormat)};var f=new Ext.XTemplate(this.listItems.periodFormats.WeekTPL);h=f.apply(k);break;case 2:h=c.format(this.listItems.periodFormats.Month);break;case 3:var b=new Date(c);var j=b.getMonth();var e=(Math.floor(j/2)+1);var g=this.getDatesforBimonth(c);var k={numperiod:e,datestart:g[0].format(this.listItems.periodFormats.DatesFormat),dateend:g[1].format(this.listItems.periodFormats.DatesFormat)};var f=new Ext.XTemplate(this.listItems.periodFormats.TwoMonthsTPL);h=f.apply(k);break;case 4:var b=new Date(c);var j=b.getMonth();var d=Math.floor(j/3)+1;var g=this.getDatesForQuarter(c);var k={numperiod:d,datestart:g[0].format(this.listItems.periodFormats.DatesFormat),dateend:g[1].format(this.listItems.periodFormats.DatesFormat)};var f=new Ext.XTemplate(this.listItems.periodFormats.QuarterTPL);h=f.apply(k);break;}return h;},createTasksDD:function(q,l){var s=new Date(this.calx.currentdate);var t=q.length;var g=[];for(var z=0;z<t;z++){if(this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.color]){colortask=this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.color];}else{colortask=this.listItems.taskdd_BaseColor;}var k="";if(this.listItems.taskdd_shownames){k=this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.subject];}else{k="&nbsp;";}var v='<div id="'+this.calx.id+"-shced-taskdd-"+this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.id];v+='" class="sched_taskdd_base" style="background-color:'+colortask;if(Ext.isIE){v+=";height:21px;";}v+='">';v+=k;v+="</div>";var p=l.insertHtml("beforeEnd",v,true);if(this.listItems.taskdd_showqtip){var A=new Date(this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.startdate]);var a=A.format(this.listItems.periodFormats.DatesFormat+" "+this.listItems.periodFormats.hourFormat);A=new Date(this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.enddate]);var D=A.format(this.listItems.periodFormats.DatesFormat+" "+this.listItems.periodFormats.hourFormat);p.dom.qtitle=this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.subject];if(this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.description]==""){var F="&nbsp;<br/>&nbsp;";}else{var F=this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.description];}if(F.length>this.calx.tipmaxLength){var f=F.substring(0,this.calx.tipmaxLength)+"...";}else{var f=F;}var o={starxl:e2cs.cal_locale.task_qtip_starts,startval:a,endxl:e2cs.cal_locale.task_qtip_ends,endval:D,details:f,location:this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.location]};p.dom.qtip=this.calx.tplTaskTip.apply(o);}switch(this.listbody.headerUnit){case 0:var n=new Date(this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.startdate]);var y=s.format("m/d/Y")+" "+this.listItems.periodFormats.startTime;var e=new Date(y);if(n<=e){g[0]=0;}else{mydiff_a=this.calx.dateDiff(e,n,e2cs.dateParts.MINUTE);if(mydiff_a<=0){g[0]=0;}else{g[0]=((this.listbody.headerUnitWidth*mydiff_a)/60);}}var j=new Date(this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.enddate]);var x=s.format("m/d/Y")+" "+this.listItems.periodFormats.endTime;var b=new Date(x);if(j>=b){g[1]=(l.getWidth(false)-g[0]);}else{mydiff_b=this.calx.dateDiff(n,j,e2cs.dateParts.MINUTE);mydiff_allday=this.calx.dateDiff(e,b,e2cs.dateParts.MINUTE);if(mydiff_b>=mydiff_allday){g[1]=(l.getWidth(false)-g[0]);}else{g[1]=((this.listbody.headerUnitWidth*mydiff_b)/60);}}break;case 1:if(this.listbody.periodType==1){var w=this.getDatesforWeek(s);}else{if(this.listbody.periodType==2){var d=new Date(s.format("m")+"/01/"+s.format("Y")+" "+this.listItems.periodFormats.startTime);var C=s.getLastDateOfMonth();var B=new Date(C.format("m/d/")+s.format("Y")+" "+this.listItems.periodFormats.endTime);var w=[d,B];}else{if(this.listbody.periodType==3){var w=this.getDatesforBimonth(s);}else{if(this.listbody.periodType==4){var w=this.getDatesForQuarter(s);}}}}var n=new Date(this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.startdate]);mydiff_a=this.calx.dateDiff(w[0],n,e2cs.dateParts.DAY);if(mydiff_a<=0){g[0]=0;}else{if(parseInt(n.format("j"))==mydiff_a){g[0]=((this.listbody.headerUnitWidth*(mydiff_a+1)));}else{if(w[0].add(Date.HOUR,(z)).format("m/d/Y")==n.format("m/d/Y")){g[0]=((this.listbody.headerUnitWidth*mydiff_a+1));}else{g[0]=((this.listbody.headerUnitWidth*(mydiff_a)));}}}var j=new Date(this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.enddate]);mydiff_b=this.calx.dateDiff(n,j,e2cs.dateParts.DAY);mydiff_c=this.calx.dateDiff(w[0],j,e2cs.dateParts.DAY);mydiff_allperiod=this.calx.dateDiff(w[1],j,e2cs.dateParts.DAY);if(mydiff_allperiod>=0){g[1]=(l.getWidth(false)-g[0]);}else{if(mydiff_a<0){if((this.listbody.headerUnitWidth*mydiff_c)>l.getWidth(false)){g[1]=l.getWidth(false);}else{if(parseInt(j.format("j"))==mydiff_c){g[1]=((this.listbody.headerUnitWidth*mydiff_c));}else{g[1]=this.listbody.headerUnitWidth*(mydiff_c+1);}}}else{var E=0;if(mydiff_b==0){E=mydiff_b+1;}else{if(n.format("m/d")==j.format("m/d")){E=1;}else{if(mydiff_b>0){E=mydiff_b+1;}}}g[1]=((this.listbody.headerUnitWidth*E));}}break;case 2:if(this.listbody.periodType==2){var d=new Date(s.format("m")+"/01/"+s.format("Y")+" "+this.listItems.periodFormats.startTime);var C=s.getLastDateOfMonth();var B=new Date(C.format("m/d/")+s.format("Y")+" "+this.listItems.periodFormats.endTime);var w=[d,B];}else{if(this.listbody.periodType==3){var w=this.getDatesforBimonth(s);}else{if(this.listbody.periodType==4){var w=this.getDatesForQuarter(s);}}}var r=parseInt(w[0].format("W"));var u=parseInt(w[1].format("W"));if(u!=(this.lastweekofPeriod_tmp)){u=this.lastweekofPeriod_tmp;}var n=new Date(this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.startdate]);var m=parseInt(n.format("W"));if(m<r){g[0]=0;}else{var c=(m-r);g[0]=(this.listbody.headerUnitWidth*c);}var j=new Date(this.calx.store.getAt(q[z]).data[this.calx.fieldsRefer.enddate]);var h=parseInt(j.format("W"));if(m==h){g[1]=this.listbody.headerUnitWidth;}else{if(h>u){g[1]=l.getWidth(false);}else{g[1]=this.listbody.headerUnitWidth*((h-m)+1);}}break;}if(Ext.isGecko3||Ext.isSafari||Ext.isIE){g[0]+=-1;}p.setX(Ext.get(this.calx.id+"-taskdd-container").getLeft()+g[0]);if(Ext.isIE){p.setWidth(g[1]+1);}else{p.setStyle("width",(g[1]-1)+"px");}if(this.listItems.taskdd_clsOver!=""){p.addClassOnOver(this.listItems.taskdd_clsOver);}if(this.listItems.launchEventOn!=""){p.addListener(this.listItems.launchEventOn,this.onclick_taskItems,this);}if(this.listItems.editableEvents){if(Ext.isOpera){p.addListener("mousedown",this.operabuttons_for_taskdd,this);}else{p.addListener("contextmenu",this.oncontextmenu_for_taskdd,this,{stopPropagation:true,normalized:true,preventDefault:true});}}}},genSchedbodyHeader:function(){var c="";if(Ext.isSafari){myDatatoGen="";}else{myDatatoGen='<div id="'+this.calx.id+'-container-tablehdr-sched-bdy-submain">';}myDatatoGen+='<table id="'+this.calx.id+'-table-hdr-sched-body" width="{TABLEXXW1}" border="0" cellpadding="0" cellspacing="0"><tr>';myDatatoGen+='<td width="'+this.listItems.descriptionWidth+'" valign="top">';if(Ext.isIE6||Ext.isIE7){myDatatoGen+='<div class="scheduler_header_eventslist_IE" style="width:'+this.listItems.descriptionWidth+';"><div class="sched_tab2_IE">'+this.listItems.headerTitle+"</div></div></td>";}else{myDatatoGen+='<div class="scheduler_header_eventslist" style="width:'+this.listItems.descriptionWidth+';"><div class="sched_tab2"><div class="sched_tab1">'+this.listItems.headerTitle+"</div></div></div></td>";}myDatatoGen+='<td width="{TDXXVAL2}">';if(Ext.isSafari){myDatatoGen+='<div id="'+this.calx.id+'-container_header_sched_base" style="width:{TDXXVAL2}px; overflow:hidden; overflow-x:hidden; overflow-y:auto;">';}else{if(Ext.isGecko3){myDatatoGen+='<div id="'+this.calx.id+'-container_header_sched_base" style="width:{TDXXVAL2}px; overflow:hidden;">';}else{myDatatoGen+='<div id="'+this.calx.id+'-container_header_sched_base" style="width:100%; overflow:hidden;">';}}myDatatoGen+='<div id="'+this.calx.id+'-subcontainer_sched_headers" style="width:{TDXXVAL3}px;">';myDatatoGen+='<table id="'+this.calx.id+"-table-hdr-sched-units"+'" width="{TDXXVAL3}" border="0" cellspacing="0" cellpadding="0">';if(Ext.isIE){myDatatoGen+='<tr id="'+this.calx.id+'-scheduler_row_headers"  class="sched_dayheader_base" style="height:20px;">';}else{myDatatoGen+='<tr id="'+this.calx.id+'-scheduler_row_headers"  class="sched_dayheader_base">';}if(this.listbody.headerUnit<0||this.listbody.headerUnit>2){this.listbody.headerUnit=1;}switch(this.listbody.headerUnit){case 0:if(this.listbody.headerUnitWidth<70){this.listbody.headerUnitWidth=70;}c="";var d=new Date(this.calx.currentdate);var h=new Date(d.format("m/d/Y")+" "+this.listItems.periodFormats.startTime);var e=new Date(d.format("m/d/Y")+" "+this.listItems.periodFormats.endTime);this.diffhrs=this.calx.dateDiff(h,e,e2cs.dateParts.HOUR);for(var k=0;k<=this.diffhrs;k++){var n=h.add(Date.HOUR,(k)).format(this.listItems.periodFormats.DatesFormat);var l=h.add(Date.HOUR,(k)).format("m/d/Y h:i:s");c+='<td width="'+this.listbody.headerUnitWidth+'" class="tdshx">';if(Ext.isIE){c+='<div class="sched_hdrbody_vals_IE" ';}else{c+='<div class="sched_hdrbody_vals" ';}c+='id="hour-'+this.calx.id+"-tdsched_valcols-"+k+"-"+l+'" ';c+='ext:qtitle="'+h.add(Date.HOUR,(k)).format(this.listItems.periodFormats.hourFormat);c+='" ext:qtip="'+h.add(Date.HOUR,(k)).format(this.listItems.periodFormats.DatesFormat)+'"';c+=">"+h.add(Date.HOUR,(k)).format(this.listItems.periodFormats.hourFormat)+"</div></td>";}this.numelements=k;break;case 1:var d=new Date(this.calx.currentdate);if(this.listbody.periodType==1){var b=this.getDatesforWeek(d);}else{if(this.listbody.periodType==2){var a=new Date(d.format("m")+"/01/"+d.format("Y"));var m=d.getLastDateOfMonth();var b=[a,m];}else{if(this.listbody.periodType==3){var b=this.getDatesforBimonth(d);}else{if(this.listbody.periodType==4){var b=this.getDatesForQuarter(d);}else{var a=new Date(d.format("m")+"/01/"+d.format("Y"));var m=new d.getLastDateOfMonth();var b=[a,m];}}}}var g=this.calx.dateDiff(b[0],b[1],e2cs.dateParts.DAY);h=b[0];if(this.listbody.periodType==1){g+=0;}if(this.listbody.periodType==2){g+=1;}c="";for(var k=0;k<g;k++){var f=h.add(Date.DAY,(k)).format(this.listItems.periodFormats.DayScheduler_format);var n=h.add(Date.DAY,(k)).format(this.listItems.periodFormats.DatesFormat);var l=h.add(Date.DAY,(k)).format("m/d/Y");c+='<td width="'+this.listbody.headerUnitWidth+'" class="tdshx">';c+='<div class="sched_hdrbody_vals" ';c+='id="days-'+this.calx.id+"-tdsched_valcols-"+l+'" ';c+='ext:qtitle="'+e2cs.cal_locale.scheduler_headerListStrings.Day+" "+f;c+='" ext:qtip="'+n+'"';c+=">"+f+"</div></td>";}this.numelements=k;break;case 2:var d=new Date(this.calx.currentdate);if(this.listbody.periodType==3){var b=this.getDatesforBimonth(d);}else{if(this.listbody.periodType==4){var b=this.getDatesForQuarter(d);}}diffweeks=this.calx.dateDiff(b[0],b[1],e2cs.dateParts.WEEK);initWeek=b[0].format("W");numinitWeek=parseInt(initWeek);Totalweekstoloop=(numinitWeek+diffweeks);if(this.listbody.periodType==3){Totalweekstoloop=Totalweekstoloop+2;}else{Totalweekstoloop=Totalweekstoloop+1;}c="";for(var k=numinitWeek;k<Totalweekstoloop;k++){var j=this.calx.getDateRangeOfWeek(k);var f=k;c+='<td width="'+this.listbody.headerUnitWidth+'" class="tdshx">';c+='<div id="weeks-'+this.calx.id+"-tdsched_valcols-"+f+'" class="sched_hdrbody_vals" style="width:'+this.listbody.headerUnitWidth+'px;" ';c+='ext:qtitle="'+e2cs.cal_locale.scheduler_headerListStrings.week+" "+f;c+='" ext:qtip="'+e2cs.cal_locale.scheduler_headerListStrings.week+" "+f;c+=" "+e2cs.cal_locale.scheduler_period_from_to.starts+" "+j[0].format(this.listItems.periodFormats.DatesFormat);c+=" "+e2cs.cal_locale.scheduler_period_from_to.ends+" "+j[1].format(this.listItems.periodFormats.DatesFormat);c+='"';c+=">"+f+"</div></td>";this.lastweekofPeriod_tmp=f;}if(this.listbody.periodType==3){this.numelements=diffweeks+2;}else{this.numelements=diffweeks+1;}break;}myDatatoGen+=c;myDatatoGen+="</tr></table></div></div></td></tr></table>";if(Ext.isSafari){}else{myDatatoGen+="</div>";}return myDatatoGen;},genShedContentList:function(g){var b="";b+='<div id="'+this.calx.id+'-body-sched-container-list" class="sched_container_body">';b+='<div id="'+this.calx.id+'body-sched-insider" class="sched_container_insider">';b+='<table id="'+this.calx.id+'-skeleton_sched" width="{ANCHO1TOTAL}" border="0" cellspacing="0" cellpadding="0">';var e=g.length;for(var c=0;c<e;c++){var a="";if(this.listItems.useStoreColor){a='style="background-color:'+this.calx.store.getAt(g[c]).data[this.calx.fieldsRefer.color]+';"';}else{a="";}b+='<tr id="'+this.calx.id+"-tr-list-event-"+this.calx.store.getAt(g[c]).data[this.calx.fieldsRefer.id]+'">';if(this.listItems.parentLists){if(this.calx.store.getAt(g[c]).data[this.calx.fieldsRefer.parent]){b+='<td width="{ANCHOREFLIST}" class="sched_listItem sched_childItem"><div id="'+this.calx.id+"-eventno-"+this.calx.store.getAt(g[c]).data[this.calx.fieldsRefer.id]+'" class="sched_lisItem_div" '+a+">"+this.calx.store.getAt(g[c]).data[this.calx.fieldsRefer.subject]+"</div></td>";}else{b+='<td width="{ANCHOREFLIST}" class="sched_listItem sched_parentItem"><div id="'+this.calx.id+"-eventno-"+this.calx.store.getAt(g[c]).data[this.calx.fieldsRefer.id]+'" class="sched_lisItem_div"'+a+">"+this.calx.store.getAt(g[c]).data[this.calx.fieldsRefer.subject]+"</div></td>";}}else{b+='<td width="{ANCHOREFLIST}" class="sched_listItem sched_parentItem"><div id="'+this.calx.id+"-eventno-"+this.calx.store.getAt(g[c]).data[this.calx.fieldsRefer.id]+'" class="sched_lisItem_div"'+a+">"+this.calx.store.getAt(g[c]).data[this.calx.fieldsRefer.subject]+"</div></td>";}b+="<td>";b+='<table width="{anchocolgrids}" border="0" cellspacing="0" cellpadding="0"><tr><td>';b+='<div id="'+this.calx.id+"-container_sched_rec-"+this.calx.store.getAt(g[c]).data[this.calx.fieldsRefer.id]+'" style="width:100%;">';b+='<div id="'+this.calx.id+"-subcontainer_sched_rec-"+this.calx.store.getAt(g[c]).data[this.calx.fieldsRefer.id]+'" style="width:{anchocolgrids}px;">';b+='<table width="{anchocolgrids}" border="0" cellspacing="0" cellpadding="0">';b+='<tr id="'+this.calx.id+"-scheduler_row_grid-"+this.calx.store.getAt(g[c]).data[this.calx.fieldsRefer.id]+'" class="sched_linetask'+this.listbody.headerUnitWidth+'">';var f=this.numelements;if(this.listbody.headerUnit==2){if(this.listbody.periodType==3){f+=2;}else{f+=1;}}for(var d=0;d<f;d++){b+='<td width="'+this.listbody.headerUnitWidth+'" class="tdshx_grid"><div style="height:20px;">&nbsp;</div></td>';}b+="</tr></table>";b+="</div>";b+="</div>";b+="</td></tr></table>";b+="</td>";b+="</tr>";}b+="</table>";b+='<div id="'+this.calx.id+'-taskdd-container" style="left:{ANCHOREFLIST}px; top:-{TOPcontenedorTASKS}px;width:{anchocolgrids}px;height:{TOPcontenedorTASKS}px;position:relative;float:inherit;clear:both;overflow:hidden;">';b+="{TASKSTODISPLAY}";b+="</div>";b+="</div>";b+="</div>";return b;},genShedNoContentScreen:function(){var b="";b+='<div id="'+this.calx.id+"-body-sched-no-task-screen"+'">';if(this.blankHTML!=""){var a={calx:this.calx.id,sched_addevent_id:this.calx.id+"_addevent_element_screen"};var c=new Ext.XTemplate('<tpl for=".">'+this.blankHTML+"</tpl>");b+=c.applyTemplate(a);}else{b+=e2cs.cal_locale.scheduler_noeventsonview;}b+="</div>";return b;},getTasksforPeriod:function(){var q="";var d=this.listbody.periodType;var e=new Date(this.calx.currentdate);var m=[];switch(d){case 0:q=e.format(this.listItems.periodFormats.Day);var k=new Date(e.format("m/d/Y")+" "+this.listItems.periodFormats.startTime);var f=new Date(e.format("m/d/Y")+" "+this.listItems.periodFormats.endTime);var m=[];var n=0;counttasks=this.calx.store.getCount();for(var o=0;o<counttasks;o++){var c=this.calx.store.getAt(o).data;testdateinit=this.calx.store.getAt(o).data[this.calx.fieldsRefer.startdate];testdateend=this.calx.store.getAt(o).data[this.calx.fieldsRefer.enddate];checkdates=this.datetohandle.between(new Date(testdateinit),new Date(testdateend));chkformat=this.datetohandle.format("m/d/Y");test=new Date(testdateinit);if(test.format("m/d/Y")==chkformat){checkdates=true;}test=new Date(testdateend);if(test.format("m/d/Y")==chkformat){checkdates=true;}if(checkdates){m[n]=o;n+=1;}}break;case 1:var p=this.getDatesforWeek(e);firstdayofweek=p[0];lastdayofweek=p[1];var m=[];var n=0;counttasks=this.calx.store.getCount();for(var o=0;o<counttasks;o++){dateinit=new Date(this.calx.store.getAt(o).data[this.calx.fieldsRefer.startdate]);dateend=new Date(this.calx.store.getAt(o).data[this.calx.fieldsRefer.enddate]);checkdates_a=dateinit.between(firstdayofweek,lastdayofweek);checkdates_b=dateend.between(firstdayofweek,lastdayofweek);if(dateinit.format("W")==firstdayofweek.format("W")||dateinit.format("W")==lastdayofweek.format("W")){checkdates_a=true;}if(dateend.format("W")==firstdayofweek.format("W")||dateend.format("W")==lastdayofweek.format("W")){checkdates_b=true;}if(dateinit<firstdayofweek&&dateend>lastdayofweek){checkdates_a=true;checkdates_b=true;}if(checkdates_a||checkdates_b){m[n]=o;n+=1;}}break;case 2:firstdayofmonth=new Date(e.format("m")+"/01/"+e.format("Y"));lastdaytmp=e.getLastDateOfMonth();lastdayofmonth=new Date(e.format("m")+"/"+lastdaytmp.format("d")+"/"+e.format("Y"));var m=[];var n=0;counttasks=this.calx.store.getCount();for(var o=0;o<counttasks;o++){dateinit=new Date(this.calx.store.getAt(o).data[this.calx.fieldsRefer.startdate]);dateend=new Date(this.calx.store.getAt(o).data[this.calx.fieldsRefer.enddate]);checkdates_a=dateinit.between(firstdayofmonth,lastdayofmonth);checkdates_b=dateend.between(firstdayofmonth,lastdayofmonth);if(dateinit.format("m")==firstdayofmonth.format("m")||dateinit.format("m")==lastdayofmonth.format("m")){checkdates_a=true;}if(dateend.format("m")==firstdayofmonth.format("m")||dateend.format("m")==lastdayofmonth.format("m")){checkdates_b=true;}var b=dateinit.getMonth()+1;var l=dateend.getMonth()+1;var j=e.getMonth()+1;if(b<j&&l>j){checkdates_a=true;checkdates_b=true;}if(dateinit<firstdayofmonth&&dateend>lastdayofmonth){checkdates_a=true;checkdates_b=true;}if(checkdates_a||checkdates_b){m[n]=o;n+=1;}}break;case 3:var a=new Date(e);var r=a.getMonth();var h=(Math.floor(r/2)+1);var p=this.getDatesforBimonth(e);firstdayofbim=p[0];lastdayofbim=p[1];var m=[];var n=0;counttasks=this.calx.store.getCount();for(var o=0;o<counttasks;o++){dateinit=new Date(this.calx.store.getAt(o).data[this.calx.fieldsRefer.startdate]);dateend=new Date(this.calx.store.getAt(o).data[this.calx.fieldsRefer.enddate]);checkdates_a=dateinit.between(firstdayofbim,lastdayofbim);checkdates_b=dateend.between(firstdayofbim,lastdayofbim);if(dateinit.format("m")==firstdayofbim.format("m")||dateinit.format("m")==lastdayofbim.format("m")){checkdates_a=true;}if(dateend.format("m")==firstdayofbim.format("m")||dateend.format("m")==lastdayofbim.format("m")){checkdates_b=true;}var b=dateinit.getMonth()+1;var l=dateend.getMonth()+1;var j=e.getMonth()+1;if(b<j&&l>j){checkdates_a=true;checkdates_b=true;}if(dateinit<firstdayofbim&&dateend>lastdayofbim){checkdates_a=true;checkdates_b=true;}if(checkdates_a||checkdates_b){m[n]=o;n+=1;}}break;case 4:var a=new Date(e);var r=a.getMonth();var g=Math.floor(r/3)+1;var p=this.getDatesForQuarter(e);firstdayofqua=p[0];lastdayofqua=p[1];var m=[];var n=0;counttasks=this.calx.store.getCount();for(var o=0;o<counttasks;o++){dateinit=new Date(this.calx.store.getAt(o).data[this.calx.fieldsRefer.startdate]);dateend=new Date(this.calx.store.getAt(o).data[this.calx.fieldsRefer.enddate]);checkdates_a=dateinit.between(firstdayofqua,lastdayofqua);checkdates_b=dateend.between(firstdayofqua,lastdayofqua);if(dateinit.format("m")==firstdayofqua.format("m")||dateinit.format("m")==firstdayofqua.format("m")){checkdates_a=true;}if(dateend.format("m")==lastdayofqua.format("m")||dateend.format("m")==lastdayofqua.format("m")){checkdates_b=true;}var b=dateinit.getMonth()+1;var l=dateend.getMonth()+1;var j=e.getMonth()+1;if(b<j&&l>j){checkdates_a=true;checkdates_b=true;}if(dateinit<firstdayofqua&&dateend>lastdayofqua){checkdates_a=true;checkdates_b=true;}if(dateinit>=firstdayofqua&&dateend<lastdayofqua){checkdates_a=true;checkdates_b=true;}if(dateinit>=firstdayofqua&&dateend<lastdayofqua){checkdates_a=true;checkdates_b=true;}if(checkdates_a||checkdates_b){m[n]=o;n+=1;}}break;default:q=e.format(this.headerFormat);break;}return m;}});