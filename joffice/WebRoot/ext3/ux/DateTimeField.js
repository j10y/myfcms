Ext.namespace("Cls","Cls.form","Cls.menu");Cls.form.DateTimeField=Ext.extend(Ext.form.DateField,{timeFields:"auto",availableTimeFields:["H","h","G","g","i","s"],formatMap:{g:"h",G:"H"},timeFieldHandlers:null,initComponent:function(){Cls.form.DateTimeField.superclass.initComponent.call(this);if(!this.timeFields||this.timeFields=="auto"){this.timeFields="";for(b in this.availableTimeFields){var c=this.availableTimeFields[b];if(this.format.indexOf(c)>=0){this.timeFields+=c;}}}var d=[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-form-date-trigger"}];var a=this.availableTimeFields.join("");for(var b=0;b<this.timeFields.length;b++){var c=this.timeFields.charAt(b);if(a.indexOf(c)<0){continue;}c=this.formatMap[c]||c;d.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-form-time-"+c+"-trigger"});}this.triggerConfig={tag:"span",cls:"x-form-dateTime-triggers",cn:d};},onResize:function(b,d){Ext.form.TriggerField.superclass.onResize.call(this,b,d);var c=this.trigger.getWidth()||(17*(this.timeFields.length+1));var a=this.el.getWidth();if(typeof b=="number"){a=this.adjustWidth("input",b-c);this.el.setWidth(a);}this.wrap.setWidth(a+c);},adjustWidth:function(a,b){if(typeof b=="number"&&(Ext.isIE&&(Ext.isIE6||!Ext.isStrict))&&/input|textarea/i.test(a)&&!this.inEditor){return b-3;}return b;},getTrigger:function(a){return this.triggers[a];},setMinValue:function(a){this.minValue=(typeof a=="string"?this.parseDate(a):a);if(this.menu){this.menu.picker.setMinDate(new Date(this.minValue.getTime()));}},setMaxValue:function(a){this.maxValue=(typeof a=="string"?this.parseDate(a):a);if(this.menu){this.menu.picker.setMaxDate(new Date(this.maxValue.getTime()));}},onTriggerClick:function(){if(this.disabled){return;}if(this.menu==null){this.menu=new Ext.menu.DateMenu({hideOnClick:false});}Ext.apply(this.menu.picker,{minDate:this.minValue?new Date(this.minValue.getTime()):this.minValue,maxDate:this.maxValue?new Date(this.maxValue.getTime()):this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,todayIsNow:true,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,"tl-bl?");this.menuEvents("on");},onSelect:function(a,c){var b=new Date(c.getTime());if(this.getValue()){c.setHours(this.getValue().getHours());c.setSeconds(this.getValue().getSeconds());c.setMinutes(this.getValue().getMinutes());}this.setValue(c);this.fireEvent("select",this,c);this.menu.hide();},initTrigger:function(){var a=this.trigger.select(".x-form-trigger",true);this.wrap.setStyle("overflow","hidden");this.timeFieldHandlers=new Array();var b=this;a.each(function(d,f,c){d.hide=function(){var h=b.wrap.getWidth();this.dom.style.display="none";b.el.setWidth(h-b.trigger.getWidth());};d.show=function(){var h=b.wrap.getWidth();this.dom.style.display="";b.el.setWidth(h-b.trigger.getWidth());};if(c>0){var g=b.timeFields.charAt(c-1);g=this.formatMap[g]||g;var e=new Cls.form.TimeFieldHandler({parent:this,timeField:g});d.on("click",e.onTriggerClick,e,{preventDefault:true});b.timeFieldHandlers.push(e);}else{d.on("click",this.onTriggerClick,this,{preventDefault:true});}d.addClassOnOver("x-form-trigger-over");d.addClassOnClick("x-form-trigger-click");},this);this.triggers=a.elements;},onDestroy:function(){if(this.timeFieldHandlers){for(var a=this.timeFieldHandlers.length-1;a>=0;a--){var b=this.timeFieldHandlers[a];b.destroy();this.timeFieldHandlers[a]=null;delete b;}this.timeFieldHandlers=null;}Cls.form.DateTimeField.superclass.onDestroy.call(this);},validateBlur:function(){if(!Cls.form.DateTimeField.superclass.validateBlur.call(this)){return false;}for(var a=this.timeFieldHandlers.length-1;a>=0;a--){if(!this.timeFieldHandlers[a].validateBlur()){return false;}}return true;}});Ext.reg("datetimefield",Cls.form.DateTimeField);Cls.form.TimeFieldHandler=function(a){Ext.apply(this,a);};Ext.extend(Cls.form.TimeFieldHandler,Ext.util.Observable,{parent:null,timeField:null,menu:null,onTriggerClick:function(){if(this.parent.disabled){return;}if(this.menu==null){this.menu=new Cls.menu.TimeFieldMenu({timeField:this.timeField});}Ext.apply(this.menu.picker,{minDate:this.parent.minValue,maxDate:this.parent.maxValue,minText:String.format(this.parent.minText,this.parent.formatDate(this.parent.minValue)),maxText:String.format(this.parent.maxText,this.parent.formatDate(this.parent.maxValue))});this.menu.picker.setValue(this.parent.getValue()||new Date());this.menu.show(this.parent.el,"tl-bl?");this.menuEvents("on");},menuEvents:function(a){this.menu[a]("select",this.onSelect,this);this.menu[a]("hide",this.onMenuHide,this);this.menu[a]("show",this.parent.onFocus,this);},onSelect:function(a,c){if(this.parent.getValue()){var b=new Date(this.parent.getValue().getTime());this.menu.picker.copyTimeField(c,b);this.parent.setValue(b);}else{this.parent.setValue(c);}this.parent.fireEvent("select",this,c);this.menu.hide();},onMenuHide:function(){this.parent.focus(false,60);this.menuEvents("un");},destroy:function(){if(this.menu){this.menu.destroy();}},validateBlur:function(){return !this.menu||!this.menu.isVisible();}});Cls.menu.TimeFieldMenu=Ext.extend(Ext.menu.Menu,{cls:"x-timeField-menu",enableScrolling:false,initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.strict=(Ext.isIE7&&Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20});}var a=Ext.apply({internalRender:this.strict||!Ext.isIE,ctCls:"x-menu-timeField-item"},this.initialConfig);Ext.apply(this,{plain:true,items:this.picker=Ext.ComponentMgr.create(a,"timepicker"+this.initialConfig.timeField)});this.picker.purgeListeners();Cls.menu.TimeFieldMenu.superclass.initComponent.call(this);me=this;this.relayEvents(this.picker,["select"]);},onBeforeShow:function(){},onClick:function(){if(this.hideOnClick){this.hide(true);}},onShow:function(){var a=this.picker.getEl();a.setWidth(a.getWidth());},beforeDestroy:function(){this.picker.destroy();}});Cls.TimeFieldPicker=Ext.extend(Ext.Component,{minText:"This date is before the minimum date",maxText:"This date is after the maximum date",nowText:"Now",constrainToViewport:true,initComponent:function(){Cls.TimeFieldPicker.superclass.initComponent.call(this);var a=this.value;this.value=new Date();if(a){this.value.setTime(a.getTime());}this.addEvents("select");if(this.handler){this.on("select",this.handler,this.scope||this);}},setMinDate:function(a){this.minDate=a;this.update(this.value,true);},setMaxDate:function(a){this.maxDate=a;this.update(this.value,true);},setValue:function(a){this.value=new Date();this.value.setTime(a.getTime());if(this.el){this.update(this.value,true);}},getValue:function(){return this.value;},focus:function(){if(this.el){this.update(this.activeDate);}},onRender:function(d,c){var b=['<table cellspacing="0" width="'+this.columns*25+'">','<tr><td class="x-date-middle" align="center">'+this.header+"</td></tr>",'<tr><td><table class="x-date-inner" cellspacing="0">'];b[b.length]="<tbody><tr>";for(var f=0;f<this.max;f++){if(f%this.columns==0&&f!=0){b[b.length]="</tr><tr>";}var a=(f<10)?"0"+f:""+f;b[b.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span>'+a+"</span></em></a></td>";}b.push("</tr></tbody></table></td></tr>",'</table><div class="x-date-mp"></div>');var g=document.createElement("div");g.className="x-date-picker";g.innerHTML=this.generateContent();d.dom.insertBefore(g,c);this.el=Ext.get(g);this.eventEl=Ext.get(g.firstChild);this.eventEl.on("mousewheel",this.handleMouseWheel,this);var e=new Ext.KeyNav(this.eventEl,{"left":function(h){this.update(this.activeDate.add(this.timeField,-1));},"right":function(h){this.update(this.activeDate.add(this.timeField,1));},"up":function(h){this.update(this.activeDate.add(this.timeField,-this.columns));},"down":function(h){this.update(this.activeDate.add(this.timeField,this.columns));},"enter":function(h){h.stopPropagation();return true;},scope:this});this.eventEl.on("click",this.handleDateClick,this,{delegate:"a.x-date-date"});this.el.unselectable();this.cells=this.el.select("table.x-date-inner tbody td");if(Ext.isIE){this.el.repaint();}this.update(this.value);},generateContent:function(d){var b=['<table cellspacing="0" width="'+this.columns*25+'">','<tr><td class="x-date-middle" align="center">'+this.header+"</td></tr>",'<tr><td><table class="x-date-inner" cellspacing="0">'];b[b.length]="<tbody><tr>";for(var c=0;c<this.max;c++){if(c%this.columns==0&&c!=0){b[b.length]="</tr><tr>";}var a=(c<10)?"0"+c:""+c;b[b.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span>'+a+"</span></em></a></td>";}b.push("</tr></tbody></table></td></tr>",'</table><div class="x-date-mp"></div>');return b.join("");},handleMouseWheel:function(a){var b=a.getWheelDelta();if(b>0){this.update(this.activeDate.add(this.timeField,1));a.stopEvent();}else{if(b<0){this.update(this.activeDate.add(this.timeField,-1));a.stopEvent();}}},handleDateClick:function(c,b){c.stopEvent();if(b.timeFieldValue!=undefined&&!Ext.fly(b.parentNode).hasClass("x-date-disabled")){var a=new Date(this.activeDate.getTime());this.updateTimeField(a,b.timeFieldValue);this.setValue(a);this.fireEvent("select",this,this.value);}},update:function(b,p){var g=this.activeDate;this.activeDate=b;if(!p&&g&&this.el){var n=this.extractTimeField(b);this.cells.removeClass("x-date-selected");this.cells.each(function(d){if(d.dom.firstChild.timeFieldValue==n){d.addClass("x-date-selected");setTimeout(function(){try{d.dom.firstChild.focus();}catch(i){}},50);return false;}});return;}this.cells.removeClass("x-date-selected");var o=this.cells.elements;var a=new Date();var e=this.minDate?this.minTime(this.minDate).getTime():Number.NEGATIVE_INFINITY;var k=this.maxDate?this.maxTime(this.maxDate).getTime():Number.POSITIVE_INFINITY;var h=new Date(b.getTime());var l=this;var j=function(r,d){d.title="";var i=h.getTime();var q=l.extractTimeField(h);d.firstChild.timeFieldValue=q;if(q==l.extractTimeField(a)){d.className+=" x-date-today";d.title=r.nowText;}if(q==l.extractTimeField(b)){d.className+=" x-date-selected";setTimeout(function(){try{d.firstChild.focus();}catch(s){}},50);}if(i<e){d.className=" x-date-disabled";d.title=r.minText;return;}if(i>k){d.className=" x-date-disabled";d.title=r.maxText;return;}};for(var f=0;f<this.max;f++){this.updateTimeField(h,f);o[f].className="x-date-active";j(this,o[f]);}if(!this.internalRender){var c=this.el.dom.firstChild;var m=c.offsetWidth;this.el.setWidth(m+this.el.getBorderWidth("lr"));Ext.fly(c).setWidth(m);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){c.rows[0].cells[1].style.width=(m-(c.rows[0].cells[0].offsetWidth+c.rows[0].cells[2].offsetWidth))+"px";this.secondPass=true;this.update.defer(10,this,[b]);}}},updateTimeField:Ext.emptyFn,extractTimeField:Ext.emptyFn,copyTimeField:function(a,b){this.updateTimeField(b,this.extractTimeField(a));},minTime:function(a){return new Date(Math.floor(a.getTime()/this.fieldInMillis)*this.fieldInMillis);},maxTime:function(a){return new Date((Math.floor(a.getTime()/this.fieldInMillis)+1)*this.fieldInMillis-1);}});Cls.DateHourPicker=Ext.extend(Cls.TimeFieldPicker,{max:24,columns:6,timeField:"H",header:"时",fieldInMillis:1000*60*60,updateTimeField:function(a,b){a.setHours(b);},extractTimeField:function(a){return a.getHours();}});Ext.reg("timepickerH",Cls.DateHourPicker);Cls.DateAMPMHourPicker=Ext.extend(Cls.DateHourPicker,{timeField:"h",generateContent:function(){var a=['<table cellspacing="0" width="'+this.columns*25+'">','<tr><td class="x-date-middle" align="center">'+this.header+"</td></tr>"];a.push(this.generateXMContent("AM"));a.push(this.generateXMContent("PM"));a.push('</table><div class="x-date-mp"></div>');return a.join("");},generateXMContent:function(d){var b=["<tr><td>",'<table class="x-date-inner" cellspacing="0">','<th colspan="6"><span>'+d+"</span></th>","<tbody><tr>"];for(var c=0;c<12;c++){if(c%this.columns==0&&c!=0){b[b.length]="</tr><tr>";}var a=(c<10)?"0"+c:""+c;b[b.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span>'+a+"</span></em></a></td>";}b.push("</tr></tbody></table></td></tr>");return b.join("");}});Ext.reg("timepickerh",Cls.DateAMPMHourPicker);Cls.DateMinutePicker=Ext.extend(Cls.TimeFieldPicker,{max:60,columns:10,timeField:"i",header:"分",fieldInMillis:1000*60,updateTimeField:function(a,b){a.setMinutes(b);},extractTimeField:function(a){return a.getMinutes();}});Ext.reg("timepickeri",Cls.DateMinutePicker);Cls.DateSecondPicker=Ext.extend(Cls.DateMinutePicker,{timeField:"s",header:"秒",fieldInMillis:1000,updateTimeField:function(a,b){a.setSeconds(b);},extractTimeField:function(a){return a.getSeconds();}});Ext.reg("timepickers",Cls.DateSecondPicker);